# Comparing `tmp/geofileops-0.8.0a6.tar.gz` & `tmp/geofileops-0.8.0a7.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "geofileops-0.8.0a6.tar", last modified: Mon Jul 17 15:58:49 2023, max compression
+gzip compressed data, was "geofileops-0.8.0a7.tar", last modified: Wed Jul 19 12:57:04 2023, max compression
```

## Comparing `geofileops-0.8.0a6.tar` & `geofileops-0.8.0a7.tar`

### file list

```diff
@@ -1,93 +1,93 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:49.010527 geofileops-0.8.0a6/
--rw-r--r--   0 runner    (1001) docker     (123)     1529 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/LICENSE.txt
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     3106 2023-07-17 15:58:49.010527 geofileops-0.8.0a6/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     2664 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.982526 geofileops-0.8.0a6/benchmark/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)       80 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmark_all.py
--rw-r--r--   0 runner    (1001) docker     (123)      294 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmark_geofileops.py
--rw-r--r--   0 runner    (1001) docker     (123)     5158 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmarker.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.982526 geofileops-0.8.0a6/benchmark/benchmarks/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmarks/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11083 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmarks/benchmarks_geofileops.py
--rw-r--r--   0 runner    (1001) docker     (123)     5219 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/benchmarks/testdata.py
--rw-r--r--   0 runner    (1001) docker     (123)     9213 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/benchmark/reporter.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.986526 geofileops-0.8.0a6/geofileops/
--rw-r--r--   0 runner    (1001) docker     (123)      668 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)       78 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/_compat.py
--rw-r--r--   0 runner    (1001) docker     (123)    88295 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/fileops.py
--rw-r--r--   0 runner    (1001) docker     (123)   109339 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/geoops.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.986526 geofileops-0.8.0a6/geofileops/helpers/
--rw-r--r--   0 runner    (1001) docker     (123)      110 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/helpers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3834 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/helpers/_parameter_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     7834 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/helpers/layerstyles.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.994526 geofileops-0.8.0a6/geofileops/util/
--rw-r--r--   0 runner    (1001) docker     (123)      119 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5529 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_general_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    80582 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_geoops_gpd.py
--rw-r--r--   0 runner    (1001) docker     (123)     5224 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_geoops_ogr.py
--rw-r--r--   0 runner    (1001) docker     (123)   116767 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_geoops_sql.py
--rw-r--r--   0 runner    (1001) docker     (123)     4487 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_io_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     7761 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_ogr_sql_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    20626 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_ogr_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     4882 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_processing_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    22585 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/_sqlite_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/geodataframe_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     4699 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/geofiletype.py
--rw-r--r--   0 runner    (1001) docker     (123)      628 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/geofiletypes.csv
--rw-r--r--   0 runner    (1001) docker     (123)    30857 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/geometry_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    12178 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/geoseries_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     8013 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/grid_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/util/test.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/geofileops/version.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:48.986526 geofileops-0.8.0a6/geofileops.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     3106 2023-07-17 15:58:48.000000 geofileops-0.8.0a6/geofileops.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     2456 2023-07-17 15:58:48.000000 geofileops-0.8.0a6/geofileops.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-17 15:58:48.000000 geofileops-0.8.0a6/geofileops.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)      117 2023-07-17 15:58:48.000000 geofileops-0.8.0a6/geofileops.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)       27 2023-07-17 15:58:48.000000 geofileops-0.8.0a6/geofileops.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)       96 2023-07-17 15:58:49.010527 geofileops-0.8.0a6/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     1043 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:49.002526 geofileops-0.8.0a6/tests/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 15:58:49.010527 geofileops-0.8.0a6/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)   114688 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/BEFL-kbl.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    17534 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/geofileops_testdata.qgz
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/linestring-row-trees.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   765952 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/linestring-watercourse.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/linestrings_hedges.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   106496 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/point.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   139264 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-invalid.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-no-rows.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-all.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-one.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-two+three.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   122880 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-parcel.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   126976 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-simplify-onborder-testcase.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)   143360 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-twolayers.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygon-zone.gpkg
--rw-r--r--   0 runner    (1001) docker     (123)    19428 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygonstyle.qml
--rw-r--r--   0 runner    (1001) docker     (123)     1631 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/data/polygonstyle.sld
--rw-r--r--   0 runner    (1001) docker     (123)     1111 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_general_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    48719 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofile.py
--rw-r--r--   0 runner    (1001) docker     (123)    21904 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofileops_singlelayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    44181 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofileops_singlelayer_gpd.py
--rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofileops_singlelayer_ogr.py
--rw-r--r--   0 runner    (1001) docker     (123)    19139 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofileops_singlelayer_sql.py
--rw-r--r--   0 runner    (1001) docker     (123)    47125 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofileops_twolayers.py
--rw-r--r--   0 runner    (1001) docker     (123)     1521 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geofiletype.py
--rw-r--r--   0 runner    (1001) docker     (123)    27930 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geometry_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    11588 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_geoseries_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     1041 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_grid_util.py
--rw-r--r--   0 runner    (1001) docker     (123)    12779 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     1564 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_io_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     1948 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_layerstyles.py
--rw-r--r--   0 runner    (1001) docker     (123)     4112 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_ogr_sql_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     4917 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_ogr_util.py
--rw-r--r--   0 runner    (1001) docker     (123)     2543 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_parameter_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     1439 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_processing_util.py
--rw-r--r--   0 runner    (1001) docker     (123)      942 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_spatialite.py
--rw-r--r--   0 runner    (1001) docker     (123)     4507 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_sqlite_util.py
--rw-r--r--   0 runner    (1001) docker     (123)      176 2023-07-17 15:58:37.000000 geofileops-0.8.0a6/tests/test_version.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.817308 geofileops-0.8.0a7/
+-rw-r--r--   0 runner    (1001) docker     (123)     1529 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/LICENSE.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     3106 2023-07-19 12:57:04.817308 geofileops-0.8.0a7/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     2664 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.801308 geofileops-0.8.0a7/benchmark/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)       80 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmark_all.py
+-rw-r--r--   0 runner    (1001) docker     (123)      294 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmark_geofileops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5058 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmarker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.801308 geofileops-0.8.0a7/benchmark/benchmarks/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmarks/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10954 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmarks/benchmarks_geofileops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5090 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/benchmarks/testdata.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9121 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/benchmark/reporter.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.801308 geofileops-0.8.0a7/geofileops/
+-rw-r--r--   0 runner    (1001) docker     (123)      650 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)       78 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/_compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    88730 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/fileops.py
+-rw-r--r--   0 runner    (1001) docker     (123)   109425 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/geoops.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.801308 geofileops-0.8.0a7/geofileops/helpers/
+-rw-r--r--   0 runner    (1001) docker     (123)      110 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/helpers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3834 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/helpers/_parameter_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7758 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/helpers/layerstyles.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.805308 geofileops-0.8.0a7/geofileops/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      119 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5529 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_general_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    80460 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_geoops_gpd.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5224 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_geoops_ogr.py
+-rw-r--r--   0 runner    (1001) docker     (123)   119200 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_geoops_sql.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4487 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_io_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7761 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_ogr_sql_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23060 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_ogr_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4882 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_processing_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22585 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/_sqlite_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/geodataframe_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4699 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/geofiletype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      670 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/geofiletypes.csv
+-rw-r--r--   0 runner    (1001) docker     (123)    30454 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/geometry_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12114 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/geoseries_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7981 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/grid_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/util/test.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/geofileops/version.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.801308 geofileops-0.8.0a7/geofileops.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     3106 2023-07-19 12:57:04.000000 geofileops-0.8.0a7/geofileops.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     2446 2023-07-19 12:57:04.000000 geofileops-0.8.0a7/geofileops.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-19 12:57:04.000000 geofileops-0.8.0a7/geofileops.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      120 2023-07-19 12:57:04.000000 geofileops-0.8.0a7/geofileops.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       27 2023-07-19 12:57:04.000000 geofileops-0.8.0a7/geofileops.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     3120 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-07-19 12:57:04.817308 geofileops-0.8.0a7/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     1046 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.813308 geofileops-0.8.0a7/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-19 12:57:04.817308 geofileops-0.8.0a7/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)   114688 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/BEFL-kbl.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    17534 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/geofileops_testdata.qgz
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/linestring-row-trees.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   765952 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/linestring-watercourse.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/linestrings_hedges.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   106496 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/point.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   139264 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-invalid.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-no-rows.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-all.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-one.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-two+three.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   122880 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-parcel.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   126976 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-simplify-onborder-testcase.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)   143360 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-twolayers.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    98304 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygon-zone.gpkg
+-rw-r--r--   0 runner    (1001) docker     (123)    19428 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygonstyle.qml
+-rw-r--r--   0 runner    (1001) docker     (123)     1631 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/data/polygonstyle.sld
+-rw-r--r--   0 runner    (1001) docker     (123)     1111 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_general_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    51559 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofile.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21819 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofileops_singlelayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44028 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofileops_singlelayer_gpd.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofileops_singlelayer_ogr.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22235 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofileops_singlelayer_sql.py
+-rw-r--r--   0 runner    (1001) docker     (123)    46731 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofileops_twolayers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1521 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geofiletype.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28000 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geometry_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11412 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_geoseries_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1041 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_grid_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12768 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1564 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_io_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1948 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_layerstyles.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4112 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_ogr_sql_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7509 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_ogr_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2543 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_parameter_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1439 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_processing_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)      942 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_spatialite.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4507 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_sqlite_util.py
+-rw-r--r--   0 runner    (1001) docker     (123)      176 2023-07-19 12:56:51.000000 geofileops-0.8.0a7/tests/test_version.py
```

### Comparing `geofileops-0.8.0a6/LICENSE.txt` & `geofileops-0.8.0a7/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/PKG-INFO` & `geofileops-0.8.0a7/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: geofileops
-Version: 0.8.0a6
+Version: 0.8.0a7
 Summary: Package to do spatial operations on large geo files.
 Home-page: https://github.com/geofileops/geofileops
 Author: Pieter Roggemans
 Author-email: pieter.roggemans@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: Operating System :: OS Independent
 Requires-Python: >=3.8
```

### Comparing `geofileops-0.8.0a6/README.md` & `geofileops-0.8.0a7/README.md`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/benchmark/benchmarker.py` & `geofileops-0.8.0a7/benchmark/benchmarker.py`

 * *Files 2% similar despite different names*

```diff
@@ -4,23 +4,20 @@
 """
 
 import datetime
 import importlib
 import inspect
 import logging
 from pathlib import Path
-import sys
 import tempfile
 from typing import List, Optional
 
 import pandas as pd
 
-# Add path so the benchmark packages are found
-sys.path.insert(0, str(Path(__file__).resolve().parent))
-import reporter
+from benchmark import reporter
 
 ################################################################################
 # Some init
 ################################################################################
 
 logger = logging.getLogger(__name__)
```

### Comparing `geofileops-0.8.0a6/benchmark/benchmarks/benchmarks_geofileops.py` & `geofileops-0.8.0a7/benchmark/benchmarks/benchmarks_geofileops.py`

 * *Files 0% similar despite different names*

```diff
@@ -3,21 +3,18 @@
 Module to benchmark geofileops operations.
 """
 
 from datetime import datetime
 import logging
 import multiprocessing
 from pathlib import Path
-import sys
 
 from benchmarker import RunResult
 from benchmarks import testdata
 
-# Add path so the benchmark packages are found
-sys.path.insert(0, str(Path(__file__).resolve().parent.parent.parent))
 import geofileops as gfo
 from geofileops.util import _geoops_sql
 from geofileops.util import _geoops_gpd
 
 ################################################################################
 # Some init
 ################################################################################
```

### Comparing `geofileops-0.8.0a6/benchmark/benchmarks/testdata.py` & `geofileops-0.8.0a7/benchmark/benchmarks/testdata.py`

 * *Files 2% similar despite different names*

```diff
@@ -4,22 +4,19 @@
 """
 
 import enum
 import logging
 from pathlib import Path
 import pprint
 import shutil
-import sys
 import tempfile
 from typing import Optional
 import urllib.request
 import zipfile
 
-# Add path so the benchmark packages are found
-sys.path.insert(0, str(Path(__file__).resolve().parent.parent.parent))
 import geofileops as gfo
 
 ################################################################################
 # Some inits
 ################################################################################
 
 logger = logging.getLogger(__name__)
```

### Comparing `geofileops-0.8.0a6/benchmark/reporter.py` & `geofileops-0.8.0a7/benchmark/reporter.py`

 * *Files 2% similar despite different names*

```diff
@@ -177,20 +177,16 @@
         plt.yscale(yscale)
 
     # Plot
     df.plot(ax=axs, kind=plot_kind, rot=rot, title=title, linestyle=linestyle)
 
     # Show y axes as percentages is asked
     if y_value_formatter is not None:
-        axs.yaxis.set_major_formatter(
-            plt.FuncFormatter(y_value_formatter.format)  # type: ignore
-        )
-        axs.yaxis.set_minor_formatter(
-            plt.FuncFormatter(y_value_formatter.format)  # type: ignore
-        )
+        axs.yaxis.set_major_formatter(plt.FuncFormatter(y_value_formatter.format))
+        axs.yaxis.set_minor_formatter(plt.FuncFormatter(y_value_formatter.format))
 
     # Show grid lines if specified
     if gridlines is not None:
         axs.grid(axis=gridlines, which="both")
 
     # Set different markers + print labels
     # Set different markers for each line + get mn/max values + print labels
@@ -220,15 +216,15 @@
                             xytext = (0, 5)
                             label_above_line = False
                         else:
                             xytext = (0, -15)
                             label_above_line = True
 
                         axs.annotate(
-                            text=text,  # type: ignore
+                            text=text,
                             # s=text,
                             # xy=(row.Index, row_fieldvalue),
                             xy=(index, row_fieldvalue),
                             xytext=xytext,
                             textcoords="offset points",
                             ha="center",
                         )
```

### Comparing `geofileops-0.8.0a6/geofileops/__init__.py` & `geofileops-0.8.0a7/geofileops/__init__.py`

 * *Files 17% similar despite different names*

```diff
@@ -6,17 +6,17 @@
 import geopandas._compat as gpd_compat
 
 if gpd_compat.USE_PYGEOS:
     os.environ["USE_PYGEOS"] = "1"
 else:
     os.environ["USE_PYGEOS"] = "0"
 
-from geofileops.fileops import *  # noqa: F403, F401
-from geofileops.geoops import *  # noqa: F403, F401
-from geofileops.helpers.layerstyles import *  # noqa: F403, F401
+from geofileops.fileops import *  # noqa: F403
+from geofileops.geoops import *  # noqa: F403
+from geofileops.helpers.layerstyles import *  # noqa: F403
 
 
 def _get_version():
     version_path = Path(__file__).resolve().parent / "version.txt"
     with open(version_path, mode="r") as file:
         return file.readline()
```

### Comparing `geofileops-0.8.0a6/geofileops/fileops.py` & `geofileops-0.8.0a7/geofileops/fileops.py`

 * *Files 1% similar despite different names*

```diff
@@ -191,5329 +191,5356 @@
 00000be0: 6c6f 7765 7228 2920 3d3d 2022 2e73 6870  lower() == ".shp
 00000bf0: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
 00000c00: 6e20 5b70 6174 682e 7374 656d 5d0a 0a20  n [path.stem].. 
 00000c10: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
 00000c20: 4e6f 6e65 0a20 2020 206c 6179 6572 7320  None.    layers 
 00000c30: 3d20 5b5d 0a20 2020 2074 7279 3a0a 2020  = [].    try:.  
 00000c40: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
-00000c50: 203d 2067 6461 6c2e 4f70 656e 4578 2873   = gdal.OpenEx(s
-00000c60: 7472 2870 6174 6829 290a 2020 2020 2020  tr(path)).      
-00000c70: 2020 6e62 5f6c 6179 6572 7320 3d20 6461    nb_layers = da
-00000c80: 7461 736f 7572 6365 2e47 6574 4c61 7965  tasource.GetLaye
-00000c90: 7243 6f75 6e74 2829 0a20 2020 2020 2020  rCount().       
-00000ca0: 2066 6f72 206c 6179 6572 5f69 6420 696e   for layer_id in
-00000cb0: 2072 616e 6765 286e 625f 6c61 7965 7273   range(nb_layers
-00000cc0: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00000cd0: 6174 6173 6f75 7263 655f 6c61 7965 7220  atasource_layer 
-00000ce0: 3d20 6461 7461 736f 7572 6365 2e47 6574  = datasource.Get
-00000cf0: 4c61 7965 7242 7949 6e64 6578 286c 6179  LayerByIndex(lay
-00000d00: 6572 5f69 6429 0a20 2020 2020 2020 2020  er_id).         
-00000d10: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00000d20: 2020 2020 2020 2020 6f6e 6c79 5f73 7061          only_spa
-00000d30: 7469 616c 5f6c 6179 6572 7320 6973 2046  tial_layers is F
-00000d40: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00000d50: 2020 2020 206f 7220 6461 7461 736f 7572       or datasour
-00000d60: 6365 5f6c 6179 6572 2e47 6574 4765 6f6d  ce_layer.GetGeom
-00000d70: 6574 7279 436f 6c75 6d6e 2829 2021 3d20  etryColumn() != 
-00000d80: 2222 0a20 2020 2020 2020 2020 2020 2029  "".            )
-00000d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00000da0: 2020 6c61 7965 7273 2e61 7070 656e 6428    layers.append(
-00000db0: 6461 7461 736f 7572 6365 5f6c 6179 6572  datasource_layer
-00000dc0: 2e47 6574 4e61 6d65 2829 290a 0a20 2020  .GetName())..   
-00000dd0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00000de0: 6e20 6173 2065 783a 0a20 2020 2020 2020  n as ex:.       
-00000df0: 2065 782e 6172 6773 203d 2028 6622 6c69   ex.args = (f"li
-00000e00: 7374 6c61 7965 7273 2065 7272 6f72 2066  stlayers error f
-00000e10: 6f72 207b 7061 7468 7d3a 5c6e 2020 7b65  or {path}:\n  {e
-00000e20: 787d 222c 290a 2020 2020 2020 2020 7261  x}",).        ra
-00000e30: 6973 650a 2020 2020 6669 6e61 6c6c 793a  ise.    finally:
-00000e40: 0a20 2020 2020 2020 2064 6174 6173 6f75  .        datasou
-00000e50: 7263 6520 3d20 4e6f 6e65 0a0a 2020 2020  rce = None..    
-00000e60: 7265 7475 726e 206c 6179 6572 730a 0a0a  return layers...
-00000e70: 636c 6173 7320 436f 6c75 6d6e 496e 666f  class ColumnInfo
-00000e80: 3a0a 2020 2020 2222 220a 2020 2020 4120  :.    """.    A 
-00000e90: 6461 7461 206f 626a 6563 7420 636f 6e74  data object cont
-00000ea0: 6169 6e69 6e67 206d 6574 612d 696e 666f  aining meta-info
-00000eb0: 726d 6174 696f 6e20 6162 6f75 7420 6120  rmation about a 
-00000ec0: 636f 6c75 6d6e 2e0a 0a20 2020 2041 7474  column...    Att
-00000ed0: 7269 6275 7465 733a 0a20 2020 2020 2020  ributes:.       
-00000ee0: 206e 616d 6520 2873 7472 293a 2074 6865   name (str): the
-00000ef0: 206e 616d 6520 6f66 2074 6865 2063 6f6c   name of the col
-00000f00: 756d 6e2e 0a20 2020 2020 2020 2067 6461  umn..        gda
-00000f10: 6c5f 7479 7065 2028 7374 7229 3a20 7468  l_type (str): th
-00000f20: 6520 7479 7065 206f 6620 7468 6520 636f  e type of the co
-00000f30: 6c75 6d6e 2061 6363 6f72 6469 6e67 2074  lumn according t
-00000f40: 6f20 6764 616c 2e0a 2020 2020 2020 2020  o gdal..        
-00000f50: 7769 6474 6820 2869 6e74 293a 2074 6865  width (int): the
-00000f60: 2077 6964 7468 206f 6620 7468 6520 636f   width of the co
-00000f70: 6c75 6d6e 2c20 6966 2073 7065 6369 6669  lumn, if specifi
-00000f80: 6564 2e0a 2020 2020 2222 220a 0a20 2020  ed..    """..   
-00000f90: 2064 6566 205f 5f69 6e69 745f 5f28 0a20   def __init__(. 
-00000fa0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00000fb0: 2020 2020 206e 616d 653a 2073 7472 2c0a       name: str,.
-00000fc0: 2020 2020 2020 2020 6764 616c 5f74 7970          gdal_typ
-00000fd0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-00000fe0: 7769 6474 683a 204f 7074 696f 6e61 6c5b  width: Optional[
-00000ff0: 696e 745d 2c0a 2020 2020 2020 2020 7072  int],.        pr
-00001000: 6563 6973 696f 6e3a 204f 7074 696f 6e61  ecision: Optiona
-00001010: 6c5b 696e 745d 2c0a 2020 2020 293a 0a20  l[int],.    ):. 
-00001020: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-00001030: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
-00001040: 7365 6c66 2e67 6461 6c5f 7479 7065 203d  self.gdal_type =
-00001050: 2067 6461 6c5f 7479 7065 0a20 2020 2020   gdal_type.     
-00001060: 2020 2073 656c 662e 7769 6474 6820 3d20     self.width = 
-00001070: 7769 6474 680a 2020 2020 2020 2020 7365  width.        se
-00001080: 6c66 2e70 7265 6369 7369 6f6e 203d 2070  lf.precision = p
-00001090: 7265 6369 7369 6f6e 0a0a 2020 2020 6465  recision..    de
-000010a0: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-000010b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000010c0: 2066 227b 7365 6c66 2e5f 5f63 6c61 7373   f"{self.__class
-000010d0: 5f5f 7d28 7b73 656c 662e 5f5f 6469 6374  __}({self.__dict
-000010e0: 5f5f 7d29 220a 0a0a 636c 6173 7320 4c61  __})"...class La
-000010f0: 7965 7249 6e66 6f3a 0a20 2020 2022 2222  yerInfo:.    """
-00001100: 0a20 2020 2041 2064 6174 6120 6f62 6a65  .    A data obje
-00001110: 6374 2063 6f6e 7461 696e 696e 6720 6d65  ct containing me
-00001120: 7461 2d69 6e66 6f72 6d61 7469 6f6e 2061  ta-information a
-00001130: 626f 7574 2061 206c 6179 6572 2e0a 0a20  bout a layer... 
-00001140: 2020 2041 7474 7269 6275 7465 733a 0a20     Attributes:. 
-00001150: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
-00001160: 293a 2074 6865 206e 616d 6520 6f66 2074  ): the name of t
-00001170: 6865 206c 6179 6572 2e0a 2020 2020 2020  he layer..      
-00001180: 2020 6665 6174 7572 6563 6f75 6e74 2028    featurecount (
-00001190: 696e 7429 3a20 7468 6520 6e75 6d62 6572  int): the number
-000011a0: 206f 6620 6665 6174 7572 6573 2028 726f   of features (ro
-000011b0: 7773 2920 696e 2074 6865 206c 6179 6572  ws) in the layer
-000011c0: 2e0a 2020 2020 2020 2020 746f 7461 6c5f  ..        total_
-000011d0: 626f 756e 6473 2028 5475 706c 655b 666c  bounds (Tuple[fl
-000011e0: 6f61 742c 2066 6c6f 6174 2c20 666c 6f61  oat, float, floa
-000011f0: 742c 2066 6c6f 6174 5d29 3a20 7468 6520  t, float]): the 
-00001200: 626f 756e 6469 6e67 2062 6f78 206f 660a  bounding box of.
-00001210: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00001220: 6c61 7965 723a 2028 6d69 6e78 2c20 6d69  layer: (minx, mi
-00001230: 6e79 2c20 6d61 7878 2c20 6d61 7879 292e  ny, maxx, maxy).
-00001240: 0a20 2020 2020 2020 2067 656f 6d65 7472  .        geometr
-00001250: 7963 6f6c 756d 6e20 2873 7472 293a 206e  ycolumn (str): n
-00001260: 616d 6520 6f66 2074 6865 2063 6f6c 756d  ame of the colum
-00001270: 6e20 7468 6174 2063 6f6e 7461 696e 7320  n that contains 
-00001280: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00001290: 7072 696d 6172 7920 6765 6f6d 6574 7279  primary geometry
-000012a0: 2e0a 2020 2020 2020 2020 6765 6f6d 6574  ..        geomet
-000012b0: 7279 7479 7065 6e61 6d65 2028 7374 7229  rytypename (str)
-000012c0: 3a20 7468 6520 6765 6f6d 6574 7279 2074  : the geometry t
-000012d0: 7970 6520 6e61 6d65 206f 6620 7468 6520  ype name of the 
-000012e0: 6765 6f6d 6574 7279 636f 6c75 6d6e 2e0a  geometrycolumn..
-000012f0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00001300: 7479 7065 206e 616d 6520 7265 7475 726e  type name return
-00001310: 6564 2069 7320 6f6e 6520 6f66 2074 6865  ed is one of the
-00001320: 2066 6f6c 6c6f 7769 6e67 3a20 504f 494e   following: POIN
-00001330: 542c 204d 554c 5449 504f 494e 542c 0a20  T, MULTIPOINT,. 
-00001340: 2020 2020 2020 2020 2020 204c 494e 4553             LINES
-00001350: 5452 494e 472c 204d 554c 5449 4c49 4e45  TRING, MULTILINE
-00001360: 5354 5249 4e47 2c20 504f 4c59 474f 4e2c  STRING, POLYGON,
-00001370: 204d 554c 5449 504f 4c59 474f 4e2c 2043   MULTIPOLYGON, C
-00001380: 4f4c 4c45 4354 494f 4e2e 0a20 2020 2020  OLLECTION..     
-00001390: 2020 2067 656f 6d65 7472 7974 7970 6520     geometrytype 
-000013a0: 2847 656f 6d65 7472 7954 7970 6529 3a20  (GeometryType): 
-000013b0: 7468 6520 6765 6f6d 6574 7279 2074 7970  the geometry typ
-000013c0: 6520 6f66 2074 6865 2067 656f 6d65 7472  e of the geometr
-000013d0: 7963 6f6c 756d 6e2e 0a20 2020 2020 2020  ycolumn..       
-000013e0: 2063 6f6c 756d 6e73 2028 6469 6374 293a   columns (dict):
-000013f0: 2074 6865 2063 6f6c 756d 6e73 2028 6f74   the columns (ot
-00001400: 6865 7220 7468 616e 2074 6865 2067 656f  her than the geo
-00001410: 6d65 7472 7920 636f 6c75 6d6e 2920 7468  metry column) th
-00001420: 6174 0a20 2020 2020 2020 2020 2020 2061  at.            a
-00001430: 7265 2061 7661 696c 6162 6c65 206f 6e20  re available on 
-00001440: 7468 6520 6c61 7965 7220 7769 7468 2074  the layer with t
-00001450: 6865 6972 2070 726f 7065 7274 6965 7320  heir properties 
-00001460: 6173 2061 2064 6963 742e 0a20 2020 2020  as a dict..     
-00001470: 2020 2066 6964 5f63 6f6c 756d 6e20 2873     fid_column (s
-00001480: 7472 293a 2063 6f6c 756d 6e20 6e61 6d65  tr): column name
-00001490: 206f 6620 7468 6520 4649 4420 636f 6c75   of the FID colu
-000014a0: 6d6e 2e20 4973 2022 2220 666f 7220 6669  mn. Is "" for fi
-000014b0: 6c65 2074 7970 6573 2074 6861 7420 646f  le types that do
-000014c0: 6e27 740a 2020 2020 2020 2020 2020 2020  n't.            
-000014d0: 6578 706c 6963 6974 6c79 2073 746f 7265  explicitly store
-000014e0: 2061 6e20 4649 442c 206c 696b 6520 7368   an FID, like sh
-000014f0: 6170 6566 696c 652e 0a20 2020 2020 2020  apefile..       
-00001500: 2063 7273 2028 7079 7072 6f6a 2e43 5253   crs (pyproj.CRS
-00001510: 293a 2074 6865 2073 7061 7469 616c 2072  ): the spatial r
-00001520: 6566 6572 656e 6365 206f 6620 7468 6520  eference of the 
-00001530: 6c61 7965 722e 0a20 2020 2020 2020 2065  layer..        e
-00001540: 7272 6f72 7320 284c 6973 745b 7374 725d  rrors (List[str]
-00001550: 293a 206c 6973 7420 6f66 2065 7272 6f72  ): list of error
-00001560: 7320 696e 2074 6865 206c 6179 6572 2c20  s in the layer, 
-00001570: 6567 2e20 696e 7661 6c69 6420 636f 6c75  eg. invalid colu
-00001580: 6d6e 0a20 2020 2020 2020 2020 2020 206e  mn.            n
-00001590: 616d 6573 2c2e 2e2e 0a20 2020 2022 2222  ames,....    """
-000015a0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-000015b0: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-000015c0: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
-000015d0: 7374 722c 0a20 2020 2020 2020 2066 6561  str,.        fea
-000015e0: 7475 7265 636f 756e 743a 2069 6e74 2c0a  turecount: int,.
-000015f0: 2020 2020 2020 2020 746f 7461 6c5f 626f          total_bo
-00001600: 756e 6473 3a20 5475 706c 655b 666c 6f61  unds: Tuple[floa
-00001610: 742c 2066 6c6f 6174 2c20 666c 6f61 742c  t, float, float,
-00001620: 2066 6c6f 6174 5d2c 0a20 2020 2020 2020   float],.       
-00001630: 2067 656f 6d65 7472 7963 6f6c 756d 6e3a   geometrycolumn:
-00001640: 2073 7472 2c0a 2020 2020 2020 2020 6765   str,.        ge
-00001650: 6f6d 6574 7279 7479 7065 6e61 6d65 3a20  ometrytypename: 
-00001660: 7374 722c 0a20 2020 2020 2020 2067 656f  str,.        geo
-00001670: 6d65 7472 7974 7970 653a 2047 656f 6d65  metrytype: Geome
-00001680: 7472 7954 7970 652c 0a20 2020 2020 2020  tryType,.       
-00001690: 2063 6f6c 756d 6e73 3a20 4469 6374 5b73   columns: Dict[s
-000016a0: 7472 2c20 436f 6c75 6d6e 496e 666f 5d2c  tr, ColumnInfo],
-000016b0: 0a20 2020 2020 2020 2066 6964 5f63 6f6c  .        fid_col
-000016c0: 756d 6e3a 2073 7472 2c0a 2020 2020 2020  umn: str,.      
-000016d0: 2020 6372 733a 204f 7074 696f 6e61 6c5b    crs: Optional[
-000016e0: 7079 7072 6f6a 2e43 5253 5d2c 0a20 2020  pyproj.CRS],.   
-000016f0: 2020 2020 2065 7272 6f72 733a 204c 6973       errors: Lis
-00001700: 745b 7374 725d 2c0a 2020 2020 293a 0a20  t[str],.    ):. 
-00001710: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-00001720: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
-00001730: 7365 6c66 2e66 6561 7475 7265 636f 756e  self.featurecoun
-00001740: 7420 3d20 6665 6174 7572 6563 6f75 6e74  t = featurecount
-00001750: 0a20 2020 2020 2020 2073 656c 662e 746f  .        self.to
-00001760: 7461 6c5f 626f 756e 6473 203d 2074 6f74  tal_bounds = tot
-00001770: 616c 5f62 6f75 6e64 730a 2020 2020 2020  al_bounds.      
-00001780: 2020 7365 6c66 2e67 656f 6d65 7472 7963    self.geometryc
-00001790: 6f6c 756d 6e20 3d20 6765 6f6d 6574 7279  olumn = geometry
-000017a0: 636f 6c75 6d6e 0a20 2020 2020 2020 2073  column.        s
-000017b0: 656c 662e 6765 6f6d 6574 7279 7479 7065  elf.geometrytype
-000017c0: 6e61 6d65 203d 2067 656f 6d65 7472 7974  name = geometryt
-000017d0: 7970 656e 616d 650a 2020 2020 2020 2020  ypename.        
-000017e0: 7365 6c66 2e67 656f 6d65 7472 7974 7970  self.geometrytyp
-000017f0: 6520 3d20 6765 6f6d 6574 7279 7479 7065  e = geometrytype
-00001800: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00001810: 6c75 6d6e 7320 3d20 636f 6c75 6d6e 730a  lumns = columns.
-00001820: 2020 2020 2020 2020 7365 6c66 2e66 6964          self.fid
-00001830: 5f63 6f6c 756d 6e20 3d20 6669 645f 636f  _column = fid_co
-00001840: 6c75 6d6e 0a20 2020 2020 2020 2073 656c  lumn.        sel
-00001850: 662e 6372 7320 3d20 6372 730a 2020 2020  f.crs = crs.    
-00001860: 2020 2020 7365 6c66 2e65 7272 6f72 7320      self.errors 
-00001870: 3d20 6572 726f 7273 0a0a 2020 2020 6465  = errors..    de
-00001880: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00001890: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000018a0: 2066 227b 7365 6c66 2e5f 5f63 6c61 7373   f"{self.__class
-000018b0: 5f5f 7d28 7b73 656c 662e 5f5f 6469 6374  __}({self.__dict
-000018c0: 5f5f 7d29 220a 0a0a 6465 6620 6765 745f  __})"...def get_
-000018d0: 6c61 7965 725f 6765 6f6d 6574 7279 7479  layer_geometryty
-000018e0: 7065 7328 0a20 2020 2070 6174 683a 2055  pes(.    path: U
-000018f0: 6e69 6f6e 5b73 7472 2c20 226f 732e 5061  nion[str, "os.Pa
-00001900: 7468 4c69 6b65 5b41 6e79 5d22 5d2c 206c  thLike[Any]"], l
-00001910: 6179 6572 3a20 4f70 7469 6f6e 616c 5b73  ayer: Optional[s
-00001920: 7472 5d20 3d20 4e6f 6e65 0a29 202d 3e20  tr] = None.) -> 
-00001930: 4c69 7374 5b73 7472 5d3a 0a20 2020 2022  List[str]:.    "
-00001940: 2222 0a20 2020 2047 6574 2074 6865 2067  "".    Get the g
-00001950: 656f 6d65 7472 7920 7479 7065 7320 696e  eometry types in
-00001960: 2074 6865 206c 6179 6572 2062 7920 6578   the layer by ex
-00001970: 616d 696e 696e 6720 6561 6368 2067 656f  amining each geo
-00001980: 6d65 7472 7920 696e 2074 6865 206c 6179  metry in the lay
-00001990: 6572 2e0a 0a20 2020 2054 6865 2067 656e  er...    The gen
-000019a0: 6572 616c 2067 656f 6d65 7472 7920 7479  eral geometry ty
-000019b0: 7065 206f 6620 7468 6520 6c61 7965 7220  pe of the layer 
-000019c0: 6361 6e20 6265 2064 6574 6572 6d69 6e65  can be determine
-000019d0: 6420 7573 696e 670a 2020 2020 3a6d 6574  d using.    :met
-000019e0: 683a 607e 6765 745f 6c61 7965 7269 6e66  h:`~get_layerinf
-000019f0: 6f60 2e0a 0a20 2020 2041 7267 733a 0a20  o`...    Args:. 
-00001a00: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-00001a10: 684c 696b 6529 3a20 7061 7468 2074 6f20  hLike): path to 
-00001a20: 7468 6520 6669 6c65 2074 6f20 6765 7420  the file to get 
-00001a30: 696e 666f 2061 626f 7574 0a20 2020 2020  info about.     
-00001a40: 2020 206c 6179 6572 2028 7374 7229 3a20     layer (str): 
-00001a50: 7468 6520 6c61 7965 7220 796f 7520 7761  the layer you wa
-00001a60: 6e74 2069 6e66 6f20 6162 6f75 742e 2044  nt info about. D
-00001a70: 6f65 736e 2774 206e 6565 6420 746f 2062  oesn't need to b
-00001a80: 650a 2020 2020 2020 2020 2020 2020 7370  e.            sp
-00001a90: 6563 6966 6965 6420 6966 2074 6865 7265  ecified if there
-00001aa0: 2069 7320 6f6e 6c79 206f 6e65 206c 6179   is only one lay
-00001ab0: 6572 2069 6e20 7468 6520 6765 6f66 696c  er in the geofil
-00001ac0: 652e 0a0a 2020 2020 5265 7475 726e 733a  e...    Returns:
-00001ad0: 0a20 2020 2020 2020 204c 6973 745b 7374  .        List[st
-00001ae0: 725d 3a20 7468 6520 6765 6f6d 6574 7279  r]: the geometry
-00001af0: 2074 7970 6573 2069 6e20 7468 6520 6c61   types in the la
-00001b00: 7965 722e 0a20 2020 2022 2222 0a20 2020  yer..    """.   
-00001b10: 2073 716c 5f73 746d 7420 3d20 2222 220a   sql_stmt = """.
-00001b20: 2020 2020 2020 2020 5345 4c45 4354 2044          SELECT D
-00001b30: 4953 5449 4e43 540a 2020 2020 2020 2020  ISTINCT.        
-00001b40: 2020 2020 2020 2043 4153 450a 2020 2020         CASE.    
-00001b50: 2020 2020 2020 2020 2020 2020 2057 4845               WHE
-00001b60: 4e20 4361 7374 546f 5369 6e67 6c65 287b  N CastToSingle({
-00001b70: 6765 6f6d 6574 7279 636f 6c75 6d6e 7d29  geometrycolumn})
-00001b80: 2049 5320 4e4f 5420 4e55 4c4c 2054 4845   IS NOT NULL THE
-00001b90: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
-00001ba0: 2020 2020 2020 2053 545f 4765 6f6d 6574         ST_Geomet
-00001bb0: 7279 5479 7065 2843 6173 7454 6f53 696e  ryType(CastToSin
+00000c50: 203d 2067 6461 6c2e 4f70 656e 4578 280a   = gdal.OpenEx(.
+00000c60: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+00000c70: 7061 7468 292c 206e 4f70 656e 466c 6167  path), nOpenFlag
+00000c80: 733d 6764 616c 2e4f 465f 5645 4354 4f52  s=gdal.OF_VECTOR
+00000c90: 207c 2067 6461 6c2e 4f46 5f52 4541 444f   | gdal.OF_READO
+00000ca0: 4e4c 5920 7c20 6764 616c 2e4f 465f 5348  NLY | gdal.OF_SH
+00000cb0: 4152 4544 0a20 2020 2020 2020 2029 0a20  ARED.        ). 
+00000cc0: 2020 2020 2020 206e 625f 6c61 7965 7273         nb_layers
+00000cd0: 203d 2064 6174 6173 6f75 7263 652e 4765   = datasource.Ge
+00000ce0: 744c 6179 6572 436f 756e 7428 290a 2020  tLayerCount().  
+00000cf0: 2020 2020 2020 666f 7220 6c61 7965 725f        for layer_
+00000d00: 6964 2069 6e20 7261 6e67 6528 6e62 5f6c  id in range(nb_l
+00000d10: 6179 6572 7329 3a0a 2020 2020 2020 2020  ayers):.        
+00000d20: 2020 2020 6461 7461 736f 7572 6365 5f6c      datasource_l
+00000d30: 6179 6572 203d 2064 6174 6173 6f75 7263  ayer = datasourc
+00000d40: 652e 4765 744c 6179 6572 4279 496e 6465  e.GetLayerByInde
+00000d50: 7828 6c61 7965 725f 6964 290a 2020 2020  x(layer_id).    
+00000d60: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00000d70: 2020 2020 2020 2020 2020 2020 206f 6e6c               onl
+00000d80: 795f 7370 6174 6961 6c5f 6c61 7965 7273  y_spatial_layers
+00000d90: 2069 7320 4661 6c73 650a 2020 2020 2020   is False.      
+00000da0: 2020 2020 2020 2020 2020 6f72 2064 6174            or dat
+00000db0: 6173 6f75 7263 655f 6c61 7965 722e 4765  asource_layer.Ge
+00000dc0: 7447 656f 6d65 7472 7943 6f6c 756d 6e28  tGeometryColumn(
+00000dd0: 2920 213d 2022 220a 2020 2020 2020 2020  ) != "".        
+00000de0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00000df0: 2020 2020 2020 206c 6179 6572 732e 6170         layers.ap
+00000e00: 7065 6e64 2864 6174 6173 6f75 7263 655f  pend(datasource_
+00000e10: 6c61 7965 722e 4765 744e 616d 6528 2929  layer.GetName())
+00000e20: 0a0a 2020 2020 6578 6365 7074 2045 7863  ..    except Exc
+00000e30: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
+00000e40: 2020 2020 2020 6578 2e61 7267 7320 3d20        ex.args = 
+00000e50: 2866 226c 6973 746c 6179 6572 7320 6572  (f"listlayers er
+00000e60: 726f 7220 666f 7220 7b70 6174 687d 3a5c  ror for {path}:\
+00000e70: 6e20 207b 6578 7d22 2c29 0a20 2020 2020  n  {ex}",).     
+00000e80: 2020 2072 6169 7365 0a20 2020 2066 696e     raise.    fin
+00000e90: 616c 6c79 3a0a 2020 2020 2020 2020 6461  ally:.        da
+00000ea0: 7461 736f 7572 6365 203d 204e 6f6e 650a  tasource = None.
+00000eb0: 0a20 2020 2072 6574 7572 6e20 6c61 7965  .    return laye
+00000ec0: 7273 0a0a 0a63 6c61 7373 2043 6f6c 756d  rs...class Colum
+00000ed0: 6e49 6e66 6f3a 0a20 2020 2022 2222 0a20  nInfo:.    """. 
+00000ee0: 2020 2041 2064 6174 6120 6f62 6a65 6374     A data object
+00000ef0: 2063 6f6e 7461 696e 696e 6720 6d65 7461   containing meta
+00000f00: 2d69 6e66 6f72 6d61 7469 6f6e 2061 626f  -information abo
+00000f10: 7574 2061 2063 6f6c 756d 6e2e 0a0a 2020  ut a column...  
+00000f20: 2020 4174 7472 6962 7574 6573 3a0a 2020    Attributes:.  
+00000f30: 2020 2020 2020 6e61 6d65 2028 7374 7229        name (str)
+00000f40: 3a20 7468 6520 6e61 6d65 206f 6620 7468  : the name of th
+00000f50: 6520 636f 6c75 6d6e 2e0a 2020 2020 2020  e column..      
+00000f60: 2020 6764 616c 5f74 7970 6520 2873 7472    gdal_type (str
+00000f70: 293a 2074 6865 2074 7970 6520 6f66 2074  ): the type of t
+00000f80: 6865 2063 6f6c 756d 6e20 6163 636f 7264  he column accord
+00000f90: 696e 6720 746f 2067 6461 6c2e 0a20 2020  ing to gdal..   
+00000fa0: 2020 2020 2077 6964 7468 2028 696e 7429       width (int)
+00000fb0: 3a20 7468 6520 7769 6474 6820 6f66 2074  : the width of t
+00000fc0: 6865 2063 6f6c 756d 6e2c 2069 6620 7370  he column, if sp
+00000fd0: 6563 6966 6965 642e 0a20 2020 2022 2222  ecified..    """
+00000fe0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00000ff0: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
+00001000: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+00001010: 7374 722c 0a20 2020 2020 2020 2067 6461  str,.        gda
+00001020: 6c5f 7479 7065 3a20 7374 722c 0a20 2020  l_type: str,.   
+00001030: 2020 2020 2077 6964 7468 3a20 4f70 7469       width: Opti
+00001040: 6f6e 616c 5b69 6e74 5d2c 0a20 2020 2020  onal[int],.     
+00001050: 2020 2070 7265 6369 7369 6f6e 3a20 4f70     precision: Op
+00001060: 7469 6f6e 616c 5b69 6e74 5d2c 0a20 2020  tional[int],.   
+00001070: 2029 3a0a 2020 2020 2020 2020 7365 6c66   ):.        self
+00001080: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
+00001090: 2020 2020 2073 656c 662e 6764 616c 5f74       self.gdal_t
+000010a0: 7970 6520 3d20 6764 616c 5f74 7970 650a  ype = gdal_type.
+000010b0: 2020 2020 2020 2020 7365 6c66 2e77 6964          self.wid
+000010c0: 7468 203d 2077 6964 7468 0a20 2020 2020  th = width.     
+000010d0: 2020 2073 656c 662e 7072 6563 6973 696f     self.precisio
+000010e0: 6e20 3d20 7072 6563 6973 696f 6e0a 0a20  n = precision.. 
+000010f0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00001100: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00001110: 6574 7572 6e20 6622 7b73 656c 662e 5f5f  eturn f"{self.__
+00001120: 636c 6173 735f 5f7d 287b 7365 6c66 2e5f  class__}({self._
+00001130: 5f64 6963 745f 5f7d 2922 0a0a 0a63 6c61  _dict__})"...cla
+00001140: 7373 204c 6179 6572 496e 666f 3a0a 2020  ss LayerInfo:.  
+00001150: 2020 2222 220a 2020 2020 4120 6461 7461    """.    A data
+00001160: 206f 626a 6563 7420 636f 6e74 6169 6e69   object containi
+00001170: 6e67 206d 6574 612d 696e 666f 726d 6174  ng meta-informat
+00001180: 696f 6e20 6162 6f75 7420 6120 6c61 7965  ion about a laye
+00001190: 722e 0a0a 2020 2020 4174 7472 6962 7574  r...    Attribut
+000011a0: 6573 3a0a 2020 2020 2020 2020 6e61 6d65  es:.        name
+000011b0: 2028 7374 7229 3a20 7468 6520 6e61 6d65   (str): the name
+000011c0: 206f 6620 7468 6520 6c61 7965 722e 0a20   of the layer.. 
+000011d0: 2020 2020 2020 2066 6561 7475 7265 636f         featureco
+000011e0: 756e 7420 2869 6e74 293a 2074 6865 206e  unt (int): the n
+000011f0: 756d 6265 7220 6f66 2066 6561 7475 7265  umber of feature
+00001200: 7320 2872 6f77 7329 2069 6e20 7468 6520  s (rows) in the 
+00001210: 6c61 7965 722e 0a20 2020 2020 2020 2074  layer..        t
+00001220: 6f74 616c 5f62 6f75 6e64 7320 2854 7570  otal_bounds (Tup
+00001230: 6c65 5b66 6c6f 6174 2c20 666c 6f61 742c  le[float, float,
+00001240: 2066 6c6f 6174 2c20 666c 6f61 745d 293a   float, float]):
+00001250: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
+00001260: 7820 6f66 0a20 2020 2020 2020 2020 2020  x of.           
+00001270: 2074 6865 206c 6179 6572 3a20 286d 696e   the layer: (min
+00001280: 782c 206d 696e 792c 206d 6178 782c 206d  x, miny, maxx, m
+00001290: 6178 7929 2e0a 2020 2020 2020 2020 6765  axy)..        ge
+000012a0: 6f6d 6574 7279 636f 6c75 6d6e 2028 7374  ometrycolumn (st
+000012b0: 7229 3a20 6e61 6d65 206f 6620 7468 6520  r): name of the 
+000012c0: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
+000012d0: 6169 6e73 2074 6865 0a20 2020 2020 2020  ains the.       
+000012e0: 2020 2020 2070 7269 6d61 7279 2067 656f       primary geo
+000012f0: 6d65 7472 792e 0a20 2020 2020 2020 2067  metry..        g
+00001300: 656f 6d65 7472 7974 7970 656e 616d 6520  eometrytypename 
+00001310: 2873 7472 293a 2074 6865 2067 656f 6d65  (str): the geome
+00001320: 7472 7920 7479 7065 206e 616d 6520 6f66  try type name of
+00001330: 2074 6865 2067 656f 6d65 7472 7963 6f6c   the geometrycol
+00001340: 756d 6e2e 0a20 2020 2020 2020 2020 2020  umn..           
+00001350: 2054 6865 2074 7970 6520 6e61 6d65 2072   The type name r
+00001360: 6574 7572 6e65 6420 6973 206f 6e65 206f  eturned is one o
+00001370: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
+00001380: 2050 4f49 4e54 2c20 4d55 4c54 4950 4f49   POINT, MULTIPOI
+00001390: 4e54 2c0a 2020 2020 2020 2020 2020 2020  NT,.            
+000013a0: 4c49 4e45 5354 5249 4e47 2c20 4d55 4c54  LINESTRING, MULT
+000013b0: 494c 494e 4553 5452 494e 472c 2050 4f4c  ILINESTRING, POL
+000013c0: 5947 4f4e 2c20 4d55 4c54 4950 4f4c 5947  YGON, MULTIPOLYG
+000013d0: 4f4e 2c20 434f 4c4c 4543 5449 4f4e 2e0a  ON, COLLECTION..
+000013e0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+000013f0: 7479 7065 2028 4765 6f6d 6574 7279 5479  type (GeometryTy
+00001400: 7065 293a 2074 6865 2067 656f 6d65 7472  pe): the geometr
+00001410: 7920 7479 7065 206f 6620 7468 6520 6765  y type of the ge
+00001420: 6f6d 6574 7279 636f 6c75 6d6e 2e0a 2020  ometrycolumn..  
+00001430: 2020 2020 2020 636f 6c75 6d6e 7320 2864        columns (d
+00001440: 6963 7429 3a20 7468 6520 636f 6c75 6d6e  ict): the column
+00001450: 7320 286f 7468 6572 2074 6861 6e20 7468  s (other than th
+00001460: 6520 6765 6f6d 6574 7279 2063 6f6c 756d  e geometry colum
+00001470: 6e29 2074 6861 740a 2020 2020 2020 2020  n) that.        
+00001480: 2020 2020 6172 6520 6176 6169 6c61 626c      are availabl
+00001490: 6520 6f6e 2074 6865 206c 6179 6572 2077  e on the layer w
+000014a0: 6974 6820 7468 6569 7220 7072 6f70 6572  ith their proper
+000014b0: 7469 6573 2061 7320 6120 6469 6374 2e0a  ties as a dict..
+000014c0: 2020 2020 2020 2020 6669 645f 636f 6c75          fid_colu
+000014d0: 6d6e 2028 7374 7229 3a20 636f 6c75 6d6e  mn (str): column
+000014e0: 206e 616d 6520 6f66 2074 6865 2046 4944   name of the FID
+000014f0: 2063 6f6c 756d 6e2e 2049 7320 2222 2066   column. Is "" f
+00001500: 6f72 2066 696c 6520 7479 7065 7320 7468  or file types th
+00001510: 6174 2064 6f6e 2774 0a20 2020 2020 2020  at don't.       
+00001520: 2020 2020 2065 7870 6c69 6369 746c 7920       explicitly 
+00001530: 7374 6f72 6520 616e 2046 4944 2c20 6c69  store an FID, li
+00001540: 6b65 2073 6861 7065 6669 6c65 2e0a 2020  ke shapefile..  
+00001550: 2020 2020 2020 6372 7320 2870 7970 726f        crs (pypro
+00001560: 6a2e 4352 5329 3a20 7468 6520 7370 6174  j.CRS): the spat
+00001570: 6961 6c20 7265 6665 7265 6e63 6520 6f66  ial reference of
+00001580: 2074 6865 206c 6179 6572 2e0a 2020 2020   the layer..    
+00001590: 2020 2020 6572 726f 7273 2028 4c69 7374      errors (List
+000015a0: 5b73 7472 5d29 3a20 6c69 7374 206f 6620  [str]): list of 
+000015b0: 6572 726f 7273 2069 6e20 7468 6520 6c61  errors in the la
+000015c0: 7965 722c 2065 672e 2069 6e76 616c 6964  yer, eg. invalid
+000015d0: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
+000015e0: 2020 2020 6e61 6d65 732c 2e2e 2e0a 2020      names,....  
+000015f0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00001600: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
+00001610: 2073 656c 662c 0a20 2020 2020 2020 206e   self,.        n
+00001620: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
+00001630: 2020 6665 6174 7572 6563 6f75 6e74 3a20    featurecount: 
+00001640: 696e 742c 0a20 2020 2020 2020 2074 6f74  int,.        tot
+00001650: 616c 5f62 6f75 6e64 733a 2054 7570 6c65  al_bounds: Tuple
+00001660: 5b66 6c6f 6174 2c20 666c 6f61 742c 2066  [float, float, f
+00001670: 6c6f 6174 2c20 666c 6f61 745d 2c0a 2020  loat, float],.  
+00001680: 2020 2020 2020 6765 6f6d 6574 7279 636f        geometryco
+00001690: 6c75 6d6e 3a20 7374 722c 0a20 2020 2020  lumn: str,.     
+000016a0: 2020 2067 656f 6d65 7472 7974 7970 656e     geometrytypen
+000016b0: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
+000016c0: 2020 6765 6f6d 6574 7279 7479 7065 3a20    geometrytype: 
+000016d0: 4765 6f6d 6574 7279 5479 7065 2c0a 2020  GeometryType,.  
+000016e0: 2020 2020 2020 636f 6c75 6d6e 733a 2044        columns: D
+000016f0: 6963 745b 7374 722c 2043 6f6c 756d 6e49  ict[str, ColumnI
+00001700: 6e66 6f5d 2c0a 2020 2020 2020 2020 6669  nfo],.        fi
+00001710: 645f 636f 6c75 6d6e 3a20 7374 722c 0a20  d_column: str,. 
+00001720: 2020 2020 2020 2063 7273 3a20 4f70 7469         crs: Opti
+00001730: 6f6e 616c 5b70 7970 726f 6a2e 4352 535d  onal[pyproj.CRS]
+00001740: 2c0a 2020 2020 2020 2020 6572 726f 7273  ,.        errors
+00001750: 3a20 4c69 7374 5b73 7472 5d2c 0a20 2020  : List[str],.   
+00001760: 2029 3a0a 2020 2020 2020 2020 7365 6c66   ):.        self
+00001770: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
+00001780: 2020 2020 2073 656c 662e 6665 6174 7572       self.featur
+00001790: 6563 6f75 6e74 203d 2066 6561 7475 7265  ecount = feature
+000017a0: 636f 756e 740a 2020 2020 2020 2020 7365  count.        se
+000017b0: 6c66 2e74 6f74 616c 5f62 6f75 6e64 7320  lf.total_bounds 
+000017c0: 3d20 746f 7461 6c5f 626f 756e 6473 0a20  = total_bounds. 
+000017d0: 2020 2020 2020 2073 656c 662e 6765 6f6d         self.geom
+000017e0: 6574 7279 636f 6c75 6d6e 203d 2067 656f  etrycolumn = geo
+000017f0: 6d65 7472 7963 6f6c 756d 6e0a 2020 2020  metrycolumn.    
+00001800: 2020 2020 7365 6c66 2e67 656f 6d65 7472      self.geometr
+00001810: 7974 7970 656e 616d 6520 3d20 6765 6f6d  ytypename = geom
+00001820: 6574 7279 7479 7065 6e61 6d65 0a20 2020  etrytypename.   
+00001830: 2020 2020 2073 656c 662e 6765 6f6d 6574       self.geomet
+00001840: 7279 7479 7065 203d 2067 656f 6d65 7472  rytype = geometr
+00001850: 7974 7970 650a 2020 2020 2020 2020 7365  ytype.        se
+00001860: 6c66 2e63 6f6c 756d 6e73 203d 2063 6f6c  lf.columns = col
+00001870: 756d 6e73 0a20 2020 2020 2020 2073 656c  umns.        sel
+00001880: 662e 6669 645f 636f 6c75 6d6e 203d 2066  f.fid_column = f
+00001890: 6964 5f63 6f6c 756d 6e0a 2020 2020 2020  id_column.      
+000018a0: 2020 7365 6c66 2e63 7273 203d 2063 7273    self.crs = crs
+000018b0: 0a20 2020 2020 2020 2073 656c 662e 6572  .        self.er
+000018c0: 726f 7273 203d 2065 7272 6f72 730a 0a20  rors = errors.. 
+000018d0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+000018e0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+000018f0: 6574 7572 6e20 6622 7b73 656c 662e 5f5f  eturn f"{self.__
+00001900: 636c 6173 735f 5f7d 287b 7365 6c66 2e5f  class__}({self._
+00001910: 5f64 6963 745f 5f7d 2922 0a0a 0a64 6566  _dict__})"...def
+00001920: 2067 6574 5f6c 6179 6572 5f67 656f 6d65   get_layer_geome
+00001930: 7472 7974 7970 6573 280a 2020 2020 7061  trytypes(.    pa
+00001940: 7468 3a20 556e 696f 6e5b 7374 722c 2022  th: Union[str, "
+00001950: 6f73 2e50 6174 684c 696b 655b 416e 795d  os.PathLike[Any]
+00001960: 225d 2c20 6c61 7965 723a 204f 7074 696f  "], layer: Optio
+00001970: 6e61 6c5b 7374 725d 203d 204e 6f6e 650a  nal[str] = None.
+00001980: 2920 2d3e 204c 6973 745b 7374 725d 3a0a  ) -> List[str]:.
+00001990: 2020 2020 2222 220a 2020 2020 4765 7420      """.    Get 
+000019a0: 7468 6520 6765 6f6d 6574 7279 2074 7970  the geometry typ
+000019b0: 6573 2069 6e20 7468 6520 6c61 7965 7220  es in the layer 
+000019c0: 6279 2065 7861 6d69 6e69 6e67 2065 6163  by examining eac
+000019d0: 6820 6765 6f6d 6574 7279 2069 6e20 7468  h geometry in th
+000019e0: 6520 6c61 7965 722e 0a0a 2020 2020 5468  e layer...    Th
+000019f0: 6520 6765 6e65 7261 6c20 6765 6f6d 6574  e general geomet
+00001a00: 7279 2074 7970 6520 6f66 2074 6865 206c  ry type of the l
+00001a10: 6179 6572 2063 616e 2062 6520 6465 7465  ayer can be dete
+00001a20: 726d 696e 6564 2075 7369 6e67 0a20 2020  rmined using.   
+00001a30: 203a 6d65 7468 3a60 7e67 6574 5f6c 6179   :meth:`~get_lay
+00001a40: 6572 696e 666f 602e 0a0a 2020 2020 4172  erinfo`...    Ar
+00001a50: 6773 3a0a 2020 2020 2020 2020 7061 7468  gs:.        path
+00001a60: 2028 5061 7468 4c69 6b65 293a 2070 6174   (PathLike): pat
+00001a70: 6820 746f 2074 6865 2066 696c 6520 746f  h to the file to
+00001a80: 2067 6574 2069 6e66 6f20 6162 6f75 740a   get info about.
+00001a90: 2020 2020 2020 2020 6c61 7965 7220 2873          layer (s
+00001aa0: 7472 293a 2074 6865 206c 6179 6572 2079  tr): the layer y
+00001ab0: 6f75 2077 616e 7420 696e 666f 2061 626f  ou want info abo
+00001ac0: 7574 2e20 446f 6573 6e27 7420 6e65 6564  ut. Doesn't need
+00001ad0: 2074 6f20 6265 0a20 2020 2020 2020 2020   to be.         
+00001ae0: 2020 2073 7065 6369 6669 6564 2069 6620     specified if 
+00001af0: 7468 6572 6520 6973 206f 6e6c 7920 6f6e  there is only on
+00001b00: 6520 6c61 7965 7220 696e 2074 6865 2067  e layer in the g
+00001b10: 656f 6669 6c65 2e0a 0a20 2020 2052 6574  eofile...    Ret
+00001b20: 7572 6e73 3a0a 2020 2020 2020 2020 4c69  urns:.        Li
+00001b30: 7374 5b73 7472 5d3a 2074 6865 2067 656f  st[str]: the geo
+00001b40: 6d65 7472 7920 7479 7065 7320 696e 2074  metry types in t
+00001b50: 6865 206c 6179 6572 2e0a 2020 2020 2222  he layer..    ""
+00001b60: 220a 2020 2020 7371 6c5f 7374 6d74 203d  ".    sql_stmt =
+00001b70: 2022 2222 0a20 2020 2020 2020 2053 454c   """.        SEL
+00001b80: 4543 5420 4449 5354 494e 4354 0a20 2020  ECT DISTINCT.   
+00001b90: 2020 2020 2020 2020 2020 2020 4341 5345              CASE
+00001ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001bb0: 2020 5748 454e 2043 6173 7454 6f53 696e    WHEN CastToSin
 00001bc0: 676c 6528 7b67 656f 6d65 7472 7963 6f6c  gle({geometrycol
-00001bd0: 756d 6e7d 2929 0a20 2020 2020 2020 2020  umn})).         
-00001be0: 2020 2020 2020 2020 454c 5345 2053 545f          ELSE ST_
-00001bf0: 4765 6f6d 6574 7279 5479 7065 287b 6765  GeometryType({ge
-00001c00: 6f6d 6574 7279 636f 6c75 6d6e 7d29 0a20  ometrycolumn}). 
-00001c10: 2020 2020 2020 2020 2020 2020 2020 454e                EN
-00001c20: 4420 4153 2067 656f 6d5f 7479 7065 0a20  D AS geom_type. 
-00001c30: 2020 2020 2020 2020 2046 524f 4d20 227b           FROM "{
-00001c40: 696e 7075 745f 6c61 7965 727d 2220 6c61  input_layer}" la
-00001c50: 7965 720a 2020 2020 2222 220a 2020 2020  yer.    """.    
-00001c60: 7265 7375 6c74 5f64 6620 3d20 7265 6164  result_df = read
-00001c70: 5f66 696c 6528 7061 7468 2c20 7371 6c5f  _file(path, sql_
-00001c80: 7374 6d74 3d73 716c 5f73 746d 742c 2073  stmt=sql_stmt, s
-00001c90: 716c 5f64 6961 6c65 6374 3d22 5351 4c49  ql_dialect="SQLI
-00001ca0: 5445 2229 0a20 2020 2072 6574 7572 6e20  TE").    return 
-00001cb0: 7265 7375 6c74 5f64 665b 2267 656f 6d5f  result_df["geom_
-00001cc0: 7479 7065 225d 2e74 6f5f 6c69 7374 2829  type"].to_list()
-00001cd0: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-00001ce0: 0a0a 0a64 6566 2067 6574 5f6c 6179 6572  ...def get_layer
-00001cf0: 696e 666f 280a 2020 2020 7061 7468 3a20  info(.    path: 
-00001d00: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
-00001d10: 6174 684c 696b 655b 416e 795d 225d 2c20  athLike[Any]"], 
-00001d20: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
-00001d30: 7374 725d 203d 204e 6f6e 650a 2920 2d3e  str] = None.) ->
-00001d40: 204c 6179 6572 496e 666f 3a0a 2020 2020   LayerInfo:.    
-00001d50: 2222 220a 2020 2020 4765 7420 696e 666f  """.    Get info
-00001d60: 726d 6174 696f 6e20 6162 6f75 7420 6120  rmation about a 
-00001d70: 6c61 7965 7220 696e 2074 6865 2067 656f  layer in the geo
-00001d80: 6669 6c65 2e0a 0a20 2020 2052 6169 7365  file...    Raise
-00001d90: 7320 616e 2065 7863 6570 7469 6f6e 2069  s an exception i
-00001da0: 6620 7468 6520 6c61 7965 7220 6465 6669  f the layer defi
-00001db0: 6e69 7469 6f6e 2068 6173 2065 7272 6f72  nition has error
-00001dc0: 7320 6c69 6b65 2069 6e76 616c 6964 2063  s like invalid c
-00001dd0: 6f6c 756d 6e0a 2020 2020 6e61 6d65 732c  olumn.    names,
-00001de0: 2e2e 2e0a 0a20 2020 2041 7267 733a 0a20  .....    Args:. 
-00001df0: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-00001e00: 684c 696b 6529 3a20 7061 7468 2074 6f20  hLike): path to 
-00001e10: 7468 6520 6669 6c65 2074 6f20 6765 7420  the file to get 
-00001e20: 696e 666f 2061 626f 7574 0a20 2020 2020  info about.     
-00001e30: 2020 206c 6179 6572 2028 7374 7229 3a20     layer (str): 
-00001e40: 7468 6520 6c61 7965 7220 796f 7520 7761  the layer you wa
-00001e50: 6e74 2069 6e66 6f20 6162 6f75 742e 2044  nt info about. D
-00001e60: 6f65 736e 2774 206e 6565 6420 746f 2062  oesn't need to b
-00001e70: 650a 2020 2020 2020 2020 2020 2020 7370  e.            sp
-00001e80: 6563 6966 6965 6420 6966 2074 6865 7265  ecified if there
-00001e90: 2069 7320 6f6e 6c79 206f 6e65 206c 6179   is only one lay
-00001ea0: 6572 2069 6e20 7468 6520 6765 6f66 696c  er in the geofil
-00001eb0: 652e 0a0a 2020 2020 5265 7475 726e 733a  e...    Returns:
-00001ec0: 0a20 2020 2020 2020 204c 6179 6572 496e  .        LayerIn
-00001ed0: 666f 3a20 7468 6520 696e 666f 726d 6174  fo: the informat
-00001ee0: 696f 6e20 6162 6f75 7420 7468 6520 6c61  ion about the la
-00001ef0: 7965 722e 0a20 2020 2022 2222 0a20 2020  yer..    """.   
-00001f00: 2023 2049 6e69 740a 2020 2020 7061 7468   # Init.    path
-00001f10: 203d 2050 6174 6828 7061 7468 290a 2020   = Path(path).  
-00001f20: 2020 6966 206e 6f74 2070 6174 682e 6578    if not path.ex
-00001f30: 6973 7473 2829 3a0a 2020 2020 2020 2020  ists():.        
-00001f40: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00001f50: 2866 2269 6e70 7574 5f70 6174 6820 646f  (f"input_path do
-00001f60: 6573 6e27 7420 6578 6973 743a 207b 7061  esn't exist: {pa
-00001f70: 7468 7d22 290a 0a20 2020 2069 6620 6c61  th}")..    if la
-00001f80: 7965 7220 6973 204e 6f6e 653a 0a20 2020  yer is None:.   
-00001f90: 2020 2020 206c 6179 6572 203d 2067 6574       layer = get
-00001fa0: 5f6f 6e6c 795f 6c61 7965 7228 7061 7468  _only_layer(path
-00001fb0: 290a 0a20 2020 2064 6174 6173 6f75 7263  )..    datasourc
-00001fc0: 6520 3d20 4e6f 6e65 0a20 2020 2074 7279  e = None.    try
-00001fd0: 3a0a 2020 2020 2020 2020 6461 7461 736f  :.        dataso
-00001fe0: 7572 6365 203d 2067 6461 6c2e 4f70 656e  urce = gdal.Open
-00001ff0: 4578 2873 7472 2870 6174 6829 290a 2020  Ex(str(path)).  
-00002000: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
-00002010: 5f6c 6179 6572 203d 2064 6174 6173 6f75  _layer = datasou
-00002020: 7263 652e 4765 744c 6179 6572 286c 6179  rce.GetLayer(lay
-00002030: 6572 290a 0a20 2020 2020 2020 2023 2049  er)..        # I
-00002040: 6620 7468 6520 6c61 7965 7220 646f 6573  f the layer does
-00002050: 6e27 7420 6578 6973 742c 2072 6574 7572  n't exist, retur
-00002060: 6e0a 2020 2020 2020 2020 6966 2064 6174  n.        if dat
-00002070: 6173 6f75 7263 655f 6c61 7965 7220 6973  asource_layer is
-00002080: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00002090: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000020a0: 726f 7228 6622 4c61 7965 7220 7b6c 6179  ror(f"Layer {lay
-000020b0: 6572 7d20 6e6f 7420 666f 756e 6420 696e  er} not found in
-000020c0: 2066 696c 653a 207b 7061 7468 7d22 290a   file: {path}").
-000020d0: 0a20 2020 2020 2020 2023 2047 6574 2063  .        # Get c
-000020e0: 6f6c 756d 6e20 696e 666f 0a20 2020 2020  olumn info.     
-000020f0: 2020 2063 6f6c 756d 6e73 203d 207b 7d0a     columns = {}.
-00002100: 2020 2020 2020 2020 6572 726f 7273 203d          errors =
-00002110: 205b 5d0a 2020 2020 2020 2020 6765 6f66   [].        geof
-00002120: 696c 6574 7970 6520 3d20 4765 6f66 696c  iletype = Geofil
-00002130: 6554 7970 6528 7061 7468 290a 2020 2020  eType(path).    
-00002140: 2020 2020 6c61 7965 725f 6465 666e 203d      layer_defn =
-00002150: 2064 6174 6173 6f75 7263 655f 6c61 7965   datasource_laye
-00002160: 722e 4765 744c 6179 6572 4465 666e 2829  r.GetLayerDefn()
-00002170: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00002180: 6e20 7261 6e67 6528 6c61 7965 725f 6465  n range(layer_de
-00002190: 666e 2e47 6574 4669 656c 6443 6f75 6e74  fn.GetFieldCount
-000021a0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-000021b0: 206e 616d 6520 3d20 6c61 7965 725f 6465   name = layer_de
-000021c0: 666e 2e47 6574 4669 656c 6444 6566 6e28  fn.GetFieldDefn(
-000021d0: 6929 2e47 6574 4e61 6d65 2829 0a20 2020  i).GetName().   
-000021e0: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
-000021f0: 2074 6869 6e6b 2077 6865 7468 6572 2074   think whether t
-00002200: 6865 2074 7970 6520 6e61 6d65 2073 686f  he type name sho
-00002210: 756c 6420 6265 2063 6f6e 7665 7274 6564  uld be converted
-00002220: 2074 6f20 6f74 6865 7220 6e61 6d65 730a   to other names.
-00002230: 2020 2020 2020 2020 2020 2020 6764 616c              gdal
-00002240: 5f74 7970 6520 3d20 6c61 7965 725f 6465  _type = layer_de
-00002250: 666e 2e47 6574 4669 656c 6444 6566 6e28  fn.GetFieldDefn(
-00002260: 6929 2e47 6574 5479 7065 4e61 6d65 2829  i).GetTypeName()
-00002270: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-00002280: 7468 203d 206c 6179 6572 5f64 6566 6e2e  th = layer_defn.
-00002290: 4765 7446 6965 6c64 4465 666e 2869 292e  GetFieldDefn(i).
-000022a0: 4765 7457 6964 7468 2829 0a20 2020 2020  GetWidth().     
-000022b0: 2020 2020 2020 2077 6964 7468 203d 2077         width = w
-000022c0: 6964 7468 2069 6620 7769 6474 6820 3e20  idth if width > 
-000022d0: 3020 656c 7365 204e 6f6e 650a 2020 2020  0 else None.    
-000022e0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-000022f0: 6e20 3d20 6c61 7965 725f 6465 666e 2e47  n = layer_defn.G
-00002300: 6574 4669 656c 6444 6566 6e28 6929 2e47  etFieldDefn(i).G
-00002310: 6574 5072 6563 6973 696f 6e28 290a 2020  etPrecision().  
-00002320: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00002330: 696f 6e20 3d20 7072 6563 6973 696f 6e20  ion = precision 
-00002340: 6966 2070 7265 6369 7369 6f6e 203e 2030  if precision > 0
-00002350: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-00002360: 2020 2020 2020 2069 6c6c 6567 616c 5f63         illegal_c
-00002370: 6f6c 756d 6e5f 6368 6172 7320 3d20 5b27  olumn_chars = ['
-00002380: 2227 5d0a 2020 2020 2020 2020 2020 2020  "'].            
-00002390: 666f 7220 696c 6c65 6761 6c5f 6368 6172  for illegal_char
-000023a0: 2069 6e20 696c 6c65 6761 6c5f 636f 6c75   in illegal_colu
-000023b0: 6d6e 5f63 6861 7273 3a0a 2020 2020 2020  mn_chars:.      
-000023c0: 2020 2020 2020 2020 2020 6966 2069 6c6c            if ill
-000023d0: 6567 616c 5f63 6861 7220 696e 206e 616d  egal_char in nam
-000023e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000023f0: 2020 2020 2020 2065 7272 6f72 732e 6170         errors.ap
-00002400: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-00002410: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00002420: 436f 6c75 6d6e 206e 616d 6520 7b6e 616d  Column name {nam
-00002430: 657d 2063 6f6e 7461 696e 7320 696c 6c65  e} contains ille
-00002440: 6761 6c20 6368 6172 3a20 7b69 6c6c 6567  gal char: {illeg
-00002450: 616c 5f63 6861 727d 2022 0a20 2020 2020  al_char} ".     
-00002460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002470: 2020 2066 2269 6e20 6669 6c65 207b 7061     f"in file {pa
-00002480: 7468 7d2c 206c 6179 6572 207b 6c61 7965  th}, layer {laye
-00002490: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
-000024a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000024b0: 2020 2020 2020 636f 6c75 6d6e 5f69 6e66        column_inf
-000024c0: 6f20 3d20 436f 6c75 6d6e 496e 666f 280a  o = ColumnInfo(.
-000024d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024e0: 6e61 6d65 3d6e 616d 652c 2067 6461 6c5f  name=name, gdal_
-000024f0: 7479 7065 3d67 6461 6c5f 7479 7065 2c20  type=gdal_type, 
-00002500: 7769 6474 683d 7769 6474 682c 2070 7265  width=width, pre
-00002510: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
-00002520: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00002530: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00002540: 6e73 5b6e 616d 655d 203d 2063 6f6c 756d  ns[name] = colum
-00002550: 6e5f 696e 666f 0a20 2020 2020 2020 2020  n_info.         
-00002560: 2020 2069 6620 6765 6f66 696c 6574 7970     if geofiletyp
-00002570: 6520 3d3d 2047 656f 6669 6c65 5479 7065  e == GeofileType
-00002580: 2e45 5352 4953 6861 7065 6669 6c65 3a0a  .ESRIShapefile:.
-00002590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025a0: 6966 206e 616d 652e 6361 7365 666f 6c64  if name.casefold
-000025b0: 2829 203d 3d20 2267 656f 6d65 7472 7922  () == "geometry"
-000025c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000025d0: 2020 2020 2020 6572 726f 7273 2e61 7070        errors.app
-000025e0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-000025f0: 2020 2020 2020 2020 2020 2020 2022 416e               "An
-00002600: 2061 7474 7269 6275 7465 2063 6f6c 756d   attribute colum
-00002610: 6e20 2767 656f 6d65 7472 7927 2069 7320  n 'geometry' is 
-00002620: 6e6f 7420 7375 7070 6f72 7465 6420 696e  not supported in
-00002630: 2061 2073 6861 7065 6669 6c65 220a 2020   a shapefile".  
-00002640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002650: 2020 290a 0a20 2020 2020 2020 2023 2047    )..        # G
-00002660: 6574 2067 656f 6d65 7472 7920 636f 6c75  et geometry colu
-00002670: 6d6e 2069 6e66 6f2e 2e2e 0a20 2020 2020  mn info....     
-00002680: 2020 2067 656f 6d65 7472 7974 7970 656e     geometrytypen
-00002690: 616d 6520 3d20 6764 616c 2e6f 6772 2e47  ame = gdal.ogr.G
-000026a0: 656f 6d65 7472 7954 7970 6554 6f4e 616d  eometryTypeToNam
-000026b0: 6528 6461 7461 736f 7572 6365 5f6c 6179  e(datasource_lay
-000026c0: 6572 2e47 6574 4765 6f6d 5479 7065 2829  er.GetGeomType()
-000026d0: 290a 2020 2020 2020 2020 6765 6f6d 6574  ).        geomet
-000026e0: 7279 7479 7065 6e61 6d65 203d 2067 656f  rytypename = geo
-000026f0: 6d65 7472 7974 7970 656e 616d 652e 7265  metrytypename.re
-00002700: 706c 6163 6528 2220 222c 2022 2229 2e75  place(" ", "").u
-00002710: 7070 6572 2829 0a0a 2020 2020 2020 2020  pper()..        
-00002720: 2320 466f 7220 7368 6170 6520 6669 6c65  # For shape file
-00002730: 732c 2074 6865 2064 6966 6665 7265 6e63  s, the differenc
-00002740: 6520 6265 7477 6565 6e20 7468 6520 274d  e between the 'M
-00002750: 554c 5449 2720 7661 7269 616e 7420 616e  ULTI' variant an
-00002760: 6420 7468 650a 2020 2020 2020 2020 2320  d the.        # 
-00002770: 7369 6e67 6c65 206f 6e65 2064 6f65 736e  single one doesn
-00002780: 2774 2065 7869 7374 732e 2e2e 2073 6f20  't exists... so 
-00002790: 616c 7761 7973 2072 6570 6f72 7420 4d55  always report MU
-000027a0: 4c54 4920 7661 7269 616e 7420 6279 2063  LTI variant by c
-000027b0: 6f6e 7665 6e74 696f 6e2e 0a20 2020 2020  onvention..     
-000027c0: 2020 2069 6620 4765 6f66 696c 6554 7970     if GeofileTyp
-000027d0: 6528 7061 7468 2920 3d3d 2047 656f 6669  e(path) == Geofi
-000027e0: 6c65 5479 7065 2e45 5352 4953 6861 7065  leType.ESRIShape
-000027f0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-00002800: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00002810: 2020 2020 2020 2067 656f 6d65 7472 7974         geometryt
-00002820: 7970 656e 616d 652e 7374 6172 7473 7769  ypename.startswi
-00002830: 7468 2822 504f 4c59 474f 4e22 290a 2020  th("POLYGON").  
-00002840: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00002850: 2067 656f 6d65 7472 7974 7970 656e 616d   geometrytypenam
-00002860: 652e 7374 6172 7473 7769 7468 2822 4c49  e.startswith("LI
-00002870: 4e45 5354 5249 4e47 2229 0a20 2020 2020  NESTRING").     
-00002880: 2020 2020 2020 2020 2020 206f 7220 6765             or ge
-00002890: 6f6d 6574 7279 7479 7065 6e61 6d65 2e73  ometrytypename.s
-000028a0: 7461 7274 7377 6974 6828 2250 4f49 4e54  tartswith("POINT
-000028b0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-000028c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000028d0: 2020 6765 6f6d 6574 7279 7479 7065 6e61    geometrytypena
-000028e0: 6d65 203d 2066 224d 554c 5449 7b67 656f  me = f"MULTI{geo
-000028f0: 6d65 7472 7974 7970 656e 616d 657d 220a  metrytypename}".
-00002900: 2020 2020 2020 2020 6966 2067 656f 6d65          if geome
-00002910: 7472 7974 7970 656e 616d 6520 3d3d 2022  trytypename == "
-00002920: 554e 4b4e 4f57 4e28 414e 5929 223a 0a20  UNKNOWN(ANY)":. 
-00002930: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-00002940: 7472 7974 7970 656e 616d 6520 3d20 2247  trytypename = "G
-00002950: 454f 4d45 5452 5922 0a0a 2020 2020 2020  EOMETRY"..      
-00002960: 2020 2320 4765 6f6d 6574 7279 7479 7065    # Geometrytype
-00002970: 0a20 2020 2020 2020 2069 6620 6765 6f6d  .        if geom
-00002980: 6574 7279 7479 7065 6e61 6d65 2021 3d20  etrytypename != 
-00002990: 224e 4f4e 4522 3a0a 2020 2020 2020 2020  "NONE":.        
-000029a0: 2020 2020 6765 6f6d 6574 7279 7479 7065      geometrytype
-000029b0: 203d 2047 656f 6d65 7472 7954 7970 655b   = GeometryType[
-000029c0: 6765 6f6d 6574 7279 7479 7065 6e61 6d65  geometrytypename
-000029d0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-000029e0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-000029f0: 6574 7279 7479 7065 203d 204e 6f6e 650a  etrytype = None.
-00002a00: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-00002a10: 6520 6765 6f6d 6574 7279 2074 7970 6520  e geometry type 
-00002a20: 6973 206e 6f74 204e 6f6e 652c 2066 696c  is not None, fil
-00002a30: 6c20 6f75 7420 7468 6520 6578 7472 6120  l out the extra 
-00002a40: 7072 6f70 6572 7469 6573 0a20 2020 2020  properties.     
-00002a50: 2020 2067 656f 6d65 7472 7963 6f6c 756d     geometrycolum
-00002a60: 6e20 3d20 4e6f 6e65 0a20 2020 2020 2020  n = None.       
-00002a70: 2065 7874 656e 7420 3d20 4e6f 6e65 0a20   extent = None. 
-00002a80: 2020 2020 2020 2063 7273 203d 204e 6f6e         crs = Non
-00002a90: 650a 2020 2020 2020 2020 746f 7461 6c5f  e.        total_
-00002aa0: 626f 756e 6473 203d 204e 6f6e 650a 2020  bounds = None.  
-00002ab0: 2020 2020 2020 6966 2067 656f 6d65 7472        if geometr
-00002ac0: 7974 7970 6520 6973 206e 6f74 204e 6f6e  ytype is not Non
-00002ad0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00002ae0: 2047 656f 6d65 7472 7920 636f 6c75 6d6e   Geometry column
-00002af0: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-00002b00: 2020 6765 6f6d 6574 7279 636f 6c75 6d6e    geometrycolumn
-00002b10: 203d 2064 6174 6173 6f75 7263 655f 6c61   = datasource_la
-00002b20: 7965 722e 4765 7447 656f 6d65 7472 7943  yer.GetGeometryC
-00002b30: 6f6c 756d 6e28 290a 2020 2020 2020 2020  olumn().        
-00002b40: 2020 2020 6966 2067 656f 6d65 7472 7963      if geometryc
-00002b50: 6f6c 756d 6e20 3d3d 2022 223a 0a20 2020  olumn == "":.   
-00002b60: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-00002b70: 6d65 7472 7963 6f6c 756d 6e20 3d20 2267  metrycolumn = "g
-00002b80: 656f 6d65 7472 7922 0a20 2020 2020 2020  eometry".       
-00002b90: 2020 2020 2023 2043 6f6e 7665 7274 2065       # Convert e
-00002ba0: 7874 656e 7420 2878 6d69 6e2c 2078 6d61  xtent (xmin, xma
-00002bb0: 782c 2079 6d69 6e2c 2079 6d61 7829 2074  x, ymin, ymax) t
-00002bc0: 6f20 626f 756e 6473 2028 786d 696e 2c20  o bounds (xmin, 
-00002bd0: 796d 696e 2c20 786d 6178 2c20 796d 6178  ymin, xmax, ymax
-00002be0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00002bf0: 7465 6e74 203d 2064 6174 6173 6f75 7263  tent = datasourc
-00002c00: 655f 6c61 7965 722e 4765 7445 7874 656e  e_layer.GetExten
-00002c10: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00002c20: 746f 7461 6c5f 626f 756e 6473 203d 2028  total_bounds = (
-00002c30: 6578 7465 6e74 5b30 5d2c 2065 7874 656e  extent[0], exten
-00002c40: 745b 325d 2c20 6578 7465 6e74 5b31 5d2c  t[2], extent[1],
-00002c50: 2065 7874 656e 745b 335d 290a 2020 2020   extent[3]).    
-00002c60: 2020 2020 2020 2020 2320 4352 530a 2020          # CRS.  
-00002c70: 2020 2020 2020 2020 2020 7370 6174 6961            spatia
-00002c80: 6c72 6566 203d 2064 6174 6173 6f75 7263  lref = datasourc
-00002c90: 655f 6c61 7965 722e 4765 7453 7061 7469  e_layer.GetSpati
-00002ca0: 616c 5265 6628 290a 2020 2020 2020 2020  alRef().        
-00002cb0: 2020 2020 6966 2073 7061 7469 616c 7265      if spatialre
-00002cc0: 6620 6973 206e 6f74 204e 6f6e 653a 0a20  f is not None:. 
-00002cd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002ce0: 7273 203d 2070 7970 726f 6a2e 4352 5328  rs = pyproj.CRS(
-00002cf0: 7370 6174 6961 6c72 6566 2e45 7870 6f72  spatialref.Expor
-00002d00: 7454 6f57 6b74 2829 290a 0a20 2020 2020  tToWkt())..     
-00002d10: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00002d20: 7370 6174 6961 6c20 7265 6620 6861 7320  spatial ref has 
-00002d30: 6e6f 2065 7073 672c 2074 7279 2074 6f20  no epsg, try to 
-00002d40: 6669 6e64 2063 6f72 7265 7370 6f6e 6469  find correspondi
-00002d50: 6e67 206f 6e65 0a20 2020 2020 2020 2020  ng one.         
-00002d60: 2020 2020 2020 2063 7273 5f65 7073 6720         crs_epsg 
-00002d70: 3d20 6372 732e 746f 5f65 7073 6728 290a  = crs.to_epsg().
-00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d90: 6966 2063 7273 5f65 7073 6720 6973 204e  if crs_epsg is N
-00002da0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00002db0: 2020 2020 2020 2020 2069 6620 6372 732e           if crs.
-00002dc0: 6e61 6d65 2069 6e20 5b0a 2020 2020 2020  name in [.      
+00001bd0: 756d 6e7d 2920 4953 204e 4f54 204e 554c  umn}) IS NOT NUL
+00001be0: 4c20 5448 454e 0a20 2020 2020 2020 2020  L THEN.         
+00001bf0: 2020 2020 2020 2020 2020 2020 5354 5f47              ST_G
+00001c00: 656f 6d65 7472 7954 7970 6528 4361 7374  eometryType(Cast
+00001c10: 546f 5369 6e67 6c65 287b 6765 6f6d 6574  ToSingle({geomet
+00001c20: 7279 636f 6c75 6d6e 7d29 290a 2020 2020  rycolumn})).    
+00001c30: 2020 2020 2020 2020 2020 2020 2045 4c53               ELS
+00001c40: 4520 5354 5f47 656f 6d65 7472 7954 7970  E ST_GeometryTyp
+00001c50: 6528 7b67 656f 6d65 7472 7963 6f6c 756d  e({geometrycolum
+00001c60: 6e7d 290a 2020 2020 2020 2020 2020 2020  n}).            
+00001c70: 2020 2045 4e44 2041 5320 6765 6f6d 5f74     END AS geom_t
+00001c80: 7970 650a 2020 2020 2020 2020 2020 4652  ype.          FR
+00001c90: 4f4d 2022 7b69 6e70 7574 5f6c 6179 6572  OM "{input_layer
+00001ca0: 7d22 206c 6179 6572 0a20 2020 2022 2222  }" layer.    """
+00001cb0: 0a20 2020 2072 6573 756c 745f 6466 203d  .    result_df =
+00001cc0: 2072 6561 645f 6669 6c65 2870 6174 682c   read_file(path,
+00001cd0: 2073 716c 5f73 746d 743d 7371 6c5f 7374   sql_stmt=sql_st
+00001ce0: 6d74 2c20 7371 6c5f 6469 616c 6563 743d  mt, sql_dialect=
+00001cf0: 2253 514c 4954 4522 290a 2020 2020 7265  "SQLITE").    re
+00001d00: 7475 726e 2072 6573 756c 745f 6466 5b22  turn result_df["
+00001d10: 6765 6f6d 5f74 7970 6522 5d2e 746f 5f6c  geom_type"].to_l
+00001d20: 6973 7428 290a 0a0a 6465 6620 6765 745f  ist()...def get_
+00001d30: 6c61 7965 7269 6e66 6f28 0a20 2020 2070  layerinfo(.    p
+00001d40: 6174 683a 2055 6e69 6f6e 5b73 7472 2c20  ath: Union[str, 
+00001d50: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
+00001d60: 5d22 5d2c 0a20 2020 206c 6179 6572 3a20  ]"],.    layer: 
+00001d70: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00001d80: 4e6f 6e65 2c0a 2020 2020 7261 6973 655f  None,.    raise_
+00001d90: 6f6e 5f6e 6f67 656f 6d3a 2062 6f6f 6c20  on_nogeom: bool 
+00001da0: 3d20 5472 7565 2c0a 2920 2d3e 204c 6179  = True,.) -> Lay
+00001db0: 6572 496e 666f 3a0a 2020 2020 2222 220a  erInfo:.    """.
+00001dc0: 2020 2020 4765 7420 696e 666f 726d 6174      Get informat
+00001dd0: 696f 6e20 6162 6f75 7420 6120 6c61 7965  ion about a laye
+00001de0: 7220 696e 2074 6865 2067 656f 6669 6c65  r in the geofile
+00001df0: 2e0a 0a20 2020 2052 6169 7365 7320 5661  ...    Raises Va
+00001e00: 6c75 6545 7272 6f72 2069 6620 7468 6520  lueError if the 
+00001e10: 6c61 7965 7220 6465 6669 6e69 7469 6f6e  layer definition
+00001e20: 2068 6173 2065 7272 6f72 7320 6c69 6b65   has errors like
+00001e30: 2069 6e76 616c 6964 2063 6f6c 756d 6e0a   invalid column.
+00001e40: 2020 2020 6e61 6d65 732c 2e2e 2e0a 0a20      names,..... 
+00001e50: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00001e60: 2070 6174 6820 2850 6174 684c 696b 6529   path (PathLike)
+00001e70: 3a20 7061 7468 2074 6f20 7468 6520 6669  : path to the fi
+00001e80: 6c65 2074 6f20 6765 7420 696e 666f 2061  le to get info a
+00001e90: 626f 7574 0a20 2020 2020 2020 206c 6179  bout.        lay
+00001ea0: 6572 2028 7374 722c 206f 7074 696f 6e61  er (str, optiona
+00001eb0: 6c29 3a20 7468 6520 6c61 7965 7220 796f  l): the layer yo
+00001ec0: 7520 7761 6e74 2069 6e66 6f20 6162 6f75  u want info abou
+00001ed0: 742e 2044 6f65 736e 2774 206e 6565 6420  t. Doesn't need 
+00001ee0: 746f 2062 650a 2020 2020 2020 2020 2020  to be.          
+00001ef0: 2020 7370 6563 6966 6965 6420 6966 2074    specified if t
+00001f00: 6865 7265 2069 7320 6f6e 6c79 206f 6e65  here is only one
+00001f10: 206c 6179 6572 2069 6e20 7468 6520 6765   layer in the ge
+00001f20: 6f66 696c 652e 0a20 2020 2020 2020 2072  ofile..        r
+00001f30: 6169 7365 5f6f 6e5f 6e6f 6765 6f6d 2028  aise_on_nogeom (
+00001f40: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+00001f50: 2054 7275 6520 746f 2072 6169 7365 2069   True to raise i
+00001f60: 6620 7468 6520 6c61 7965 7220 646f 6573  f the layer does
+00001f70: 6e27 7420 6861 7665 2061 0a20 2020 2020  n't have a.     
+00001f80: 2020 2020 2020 2067 656f 6d65 7472 7920         geometry 
+00001f90: 636f 6c75 6d6e 2e20 4966 2046 616c 7365  column. If False
+00001fa0: 2c20 7468 6520 7265 7475 726e 6564 204c  , the returned L
+00001fb0: 6179 6572 496e 666f 2e67 656f 6d65 7472  ayerInfo.geometr
+00001fc0: 7963 6f6c 756d 6e20 7769 6c6c 2062 650a  ycolumn will be.
+00001fd0: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
+00001fe0: 2e20 4465 6661 756c 7473 2074 6f20 5472  . Defaults to Tr
+00001ff0: 7565 2e0a 0a20 2020 2052 6574 7572 6e73  ue...    Returns
+00002000: 3a0a 2020 2020 2020 2020 4c61 7965 7249  :.        LayerI
+00002010: 6e66 6f3a 2074 6865 2069 6e66 6f72 6d61  nfo: the informa
+00002020: 7469 6f6e 2061 626f 7574 2074 6865 206c  tion about the l
+00002030: 6179 6572 2e0a 2020 2020 2222 220a 2020  ayer..    """.  
+00002040: 2020 2320 496e 6974 0a20 2020 2070 6174    # Init.    pat
+00002050: 6820 3d20 5061 7468 2870 6174 6829 0a20  h = Path(path). 
+00002060: 2020 2069 6620 6e6f 7420 7061 7468 2e65     if not path.e
+00002070: 7869 7374 7328 293a 0a20 2020 2020 2020  xists():.       
+00002080: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00002090: 7228 6622 696e 7075 745f 7061 7468 2064  r(f"input_path d
+000020a0: 6f65 736e 2774 2065 7869 7374 3a20 7b70  oesn't exist: {p
+000020b0: 6174 687d 2229 0a0a 2020 2020 6966 206c  ath}")..    if l
+000020c0: 6179 6572 2069 7320 4e6f 6e65 3a0a 2020  ayer is None:.  
+000020d0: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
+000020e0: 745f 6f6e 6c79 5f6c 6179 6572 2870 6174  t_only_layer(pat
+000020f0: 6829 0a0a 2020 2020 6461 7461 736f 7572  h)..    datasour
+00002100: 6365 203d 204e 6f6e 650a 2020 2020 7472  ce = None.    tr
+00002110: 793a 0a20 2020 2020 2020 2064 6174 6173  y:.        datas
+00002120: 6f75 7263 6520 3d20 6764 616c 2e4f 7065  ource = gdal.Ope
+00002130: 6e45 7828 7374 7228 7061 7468 2929 0a20  nEx(str(path)). 
+00002140: 2020 2020 2020 2064 6174 6173 6f75 7263         datasourc
+00002150: 655f 6c61 7965 7220 3d20 6461 7461 736f  e_layer = dataso
+00002160: 7572 6365 2e47 6574 4c61 7965 7228 6c61  urce.GetLayer(la
+00002170: 7965 7229 0a0a 2020 2020 2020 2020 2320  yer)..        # 
+00002180: 4966 2074 6865 206c 6179 6572 2064 6f65  If the layer doe
+00002190: 736e 2774 2065 7869 7374 2c20 7265 7475  sn't exist, retu
+000021a0: 726e 0a20 2020 2020 2020 2069 6620 6461  rn.        if da
+000021b0: 7461 736f 7572 6365 5f6c 6179 6572 2069  tasource_layer i
+000021c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000021d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000021e0: 7272 6f72 2866 224c 6179 6572 207b 6c61  rror(f"Layer {la
+000021f0: 7965 727d 206e 6f74 2066 6f75 6e64 2069  yer} not found i
+00002200: 6e20 6669 6c65 3a20 7b70 6174 687d 2229  n file: {path}")
+00002210: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
+00002220: 636f 6c75 6d6e 2069 6e66 6f0a 2020 2020  column info.    
+00002230: 2020 2020 636f 6c75 6d6e 7320 3d20 7b7d      columns = {}
+00002240: 0a20 2020 2020 2020 2065 7272 6f72 7320  .        errors 
+00002250: 3d20 5b5d 0a20 2020 2020 2020 2067 656f  = [].        geo
+00002260: 6669 6c65 7479 7065 203d 2047 656f 6669  filetype = Geofi
+00002270: 6c65 5479 7065 2870 6174 6829 0a20 2020  leType(path).   
+00002280: 2020 2020 206c 6179 6572 5f64 6566 6e20       layer_defn 
+00002290: 3d20 6461 7461 736f 7572 6365 5f6c 6179  = datasource_lay
+000022a0: 6572 2e47 6574 4c61 7965 7244 6566 6e28  er.GetLayerDefn(
+000022b0: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
+000022c0: 696e 2072 616e 6765 286c 6179 6572 5f64  in range(layer_d
+000022d0: 6566 6e2e 4765 7446 6965 6c64 436f 756e  efn.GetFieldCoun
+000022e0: 7428 2929 3a0a 2020 2020 2020 2020 2020  t()):.          
+000022f0: 2020 6e61 6d65 203d 206c 6179 6572 5f64    name = layer_d
+00002300: 6566 6e2e 4765 7446 6965 6c64 4465 666e  efn.GetFieldDefn
+00002310: 2869 292e 4765 744e 616d 6528 290a 2020  (i).GetName().  
+00002320: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
+00002330: 3a20 7468 696e 6b20 7768 6574 6865 7220  : think whether 
+00002340: 7468 6520 7479 7065 206e 616d 6520 7368  the type name sh
+00002350: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
+00002360: 6420 746f 206f 7468 6572 206e 616d 6573  d to other names
+00002370: 0a20 2020 2020 2020 2020 2020 2067 6461  .            gda
+00002380: 6c5f 7479 7065 203d 206c 6179 6572 5f64  l_type = layer_d
+00002390: 6566 6e2e 4765 7446 6965 6c64 4465 666e  efn.GetFieldDefn
+000023a0: 2869 292e 4765 7454 7970 654e 616d 6528  (i).GetTypeName(
+000023b0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+000023c0: 6474 6820 3d20 6c61 7965 725f 6465 666e  dth = layer_defn
+000023d0: 2e47 6574 4669 656c 6444 6566 6e28 6929  .GetFieldDefn(i)
+000023e0: 2e47 6574 5769 6474 6828 290a 2020 2020  .GetWidth().    
+000023f0: 2020 2020 2020 2020 7769 6474 6820 3d20          width = 
+00002400: 7769 6474 6820 6966 2077 6964 7468 203e  width if width >
+00002410: 2030 2065 6c73 6520 4e6f 6e65 0a20 2020   0 else None.   
+00002420: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
+00002430: 6f6e 203d 206c 6179 6572 5f64 6566 6e2e  on = layer_defn.
+00002440: 4765 7446 6965 6c64 4465 666e 2869 292e  GetFieldDefn(i).
+00002450: 4765 7450 7265 6369 7369 6f6e 2829 0a20  GetPrecision(). 
+00002460: 2020 2020 2020 2020 2020 2070 7265 6369             preci
+00002470: 7369 6f6e 203d 2070 7265 6369 7369 6f6e  sion = precision
+00002480: 2069 6620 7072 6563 6973 696f 6e20 3e20   if precision > 
+00002490: 3020 656c 7365 204e 6f6e 650a 2020 2020  0 else None.    
+000024a0: 2020 2020 2020 2020 696c 6c65 6761 6c5f          illegal_
+000024b0: 636f 6c75 6d6e 5f63 6861 7273 203d 205b  column_chars = [
+000024c0: 2722 275d 0a20 2020 2020 2020 2020 2020  '"'].           
+000024d0: 2066 6f72 2069 6c6c 6567 616c 5f63 6861   for illegal_cha
+000024e0: 7220 696e 2069 6c6c 6567 616c 5f63 6f6c  r in illegal_col
+000024f0: 756d 6e5f 6368 6172 733a 0a20 2020 2020  umn_chars:.     
+00002500: 2020 2020 2020 2020 2020 2069 6620 696c             if il
+00002510: 6c65 6761 6c5f 6368 6172 2069 6e20 6e61  legal_char in na
+00002520: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00002530: 2020 2020 2020 2020 6572 726f 7273 2e61          errors.a
+00002540: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
+00002550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00002560: 2243 6f6c 756d 6e20 6e61 6d65 207b 6e61  "Column name {na
+00002570: 6d65 7d20 636f 6e74 6169 6e73 2069 6c6c  me} contains ill
+00002580: 6567 616c 2063 6861 723a 207b 696c 6c65  egal char: {ille
+00002590: 6761 6c5f 6368 6172 7d20 220a 2020 2020  gal_char} ".    
+000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025b0: 2020 2020 6622 696e 2066 696c 6520 7b70      f"in file {p
+000025c0: 6174 687d 2c20 6c61 7965 7220 7b6c 6179  ath}, layer {lay
+000025d0: 6572 7d22 0a20 2020 2020 2020 2020 2020  er}".           
+000025e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000025f0: 2020 2020 2020 2063 6f6c 756d 6e5f 696e         column_in
+00002600: 666f 203d 2043 6f6c 756d 6e49 6e66 6f28  fo = ColumnInfo(
+00002610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002620: 206e 616d 653d 6e61 6d65 2c20 6764 616c   name=name, gdal
+00002630: 5f74 7970 653d 6764 616c 5f74 7970 652c  _type=gdal_type,
+00002640: 2077 6964 7468 3d77 6964 7468 2c20 7072   width=width, pr
+00002650: 6563 6973 696f 6e3d 7072 6563 6973 696f  ecision=precisio
+00002660: 6e0a 2020 2020 2020 2020 2020 2020 290a  n.            ).
+00002670: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00002680: 6d6e 735b 6e61 6d65 5d20 3d20 636f 6c75  mns[name] = colu
+00002690: 6d6e 5f69 6e66 6f0a 2020 2020 2020 2020  mn_info.        
+000026a0: 2020 2020 6966 2067 656f 6669 6c65 7479      if geofilety
+000026b0: 7065 203d 3d20 4765 6f66 696c 6554 7970  pe == GeofileTyp
+000026c0: 652e 4553 5249 5368 6170 6566 696c 653a  e.ESRIShapefile:
+000026d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000026e0: 2069 6620 6e61 6d65 2e63 6173 6566 6f6c   if name.casefol
+000026f0: 6428 2920 3d3d 2022 6765 6f6d 6574 7279  d() == "geometry
+00002700: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00002710: 2020 2020 2020 2065 7272 6f72 732e 6170         errors.ap
+00002720: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
+00002730: 2020 2020 2020 2020 2020 2020 2020 2241                "A
+00002740: 6e20 6174 7472 6962 7574 6520 636f 6c75  n attribute colu
+00002750: 6d6e 2027 6765 6f6d 6574 7279 2720 6973  mn 'geometry' is
+00002760: 206e 6f74 2073 7570 706f 7274 6564 2069   not supported i
+00002770: 6e20 6120 7368 6170 6566 696c 6522 0a20  n a shapefile". 
+00002780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002790: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+000027a0: 4765 7420 6765 6f6d 6574 7279 2063 6f6c  Get geometry col
+000027b0: 756d 6e20 696e 666f 2e2e 2e0a 2020 2020  umn info....    
+000027c0: 2020 2020 6765 6f6d 6574 7279 7479 7065      geometrytype
+000027d0: 6e61 6d65 203d 2067 6461 6c2e 6f67 722e  name = gdal.ogr.
+000027e0: 4765 6f6d 6574 7279 5479 7065 546f 4e61  GeometryTypeToNa
+000027f0: 6d65 2864 6174 6173 6f75 7263 655f 6c61  me(datasource_la
+00002800: 7965 722e 4765 7447 656f 6d54 7970 6528  yer.GetGeomType(
+00002810: 2929 0a20 2020 2020 2020 2067 656f 6d65  )).        geome
+00002820: 7472 7974 7970 656e 616d 6520 3d20 6765  trytypename = ge
+00002830: 6f6d 6574 7279 7479 7065 6e61 6d65 2e72  ometrytypename.r
+00002840: 6570 6c61 6365 2822 2022 2c20 2222 292e  eplace(" ", "").
+00002850: 7570 7065 7228 290a 0a20 2020 2020 2020  upper()..       
+00002860: 2023 2046 6f72 2073 6861 7065 2066 696c   # For shape fil
+00002870: 6573 2c20 7468 6520 6469 6666 6572 656e  es, the differen
+00002880: 6365 2062 6574 7765 656e 2074 6865 2027  ce between the '
+00002890: 4d55 4c54 4927 2076 6172 6961 6e74 2061  MULTI' variant a
+000028a0: 6e64 2074 6865 0a20 2020 2020 2020 2023  nd the.        #
+000028b0: 2073 696e 676c 6520 6f6e 6520 646f 6573   single one does
+000028c0: 6e27 7420 6578 6973 7473 2e2e 2e20 736f  n't exists... so
+000028d0: 2061 6c77 6179 7320 7265 706f 7274 204d   always report M
+000028e0: 554c 5449 2076 6172 6961 6e74 2062 7920  ULTI variant by 
+000028f0: 636f 6e76 656e 7469 6f6e 2e0a 2020 2020  convention..    
+00002900: 2020 2020 6966 2047 656f 6669 6c65 5479      if GeofileTy
+00002910: 7065 2870 6174 6829 203d 3d20 4765 6f66  pe(path) == Geof
+00002920: 696c 6554 7970 652e 4553 5249 5368 6170  ileType.ESRIShap
+00002930: 6566 696c 653a 0a20 2020 2020 2020 2020  efile:.         
+00002940: 2020 2069 6620 6765 6f6d 6574 7279 7479     if geometryty
+00002950: 7065 6e61 6d65 2e73 7461 7274 7377 6974  pename.startswit
+00002960: 6828 2822 504f 4c59 474f 4e22 2c20 224c  h(("POLYGON", "L
+00002970: 494e 4553 5452 494e 4722 2c20 2250 4f49  INESTRING", "POI
+00002980: 4e54 2229 293a 0a20 2020 2020 2020 2020  NT")):.         
+00002990: 2020 2020 2020 2067 656f 6d65 7472 7974         geometryt
+000029a0: 7970 656e 616d 6520 3d20 6622 4d55 4c54  ypename = f"MULT
+000029b0: 497b 6765 6f6d 6574 7279 7479 7065 6e61  I{geometrytypena
+000029c0: 6d65 7d22 0a20 2020 2020 2020 2069 6620  me}".        if 
+000029d0: 6765 6f6d 6574 7279 7479 7065 6e61 6d65  geometrytypename
+000029e0: 203d 3d20 2255 4e4b 4e4f 574e 2841 4e59   == "UNKNOWN(ANY
+000029f0: 2922 3a0a 2020 2020 2020 2020 2020 2020  )":.            
+00002a00: 6765 6f6d 6574 7279 7479 7065 6e61 6d65  geometrytypename
+00002a10: 203d 2022 4745 4f4d 4554 5259 220a 0a20   = "GEOMETRY".. 
+00002a20: 2020 2020 2020 2023 2047 656f 6d65 7472         # Geometr
+00002a30: 7974 7970 650a 2020 2020 2020 2020 6966  ytype.        if
+00002a40: 2067 656f 6d65 7472 7974 7970 656e 616d   geometrytypenam
+00002a50: 6520 213d 2022 4e4f 4e45 223a 0a20 2020  e != "NONE":.   
+00002a60: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
+00002a70: 7974 7970 6520 3d20 4765 6f6d 6574 7279  ytype = Geometry
+00002a80: 5479 7065 5b67 656f 6d65 7472 7974 7970  Type[geometrytyp
+00002a90: 656e 616d 655d 0a20 2020 2020 2020 2065  ename].        e
+00002aa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00002ab0: 2067 656f 6d65 7472 7974 7970 6520 3d20   geometrytype = 
+00002ac0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
+00002ad0: 4966 2074 6865 2067 656f 6d65 7472 7920  If the geometry 
+00002ae0: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
+00002af0: 2c20 6669 6c6c 206f 7574 2074 6865 2065  , fill out the e
+00002b00: 7874 7261 2070 726f 7065 7274 6965 730a  xtra properties.
+00002b10: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+00002b20: 636f 6c75 6d6e 203d 204e 6f6e 650a 2020  column = None.  
+00002b30: 2020 2020 2020 6578 7465 6e74 203d 204e        extent = N
+00002b40: 6f6e 650a 2020 2020 2020 2020 6372 7320  one.        crs 
+00002b50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
+00002b60: 6f74 616c 5f62 6f75 6e64 7320 3d20 4e6f  otal_bounds = No
+00002b70: 6e65 0a20 2020 2020 2020 2069 6620 6765  ne.        if ge
+00002b80: 6f6d 6574 7279 7479 7065 2069 7320 6e6f  ometrytype is no
+00002b90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00002ba0: 2020 2020 2320 4765 6f6d 6574 7279 2063      # Geometry c
+00002bb0: 6f6c 756d 6e20 6e61 6d65 0a20 2020 2020  olumn name.     
+00002bc0: 2020 2020 2020 2067 656f 6d65 7472 7963         geometryc
+00002bd0: 6f6c 756d 6e20 3d20 6461 7461 736f 7572  olumn = datasour
+00002be0: 6365 5f6c 6179 6572 2e47 6574 4765 6f6d  ce_layer.GetGeom
+00002bf0: 6574 7279 436f 6c75 6d6e 2829 0a20 2020  etryColumn().   
+00002c00: 2020 2020 2020 2020 2069 6620 6765 6f6d           if geom
+00002c10: 6574 7279 636f 6c75 6d6e 203d 3d20 2222  etrycolumn == ""
+00002c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002c30: 2020 6765 6f6d 6574 7279 636f 6c75 6d6e    geometrycolumn
+00002c40: 203d 2022 6765 6f6d 6574 7279 220a 2020   = "geometry".  
+00002c50: 2020 2020 2020 2020 2020 2320 436f 6e76            # Conv
+00002c60: 6572 7420 6578 7465 6e74 2028 786d 696e  ert extent (xmin
+00002c70: 2c20 786d 6178 2c20 796d 696e 2c20 796d  , xmax, ymin, ym
+00002c80: 6178 2920 746f 2062 6f75 6e64 7320 2878  ax) to bounds (x
+00002c90: 6d69 6e2c 2079 6d69 6e2c 2078 6d61 782c  min, ymin, xmax,
+00002ca0: 2079 6d61 7829 0a20 2020 2020 2020 2020   ymax).         
+00002cb0: 2020 2065 7874 656e 7420 3d20 6461 7461     extent = data
+00002cc0: 736f 7572 6365 5f6c 6179 6572 2e47 6574  source_layer.Get
+00002cd0: 4578 7465 6e74 2829 0a20 2020 2020 2020  Extent().       
+00002ce0: 2020 2020 2074 6f74 616c 5f62 6f75 6e64       total_bound
+00002cf0: 7320 3d20 2865 7874 656e 745b 305d 2c20  s = (extent[0], 
+00002d00: 6578 7465 6e74 5b32 5d2c 2065 7874 656e  extent[2], exten
+00002d10: 745b 315d 2c20 6578 7465 6e74 5b33 5d29  t[1], extent[3])
+00002d20: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00002d30: 5253 0a20 2020 2020 2020 2020 2020 2073  RS.            s
+00002d40: 7061 7469 616c 7265 6620 3d20 6461 7461  patialref = data
+00002d50: 736f 7572 6365 5f6c 6179 6572 2e47 6574  source_layer.Get
+00002d60: 5370 6174 6961 6c52 6566 2829 0a20 2020  SpatialRef().   
+00002d70: 2020 2020 2020 2020 2069 6620 7370 6174           if spat
+00002d80: 6961 6c72 6566 2069 7320 6e6f 7420 4e6f  ialref is not No
+00002d90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00002da0: 2020 2020 6372 7320 3d20 7079 7072 6f6a      crs = pyproj
+00002db0: 2e43 5253 2873 7061 7469 616c 7265 662e  .CRS(spatialref.
+00002dc0: 4578 706f 7274 546f 576b 7428 2929 0a0a  ExportToWkt())..
 00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002de0: 2020 2242 656c 6765 2031 3937 3220 2f20    "Belge 1972 / 
-00002df0: 4265 6c67 6961 6e20 4c61 6d62 6572 7420  Belgian Lambert 
-00002e00: 3732 222c 0a20 2020 2020 2020 2020 2020  72",.           
-00002e10: 2020 2020 2020 2020 2020 2020 2022 4265               "Be
-00002e20: 6c67 655f 3139 3732 5f42 656c 6769 616e  lge_1972_Belgian
-00002e30: 5f4c 616d 6265 7274 5f37 3222 2c0a 2020  _Lambert_72",.  
-00002e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e50: 2020 2020 2020 2242 656c 6765 5f4c 616d        "Belge_Lam
-00002e60: 6265 7274 5f31 3937 3222 2c0a 2020 2020  bert_1972",.    
-00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e80: 2020 2020 2242 4437 3220 2f20 4265 6c67      "BD72 / Belg
-00002e90: 6961 6e20 4c61 6d62 6572 7420 3732 222c  ian Lambert 72",
-00002ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002eb0: 2020 2020 205d 3a0a 2020 2020 2020 2020       ]:.        
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ed0: 2320 4265 6c67 6961 6e20 4c61 6d62 6572  # Belgian Lamber
-00002ee0: 7420 696e 206e 616d 652c 2073 6f20 6173  t in name, so as
-00002ef0: 7375 6d65 2033 3133 3730 0a20 2020 2020  sume 31370.     
-00002f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f10: 2020 2063 7273 203d 2070 7970 726f 6a2e     crs = pyproj.
-00002f20: 4352 532e 6672 6f6d 5f65 7073 6728 3331  CRS.from_epsg(31
-00002f30: 3337 3029 0a0a 2020 2020 2020 2020 2020  370)..          
-00002f40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00002f50: 4966 2073 6861 7065 6669 6c65 2c20 6164  If shapefile, ad
-00002f60: 6420 636f 7272 6563 7420 3331 3337 3020  d correct 31370 
-00002f70: 2e70 726a 2066 696c 650a 2020 2020 2020  .prj file.      
+00002de0: 2320 4966 2073 7061 7469 616c 2072 6566  # If spatial ref
+00002df0: 2068 6173 206e 6f20 6570 7367 2c20 7472   has no epsg, tr
+00002e00: 7920 746f 2066 696e 6420 636f 7272 6573  y to find corres
+00002e10: 706f 6e64 696e 6720 6f6e 650a 2020 2020  ponding one.    
+00002e20: 2020 2020 2020 2020 2020 2020 6372 735f              crs_
+00002e30: 6570 7367 203d 2063 7273 2e74 6f5f 6570  epsg = crs.to_ep
+00002e40: 7367 2829 0a20 2020 2020 2020 2020 2020  sg().           
+00002e50: 2020 2020 2069 6620 6372 735f 6570 7367       if crs_epsg
+00002e60: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00002e70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002e80: 2063 7273 2e6e 616d 6520 696e 205b 0a20   crs.name in [. 
+00002e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ea0: 2020 2020 2020 2022 4265 6c67 6520 3139         "Belge 19
+00002eb0: 3732 202f 2042 656c 6769 616e 204c 616d  72 / Belgian Lam
+00002ec0: 6265 7274 2037 3222 2c0a 2020 2020 2020  bert 72",.      
+00002ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ee0: 2020 2242 656c 6765 5f31 3937 325f 4265    "Belge_1972_Be
+00002ef0: 6c67 6961 6e5f 4c61 6d62 6572 745f 3732  lgian_Lambert_72
+00002f00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00002f10: 2020 2020 2020 2020 2020 2022 4265 6c67             "Belg
+00002f20: 655f 4c61 6d62 6572 745f 3139 3732 222c  e_Lambert_1972",
+00002f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f40: 2020 2020 2020 2020 2022 4244 3732 202f           "BD72 /
+00002f50: 2042 656c 6769 616e 204c 616d 6265 7274   Belgian Lambert
+00002f60: 2037 3222 2c0a 2020 2020 2020 2020 2020   72",.          
+00002f70: 2020 2020 2020 2020 2020 5d3a 0a20 2020            ]:.   
 00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f90: 2020 6966 2047 656f 6669 6c65 5479 7065    if GeofileType
-00002fa0: 2870 6174 6829 203d 3d20 4765 6f66 696c  (path) == Geofil
-00002fb0: 6554 7970 652e 4553 5249 5368 6170 6566  eType.ESRIShapef
-00002fc0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 2070 726a 5f70 6174 6820 3d20 7061 7468   prj_path = path
-00002ff0: 2e70 6172 656e 7420 2f20 6622 7b70 6174  .parent / f"{pat
-00003000: 682e 7374 656d 7d2e 7072 6a22 0a20 2020  h.stem}.prj".   
-00003010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003020: 2020 2020 2020 2020 2069 6620 7072 6a5f           if prj_
-00003030: 7061 7468 2e65 7869 7374 7328 293a 0a20  path.exists():. 
+00002f90: 2020 2020 2023 2042 656c 6769 616e 204c       # Belgian L
+00002fa0: 616d 6265 7274 2069 6e20 6e61 6d65 2c20  ambert in name, 
+00002fb0: 736f 2061 7373 756d 6520 3331 3337 300a  so assume 31370.
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fd0: 2020 2020 2020 2020 6372 7320 3d20 7079          crs = py
+00002fe0: 7072 6f6a 2e43 5253 2e66 726f 6d5f 6570  proj.CRS.from_ep
+00002ff0: 7367 2833 3133 3730 290a 0a20 2020 2020  sg(31370)..     
+00003000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003010: 2020 2023 2049 6620 7368 6170 6566 696c     # If shapefil
+00003020: 652c 2061 6464 2063 6f72 7265 6374 2033  e, add correct 3
+00003030: 3133 3730 202e 7072 6a20 6669 6c65 0a20  1370 .prj file. 
 00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003050: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00003060: 726a 5f72 656e 616d 655f 7061 7468 203d  rj_rename_path =
-00003070: 2070 6174 682e 7061 7265 6e74 202f 2066   path.parent / f
-00003080: 227b 7061 7468 2e73 7465 6d7d 5f6f 7269  "{path.stem}_ori
-00003090: 672e 7072 6a22 0a20 2020 2020 2020 2020  g.prj".         
-000030a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030b0: 2020 2020 2020 2069 6620 6e6f 7420 7072         if not pr
-000030c0: 6a5f 7265 6e61 6d65 5f70 6174 682e 6578  j_rename_path.ex
-000030d0: 6973 7473 2829 3a0a 2020 2020 2020 2020  ists():.        
-000030e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030f0: 2020 2020 2020 2020 2020 2020 7072 6a5f              prj_
-00003100: 7061 7468 2e72 656e 616d 6528 7072 6a5f  path.rename(prj_
-00003110: 7265 6e61 6d65 5f70 6174 6829 0a20 2020  rename_path).   
-00003120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003130: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00003140: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003160: 2020 2020 2020 2070 726a 5f70 6174 682e         prj_path.
-00003170: 756e 6c69 6e6b 2829 0a20 2020 2020 2020  unlink().       
-00003180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003190: 2020 2020 2020 2020 2070 726a 5f70 6174           prj_pat
-000031a0: 682e 7772 6974 655f 7465 7874 2850 524a  h.write_text(PRJ
-000031b0: 5f45 5053 475f 3331 3337 3029 0a0a 2020  _EPSG_31370)..  
-000031c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000031d0: 204c 6179 6572 496e 666f 280a 2020 2020   LayerInfo(.    
-000031e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000031f0: 3d64 6174 6173 6f75 7263 655f 6c61 7965  =datasource_laye
-00003200: 722e 4765 744e 616d 6528 292c 0a20 2020  r.GetName(),.   
-00003210: 2020 2020 2020 2020 2020 2020 2066 6561               fea
-00003220: 7475 7265 636f 756e 743d 6461 7461 736f  turecount=dataso
-00003230: 7572 6365 5f6c 6179 6572 2e47 6574 4665  urce_layer.GetFe
-00003240: 6174 7572 6543 6f75 6e74 2829 2c0a 2020  atureCount(),.  
-00003250: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00003260: 7461 6c5f 626f 756e 6473 3d74 6f74 616c  tal_bounds=total
-00003270: 5f62 6f75 6e64 732c 0a20 2020 2020 2020  _bounds,.       
-00003280: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
-00003290: 7963 6f6c 756d 6e3d 6765 6f6d 6574 7279  ycolumn=geometry
-000032a0: 636f 6c75 6d6e 2c0a 2020 2020 2020 2020  column,.        
-000032b0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
-000032c0: 7479 7065 6e61 6d65 3d67 656f 6d65 7472  typename=geometr
-000032d0: 7974 7970 656e 616d 652c 0a20 2020 2020  ytypename,.     
-000032e0: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-000032f0: 7472 7974 7970 653d 6765 6f6d 6574 7279  trytype=geometry
-00003300: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00003310: 2020 2020 2020 636f 6c75 6d6e 733d 636f        columns=co
-00003320: 6c75 6d6e 732c 0a20 2020 2020 2020 2020  lumns,.         
-00003330: 2020 2020 2020 2066 6964 5f63 6f6c 756d         fid_colum
-00003340: 6e3d 6461 7461 736f 7572 6365 5f6c 6179  n=datasource_lay
-00003350: 6572 2e47 6574 4649 4443 6f6c 756d 6e28  er.GetFIDColumn(
-00003360: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00003370: 2020 2063 7273 3d63 7273 2c0a 2020 2020     crs=crs,.    
-00003380: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00003390: 7273 3d65 7272 6f72 732c 0a20 2020 2020  rs=errors,.     
-000033a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000033b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000033c0: 2020 2065 7272 6f72 732e 6170 7065 6e64     errors.append
-000033d0: 2822 4c61 7965 7220 646f 6573 6e27 7420  ("Layer doesn't 
-000033e0: 6861 7665 2061 2067 656f 6d65 7472 7920  have a geometry 
-000033f0: 636f 6c75 6d6e 2122 290a 0a20 2020 2065  column!")..    e
-00003400: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00003410: 6173 2065 783a 0a20 2020 2020 2020 2065  as ex:.        e
-00003420: 782e 6172 6773 203d 2028 6622 6765 745f  x.args = (f"get_
-00003430: 6c61 7965 7269 6e66 6f20 6572 726f 7220  layerinfo error 
-00003440: 666f 7220 7b70 6174 687d 2e7b 6c61 7965  for {path}.{laye
-00003450: 727d 3a5c 6e20 207b 6578 7d22 2c29 0a20  r}:\n  {ex}",). 
-00003460: 2020 2020 2020 2072 6169 7365 0a20 2020         raise.   
-00003470: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00003480: 2020 6461 7461 736f 7572 6365 203d 204e    datasource = N
-00003490: 6f6e 650a 0a20 2020 2023 2049 6620 7765  one..    # If we
-000034a0: 2064 6964 6e27 7420 7265 7475 726e 206f   didn't return o
-000034b0: 7220 7261 6973 6520 7965 7420 6865 7265  r raise yet here
-000034c0: 2c20 7468 6572 6520 6d75 7374 2068 6176  , there must hav
-000034d0: 6520 6265 656e 2065 7272 6f72 730a 2020  e been errors.  
-000034e0: 2020 6572 726f 7273 5f73 7472 203d 2070    errors_str = p
-000034f0: 7072 696e 742e 7066 6f72 6d61 7428 6572  print.pformat(er
-00003500: 726f 7273 290a 2020 2020 7261 6973 6520  rors).    raise 
-00003510: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-00003520: 2020 2066 2245 7272 6f72 7320 696e 206c     f"Errors in l
-00003530: 6179 6572 2064 6566 696e 6974 696f 6e20  ayer definition 
-00003540: 6f66 2066 696c 6520 7b70 6174 687d 2c20  of file {path}, 
-00003550: 6c61 7965 7220 7b6c 6179 6572 7d3a 205c  layer {layer}: \
-00003560: 6e7b 6572 726f 7273 5f73 7472 7d22 0a20  n{errors_str}". 
-00003570: 2020 2029 0a0a 0a64 6566 2067 6574 5f6f     )...def get_o
-00003580: 6e6c 795f 6c61 7965 7228 7061 7468 3a20  nly_layer(path: 
-00003590: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
-000035a0: 6174 684c 696b 655b 416e 795d 225d 2920  athLike[Any]"]) 
-000035b0: 2d3e 2073 7472 3a0a 2020 2020 2222 220a  -> str:.    """.
-000035c0: 2020 2020 4765 7420 7468 6520 6c61 7965      Get the laye
-000035d0: 726e 616d 6520 666f 7220 6120 6669 6c65  rname for a file
-000035e0: 2074 6861 7420 6f6e 6c79 2063 6f6e 7461   that only conta
-000035f0: 696e 7320 6f6e 6520 6c61 7965 722e 0a0a  ins one layer...
-00003600: 2020 2020 4966 2074 6865 2066 696c 6520      If the file 
-00003610: 636f 6e74 6169 6e73 206d 756c 7469 706c  contains multipl
-00003620: 6520 6c61 7965 7273 2c20 616e 2065 7863  e layers, an exc
-00003630: 6570 7469 6f6e 2069 7320 7468 726f 776e  eption is thrown
-00003640: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
-00003650: 2020 2020 2070 6174 6820 2850 6174 684c       path (PathL
-00003660: 696b 6529 3a20 7468 6520 6669 6c65 2e0a  ike): the file..
-00003670: 0a20 2020 2052 6169 7365 733a 0a20 2020  .    Raises:.   
-00003680: 2020 2020 2056 616c 7565 4572 726f 723a       ValueError:
-00003690: 2061 6e20 696e 7661 6c69 6420 7061 7261   an invalid para
-000036a0: 6d65 7465 7220 7661 6c75 6520 7761 7320  meter value was 
-000036b0: 7061 7373 6564 2e0a 0a20 2020 2052 6574  passed...    Ret
-000036c0: 7572 6e73 3a0a 2020 2020 2020 2020 7374  urns:.        st
-000036d0: 723a 2074 6865 206c 6179 6572 206e 616d  r: the layer nam
-000036e0: 650a 2020 2020 2222 220a 2020 2020 6461  e.    """.    da
-000036f0: 7461 736f 7572 6365 203d 204e 6f6e 650a  tasource = None.
-00003700: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00003710: 2064 6174 6173 6f75 7263 655f 6c61 7965   datasource_laye
-00003720: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
-00003730: 2064 6174 6173 6f75 7263 6520 3d20 6764   datasource = gd
-00003740: 616c 2e4f 7065 6e45 7828 0a20 2020 2020  al.OpenEx(.     
-00003750: 2020 2020 2020 2073 7472 2870 6174 6829         str(path)
-00003760: 2c20 6e4f 7065 6e46 6c61 6773 3d67 6461  , nOpenFlags=gda
-00003770: 6c2e 4f46 5f56 4543 544f 5220 7c20 6764  l.OF_VECTOR | gd
-00003780: 616c 2e4f 465f 5245 4144 4f4e 4c59 207c  al.OF_READONLY |
-00003790: 2067 6461 6c2e 4f46 5f53 4841 5245 440a   gdal.OF_SHARED.
-000037a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000037b0: 2020 6e62 5f6c 6179 6572 7320 3d20 6461    nb_layers = da
-000037c0: 7461 736f 7572 6365 2e47 6574 4c61 7965  tasource.GetLaye
-000037d0: 7243 6f75 6e74 2829 0a20 2020 2020 2020  rCount().       
-000037e0: 2069 6620 6e62 5f6c 6179 6572 7320 3d3d   if nb_layers ==
-000037f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00003800: 6461 7461 736f 7572 6365 5f6c 6179 6572  datasource_layer
-00003810: 203d 2064 6174 6173 6f75 7263 652e 4765   = datasource.Ge
-00003820: 744c 6179 6572 4279 496e 6465 7828 3029  tLayerByIndex(0)
-00003830: 0a20 2020 2020 2020 2065 6c69 6620 6e62  .        elif nb
-00003840: 5f6c 6179 6572 7320 3d3d 2030 3a0a 2020  _layers == 0:.  
-00003850: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00003860: 5661 6c75 6545 7272 6f72 2866 2245 7272  ValueError(f"Err
-00003870: 6f72 3a20 4e6f 206c 6179 6572 7320 666f  or: No layers fo
-00003880: 756e 6420 696e 207b 7061 7468 7d22 290a  und in {path}").
-00003890: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000038a0: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-000038b0: 6b20 6966 2074 6865 7265 2069 7320 6f6e  k if there is on
-000038c0: 6c79 206f 6e65 2073 7061 7469 616c 206c  ly one spatial l
-000038d0: 6179 6572 0a20 2020 2020 2020 2020 2020  ayer.           
-000038e0: 206c 6179 6572 7320 3d20 6c69 7374 6c61   layers = listla
-000038f0: 7965 7273 2870 6174 682c 206f 6e6c 795f  yers(path, only_
-00003900: 7370 6174 6961 6c5f 6c61 7965 7273 3d54  spatial_layers=T
-00003910: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00003920: 2069 6620 6c65 6e28 6c61 7965 7273 2920   if len(layers) 
-00003930: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00003940: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
-00003950: 5f6c 6179 6572 203d 2064 6174 6173 6f75  _layer = datasou
-00003960: 7263 652e 4765 744c 6179 6572 286c 6179  rce.GetLayer(lay
-00003970: 6572 735b 305d 290a 2020 2020 2020 2020  ers[0]).        
-00003980: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00003990: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000039a0: 5661 6c75 6545 7272 6f72 2866 224c 6179  ValueError(f"Lay
-000039b0: 6572 2068 6173 203e 2031 206c 6179 6572  er has > 1 layer
-000039c0: 3a20 7b70 6174 687d 3a20 7b6c 6179 6572  : {path}: {layer
-000039d0: 737d 2229 0a0a 2020 2020 2020 2020 7265  s}")..        re
-000039e0: 7475 726e 2064 6174 6173 6f75 7263 655f  turn datasource_
-000039f0: 6c61 7965 722e 4765 744e 616d 6528 290a  layer.GetName().
-00003a00: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
-00003a10: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
-00003a20: 2020 2020 2065 782e 6172 6773 203d 2028       ex.args = (
-00003a30: 6622 6765 745f 6f6e 6c79 5f6c 6179 6572  f"get_only_layer
-00003a40: 2065 7272 6f72 2066 6f72 207b 7061 7468   error for {path
-00003a50: 7d3a 5c6e 2020 7b65 787d 222c 290a 2020  }:\n  {ex}",).  
-00003a60: 2020 2020 2020 7261 6973 650a 2020 2020        raise.    
-00003a70: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
-00003a80: 2064 6174 6173 6f75 7263 6520 3d20 4e6f   datasource = No
-00003a90: 6e65 0a0a 0a64 6566 2067 6574 5f64 6566  ne...def get_def
-00003aa0: 6175 6c74 5f6c 6179 6572 2870 6174 683a  ault_layer(path:
-00003ab0: 2055 6e69 6f6e 5b73 7472 2c20 226f 732e   Union[str, "os.
-00003ac0: 5061 7468 4c69 6b65 5b41 6e79 5d22 5d29  PathLike[Any]"])
-00003ad0: 202d 3e20 7374 723a 0a20 2020 2022 2222   -> str:.    """
-00003ae0: 0a20 2020 2047 6574 2074 6865 2064 6566  .    Get the def
-00003af0: 6175 6c74 206c 6179 6572 206e 616d 6520  ault layer name 
-00003b00: 746f 2062 6520 7573 6564 2066 6f72 2061  to be used for a
-00003b10: 206c 6179 6572 2069 6e20 7468 6973 2066   layer in this f
-00003b20: 696c 652e 0a0a 2020 2020 5468 6973 2069  ile...    This i
-00003b30: 7320 7468 6520 7374 656d 206f 6620 7468  s the stem of th
-00003b40: 6520 6669 6c65 7061 7468 2e0a 0a20 2020  e filepath...   
-00003b50: 2041 7267 733a 0a20 2020 2020 2020 2070   Args:.        p
-00003b60: 6174 6820 2855 6e69 6f6e 5b73 7472 2c29  ath (Union[str,)
-00003b70: 3a20 5468 6520 7061 7468 2074 6f20 7468  : The path to th
-00003b80: 6520 6669 6c65 2e0a 0a20 2020 2052 6574  e file...    Ret
-00003b90: 7572 6e73 3a0a 2020 2020 2020 2020 7374  urns:.        st
-00003ba0: 723a 2054 6865 2064 6566 6175 6c74 206c  r: The default l
-00003bb0: 6179 6572 206e 616d 652e 0a20 2020 2022  ayer name..    "
-00003bc0: 2222 0a20 2020 2072 6574 7572 6e20 5061  "".    return Pa
-00003bd0: 7468 2870 6174 6829 2e73 7465 6d0a 0a0a  th(path).stem...
-00003be0: 6465 6620 6578 6563 7574 655f 7371 6c28  def execute_sql(
-00003bf0: 0a20 2020 2070 6174 683a 2055 6e69 6f6e  .    path: Union
-00003c00: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
-00003c10: 6b65 5b41 6e79 5d22 5d2c 0a20 2020 2073  ke[Any]"],.    s
-00003c20: 716c 5f73 746d 743a 2073 7472 2c0a 2020  ql_stmt: str,.  
-00003c30: 2020 7371 6c5f 6469 616c 6563 743a 204f    sql_dialect: O
-00003c40: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00003c50: 6f6e 652c 0a29 3a0a 2020 2020 2222 220a  one,.):.    """.
-00003c60: 2020 2020 4578 6563 7574 6520 6120 7371      Execute a sq
-00003c70: 6c20 7374 6174 656d 656e 7420 2844 4d4c  l statement (DML
-00003c80: 206f 7220 4444 4c29 206f 6e20 7468 6520   or DDL) on the 
-00003c90: 6669 6c65 2e0a 0a20 2020 2054 6f20 7275  file...    To ru
-00003ca0: 6e20 5345 4c45 4354 2073 716c 2073 7461  n SELECT sql sta
-00003cb0: 7465 6d65 6e74 7320 6f6e 2061 2066 696c  tements on a fil
-00003cc0: 652c 2075 7365 203a 6d65 7468 3a60 7e72  e, use :meth:`~r
-00003cd0: 6561 645f 6669 6c65 602e 0a0a 2020 2020  ead_file`...    
-00003ce0: 4172 6773 3a0a 2020 2020 2020 2020 7061  Args:.        pa
-00003cf0: 7468 2028 5061 7468 4c69 6b65 293a 2054  th (PathLike): T
-00003d00: 6865 2070 6174 6820 746f 2074 6865 2066  he path to the f
-00003d10: 696c 652e 0a20 2020 2020 2020 2073 716c  ile..        sql
-00003d20: 5f73 746d 7420 2873 7472 293a 2054 6865  _stmt (str): The
-00003d30: 2073 716c 2073 7461 7465 6d65 6e74 2074   sql statement t
-00003d40: 6f20 6578 6563 7574 652e 0a20 2020 2020  o execute..     
-00003d50: 2020 2073 716c 5f64 6961 6c65 6374 2028     sql_dialect (
-00003d60: 7374 7229 3a20 5468 6520 7371 6c20 6469  str): The sql di
-00003d70: 616c 6563 7420 746f 2075 7365 3a0a 2020  alect to use:.  
-00003d80: 2020 2020 2020 2020 2020 2a20 4e6f 6e65            * None
-00003d90: 3a20 7573 6520 7468 6520 6e61 7469 7665  : use the native
-00003da0: 2053 514c 2064 6961 6c65 6374 206f 6620   SQL dialect of 
-00003db0: 7468 6520 6765 6f66 696c 652e 0a20 2020  the geofile..   
-00003dc0: 2020 2020 2020 2020 202a 2027 4f47 5253           * 'OGRS
-00003dd0: 514c 273a 2066 6f72 6365 2074 6865 2075  QL': force the u
-00003de0: 7365 206f 6620 7468 6520 4f47 5220 5351  se of the OGR SQ
-00003df0: 4c20 6469 616c 6563 742e 0a20 2020 2020  L dialect..     
-00003e00: 2020 2020 2020 202a 2027 5351 4c49 5445         * 'SQLITE
-00003e10: 273a 2066 6f72 6365 2074 6865 2075 7365  ': force the use
-00003e20: 206f 6620 7468 6520 5351 4c49 5445 2064   of the SQLITE d
-00003e30: 6961 6c65 6374 2e0a 2020 2020 2020 2020  ialect..        
-00003e40: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-00003e50: 4e6f 6e65 2e0a 2020 2020 2222 220a 2020  None..    """.  
-00003e60: 2020 6461 7461 736f 7572 6365 203d 204e    datasource = N
-00003e70: 6f6e 650a 2020 2020 7472 793a 0a20 2020  one.    try:.   
-00003e80: 2020 2020 2064 6174 6173 6f75 7263 6520       datasource 
-00003e90: 3d20 6764 616c 2e4f 7065 6e45 7828 7374  = gdal.OpenEx(st
-00003ea0: 7228 7061 7468 292c 206e 4f70 656e 466c  r(path), nOpenFl
-00003eb0: 6167 733d 6764 616c 2e4f 465f 5550 4441  ags=gdal.OF_UPDA
-00003ec0: 5445 290a 2020 2020 2020 2020 7265 7375  TE).        resu
-00003ed0: 6c74 203d 2064 6174 6173 6f75 7263 652e  lt = datasource.
-00003ee0: 4578 6563 7574 6553 514c 2873 716c 5f73  ExecuteSQL(sql_s
-00003ef0: 746d 742c 2064 6961 6c65 6374 3d73 716c  tmt, dialect=sql
-00003f00: 5f64 6961 6c65 6374 290a 2020 2020 2020  _dialect).      
-00003f10: 2020 6461 7461 736f 7572 6365 2e52 656c    datasource.Rel
-00003f20: 6561 7365 5265 7375 6c74 5365 7428 7265  easeResultSet(re
-00003f30: 7375 6c74 290a 0a20 2020 2065 7863 6570  sult)..    excep
-00003f40: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00003f50: 783a 0a20 2020 2020 2020 2065 782e 6172  x:.        ex.ar
-00003f60: 6773 203d 2028 6622 6578 6563 7574 655f  gs = (f"execute_
-00003f70: 7371 6c20 6572 726f 7220 666f 7220 7b70  sql error for {p
-00003f80: 6174 687d 5c6e 2020 7b65 787d 222c 290a  ath}\n  {ex}",).
-00003f90: 2020 2020 2020 2020 7261 6973 650a 2020          raise.  
-00003fa0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-00003fb0: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
-00003fc0: 4e6f 6e65 0a0a 0a64 6566 2063 7265 6174  None...def creat
-00003fd0: 655f 7370 6174 6961 6c5f 696e 6465 7828  e_spatial_index(
-00003fe0: 0a20 2020 2070 6174 683a 2055 6e69 6f6e  .    path: Union
-00003ff0: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
-00004000: 6b65 5b41 6e79 5d22 5d2c 0a20 2020 206c  ke[Any]"],.    l
-00004010: 6179 6572 3a20 4f70 7469 6f6e 616c 5b73  ayer: Optional[s
-00004020: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00004030: 6361 6368 655f 7369 7a65 5f6d 623a 204f  cache_size_mb: O
-00004040: 7074 696f 6e61 6c5b 696e 745d 203d 2031  ptional[int] = 1
-00004050: 3238 2c0a 2020 2020 6578 6973 745f 6f6b  28,.    exist_ok
-00004060: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00004070: 2020 2020 666f 7263 655f 7265 6275 696c      force_rebuil
-00004080: 643a 2062 6f6f 6c20 3d20 4661 6c73 652c  d: bool = False,
-00004090: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
-000040a0: 4372 6561 7465 2061 2073 7061 7469 616c  Create a spatial
-000040b0: 2069 6e64 6578 206f 6e20 7468 6520 6c61   index on the la
-000040c0: 7965 7220 7370 6563 6966 6965 642e 0a0a  yer specified...
-000040d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000040e0: 2020 7061 7468 2028 5061 7468 4c69 6b65    path (PathLike
-000040f0: 293a 2054 6865 2066 696c 6520 7061 7468  ): The file path
-00004100: 2e0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
-00004110: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00004120: 2054 6865 206c 6179 6572 2e20 4966 206e   The layer. If n
-00004130: 6f74 2073 7065 6369 6669 6564 2c20 616e  ot specified, an
-00004140: 6420 7468 6572 6520 6973 206f 6e6c 790a  d there is only.
-00004150: 2020 2020 2020 2020 2020 2020 6f6e 6520              one 
-00004160: 6c61 7965 7220 696e 2074 6865 2066 696c  layer in the fil
-00004170: 652c 2074 6869 7320 6c61 7965 7220 6973  e, this layer is
-00004180: 2075 7365 642e 204f 7468 6572 7769 7365   used. Otherwise
-00004190: 2065 7863 6570 7469 6f6e 2e0a 2020 2020   exception..    
-000041a0: 2020 2020 6361 6368 655f 7369 7a65 5f6d      cache_size_m
-000041b0: 6220 2869 6e74 2c20 6f70 7469 6f6e 616c  b (int, optional
-000041c0: 293a 2063 6163 6865 206d 656d 6f72 7920  ): cache memory 
-000041d0: 696e 204d 4220 7468 6174 2063 616e 2062  in MB that can b
-000041e0: 6520 7573 6564 2077 6869 6c65 0a20 2020  e used while.   
-000041f0: 2020 2020 2020 2020 2063 7265 6174 696e           creatin
-00004200: 6720 7370 6174 6961 6c20 696e 6465 7820  g spatial index 
-00004210: 666f 7220 7370 6174 6961 6c69 7465 2066  for spatialite f
-00004220: 696c 6573 2028 2e67 706b 6720 6f72 202e  iles (.gpkg or .
-00004230: 7371 6c69 7465 292e 2049 6620 4e6f 6e65  sqlite). If None
-00004240: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
-00004250: 6520 6465 6661 756c 7420 6361 6368 655f  e default cache_
-00004260: 7369 7a65 2066 726f 6d20 7371 6c69 7465  size from sqlite
-00004270: 2069 7320 7573 6564 2e20 4465 6661 756c   is used. Defaul
-00004280: 7473 2074 6f20 3132 382e 0a20 2020 2020  ts to 128..     
-00004290: 2020 2065 7869 7374 5f6f 6b20 2862 6f6f     exist_ok (boo
-000042a0: 6c2c 206f 7074 696f 6e73 293a 2049 6620  l, options): If 
-000042b0: 5472 7565 2061 6e64 2074 6865 2069 6e64  True and the ind
-000042c0: 6578 2065 7869 7374 7320 616c 7265 6164  ex exists alread
-000042d0: 792c 2064 6f6e 2774 0a20 2020 2020 2020  y, don't.       
-000042e0: 2020 2020 2074 6872 6f77 2061 6e20 6572       throw an er
-000042f0: 726f 722e 0a20 2020 2020 2020 2066 6f72  ror..        for
-00004300: 6365 5f72 6562 7569 6c64 2028 626f 6f6c  ce_rebuild (bool
-00004310: 2c20 6f70 7469 6f6e 7329 3a20 5472 7565  , options): True
-00004320: 2074 6f20 666f 7263 6520 7265 6275 696c   to force rebuil
-00004330: 6420 6576 656e 2069 6620 696e 6465 780a  d even if index.
-00004340: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-00004350: 7473 2061 6c72 6561 6479 2e20 4465 6661  ts already. Defa
-00004360: 756c 7473 2074 6f20 4661 6c73 652e 0a20  ults to False.. 
-00004370: 2020 2022 2222 0a20 2020 2023 2049 6e69     """.    # Ini
-00004380: 740a 2020 2020 7061 7468 203d 2050 6174  t.    path = Pat
-00004390: 6828 7061 7468 290a 2020 2020 6966 206c  h(path).    if l
-000043a0: 6179 6572 2069 7320 4e6f 6e65 3a0a 2020  ayer is None:.  
-000043b0: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
-000043c0: 745f 6f6e 6c79 5f6c 6179 6572 2870 6174  t_only_layer(pat
-000043d0: 6829 0a0a 2020 2020 2320 4966 2069 6e64  h)..    # If ind
-000043e0: 6578 2061 6c72 6561 6479 2065 7869 7374  ex already exist
-000043f0: 732c 2072 656d 6f76 6520 696e 6465 7820  s, remove index 
-00004400: 6f72 2072 6574 7572 6e0a 2020 2020 6966  or return.    if
-00004410: 2068 6173 5f73 7061 7469 616c 5f69 6e64   has_spatial_ind
-00004420: 6578 2870 6174 682c 206c 6179 6572 293a  ex(path, layer):
-00004430: 0a20 2020 2020 2020 2069 6620 666f 7263  .        if forc
-00004440: 655f 7265 6275 696c 643a 0a20 2020 2020  e_rebuild:.     
-00004450: 2020 2020 2020 2072 656d 6f76 655f 7370         remove_sp
-00004460: 6174 6961 6c5f 696e 6465 7828 7061 7468  atial_index(path
-00004470: 2c20 6c61 7965 7229 0a20 2020 2020 2020  , layer).       
-00004480: 2065 6c69 6620 6578 6973 745f 6f6b 3a0a   elif exist_ok:.
-00004490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000044a0: 726e 0a20 2020 2020 2020 2065 6c73 653a  rn.        else:
-000044b0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000044c0: 7365 2045 7863 6570 7469 6f6e 280a 2020  se Exception(.  
-000044d0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000044e0: 4572 726f 7220 6164 6469 6e67 2073 7061  Error adding spa
-000044f0: 7469 616c 2069 6e64 6578 2074 6f20 7b70  tial index to {p
-00004500: 6174 687d 2e7b 6c61 7965 727d 2c20 6974  ath}.{layer}, it
-00004510: 2065 7869 7374 7320 616c 7265 6164 7922   exists already"
-00004520: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00004530: 2020 2020 2320 4e6f 7720 7265 616c 6c79      # Now really
-00004540: 2061 6464 2069 6e64 6578 0a20 2020 2064   add index.    d
-00004550: 6174 6173 6f75 7263 6520 3d20 4e6f 6e65  atasource = None
-00004560: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00004570: 2020 6765 6f66 696c 6574 7970 6520 3d20    geofiletype = 
-00004580: 4765 6f66 696c 6554 7970 6528 7061 7468  GeofileType(path
-00004590: 290a 2020 2020 2020 2020 6966 2067 656f  ).        if geo
-000045a0: 6669 6c65 7479 7065 2e69 735f 7370 6174  filetype.is_spat
-000045b0: 6961 6c69 7465 5f62 6173 6564 3a0a 2020  ialite_based:.  
-000045c0: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-000045d0: 636f 6e66 6967 206f 7074 696f 6e73 206e  config options n
-000045e0: 6565 6420 746f 2062 6520 7365 7420 6265  eed to be set be
-000045f0: 666f 7265 206f 7065 6e69 6e67 2074 6865  fore opening the
-00004600: 2066 696c 6521 0a20 2020 2020 2020 2020   file!.         
-00004610: 2020 206c 6179 6572 696e 666f 203d 2067     layerinfo = g
-00004620: 6574 5f6c 6179 6572 696e 666f 2870 6174  et_layerinfo(pat
-00004630: 682c 206c 6179 6572 290a 2020 2020 2020  h, layer).      
-00004640: 2020 2020 2020 7769 7468 205f 6f67 725f        with _ogr_
-00004650: 7574 696c 2e73 6574 5f63 6f6e 6669 675f  util.set_config_
-00004660: 6f70 7469 6f6e 7328 7b22 4f47 525f 5351  options({"OGR_SQ
-00004670: 4c49 5445 5f43 4143 4845 223a 2063 6163  LITE_CACHE": cac
-00004680: 6865 5f73 697a 655f 6d62 7d29 3a0a 2020  he_size_mb}):.  
-00004690: 2020 2020 2020 2020 2020 2020 2020 6461                da
-000046a0: 7461 736f 7572 6365 203d 2067 6461 6c2e  tasource = gdal.
-000046b0: 4f70 656e 4578 2873 7472 2870 6174 6829  OpenEx(str(path)
-000046c0: 2c20 6e4f 7065 6e46 6c61 6773 3d67 6461  , nOpenFlags=gda
-000046d0: 6c2e 4f46 5f55 5044 4154 4529 0a20 2020  l.OF_UPDATE).   
-000046e0: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-000046f0: 6d65 7472 7963 6f6c 756d 6e20 3d20 6c61  metrycolumn = la
-00004700: 7965 7269 6e66 6f2e 6765 6f6d 6574 7279  yerinfo.geometry
-00004710: 636f 6c75 6d6e 0a20 2020 2020 2020 2020  column.         
-00004720: 2020 2020 2020 2073 716c 203d 2066 2253         sql = f"S
-00004730: 454c 4543 5420 4372 6561 7465 5370 6174  ELECT CreateSpat
-00004740: 6961 6c49 6e64 6578 2827 7b6c 6179 6572  ialIndex('{layer
-00004750: 7d27 2c20 277b 6765 6f6d 6574 7279 636f  }', '{geometryco
-00004760: 6c75 6d6e 7d27 2922 0a20 2020 2020 2020  lumn}')".       
-00004770: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00004780: 3d20 6461 7461 736f 7572 6365 2e45 7865  = datasource.Exe
-00004790: 6375 7465 5351 4c28 7371 6c2c 2064 6961  cuteSQL(sql, dia
-000047a0: 6c65 6374 3d22 5351 4c49 5445 2229 0a20  lect="SQLITE"). 
-000047b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000047c0: 6174 6173 6f75 7263 652e 5265 6c65 6173  atasource.Releas
-000047d0: 6552 6573 756c 7453 6574 2872 6573 756c  eResultSet(resul
-000047e0: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
-000047f0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00004800: 6173 6f75 7263 6520 3d20 6764 616c 2e4f  asource = gdal.O
-00004810: 7065 6e45 7828 7374 7228 7061 7468 292c  penEx(str(path),
-00004820: 206e 4f70 656e 466c 6167 733d 6764 616c   nOpenFlags=gdal
-00004830: 2e4f 465f 5550 4441 5445 290a 2020 2020  .OF_UPDATE).    
-00004840: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00004850: 2064 6174 6173 6f75 7263 652e 4578 6563   datasource.Exec
-00004860: 7574 6553 514c 2866 2743 5245 4154 4520  uteSQL(f'CREATE 
-00004870: 5350 4154 4941 4c20 494e 4445 5820 4f4e  SPATIAL INDEX ON
-00004880: 2022 7b6c 6179 6572 7d22 2729 0a20 2020   "{layer}"').   
-00004890: 2020 2020 2020 2020 2064 6174 6173 6f75           datasou
-000048a0: 7263 652e 5265 6c65 6173 6552 6573 756c  rce.ReleaseResul
-000048b0: 7453 6574 2872 6573 756c 7429 0a0a 2020  tSet(result)..  
-000048c0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000048d0: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-000048e0: 2020 6578 2e61 7267 7320 3d20 2866 2263    ex.args = (f"c
-000048f0: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
-00004900: 6465 7820 6572 726f 7220 666f 7220 7b70  dex error for {p
-00004910: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
-00004920: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
-00004930: 2072 6169 7365 0a20 2020 2066 696e 616c   raise.    final
-00004940: 6c79 3a0a 2020 2020 2020 2020 6461 7461  ly:.        data
-00004950: 736f 7572 6365 203d 204e 6f6e 650a 0a20  source = None.. 
-00004960: 2020 2069 6620 6e6f 7420 6861 735f 7370     if not has_sp
-00004970: 6174 6961 6c5f 696e 6465 7828 7061 7468  atial_index(path
-00004980: 2c20 6c61 7965 7229 3a0a 2020 2020 2020  , layer):.      
-00004990: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-000049a0: 7272 6f72 2866 2263 7265 6174 655f 7370  rror(f"create_sp
-000049b0: 6174 6961 6c5f 696e 6465 7820 6661 696c  atial_index fail
-000049c0: 6564 206f 6e20 7b70 6174 687d 2c20 6c61  ed on {path}, la
-000049d0: 7965 723a 207b 6c61 7965 727d 2229 0a0a  yer: {layer}")..
-000049e0: 0a64 6566 2068 6173 5f73 7061 7469 616c  .def has_spatial
-000049f0: 5f69 6e64 6578 280a 2020 2020 7061 7468  _index(.    path
-00004a00: 3a20 556e 696f 6e5b 7374 722c 2022 6f73  : Union[str, "os
-00004a10: 2e50 6174 684c 696b 655b 416e 795d 225d  .PathLike[Any]"]
-00004a20: 2c20 6c61 7965 723a 204f 7074 696f 6e61  , layer: Optiona
-00004a30: 6c5b 7374 725d 203d 204e 6f6e 650a 2920  l[str] = None.) 
-00004a40: 2d3e 2062 6f6f 6c3a 0a20 2020 2022 2222  -> bool:.    """
-00004a50: 0a20 2020 2043 6865 636b 2069 6620 7468  .    Check if th
-00004a60: 6520 6c61 7965 722f 636f 6c75 6d6e 2068  e layer/column h
-00004a70: 6173 2061 2073 7061 7469 616c 2069 6e64  as a spatial ind
-00004a80: 6578 2e0a 0a20 2020 2041 7267 733a 0a20  ex...    Args:. 
-00004a90: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-00004aa0: 684c 696b 6529 3a20 5468 6520 6669 6c65  hLike): The file
-00004ab0: 2070 6174 682e 0a20 2020 2020 2020 206c   path..        l
-00004ac0: 6179 6572 2028 7374 722c 206f 7074 696f  ayer (str, optio
-00004ad0: 6e61 6c29 3a20 5468 6520 6c61 7965 722e  nal): The layer.
-00004ae0: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00004af0: 652e 0a0a 2020 2020 5261 6973 6573 3a0a  e...    Raises:.
-00004b00: 2020 2020 2020 2020 5661 6c75 6545 7272          ValueErr
-00004b10: 6f72 3a20 616e 2069 6e76 616c 6964 2070  or: an invalid p
-00004b20: 6172 616d 6574 6572 2076 616c 7565 2077  arameter value w
-00004b30: 6173 2070 6173 7365 642e 0a0a 2020 2020  as passed...    
-00004b40: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-00004b50: 2062 6f6f 6c3a 2054 7275 6520 6966 2074   bool: True if t
-00004b60: 6865 2073 7061 7469 616c 2063 6f6c 756d  he spatial colum
-00004b70: 6e20 6578 6973 7473 2e0a 2020 2020 2222  n exists..    ""
-00004b80: 220a 2020 2020 2320 496e 6974 0a20 2020  ".    # Init.   
-00004b90: 2070 6174 6820 3d20 5061 7468 2870 6174   path = Path(pat
-00004ba0: 6829 0a0a 2020 2020 2320 4e6f 7720 6368  h)..    # Now ch
-00004bb0: 6563 6b20 7468 6520 696e 6465 780a 2020  eck the index.  
-00004bc0: 2020 6461 7461 736f 7572 6365 203d 204e    datasource = N
-00004bd0: 6f6e 650a 2020 2020 6765 6f66 696c 6574  one.    geofilet
-00004be0: 7970 6520 3d20 4765 6f66 696c 6554 7970  ype = GeofileTyp
-00004bf0: 6528 7061 7468 290a 2020 2020 7472 793a  e(path).    try:
-00004c00: 0a20 2020 2020 2020 2069 6620 6765 6f66  .        if geof
-00004c10: 696c 6574 7970 652e 6973 5f73 7061 7469  iletype.is_spati
-00004c20: 616c 6974 655f 6261 7365 643a 0a20 2020  alite_based:.   
-00004c30: 2020 2020 2020 2020 206c 6179 6572 696e           layerin
-00004c40: 666f 203d 2067 6574 5f6c 6179 6572 696e  fo = get_layerin
-00004c50: 666f 2870 6174 682c 206c 6179 6572 290a  fo(path, layer).
-00004c60: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00004c70: 736f 7572 6365 203d 2067 6461 6c2e 4f70  source = gdal.Op
-00004c80: 656e 4578 2873 7472 2870 6174 6829 2c20  enEx(str(path), 
-00004c90: 6e4f 7065 6e46 6c61 6773 3d67 6461 6c2e  nOpenFlags=gdal.
-00004ca0: 4f46 5f52 4541 444f 4e4c 5929 0a20 2020  OF_READONLY).   
-00004cb0: 2020 2020 2020 2020 2073 716c 203d 2066           sql = f
-00004cc0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00004cd0: 2020 2020 5345 4c45 4354 2048 6173 5370      SELECT HasSp
-00004ce0: 6174 6961 6c49 6e64 6578 2827 7b6c 6179  atialIndex('{lay
-00004cf0: 6572 696e 666f 2e6e 616d 657d 272c 0a20  erinfo.name}',. 
-00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d20: 2020 2020 2020 277b 6c61 7965 7269 6e66        '{layerinf
-00004d30: 6f2e 6765 6f6d 6574 7279 636f 6c75 6d6e  o.geometrycolumn
-00004d40: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-00004d50: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00004d60: 7265 7375 6c74 203d 2064 6174 6173 6f75  result = datasou
-00004d70: 7263 652e 4578 6563 7574 6553 514c 2873  rce.ExecuteSQL(s
-00004d80: 716c 2c20 6469 616c 6563 743d 2253 514c  ql, dialect="SQL
-00004d90: 4954 4522 290a 2020 2020 2020 2020 2020  ITE").          
-00004da0: 2020 6861 735f 7370 6174 6961 6c5f 696e    has_spatial_in
-00004db0: 6465 7820 3d20 7265 7375 6c74 2e47 6574  dex = result.Get
-00004dc0: 4e65 7874 4665 6174 7572 6528 292e 4765  NextFeature().Ge
-00004dd0: 7446 6965 6c64 2830 2920 3d3d 2031 0a20  tField(0) == 1. 
-00004de0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-00004df0: 6f75 7263 652e 5265 6c65 6173 6552 6573  ource.ReleaseRes
-00004e00: 756c 7453 6574 2872 6573 756c 7429 0a20  ultSet(result). 
-00004e10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004e20: 6e20 6861 735f 7370 6174 6961 6c5f 696e  n has_spatial_in
-00004e30: 6465 780a 2020 2020 2020 2020 656c 6966  dex.        elif
-00004e40: 2067 656f 6669 6c65 7479 7065 203d 3d20   geofiletype == 
-00004e50: 4765 6f66 696c 6554 7970 652e 4553 5249  GeofileType.ESRI
-00004e60: 5368 6170 6566 696c 653a 0a20 2020 2020  Shapefile:.     
-00004e70: 2020 2020 2020 2069 6e64 6578 5f70 6174         index_pat
-00004e80: 6820 3d20 7061 7468 2e70 6172 656e 7420  h = path.parent 
-00004e90: 2f20 6622 7b70 6174 682e 7374 656d 7d2e  / f"{path.stem}.
-00004ea0: 7169 7822 0a20 2020 2020 2020 2020 2020  qix".           
-00004eb0: 2072 6574 7572 6e20 696e 6465 785f 7061   return index_pa
-00004ec0: 7468 2e65 7869 7374 7328 290a 2020 2020  th.exists().    
-00004ed0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00004ee0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00004ef0: 6545 7272 6f72 2866 2268 6173 5f73 7061  eError(f"has_spa
-00004f00: 7469 616c 5f69 6e64 6578 206e 6f74 2073  tial_index not s
-00004f10: 7570 706f 7274 6564 2066 6f72 207b 7061  upported for {pa
-00004f20: 7468 7d22 290a 0a20 2020 2065 7863 6570  th}")..    excep
-00004f30: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00004f40: 783a 0a20 2020 2020 2020 2065 782e 6172  x:.        ex.ar
-00004f50: 6773 203d 2028 6622 6861 735f 7370 6174  gs = (f"has_spat
-00004f60: 6961 6c5f 696e 6465 7820 6572 726f 7220  ial_index error 
-00004f70: 666f 7220 7b70 6174 687d 2e7b 6c61 7965  for {path}.{laye
-00004f80: 727d 3a5c 6e20 207b 6578 7d22 2c29 0a20  r}:\n  {ex}",). 
-00004f90: 2020 2020 2020 2072 6169 7365 0a20 2020         raise.   
-00004fa0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00004fb0: 2020 6461 7461 736f 7572 6365 203d 204e    datasource = N
-00004fc0: 6f6e 650a 0a0a 6465 6620 7265 6d6f 7665  one...def remove
-00004fd0: 5f73 7061 7469 616c 5f69 6e64 6578 280a  _spatial_index(.
-00004fe0: 2020 2020 7061 7468 3a20 556e 696f 6e5b      path: Union[
-00004ff0: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
-00005000: 655b 416e 795d 225d 2c20 6c61 7965 723a  e[Any]"], layer:
-00005010: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00005020: 204e 6f6e 650a 293a 0a20 2020 2022 2222   None.):.    """
-00005030: 0a20 2020 2052 656d 6f76 6520 7468 6520  .    Remove the 
-00005040: 7370 6174 6961 6c20 696e 6465 7820 6672  spatial index fr
-00005050: 6f6d 2074 6865 206c 6179 6572 2073 7065  om the layer spe
-00005060: 6369 6669 6564 2e0a 0a20 2020 2041 7267  cified...    Arg
-00005070: 733a 0a20 2020 2020 2020 2070 6174 6820  s:.        path 
-00005080: 2850 6174 684c 696b 6529 3a20 5468 6520  (PathLike): The 
-00005090: 6669 6c65 2070 6174 682e 0a20 2020 2020  file path..     
-000050a0: 2020 206c 6179 6572 2028 7374 722c 206f     layer (str, o
-000050b0: 7074 696f 6e61 6c29 3a20 5468 6520 6c61  ptional): The la
-000050c0: 7965 722e 2049 6620 6e6f 7420 7370 6563  yer. If not spec
-000050d0: 6966 6965 642c 2061 6e64 2074 6865 7265  ified, and there
-000050e0: 2069 7320 6f6e 6c79 0a20 2020 2020 2020   is only.       
-000050f0: 2020 2020 206f 6e65 206c 6179 6572 2069       one layer i
-00005100: 6e20 7468 6520 6669 6c65 2c20 7468 6973  n the file, this
-00005110: 206c 6179 6572 2069 7320 7573 6564 2e20   layer is used. 
-00005120: 4f74 6865 7277 6973 6520 6578 6365 7074  Otherwise except
-00005130: 696f 6e2e 0a20 2020 2022 2222 0a20 2020  ion..    """.   
-00005140: 2023 2049 6e69 740a 2020 2020 7061 7468   # Init.    path
-00005150: 203d 2050 6174 6828 7061 7468 290a 0a20   = Path(path).. 
-00005160: 2020 2023 204e 6f77 2072 6561 6c6c 7920     # Now really 
-00005170: 7265 6d6f 7665 2069 6e64 6578 0a20 2020  remove index.   
-00005180: 2064 6174 6173 6f75 7263 6520 3d20 4e6f   datasource = No
-00005190: 6e65 0a20 2020 2067 656f 6669 6c65 7479  ne.    geofilety
-000051a0: 7065 203d 2047 656f 6669 6c65 5479 7065  pe = GeofileType
-000051b0: 2870 6174 6829 0a20 2020 206c 6179 6572  (path).    layer
-000051c0: 696e 666f 203d 2067 6574 5f6c 6179 6572  info = get_layer
-000051d0: 696e 666f 2870 6174 682c 206c 6179 6572  info(path, layer
-000051e0: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
-000051f0: 2020 2069 6620 6765 6f66 696c 6574 7970     if geofiletyp
-00005200: 652e 6973 5f73 7061 7469 616c 6974 655f  e.is_spatialite_
-00005210: 6261 7365 643a 0a20 2020 2020 2020 2020  based:.         
-00005220: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
-00005230: 6764 616c 2e4f 7065 6e45 7828 7374 7228  gdal.OpenEx(str(
-00005240: 7061 7468 292c 206e 4f70 656e 466c 6167  path), nOpenFlag
-00005250: 733d 6764 616c 2e4f 465f 5550 4441 5445  s=gdal.OF_UPDATE
-00005260: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00005270: 7375 6c74 203d 2064 6174 6173 6f75 7263  sult = datasourc
-00005280: 652e 4578 6563 7574 6553 514c 280a 2020  e.ExecuteSQL(.  
-00005290: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000052a0: 5345 4c45 4354 2044 6973 6162 6c65 5370  SELECT DisableSp
-000052b0: 6174 6961 6c49 6e64 6578 2827 7b6c 6179  atialIndex('{lay
-000052c0: 6572 696e 666f 2e6e 616d 657d 272c 2027  erinfo.name}', '
-000052d0: 7b6c 6179 6572 696e 666f 2e67 656f 6d65  {layerinfo.geome
-000052e0: 7472 7963 6f6c 756d 6e7d 2729 222c 2020  trycolumn}')",  
-000052f0: 2320 6e6f 7161 3a20 4535 3031 0a20 2020  # noqa: E501.   
-00005300: 2020 2020 2020 2020 2020 2020 2064 6961               dia
-00005310: 6c65 6374 3d22 5351 4c49 5445 222c 0a20  lect="SQLITE",. 
-00005320: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005330: 2020 2020 2020 2020 2064 6174 6173 6f75           datasou
-00005340: 7263 652e 5265 6c65 6173 6552 6573 756c  rce.ReleaseResul
-00005350: 7453 6574 2872 6573 756c 7429 0a20 2020  tSet(result).   
-00005360: 2020 2020 2065 6c69 6620 6765 6f66 696c       elif geofil
-00005370: 6574 7970 6520 3d3d 2047 656f 6669 6c65  etype == Geofile
-00005380: 5479 7065 2e45 5352 4953 6861 7065 6669  Type.ESRIShapefi
-00005390: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-000053a0: 2320 4452 4f50 2053 5041 5449 414c 2049  # DROP SPATIAL I
-000053b0: 4e44 4558 204f 4e20 2e2e 2e20 636f 6d6d  NDEX ON ... comm
-000053c0: 616e 6420 6769 7665 7320 616e 2065 7272  and gives an err
-000053d0: 6f72 2c20 736f 206a 7573 7420 7265 6d6f  or, so just remo
-000053e0: 7665 202e 7169 780a 2020 2020 2020 2020  ve .qix.        
-000053f0: 2020 2020 696e 6465 785f 7061 7468 203d      index_path =
-00005400: 2070 6174 682e 7061 7265 6e74 202f 2066   path.parent / f
-00005410: 227b 7061 7468 2e73 7465 6d7d 2e71 6978  "{path.stem}.qix
-00005420: 220a 2020 2020 2020 2020 2020 2020 696e  ".            in
-00005430: 6465 785f 7061 7468 2e75 6e6c 696e 6b28  dex_path.unlink(
-00005440: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00005450: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00005460: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
-00005470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005480: 6622 7265 6d6f 7665 5f73 7061 7469 616c  f"remove_spatial
-00005490: 5f69 6e64 6578 2069 7320 6e6f 7420 7375  _index is not su
-000054a0: 7070 6f72 7465 6420 666f 7220 7b70 6174  pported for {pat
-000054b0: 682e 7375 6666 6978 7d20 6669 6c65 220a  h.suffix} file".
-000054c0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000054d0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-000054e0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
-000054f0: 2020 2065 782e 6172 6773 203d 2028 6622     ex.args = (f"
-00005500: 7265 6d6f 7665 5f73 7061 7469 616c 5f69  remove_spatial_i
-00005510: 6e64 6578 2065 7272 6f72 2066 6f72 207b  ndex error for {
-00005520: 7061 7468 7d2e 7b6c 6179 6572 7d3a 5c6e  path}.{layer}:\n
-00005530: 2020 7b65 787d 222c 290a 2020 2020 2020    {ex}",).      
-00005540: 2020 7261 6973 650a 2020 2020 6669 6e61    raise.    fina
-00005550: 6c6c 793a 0a20 2020 2020 2020 2064 6174  lly:.        dat
-00005560: 6173 6f75 7263 6520 3d20 4e6f 6e65 0a0a  asource = None..
-00005570: 0a64 6566 2072 656e 616d 655f 6c61 7965  .def rename_laye
-00005580: 7228 0a20 2020 2070 6174 683a 2055 6e69  r(.    path: Uni
-00005590: 6f6e 5b73 7472 2c20 226f 732e 5061 7468  on[str, "os.Path
-000055a0: 4c69 6b65 5b41 6e79 5d22 5d2c 206e 6577  Like[Any]"], new
-000055b0: 5f6c 6179 6572 3a20 7374 722c 206c 6179  _layer: str, lay
-000055c0: 6572 3a20 4f70 7469 6f6e 616c 5b73 7472  er: Optional[str
-000055d0: 5d20 3d20 4e6f 6e65 0a29 3a0a 2020 2020  ] = None.):.    
-000055e0: 2222 220a 2020 2020 5265 6e61 6d65 2074  """.    Rename t
-000055f0: 6865 206c 6179 6572 2073 7065 6369 6669  he layer specifi
-00005600: 6564 2e0a 0a20 2020 2041 7267 733a 0a20  ed...    Args:. 
-00005610: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-00005620: 684c 696b 6529 3a20 5468 6520 6669 6c65  hLike): The file
-00005630: 2070 6174 682e 0a20 2020 2020 2020 206c   path..        l
-00005640: 6179 6572 2028 4f70 7469 6f6e 616c 5b73  ayer (Optional[s
-00005650: 7472 5d29 3a20 5468 6520 6c61 7965 7220  tr]): The layer 
-00005660: 6e61 6d65 2e20 4966 206e 6f74 2073 7065  name. If not spe
-00005670: 6369 6669 6564 2c20 616e 6420 7468 6572  cified, and ther
-00005680: 6520 6973 206f 6e6c 790a 2020 2020 2020  e is only.      
-00005690: 2020 2020 2020 6f6e 6520 6c61 7965 7220        one layer 
-000056a0: 696e 2074 6865 2066 696c 652c 2074 6869  in the file, thi
-000056b0: 7320 6c61 7965 7220 6973 2075 7365 642e  s layer is used.
-000056c0: 204f 7468 6572 7769 7365 2065 7863 6570   Otherwise excep
-000056d0: 7469 6f6e 2e0a 2020 2020 2020 2020 6e65  tion..        ne
-000056e0: 775f 6c61 7965 7220 2873 7472 293a 2054  w_layer (str): T
-000056f0: 6865 206e 6577 206c 6179 6572 206e 616d  he new layer nam
-00005700: 652e 2049 6620 6e6f 7420 7370 6563 6966  e. If not specif
-00005710: 6965 642c 2061 6e64 2074 6865 7265 2069  ied, and there i
-00005720: 7320 6f6e 6c79 0a20 2020 2020 2020 2020  s only.         
-00005730: 2020 206f 6e65 206c 6179 6572 2069 6e20     one layer in 
-00005740: 7468 6520 6669 6c65 2c20 7468 6973 206c  the file, this l
-00005750: 6179 6572 2069 7320 7573 6564 2e20 4f74  ayer is used. Ot
-00005760: 6865 7277 6973 6520 6578 6365 7074 696f  herwise exceptio
-00005770: 6e2e 0a20 2020 2022 2222 0a20 2020 2023  n..    """.    #
-00005780: 2043 6865 636b 2069 6e70 7574 2070 6172   Check input par
-00005790: 616d 6574 6572 730a 2020 2020 7061 7468  ameters.    path
-000057a0: 203d 2050 6174 6828 7061 7468 290a 2020   = Path(path).  
-000057b0: 2020 6966 206c 6179 6572 2069 7320 4e6f    if layer is No
-000057c0: 6e65 3a0a 2020 2020 2020 2020 6c61 7965  ne:.        laye
-000057d0: 7220 3d20 6765 745f 6f6e 6c79 5f6c 6179  r = get_only_lay
-000057e0: 6572 2870 6174 6829 0a0a 2020 2020 2320  er(path)..    # 
-000057f0: 4e6f 7720 7265 616c 6c79 2072 656e 616d  Now really renam
-00005800: 650a 2020 2020 6461 7461 736f 7572 6365  e.    datasource
-00005810: 203d 204e 6f6e 650a 2020 2020 6765 6f66   = None.    geof
-00005820: 696c 6574 7970 6520 3d20 4765 6f66 696c  iletype = Geofil
-00005830: 6554 7970 6528 7061 7468 290a 2020 2020  eType(path).    
-00005840: 6966 2067 656f 6669 6c65 7479 7065 2e69  if geofiletype.i
-00005850: 735f 7370 6174 6961 6c69 7465 5f62 6173  s_spatialite_bas
-00005860: 6564 3a0a 2020 2020 2020 2020 7472 793a  ed:.        try:
-00005870: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00005880: 6173 6f75 7263 6520 3d20 6764 616c 2e4f  asource = gdal.O
-00005890: 7065 6e45 7828 7374 7228 7061 7468 292c  penEx(str(path),
-000058a0: 206e 4f70 656e 466c 6167 733d 6764 616c   nOpenFlags=gdal
-000058b0: 2e4f 465f 5550 4441 5445 290a 2020 2020  .OF_UPDATE).    
-000058c0: 2020 2020 2020 2020 7371 6c5f 7374 6d74          sql_stmt
-000058d0: 203d 2066 2741 4c54 4552 2054 4142 4c45   = f'ALTER TABLE
-000058e0: 2022 7b6c 6179 6572 7d22 2052 454e 414d   "{layer}" RENAM
-000058f0: 4520 544f 2022 7b6e 6577 5f6c 6179 6572  E TO "{new_layer
-00005900: 7d22 270a 2020 2020 2020 2020 2020 2020  }"'.            
-00005910: 7265 7375 6c74 203d 2064 6174 6173 6f75  result = datasou
-00005920: 7263 652e 4578 6563 7574 6553 514c 2873  rce.ExecuteSQL(s
-00005930: 716c 5f73 746d 7429 0a20 2020 2020 2020  ql_stmt).       
-00005940: 2020 2020 2064 6174 6173 6f75 7263 652e       datasource.
-00005950: 5265 6c65 6173 6552 6573 756c 7453 6574  ReleaseResultSet
-00005960: 2872 6573 756c 7429 0a20 2020 2020 2020  (result).       
-00005970: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00005980: 6e20 6173 2065 783a 0a20 2020 2020 2020  n as ex:.       
-00005990: 2020 2020 2065 782e 6172 6773 203d 2028       ex.args = (
-000059a0: 6622 7265 6e61 6d65 5f6c 6179 6572 2065  f"rename_layer e
-000059b0: 7272 6f72 2066 6f72 207b 7061 7468 7d2e  rror for {path}.
-000059c0: 7b6c 6179 6572 7d3a 5c6e 2020 7b65 787d  {layer}:\n  {ex}
-000059d0: 222c 290a 2020 2020 2020 2020 2020 2020  ",).            
-000059e0: 7261 6973 650a 2020 2020 2020 2020 6669  raise.        fi
-000059f0: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
-00005a00: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
-00005a10: 4e6f 6e65 0a20 2020 2065 6c69 6620 6765  None.    elif ge
-00005a20: 6f66 696c 6574 7970 6520 3d3d 2047 656f  ofiletype == Geo
-00005a30: 6669 6c65 5479 7065 2e45 5352 4953 6861  fileType.ESRISha
-00005a40: 7065 6669 6c65 3a0a 2020 2020 2020 2020  pefile:.        
-00005a50: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00005a60: 2866 2272 656e 616d 655f 6c61 7965 7220  (f"rename_layer 
-00005a70: 6e6f 7420 706f 7373 6962 6c65 2066 6f72  not possible for
-00005a80: 207b 6765 6f66 696c 6574 7970 657d 2066   {geofiletype} f
-00005a90: 696c 6522 290a 2020 2020 656c 7365 3a0a  ile").    else:.
-00005aa0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00005ab0: 6c75 6545 7272 6f72 2866 2272 656e 616d  lueError(f"renam
-00005ac0: 655f 6c61 7965 7220 6e6f 7420 696d 706c  e_layer not impl
-00005ad0: 656d 656e 7465 6420 666f 7220 7b70 6174  emented for {pat
-00005ae0: 682e 7375 6666 6978 7d20 6669 6c65 2229  h.suffix} file")
-00005af0: 0a0a 0a64 6566 2072 656e 616d 655f 636f  ...def rename_co
-00005b00: 6c75 6d6e 280a 2020 2020 7061 7468 3a20  lumn(.    path: 
-00005b10: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
-00005b20: 6174 684c 696b 655b 416e 795d 225d 2c0a  athLike[Any]"],.
-00005b30: 2020 2020 636f 6c75 6d6e 5f6e 616d 653a      column_name:
-00005b40: 2073 7472 2c0a 2020 2020 6e65 775f 636f   str,.    new_co
-00005b50: 6c75 6d6e 5f6e 616d 653a 2073 7472 2c0a  lumn_name: str,.
-00005b60: 2020 2020 6c61 7965 723a 204f 7074 696f      layer: Optio
-00005b70: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-00005b80: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
-00005b90: 5265 6e61 6d65 2074 6865 2063 6f6c 756d  Rename the colum
-00005ba0: 6e20 7370 6563 6966 6965 642e 0a0a 2020  n specified...  
-00005bb0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00005bc0: 7061 7468 2028 5061 7468 4c69 6b65 293a  path (PathLike):
-00005bd0: 2054 6865 2066 696c 6520 7061 7468 2e0a   The file path..
-00005be0: 2020 2020 2020 2020 636f 6c75 6d6e 5f6e          column_n
-00005bf0: 616d 6520 2873 7472 293a 2074 6865 2063  ame (str): the c
-00005c00: 7572 7265 6e74 2063 6f6c 756d 6e20 6e61  urrent column na
-00005c10: 6d65 2e0a 2020 2020 2020 2020 6e65 775f  me..        new_
-00005c20: 636f 6c75 6d6e 5f6e 616d 6520 2873 7472  column_name (str
-00005c30: 293a 2074 6865 206e 6577 2063 6f6c 756d  ): the new colum
-00005c40: 6e20 6e61 6d65 2e0a 2020 2020 2020 2020  n name..        
-00005c50: 6c61 7965 7220 284f 7074 696f 6e61 6c5b  layer (Optional[
-00005c60: 7374 725d 293a 2054 6865 206c 6179 6572  str]): The layer
-00005c70: 206e 616d 652e 2049 6620 6e6f 7420 7370   name. If not sp
-00005c80: 6563 6966 6965 642c 2061 6e64 2074 6865  ecified, and the
-00005c90: 7265 2069 7320 6f6e 6c79 0a20 2020 2020  re is only.     
-00005ca0: 2020 2020 2020 206f 6e65 206c 6179 6572         one layer
-00005cb0: 2069 6e20 7468 6520 6669 6c65 2c20 7468   in the file, th
-00005cc0: 6973 206c 6179 6572 2069 7320 7573 6564  is layer is used
-00005cd0: 2e20 4f74 6865 7277 6973 6520 6578 6365  . Otherwise exce
-00005ce0: 7074 696f 6e2e 0a20 2020 2022 2222 0a20  ption..    """. 
-00005cf0: 2020 2023 2043 6865 636b 2069 6e70 7574     # Check input
-00005d00: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
-00005d10: 7061 7468 203d 2050 6174 6828 7061 7468  path = Path(path
-00005d20: 290a 2020 2020 6966 206c 6179 6572 2069  ).    if layer i
-00005d30: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00005d40: 6c61 7965 7220 3d20 6765 745f 6f6e 6c79  layer = get_only
-00005d50: 5f6c 6179 6572 2870 6174 6829 0a20 2020  _layer(path).   
-00005d60: 2069 6e66 6f20 3d20 6765 745f 6c61 7965   info = get_laye
-00005d70: 7269 6e66 6f28 7061 7468 2c20 6c61 7965  rinfo(path, laye
-00005d80: 7229 0a20 2020 2069 6620 636f 6c75 6d6e  r).    if column
-00005d90: 5f6e 616d 6520 6e6f 7420 696e 2069 6e66  _name not in inf
-00005da0: 6f2e 636f 6c75 6d6e 7320 616e 6420 6e65  o.columns and ne
-00005db0: 775f 636f 6c75 6d6e 5f6e 616d 6520 696e  w_column_name in
-00005dc0: 2069 6e66 6f2e 636f 6c75 6d6e 733a 0a20   info.columns:. 
-00005dd0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-00005de0: 666f 280a 2020 2020 2020 2020 2020 2020  fo(.            
-00005df0: 6622 436f 6c75 6d6e 207b 636f 6c75 6d6e  f"Column {column
-00005e00: 5f6e 616d 657d 2073 6565 6d73 2074 6f20  _name} seems to 
-00005e10: 6265 2072 656e 616d 6564 2061 6c72 6561  be renamed alrea
-00005e20: 6479 2074 6f20 7b6e 6577 5f63 6f6c 756d  dy to {new_colum
-00005e30: 6e5f 6e61 6d65 7d22 0a20 2020 2020 2020  n_name}".       
-00005e40: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00005e50: 6e0a 0a20 2020 2023 204e 6f77 2072 6561  n..    # Now rea
-00005e60: 6c6c 7920 7265 6e61 6d65 0a20 2020 2064  lly rename.    d
-00005e70: 6174 6173 6f75 7263 6520 3d20 4e6f 6e65  atasource = None
-00005e80: 0a20 2020 2067 656f 6669 6c65 7479 7065  .    geofiletype
-00005e90: 203d 2047 656f 6669 6c65 5479 7065 2870   = GeofileType(p
-00005ea0: 6174 6829 0a20 2020 2069 6620 6765 6f66  ath).    if geof
-00005eb0: 696c 6574 7970 652e 6973 5f73 7061 7469  iletype.is_spati
-00005ec0: 616c 6974 655f 6261 7365 643a 0a20 2020  alite_based:.   
-00005ed0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00005ee0: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
-00005ef0: 203d 2067 6461 6c2e 4f70 656e 4578 2873   = gdal.OpenEx(s
-00005f00: 7472 2870 6174 6829 2c20 6e4f 7065 6e46  tr(path), nOpenF
-00005f10: 6c61 6773 3d67 6461 6c2e 4f46 5f55 5044  lags=gdal.OF_UPD
-00005f20: 4154 4529 0a20 2020 2020 2020 2020 2020  ATE).           
-00005f30: 2073 716c 5f73 746d 7420 3d20 280a 2020   sql_stmt = (.  
-00005f40: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00005f50: 414c 5445 5220 5441 424c 4520 227b 6c61  ALTER TABLE "{la
-00005f60: 7965 727d 2220 270a 2020 2020 2020 2020  yer}" '.        
-00005f70: 2020 2020 2020 2020 6627 5245 4e41 4d45          f'RENAME
-00005f80: 2043 4f4c 554d 4e20 227b 636f 6c75 6d6e   COLUMN "{column
-00005f90: 5f6e 616d 657d 2220 544f 2022 7b6e 6577  _name}" TO "{new
-00005fa0: 5f63 6f6c 756d 6e5f 6e61 6d65 7d22 270a  _column_name}"'.
-00005fb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00005fc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00005fd0: 203d 2064 6174 6173 6f75 7263 652e 4578   = datasource.Ex
-00005fe0: 6563 7574 6553 514c 2873 716c 5f73 746d  ecuteSQL(sql_stm
-00005ff0: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-00006000: 6174 6173 6f75 7263 652e 5265 6c65 6173  atasource.Releas
-00006010: 6552 6573 756c 7453 6574 2872 6573 756c  eResultSet(resul
-00006020: 7429 0a20 2020 2020 2020 2065 7863 6570  t).        excep
-00006030: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00006040: 783a 0a20 2020 2020 2020 2020 2020 2065  x:.            e
-00006050: 782e 6172 6773 203d 2028 6622 7265 6e61  x.args = (f"rena
-00006060: 6d65 5f63 6f6c 756d 6e20 6572 726f 7220  me_column error 
-00006070: 666f 7220 7b70 6174 687d 2e7b 6c61 7965  for {path}.{laye
-00006080: 727d 3a5c 6e20 207b 6578 7d22 2c29 0a20  r}:\n  {ex}",). 
-00006090: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000060a0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-000060b0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-000060c0: 7461 736f 7572 6365 203d 204e 6f6e 650a  tasource = None.
-000060d0: 0a20 2020 2065 6c69 6620 6765 6f66 696c  .    elif geofil
-000060e0: 6574 7970 6520 3d3d 2047 656f 6669 6c65  etype == Geofile
-000060f0: 5479 7065 2e45 5352 4953 6861 7065 6669  Type.ESRIShapefi
-00006100: 6c65 3a0a 2020 2020 2020 2020 7261 6973  le:.        rais
-00006110: 6520 5661 6c75 6545 7272 6f72 2866 2272  e ValueError(f"r
-00006120: 656e 616d 655f 636f 6c75 6d6e 2069 7320  ename_column is 
-00006130: 6e6f 7420 706f 7373 6962 6c65 2066 6f72  not possible for
-00006140: 207b 6765 6f66 696c 6574 7970 657d 2066   {geofiletype} f
-00006150: 696c 6522 290a 2020 2020 656c 7365 3a0a  ile").    else:.
-00006160: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00006170: 6c75 6545 7272 6f72 2866 2272 656e 616d  lueError(f"renam
-00006180: 655f 636f 6c75 6d6e 2069 7320 6e6f 7420  e_column is not 
-00006190: 696d 706c 656d 656e 7465 6420 666f 7220  implemented for 
-000061a0: 7b70 6174 682e 7375 6666 6978 7d20 6669  {path.suffix} fi
-000061b0: 6c65 2229 0a0a 0a63 6c61 7373 2044 6174  le")...class Dat
-000061c0: 6154 7970 6528 656e 756d 2e45 6e75 6d29  aType(enum.Enum)
-000061d0: 3a0a 2020 2020 2222 220a 2020 2020 5468  :.    """.    Th
-000061e0: 6973 2065 6e75 6d20 6465 6669 6e65 7320  is enum defines 
-000061f0: 7468 6520 7374 616e 6461 7264 2064 6174  the standard dat
-00006200: 6120 7479 7065 7320 7468 6174 2063 616e  a types that can
-00006210: 2062 6520 7573 6564 2066 6f72 2063 6f6c   be used for col
-00006220: 756d 6e73 2e0a 2020 2020 2222 220a 0a20  umns..    """.. 
-00006230: 2020 2054 4558 5420 3d20 2254 4558 5422     TEXT = "TEXT"
-00006240: 0a20 2020 2022 2222 436f 6c75 6d6e 2077  .    """Column w
-00006250: 6974 6820 7465 7874 2064 6174 613a 207e  ith text data: ~
-00006260: 2073 7472 696e 672c 2063 6861 722c 2076   string, char, v
-00006270: 6172 6368 6172 2c20 636c 6f62 2e22 2222  archar, clob."""
-00006280: 0a20 2020 2049 4e54 4547 4552 203d 2022  .    INTEGER = "
-00006290: 494e 5445 4745 5222 0a20 2020 2022 2222  INTEGER".    """
-000062a0: 436f 6c75 6d6e 2077 6974 6820 696e 7465  Column with inte
-000062b0: 6765 7220 6461 7461 2e22 2222 0a20 2020  ger data.""".   
-000062c0: 2052 4541 4c20 3d20 2252 4541 4c22 0a20   REAL = "REAL". 
-000062d0: 2020 2022 2222 436f 6c75 6d6e 2077 6974     """Column wit
-000062e0: 6820 666c 6f61 7469 6e67 2070 6f69 6e74  h floating point
-000062f0: 2064 6174 613a 207e 2066 6c6f 6174 2c20   data: ~ float, 
-00006300: 646f 7562 6c65 2e22 2222 0a20 2020 2044  double.""".    D
-00006310: 4154 4520 3d20 2244 4154 4522 0a20 2020  ATE = "DATE".   
-00006320: 2022 2222 436f 6c75 6d6e 2077 6974 6820   """Column with 
-00006330: 6461 7465 2064 6174 612e 2222 220a 2020  date data.""".  
-00006340: 2020 5449 4d45 5354 414d 5020 3d20 2254    TIMESTAMP = "T
-00006350: 494d 4553 5441 4d50 220a 2020 2020 2222  IMESTAMP".    ""
-00006360: 2243 6f6c 756d 6e20 7769 7468 2074 696d  "Column with tim
-00006370: 6573 7461 6d70 2064 6174 613a 207e 2064  estamp data: ~ d
-00006380: 6174 6574 696d 652e 2222 220a 2020 2020  atetime.""".    
-00006390: 424f 4f4c 4541 4e20 3d20 2242 4f4f 4c45  BOOLEAN = "BOOLE
-000063a0: 414e 220a 2020 2020 2222 2243 6f6c 756d  AN".    """Colum
-000063b0: 6e20 7769 7468 2062 6f6f 6c65 616e 2064  n with boolean d
-000063c0: 6174 612e 2222 220a 2020 2020 424c 4f42  ata.""".    BLOB
-000063d0: 203d 2022 424c 4f42 220a 2020 2020 2222   = "BLOB".    ""
-000063e0: 2243 6f6c 756d 6e20 7769 7468 2062 696e  "Column with bin
-000063f0: 6172 7920 6461 7461 2e22 2222 0a20 2020  ary data.""".   
-00006400: 204e 554d 4552 4943 203d 2022 4e55 4d45   NUMERIC = "NUME
-00006410: 5249 4322 0a20 2020 2022 2222 436f 6c75  RIC".    """Colu
-00006420: 6d6e 2077 6974 6820 6e75 6d65 7269 6320  mn with numeric 
-00006430: 6461 7461 3a20 6578 6163 7420 6465 6369  data: exact deci
-00006440: 6d61 6c20 6461 7461 2e22 2222 0a0a 0a64  mal data."""...d
-00006450: 6566 2061 6464 5f63 6f6c 756d 6e28 0a20  ef add_column(. 
-00006460: 2020 2070 6174 683a 2055 6e69 6f6e 5b73     path: Union[s
-00006470: 7472 2c20 226f 732e 5061 7468 4c69 6b65  tr, "os.PathLike
-00006480: 5b41 6e79 5d22 5d2c 0a20 2020 206e 616d  [Any]"],.    nam
-00006490: 653a 2073 7472 2c0a 2020 2020 7479 7065  e: str,.    type
-000064a0: 3a20 556e 696f 6e5b 4461 7461 5479 7065  : Union[DataType
-000064b0: 2c20 7374 725d 2c0a 2020 2020 6578 7072  , str],.    expr
-000064c0: 6573 7369 6f6e 3a20 556e 696f 6e5b 7374  ession: Union[st
-000064d0: 722c 2069 6e74 2c20 666c 6f61 742c 204e  r, int, float, N
-000064e0: 6f6e 655d 203d 204e 6f6e 652c 0a20 2020  one] = None,.   
-000064f0: 2065 7870 7265 7373 696f 6e5f 6469 616c   expression_dial
-00006500: 6563 743a 204f 7074 696f 6e61 6c5b 7374  ect: Optional[st
-00006510: 725d 203d 204e 6f6e 652c 0a20 2020 206c  r] = None,.    l
-00006520: 6179 6572 3a20 4f70 7469 6f6e 616c 5b73  ayer: Optional[s
-00006530: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00006540: 666f 7263 655f 7570 6461 7465 3a20 626f  force_update: bo
-00006550: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00006560: 7769 6474 683a 204f 7074 696f 6e61 6c5b  width: Optional[
-00006570: 696e 745d 203d 204e 6f6e 652c 0a29 3a0a  int] = None,.):.
-00006580: 2020 2020 2222 220a 2020 2020 4164 6420      """.    Add 
-00006590: 6120 636f 6c75 6d6e 2074 6f20 6120 6c61  a column to a la
-000065a0: 7965 7220 6f66 2074 6865 2067 656f 6669  yer of the geofi
-000065b0: 6c65 2e0a 0a20 2020 2041 7267 733a 0a20  le...    Args:. 
-000065c0: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-000065d0: 684c 696b 6529 3a20 5061 7468 2074 6f20  hLike): Path to 
-000065e0: 7468 6520 6765 6f66 696c 652e 0a20 2020  the geofile..   
-000065f0: 2020 2020 206e 616d 6520 2873 7472 293a       name (str):
-00006600: 204e 616d 6520 666f 7220 7468 6520 6e65   Name for the ne
-00006610: 7720 636f 6c75 6d6e 2e0a 2020 2020 2020  w column..      
-00006620: 2020 7479 7065 2028 7374 7229 3a20 436f    type (str): Co
-00006630: 6c75 6d6e 2074 7970 6520 6f66 2074 6865  lumn type of the
-00006640: 206e 6577 2063 6f6c 756d 6e2e 0a20 2020   new column..   
-00006650: 2020 2020 2065 7870 7265 7373 696f 6e20       expression 
-00006660: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00006670: 2053 514c 6974 6520 6578 7072 6573 7369   SQLite expressi
-00006680: 6f6e 2074 6f20 7573 6520 746f 2075 7064  on to use to upd
-00006690: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-000066a0: 7468 6520 7661 6c75 652e 2044 6566 6175  the value. Defau
-000066b0: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
-000066c0: 2020 2020 2065 7870 7265 7373 696f 6e5f       expression_
-000066d0: 6469 616c 6563 7420 2873 7472 2c20 6f70  dialect (str, op
-000066e0: 7469 6f6e 616c 293a 2053 514c 2064 6961  tional): SQL dia
-000066f0: 6c65 6374 2075 7365 6420 666f 7220 7468  lect used for th
-00006700: 6520 6578 7072 6573 7369 6f6e 2e0a 2020  e expression..  
-00006710: 2020 2020 2020 6c61 7965 7220 2873 7472        layer (str
-00006720: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
-00006730: 206c 6179 6572 206e 616d 652e 2049 6620   layer name. If 
-00006740: 4e6f 6e65 2061 6e64 2074 6865 2067 656f  None and the geo
-00006750: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00006760: 2068 6173 206f 6e6c 7920 6f6e 6520 6c61   has only one la
-00006770: 7965 722c 2074 6861 7420 6c61 7965 7220  yer, that layer 
-00006780: 6973 2075 7365 642e 2044 6566 6175 6c74  is used. Default
-00006790: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-000067a0: 2020 2066 6f72 6365 5f75 7064 6174 6520     force_update 
-000067b0: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
-000067c0: 3a20 4966 2074 6865 2063 6f6c 756d 6e20  : If the column 
-000067d0: 616c 7265 6164 7920 6578 6973 7473 2c20  already exists, 
-000067e0: 6578 6563 7574 650a 2020 2020 2020 2020  execute.        
-000067f0: 2020 2020 7468 6520 7570 6461 7465 2061      the update a
-00006800: 6e79 7761 792e 2044 6566 6175 6c74 7320  nyway. Defaults 
-00006810: 746f 2046 616c 7365 2e0a 2020 2020 2020  to False..      
-00006820: 2020 7769 6474 6820 2869 6e74 2c20 6f70    width (int, op
-00006830: 7469 6f6e 616c 293a 2074 6865 2077 6964  tional): the wid
-00006840: 7468 206f 6620 7468 6520 6669 656c 642e  th of the field.
-00006850: 0a0a 2020 2020 5261 6973 6573 3a0a 2020  ..    Raises:.  
-00006860: 2020 2020 2020 6578 3a20 5b64 6573 6372        ex: [descr
-00006870: 6970 7469 6f6e 5d0a 2020 2020 2222 220a  iption].    """.
-00006880: 2020 2020 2320 496e 6974 0a20 2020 2069      # Init.    i
-00006890: 6620 6973 696e 7374 616e 6365 2874 7970  f isinstance(typ
-000068a0: 652c 2044 6174 6154 7970 6529 3a0a 2020  e, DataType):.  
-000068b0: 2020 2020 2020 7479 7065 5f73 7472 203d        type_str =
-000068c0: 2074 7970 652e 7661 6c75 650a 2020 2020   type.value.    
-000068d0: 656c 7365 3a0a 2020 2020 2020 2020 7479  else:.        ty
-000068e0: 7065 5f6c 6f77 6572 203d 2074 7970 652e  pe_lower = type.
-000068f0: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-00006900: 6966 2074 7970 655f 6c6f 7765 7220 3d3d  if type_lower ==
-00006910: 2022 7374 7269 6e67 223a 0a20 2020 2020   "string":.     
-00006920: 2020 2020 2020 2023 2054 4f44 4f3a 2074         # TODO: t
-00006930: 6869 6e6b 2077 6865 7468 6572 2062 6569  hink whether bei
-00006940: 6e67 2066 6c65 7869 626c 6520 6865 7265  ng flexible here
-00006950: 2069 7320 6120 676f 6f64 2069 6465 612e   is a good idea.
-00006960: 2e2e 0a20 2020 2020 2020 2020 2020 2074  ...            t
-00006970: 7970 655f 7374 7220 3d20 2254 4558 5422  ype_str = "TEXT"
-00006980: 0a20 2020 2020 2020 2065 6c69 6620 7479  .        elif ty
-00006990: 7065 5f6c 6f77 6572 203d 3d20 2262 696e  pe_lower == "bin
-000069a0: 6172 7922 3a0a 2020 2020 2020 2020 2020  ary":.          
-000069b0: 2020 7479 7065 5f73 7472 203d 2022 424c    type_str = "BL
-000069c0: 4f42 220a 2020 2020 2020 2020 656c 6966  OB".        elif
-000069d0: 2074 7970 655f 6c6f 7765 7220 3d3d 2022   type_lower == "
-000069e0: 7469 6d65 223a 0a20 2020 2020 2020 2020  time":.         
-000069f0: 2020 2074 7970 655f 7374 7220 3d20 2244     type_str = "D
-00006a00: 4154 4554 494d 4522 0a20 2020 2020 2020  ATETIME".       
-00006a10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006a20: 2020 2074 7970 655f 7374 7220 3d20 7479     type_str = ty
-00006a30: 7065 0a20 2020 2070 6174 6820 3d20 5061  pe.    path = Pa
-00006a40: 7468 2870 6174 6829 0a20 2020 2069 6620  th(path).    if 
-00006a50: 6c61 7965 7220 6973 204e 6f6e 653a 0a20  layer is None:. 
-00006a60: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
-00006a70: 6574 5f6f 6e6c 795f 6c61 7965 7228 7061  et_only_layer(pa
-00006a80: 7468 290a 2020 2020 6c61 7965 7269 6e66  th).    layerinf
-00006a90: 6f5f 6f72 6967 203d 2067 6574 5f6c 6179  o_orig = get_lay
-00006aa0: 6572 696e 666f 2870 6174 682c 206c 6179  erinfo(path, lay
-00006ab0: 6572 290a 0a20 2020 2023 2047 6f21 0a20  er)..    # Go!. 
-00006ac0: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
-00006ad0: 4e6f 6e65 0a20 2020 2074 7279 3a0a 2020  None.    try:.  
-00006ae0: 2020 2020 2020 2320 4966 2063 6f6c 756d        # If colum
-00006af0: 6e20 646f 6573 6e27 7420 6578 6973 7420  n doesn't exist 
-00006b00: 7965 742c 2063 7265 6174 6520 6974 0a20  yet, create it. 
-00006b10: 2020 2020 2020 2063 6f6c 756d 6e73 5f75         columns_u
-00006b20: 7070 6572 203d 205b 636f 6c75 6d6e 2e75  pper = [column.u
-00006b30: 7070 6572 2829 2066 6f72 2063 6f6c 756d  pper() for colum
-00006b40: 6e20 696e 206c 6179 6572 696e 666f 5f6f  n in layerinfo_o
-00006b50: 7269 672e 636f 6c75 6d6e 735d 0a20 2020  rig.columns].   
-00006b60: 2020 2020 2069 6620 6e61 6d65 2e75 7070       if name.upp
-00006b70: 6572 2829 206e 6f74 2069 6e20 636f 6c75  er() not in colu
-00006b80: 6d6e 735f 7570 7065 723a 0a20 2020 2020  mns_upper:.     
-00006b90: 2020 2020 2020 2077 6964 7468 5f73 7472         width_str
-00006ba0: 203d 2066 2228 7b77 6964 7468 7d29 2220   = f"({width})" 
-00006bb0: 6966 2077 6964 7468 2069 7320 6e6f 7420  if width is not 
-00006bc0: 4e6f 6e65 2065 6c73 6520 2222 0a20 2020  None else "".   
-00006bd0: 2020 2020 2020 2020 2073 716c 5f73 746d           sql_stm
-00006be0: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
-00006bf0: 2020 2020 2020 6627 414c 5445 5220 5441        f'ALTER TA
-00006c00: 424c 4520 227b 6c61 7965 727d 2220 4144  BLE "{layer}" AD
-00006c10: 4420 434f 4c55 4d4e 2022 7b6e 616d 657d  D COLUMN "{name}
-00006c20: 2220 7b74 7970 655f 7374 727d 7b77 6964  " {type_str}{wid
-00006c30: 7468 5f73 7472 7d27 0a20 2020 2020 2020  th_str}'.       
-00006c40: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006c50: 2020 2064 6174 6173 6f75 7263 6520 3d20     datasource = 
-00006c60: 6764 616c 2e4f 7065 6e45 7828 7374 7228  gdal.OpenEx(str(
-00006c70: 7061 7468 292c 206e 4f70 656e 466c 6167  path), nOpenFlag
-00006c80: 733d 6764 616c 2e4f 465f 5550 4441 5445  s=gdal.OF_UPDATE
-00006c90: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006ca0: 7375 6c74 203d 2064 6174 6173 6f75 7263  sult = datasourc
-00006cb0: 652e 4578 6563 7574 6553 514c 2873 716c  e.ExecuteSQL(sql
-00006cc0: 5f73 746d 7429 0a20 2020 2020 2020 2020  _stmt).         
-00006cd0: 2020 2064 6174 6173 6f75 7263 652e 5265     datasource.Re
-00006ce0: 6c65 6173 6552 6573 756c 7453 6574 2872  leaseResultSet(r
-00006cf0: 6573 756c 7429 0a20 2020 2020 2020 2065  esult).        e
-00006d00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00006d10: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00006d20: 6622 436f 6c75 6d6e 207b 6e61 6d65 7d20  f"Column {name} 
-00006d30: 6578 6973 7465 6420 616c 7265 6164 7920  existed already 
-00006d40: 696e 207b 7061 7468 7d2c 206c 6179 6572  in {path}, layer
-00006d50: 207b 6c61 7965 727d 2229 0a0a 2020 2020   {layer}")..    
-00006d60: 2020 2020 2320 4966 2061 6e20 6578 7072      # If an expr
-00006d70: 6573 7369 6f6e 2077 6173 2070 726f 7669  ession was provi
-00006d80: 6465 6420 616e 6420 7570 6461 7465 2063  ded and update c
-00006d90: 616e 2062 6520 646f 6e65 2c20 676f 2066  an be done, go f
-00006da0: 6f72 2069 742e 2e2e 0a20 2020 2020 2020  or it....       
-00006db0: 2069 6620 6578 7072 6573 7369 6f6e 2069   if expression i
-00006dc0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2028  s not None and (
-00006dd0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-00006de0: 6520 6e6f 7420 696e 206c 6179 6572 696e  e not in layerin
-00006df0: 666f 5f6f 7269 672e 636f 6c75 6d6e 7320  fo_orig.columns 
-00006e00: 6f72 2066 6f72 6365 5f75 7064 6174 6520  or force_update 
-00006e10: 6973 2054 7275 650a 2020 2020 2020 2020  is True.        
-00006e20: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00006e30: 6620 6461 7461 736f 7572 6365 2069 7320  f datasource is 
-00006e40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006e50: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
-00006e60: 203d 2067 6461 6c2e 4f70 656e 4578 2873   = gdal.OpenEx(s
-00006e70: 7472 2870 6174 6829 2c20 6e4f 7065 6e46  tr(path), nOpenF
-00006e80: 6c61 6773 3d67 6461 6c2e 4f46 5f55 5044  lags=gdal.OF_UPD
-00006e90: 4154 4529 0a20 2020 2020 2020 2020 2020  ATE).           
-00006ea0: 2073 716c 5f73 746d 7420 3d20 6627 5550   sql_stmt = f'UP
-00006eb0: 4441 5445 2022 7b6c 6179 6572 7d22 2053  DATE "{layer}" S
-00006ec0: 4554 2022 7b6e 616d 657d 2220 3d20 7b65  ET "{name}" = {e
-00006ed0: 7870 7265 7373 696f 6e7d 270a 2020 2020  xpression}'.    
-00006ee0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00006ef0: 2064 6174 6173 6f75 7263 652e 4578 6563   datasource.Exec
-00006f00: 7574 6553 514c 2873 716c 5f73 746d 742c  uteSQL(sql_stmt,
-00006f10: 2064 6961 6c65 6374 3d65 7870 7265 7373   dialect=express
-00006f20: 696f 6e5f 6469 616c 6563 7429 0a20 2020  ion_dialect).   
-00006f30: 2020 2020 2020 2020 2064 6174 6173 6f75           datasou
-00006f40: 7263 652e 5265 6c65 6173 6552 6573 756c  rce.ReleaseResul
-00006f50: 7453 6574 2872 6573 756c 7429 0a0a 2020  tSet(result)..  
-00006f60: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00006f70: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-00006f80: 2020 6578 2e61 7267 7320 3d20 2866 2261    ex.args = (f"a
-00006f90: 6464 5f63 6f6c 756d 6e20 6572 726f 7220  dd_column error 
-00006fa0: 666f 7220 7b70 6174 687d 2e7b 6c61 7965  for {path}.{laye
-00006fb0: 727d 3a5c 6e20 207b 6578 7d22 2c29 0a20  r}:\n  {ex}",). 
-00006fc0: 2020 2020 2020 2072 6169 7365 0a20 2020         raise.   
-00006fd0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00006fe0: 2020 6461 7461 736f 7572 6365 203d 204e    datasource = N
-00006ff0: 6f6e 650a 0a0a 6465 6620 6472 6f70 5f63  one...def drop_c
-00007000: 6f6c 756d 6e28 0a20 2020 2070 6174 683a  olumn(.    path:
-00007010: 2055 6e69 6f6e 5b73 7472 2c20 226f 732e   Union[str, "os.
-00007020: 5061 7468 4c69 6b65 5b41 6e79 5d22 5d2c  PathLike[Any]"],
-00007030: 2063 6f6c 756d 6e5f 6e61 6d65 3a20 7374   column_name: st
-00007040: 722c 206c 6179 6572 3a20 4f70 7469 6f6e  r, layer: Option
-00007050: 616c 5b73 7472 5d20 3d20 4e6f 6e65 0a29  al[str] = None.)
-00007060: 3a0a 2020 2020 2222 220a 2020 2020 4472  :.    """.    Dr
-00007070: 6f70 2074 6865 2063 6f6c 756d 6e20 7370  op the column sp
-00007080: 6563 6966 6965 642e 0a0a 2020 2020 4172  ecified...    Ar
-00007090: 6773 3a0a 2020 2020 2020 2020 7061 7468  gs:.        path
-000070a0: 2028 5061 7468 4c69 6b65 293a 2054 6865   (PathLike): The
-000070b0: 2066 696c 6520 7061 7468 2e0a 2020 2020   file path..    
-000070c0: 2020 2020 636f 6c75 6d6e 5f6e 616d 6520      column_name 
-000070d0: 2873 7472 293a 2074 6865 2063 6f6c 756d  (str): the colum
-000070e0: 6e20 6e61 6d65 2e0a 2020 2020 2020 2020  n name..        
-000070f0: 6c61 7965 7220 284f 7074 696f 6e61 6c5b  layer (Optional[
-00007100: 7374 725d 293a 2054 6865 206c 6179 6572  str]): The layer
-00007110: 206e 616d 652e 2049 6620 6e6f 7420 7370   name. If not sp
-00007120: 6563 6966 6965 642c 2061 6e64 2074 6865  ecified, and the
-00007130: 7265 2069 7320 6f6e 6c79 0a20 2020 2020  re is only.     
-00007140: 2020 2020 2020 206f 6e65 206c 6179 6572         one layer
-00007150: 2069 6e20 7468 6520 6669 6c65 2c20 7468   in the file, th
-00007160: 6973 206c 6179 6572 2069 7320 7573 6564  is layer is used
-00007170: 2e20 4f74 6865 7277 6973 6520 6120 5661  . Otherwise a Va
-00007180: 6c75 6545 7272 6f72 2069 730a 2020 2020  lueError is.    
-00007190: 2020 2020 2020 2020 7261 6973 6564 2e0a          raised..
-000071a0: 2020 2020 2222 220a 2020 2020 2320 4368      """.    # Ch
-000071b0: 6563 6b20 696e 7075 7420 7061 7261 6d65  eck input parame
-000071c0: 7465 7273 0a20 2020 2070 6174 6820 3d20  ters.    path = 
-000071d0: 5061 7468 2870 6174 6829 0a20 2020 2069  Path(path).    i
-000071e0: 6620 6c61 7965 7220 6973 204e 6f6e 653a  f layer is None:
-000071f0: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
-00007200: 2067 6574 5f6f 6e6c 795f 6c61 7965 7228   get_only_layer(
-00007210: 7061 7468 290a 2020 2020 696e 666f 203d  path).    info =
-00007220: 2067 6574 5f6c 6179 6572 696e 666f 2870   get_layerinfo(p
-00007230: 6174 682c 206c 6179 6572 290a 2020 2020  ath, layer).    
-00007240: 6966 2063 6f6c 756d 6e5f 6e61 6d65 206e  if column_name n
-00007250: 6f74 2069 6e20 696e 666f 2e63 6f6c 756d  ot in info.colum
-00007260: 6e73 3a0a 2020 2020 2020 2020 6c6f 6767  ns:.        logg
-00007270: 6572 2e69 6e66 6f28 6622 436f 6c75 6d6e  er.info(f"Column
-00007280: 207b 636f 6c75 6d6e 5f6e 616d 657d 206e   {column_name} n
-00007290: 6f74 2070 7265 7365 6e74 2073 6f20 6361  ot present so ca
-000072a0: 6e6e 6f74 2062 6520 6472 6f70 7065 642e  nnot be dropped.
-000072b0: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-000072c0: 6e0a 0a20 2020 2023 204e 6f77 2072 6561  n..    # Now rea
-000072d0: 6c6c 7920 7265 6e61 6d65 0a20 2020 2064  lly rename.    d
-000072e0: 6174 6173 6f75 7263 6520 3d20 4e6f 6e65  atasource = None
-000072f0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00007300: 2020 6461 7461 736f 7572 6365 203d 2067    datasource = g
-00007310: 6461 6c2e 4f70 656e 4578 2873 7472 2870  dal.OpenEx(str(p
-00007320: 6174 6829 2c20 6e4f 7065 6e46 6c61 6773  ath), nOpenFlags
-00007330: 3d67 6461 6c2e 4f46 5f55 5044 4154 4529  =gdal.OF_UPDATE)
-00007340: 0a20 2020 2020 2020 2073 716c 5f73 746d  .        sql_stm
-00007350: 7420 3d20 6627 414c 5445 5220 5441 424c  t = f'ALTER TABL
-00007360: 4520 227b 6c61 7965 727d 2220 4452 4f50  E "{layer}" DROP
-00007370: 2043 4f4c 554d 4e20 227b 636f 6c75 6d6e   COLUMN "{column
-00007380: 5f6e 616d 657d 2227 0a20 2020 2020 2020  _name}"'.       
-00007390: 2072 6573 756c 7420 3d20 6461 7461 736f   result = dataso
-000073a0: 7572 6365 2e45 7865 6375 7465 5351 4c28  urce.ExecuteSQL(
-000073b0: 7371 6c5f 7374 6d74 290a 2020 2020 2020  sql_stmt).      
-000073c0: 2020 6461 7461 736f 7572 6365 2e52 656c    datasource.Rel
-000073d0: 6561 7365 5265 7375 6c74 5365 7428 7265  easeResultSet(re
-000073e0: 7375 6c74 290a 0a20 2020 2065 7863 6570  sult)..    excep
-000073f0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00007400: 783a 0a20 2020 2020 2020 2065 782e 6172  x:.        ex.ar
-00007410: 6773 203d 2028 6622 6472 6f70 5f63 6f6c  gs = (f"drop_col
-00007420: 756d 6e20 6572 726f 7220 666f 7220 7b70  umn error for {p
-00007430: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
-00007440: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
-00007450: 2072 6169 7365 0a20 2020 2066 696e 616c   raise.    final
-00007460: 6c79 3a0a 2020 2020 2020 2020 6461 7461  ly:.        data
-00007470: 736f 7572 6365 203d 204e 6f6e 650a 0a0a  source = None...
-00007480: 6465 6620 7570 6461 7465 5f63 6f6c 756d  def update_colum
-00007490: 6e28 0a20 2020 2070 6174 683a 2055 6e69  n(.    path: Uni
-000074a0: 6f6e 5b73 7472 2c20 226f 732e 5061 7468  on[str, "os.Path
-000074b0: 4c69 6b65 5b41 6e79 5d22 5d2c 0a20 2020  Like[Any]"],.   
-000074c0: 206e 616d 653a 2073 7472 2c0a 2020 2020   name: str,.    
-000074d0: 6578 7072 6573 7369 6f6e 3a20 7374 722c  expression: str,
-000074e0: 0a20 2020 206c 6179 6572 3a20 4f70 7469  .    layer: Opti
-000074f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00007500: 2c0a 2020 2020 7768 6572 653a 204f 7074  ,.    where: Opt
-00007510: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00007520: 652c 0a29 3a0a 2020 2020 2222 220a 2020  e,.):.    """.  
-00007530: 2020 5570 6461 7465 2061 2063 6f6c 756d    Update a colum
-00007540: 6e20 6672 6f6d 2061 206c 6179 6572 206f  n from a layer o
-00007550: 6620 7468 6520 6765 6f66 696c 652e 0a0a  f the geofile...
-00007560: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00007570: 2020 7061 7468 2028 5061 7468 4c69 6b65    path (PathLike
-00007580: 293a 2050 6174 6820 746f 2074 6865 2067  ): Path to the g
-00007590: 656f 6669 6c65 0a20 2020 2020 2020 206e  eofile.        n
-000075a0: 616d 6520 2873 7472 293a 204e 616d 6520  ame (str): Name 
-000075b0: 666f 7220 7468 6520 6e65 7720 636f 6c75  for the new colu
-000075c0: 6d6e 0a20 2020 2020 2020 2065 7870 7265  mn.        expre
-000075d0: 7373 696f 6e20 2873 7472 293a 2053 514c  ssion (str): SQL
-000075e0: 6974 6520 6578 7072 6573 7369 6f6e 2074  ite expression t
-000075f0: 6f20 7573 6520 746f 2075 7064 6174 650a  o use to update.
-00007600: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00007610: 7661 6c75 652e 0a20 2020 2020 2020 206c  value..        l
-00007620: 6179 6572 2028 7374 722c 206f 7074 696f  ayer (str, optio
-00007630: 6e61 6c29 3a20 5468 6520 6c61 7965 7220  nal): The layer 
-00007640: 6e61 6d65 2e20 4966 204e 6f6e 6520 616e  name. If None an
-00007650: 6420 7468 6520 6765 6f66 696c 650a 2020  d the geofile.  
-00007660: 2020 2020 2020 2020 2020 6861 7320 6f6e            has on
-00007670: 6c79 206f 6e65 206c 6179 6572 2c20 7468  ly one layer, th
-00007680: 6174 206c 6179 6572 2069 7320 7573 6564  at layer is used
-00007690: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-000076a0: 6e65 2e0a 2020 2020 2020 2020 6c61 7965  ne..        laye
-000076b0: 7220 2873 7472 2c20 6f70 7469 6f6e 616c  r (str, optional
-000076c0: 293a 2053 514c 2077 6865 7265 2063 6c61  ): SQL where cla
-000076d0: 7573 6520 746f 2072 6573 7472 6963 7420  use to restrict 
-000076e0: 7468 6520 726f 7773 2074 6861 7420 7769  the rows that wi
-000076f0: 6c6c 0a20 2020 2020 2020 2020 2020 2062  ll.            b
-00007700: 6520 7570 6461 7465 642e 2044 6566 6175  e updated. Defau
-00007710: 6c74 7320 746f 204e 6f6e 652e 0a0a 2020  lts to None...  
-00007720: 2020 5261 6973 6573 3a0a 2020 2020 2020    Raises:.      
-00007730: 2020 5661 6c75 6545 7272 6f72 3a20 616e    ValueError: an
-00007740: 2069 6e76 616c 6964 2070 6172 616d 6574   invalid paramet
-00007750: 6572 2076 616c 7565 2077 6173 2070 6173  er value was pas
-00007760: 7365 642e 0a20 2020 2022 2222 0a0a 2020  sed..    """..  
-00007770: 2020 2320 496e 6974 0a20 2020 2070 6174    # Init.    pat
-00007780: 6820 3d20 5061 7468 2870 6174 6829 0a20  h = Path(path). 
-00007790: 2020 2069 6620 6c61 7965 7220 6973 204e     if layer is N
-000077a0: 6f6e 653a 0a20 2020 2020 2020 206c 6179  one:.        lay
-000077b0: 6572 203d 2067 6574 5f6f 6e6c 795f 6c61  er = get_only_la
-000077c0: 7965 7228 7061 7468 290a 2020 2020 6c61  yer(path).    la
-000077d0: 7965 7269 6e66 6f5f 6f72 6967 203d 2067  yerinfo_orig = g
-000077e0: 6574 5f6c 6179 6572 696e 666f 2870 6174  et_layerinfo(pat
-000077f0: 682c 206c 6179 6572 290a 2020 2020 636f  h, layer).    co
-00007800: 6c75 6d6e 735f 7570 7065 7220 3d20 5b63  lumns_upper = [c
-00007810: 6f6c 756d 6e2e 7570 7065 7228 2920 666f  olumn.upper() fo
-00007820: 7220 636f 6c75 6d6e 2069 6e20 6c61 7965  r column in laye
-00007830: 7269 6e66 6f5f 6f72 6967 2e63 6f6c 756d  rinfo_orig.colum
-00007840: 6e73 5d0a 2020 2020 6966 206e 616d 652e  ns].    if name.
-00007850: 7570 7065 7228 2920 6e6f 7420 696e 2063  upper() not in c
-00007860: 6f6c 756d 6e73 5f75 7070 6572 3a0a 2020  olumns_upper:.  
-00007870: 2020 2020 2020 2320 4966 2063 6f6c 756d        # If colum
-00007880: 6e20 646f 6573 6e27 7420 6578 6973 7420  n doesn't exist 
-00007890: 7965 742c 2065 7272 6f72 210a 2020 2020  yet, error!.    
-000078a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000078b0: 7272 6f72 2866 2243 6f6c 756d 6e20 7b6e  rror(f"Column {n
-000078c0: 616d 657d 2064 6f65 736e 2774 2065 7869  ame} doesn't exi
-000078d0: 7374 2069 6e20 7b70 6174 687d 2c20 6c61  st in {path}, la
-000078e0: 7965 7220 7b6c 6179 6572 7d22 290a 0a20  yer {layer}").. 
-000078f0: 2020 2023 2047 6f21 0a20 2020 2064 6174     # Go!.    dat
-00007900: 6173 6f75 7263 6520 3d20 4e6f 6e65 0a20  asource = None. 
-00007910: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00007920: 6461 7461 736f 7572 6365 203d 2067 6461  datasource = gda
-00007930: 6c2e 4f70 656e 4578 2873 7472 2870 6174  l.OpenEx(str(pat
-00007940: 6829 2c20 6e4f 7065 6e46 6c61 6773 3d67  h), nOpenFlags=g
-00007950: 6461 6c2e 4f46 5f55 5044 4154 4529 0a20  dal.OF_UPDATE). 
-00007960: 2020 2020 2020 2073 716c 6974 655f 7374         sqlite_st
-00007970: 6d74 203d 2066 2755 5044 4154 4520 227b  mt = f'UPDATE "{
-00007980: 6c61 7965 727d 2220 5345 5420 227b 6e61  layer}" SET "{na
-00007990: 6d65 7d22 203d 207b 6578 7072 6573 7369  me}" = {expressi
-000079a0: 6f6e 7d27 0a20 2020 2020 2020 2069 6620  on}'.        if 
-000079b0: 7768 6572 6520 6973 206e 6f74 204e 6f6e  where is not Non
-000079c0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-000079d0: 716c 6974 655f 7374 6d74 202b 3d20 6622  qlite_stmt += f"
-000079e0: 5c6e 2057 4845 5245 207b 7768 6572 657d  \n WHERE {where}
-000079f0: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
-00007a00: 203d 2064 6174 6173 6f75 7263 652e 4578   = datasource.Ex
-00007a10: 6563 7574 6553 514c 2873 716c 6974 655f  ecuteSQL(sqlite_
-00007a20: 7374 6d74 2c20 6469 616c 6563 743d 2253  stmt, dialect="S
-00007a30: 514c 4954 4522 290a 2020 2020 2020 2020  QLITE").        
-00007a40: 6461 7461 736f 7572 6365 2e52 656c 6561  datasource.Relea
-00007a50: 7365 5265 7375 6c74 5365 7428 7265 7375  seResultSet(resu
-00007a60: 6c74 290a 0a20 2020 2065 7863 6570 7420  lt)..    except 
-00007a70: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
-00007a80: 0a20 2020 2020 2020 2065 782e 6172 6773  .        ex.args
-00007a90: 203d 2028 6622 7570 6461 7465 5f63 6f6c   = (f"update_col
-00007aa0: 756d 6e20 6572 726f 7220 666f 7220 7b70  umn error for {p
-00007ab0: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
-00007ac0: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
-00007ad0: 2072 6169 7365 0a20 2020 2066 696e 616c   raise.    final
-00007ae0: 6c79 3a0a 2020 2020 2020 2020 6461 7461  ly:.        data
-00007af0: 736f 7572 6365 203d 204e 6f6e 650a 0a0a  source = None...
-00007b00: 6465 6620 7265 6164 5f66 696c 6528 0a20  def read_file(. 
-00007b10: 2020 2070 6174 683a 2055 6e69 6f6e 5b73     path: Union[s
-00007b20: 7472 2c20 226f 732e 5061 7468 4c69 6b65  tr, "os.PathLike
-00007b30: 5b41 6e79 5d22 5d2c 0a20 2020 206c 6179  [Any]"],.    lay
-00007b40: 6572 3a20 4f70 7469 6f6e 616c 5b73 7472  er: Optional[str
-00007b50: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 636f  ] = None,.    co
-00007b60: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
-00007b70: 4974 6572 6162 6c65 5b73 7472 5d5d 203d  Iterable[str]] =
-00007b80: 204e 6f6e 652c 0a20 2020 2062 626f 783d   None,.    bbox=
-00007b90: 4e6f 6e65 2c0a 2020 2020 726f 7773 3d4e  None,.    rows=N
-00007ba0: 6f6e 652c 0a20 2020 2073 716c 5f73 746d  one,.    sql_stm
-00007bb0: 743a 204f 7074 696f 6e61 6c5b 7374 725d  t: Optional[str]
-00007bc0: 203d 204e 6f6e 652c 0a20 2020 2073 716c   = None,.    sql
-00007bd0: 5f64 6961 6c65 6374 3a20 4f70 7469 6f6e  _dialect: Option
-00007be0: 616c 5b4c 6974 6572 616c 5b22 5351 4c49  al[Literal["SQLI
-00007bf0: 5445 222c 2022 4f47 5253 514c 225d 5d20  TE", "OGRSQL"]] 
-00007c00: 3d20 4e6f 6e65 2c0a 2020 2020 6967 6e6f  = None,.    igno
-00007c10: 7265 5f67 656f 6d65 7472 793a 2062 6f6f  re_geometry: boo
-00007c20: 6c20 3d20 4661 6c73 652c 0a20 2020 2066  l = False,.    f
-00007c30: 6964 5f61 735f 696e 6465 783a 2062 6f6f  id_as_index: boo
-00007c40: 6c20 3d20 4661 6c73 652c 0a29 202d 3e20  l = False,.) -> 
-00007c50: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
-00007c60: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00007c70: 6164 7320 6120 6669 6c65 2074 6f20 6120  ads a file to a 
-00007c80: 6765 6f70 616e 6461 7320 4765 6f44 6174  geopandas GeoDat
-00007c90: 6166 7261 6d65 2e0a 0a20 2020 2054 6865  aframe...    The
-00007ca0: 2066 696c 6520 666f 726d 6174 2069 7320   file format is 
-00007cb0: 6465 7465 6374 6564 2062 6173 6564 206f  detected based o
-00007cc0: 6e20 7468 6520 6669 6c65 7061 7468 2065  n the filepath e
-00007cd0: 7874 656e 7369 6f6e 2e0a 0a20 2020 2049  xtension...    I
-00007ce0: 6620 616e 2073 716c 5f73 746d 7420 6973  f an sql_stmt is
-00007cf0: 2073 7065 6369 6669 6564 2c20 7468 6520   specified, the 
-00007d00: 7371 6c69 7465 2071 7565 7279 2063 616e  sqlite query can
-00007d10: 2063 6f6e 7461 696e 2066 6f6c 6c6f 7769   contain followi
-00007d20: 6e67 2070 6c61 6365 686f 6c64 6572 730a  ng placeholders.
-00007d30: 2020 2020 7468 6174 2077 696c 6c20 6265      that will be
-00007d40: 2061 7574 6f6d 6174 6963 616c 6c79 2072   automatically r
-00007d50: 6570 6c61 6365 6420 666f 7220 796f 753a  eplaced for you:
-00007d60: 0a0a 2020 2020 2020 2a20 7b67 656f 6d65  ..      * {geome
-00007d70: 7472 7963 6f6c 756d 6e7d 3a20 7468 6520  trycolumn}: the 
-00007d80: 636f 6c75 6d6e 2077 6865 7265 2074 6865  column where the
-00007d90: 2070 7269 6d61 7279 2067 656f 6d65 7472   primary geometr
-00007da0: 7920 6973 2073 746f 7265 642e 0a20 2020  y is stored..   
-00007db0: 2020 202a 207b 636f 6c75 6d6e 735f 746f     * {columns_to
-00007dc0: 5f73 656c 6563 745f 7374 727d 3a20 6966  _select_str}: if
-00007dd0: 2027 636f 6c75 6d6e 7327 2069 7320 6e6f   'columns' is no
-00007de0: 7420 4e6f 6e65 2c20 7468 6f73 6520 636f  t None, those co
-00007df0: 6c75 6d6e 732c 0a20 2020 2020 2020 206f  lumns,.        o
-00007e00: 7468 6572 7769 7365 2061 6c6c 2063 6f6c  therwise all col
-00007e10: 756d 6e73 206f 6620 7468 6520 6c61 7965  umns of the laye
-00007e20: 722e 0a20 2020 2020 202a 207b 696e 7075  r..      * {inpu
-00007e30: 745f 6c61 7965 727d 3a20 7468 6520 6c61  t_layer}: the la
-00007e40: 7965 7220 6e61 6d65 206f 6620 7468 6520  yer name of the 
-00007e50: 696e 7075 7420 6c61 7965 722e 0a0a 2020  input layer...  
-00007e60: 2020 4578 616d 706c 6520 7371 6c20 7374    Example sql st
-00007e70: 6174 656d 656e 7420 7769 7468 2070 6c61  atement with pla
-00007e80: 6365 686f 6c64 6572 733a 0a20 2020 203a  ceholders:.    :
-00007e90: 3a0a 0a20 2020 2020 2020 2053 454c 4543  :..        SELEC
-00007ea0: 5420 7b67 656f 6d65 7472 7963 6f6c 756d  T {geometrycolum
-00007eb0: 6e7d 0a20 2020 2020 2020 2020 2020 2020  n}.             
-00007ec0: 207b 636f 6c75 6d6e 735f 746f 5f73 656c   {columns_to_sel
-00007ed0: 6563 745f 7374 727d 0a20 2020 2020 2020  ect_str}.       
-00007ee0: 2020 2046 524f 4d20 227b 696e 7075 745f     FROM "{input_
-00007ef0: 6c61 7965 727d 2220 6c61 7965 720a 0a20  layer}" layer.. 
-00007f00: 2020 2054 6865 2075 6e64 6572 6c79 696e     The underlyin
-00007f10: 6720 6c69 6272 6172 7920 7573 6564 2074  g library used t
-00007f20: 6f20 7265 6164 2074 6865 2066 696c 6520  o read the file 
-00007f30: 6361 6e20 6265 2063 686f 6f73 656e 2075  can be choosen u
-00007f40: 7369 6e67 2074 6865 0a20 2020 2022 4746  sing the.    "GF
-00007f50: 4f5f 494f 5f45 4e47 494e 4522 2065 6e76  O_IO_ENGINE" env
-00007f60: 6972 6f6e 6d65 6e74 2076 6172 6961 626c  ironment variabl
-00007f70: 652e 2050 6f73 7369 626c 6520 7661 6c75  e. Possible valu
-00007f80: 6573 2061 7265 2022 6669 6f6e 6122 2061  es are "fiona" a
-00007f90: 6e64 2022 7079 6f67 7269 6f22 2e0a 2020  nd "pyogrio"..  
-00007fa0: 2020 5468 6973 206f 7074 696f 6e20 6973    This option is
-00007fb0: 2063 7265 6174 6564 2061 7320 6120 7465   created as a te
-00007fc0: 6d70 6f72 6172 7920 6661 6c6c 6261 636b  mporary fallback
-00007fd0: 2074 6f20 2266 696f 6e61 2220 666f 7220   to "fiona" for 
-00007fe0: 6361 7365 7320 7768 6572 6520 2270 796f  cases where "pyo
-00007ff0: 6772 696f 220a 2020 2020 6769 7665 7320  grio".    gives 
-00008000: 6973 7375 6573 2c20 736f 2070 6c65 6173  issues, so pleas
-00008010: 6520 7265 706f 7274 2069 7373 7565 7320  e report issues 
-00008020: 6966 2074 6865 7920 6172 6520 656e 636f  if they are enco
-00008030: 756e 7465 7265 642e 2049 6e20 7468 6520  untered. In the 
-00008040: 6675 7475 7265 2073 7570 706f 7274 0a20  future support. 
-00008050: 2020 2066 6f72 2074 6865 2022 6669 6f6e     for the "fion
-00008060: 6122 2065 6e67 696e 6520 6d6f 7374 206c  a" engine most l
-00008070: 696b 656c 7920 7769 6c6c 2062 6520 7265  ikely will be re
-00008080: 6d6f 7665 642e 2044 6566 6175 6c74 2065  moved. Default e
-00008090: 6e67 696e 6520 6973 2022 7079 6f67 7269  ngine is "pyogri
-000080a0: 6f22 2e0a 0a20 2020 2041 7267 733a 0a20  o"...    Args:. 
-000080b0: 2020 2020 2020 2070 6174 6820 2866 696c         path (fil
-000080c0: 6520 7061 7468 293a 2070 6174 6820 746f  e path): path to
-000080d0: 2074 6865 2066 696c 6520 746f 2072 6561   the file to rea
-000080e0: 6420 6672 6f6d 0a20 2020 2020 2020 206c  d from.        l
-000080f0: 6179 6572 2028 7374 722c 206f 7074 696f  ayer (str, optio
-00008100: 6e61 6c29 3a20 5468 6520 6c61 7965 7220  nal): The layer 
-00008110: 746f 2072 6561 642e 2044 6566 6175 6c74  to read. Default
-00008120: 7320 746f 204e 6f6e 652c 0a20 2020 2020  s to None,.     
-00008130: 2020 2020 2020 2074 6865 6e20 7265 6164         then read
-00008140: 7320 7468 6520 6f6e 6c79 206c 6179 6572  s the only layer
-00008150: 2069 6e20 7468 6520 6669 6c65 206f 7220   in the file or 
-00008160: 7468 726f 7773 2065 7272 6f72 2e0a 2020  throws error..  
-00008170: 2020 2020 2020 636f 6c75 6d6e 7320 2849        columns (I
-00008180: 7465 7261 626c 655b 7374 725d 2c20 6f70  terable[str], op
-00008190: 7469 6f6e 616c 293a 2054 6865 2028 6e6f  tional): The (no
-000081a0: 6e2d 6765 6f6d 6574 7279 2920 636f 6c75  n-geometry) colu
-000081b0: 6d6e 7320 746f 2072 6561 6420 7769 6c6c  mns to read will
-000081c0: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-000081d0: 7265 7475 726e 6564 2069 6e20 7468 6520  returned in the 
-000081e0: 6f72 6465 7220 7370 6563 6966 6965 642e  order specified.
-000081f0: 2049 6620 4e6f 6e65 2c20 616c 6c20 7374   If None, all st
-00008200: 616e 6461 7264 2063 6f6c 756d 6e73 2061  andard columns a
-00008210: 7265 2072 6561 642e 0a20 2020 2020 2020  re read..       
-00008220: 2020 2020 2049 6e20 6164 6469 7469 6f6e       In addition
-00008230: 2074 6f20 7374 616e 6461 7264 2063 6f6c   to standard col
-00008240: 756d 6e73 2c20 6974 2069 7320 616c 736f  umns, it is also
-00008250: 2070 6f73 7369 626c 650a 2020 2020 2020   possible.      
-00008260: 2020 2020 2020 746f 2073 7065 6369 6679        to specify
-00008270: 2022 6669 6422 2c20 6120 756e 6971 7565   "fid", a unique
-00008280: 2069 6e64 6578 2061 7661 696c 6162 6c65   index available
-00008290: 2069 6e20 616c 6c20 696e 7075 7420 6669   in all input fi
-000082a0: 6c65 732e 204e 6f74 6520 7468 6174 2074  les. Note that t
-000082b0: 6865 0a20 2020 2020 2020 2020 2020 2022  he.            "
-000082c0: 6669 6422 2077 696c 6c20 6265 2061 6c69  fid" will be ali
-000082d0: 6173 6564 2065 672e 2074 6f20 2266 6964  ased eg. to "fid
-000082e0: 5f31 222e 2044 6566 6175 6c74 7320 746f  _1". Defaults to
-000082f0: 204e 6f6e 652e 0a20 2020 2020 2020 2062   None..        b
-00008300: 626f 7820 285b 7479 7065 5d2c 206f 7074  box ([type], opt
-00008310: 696f 6e61 6c29 3a20 5265 6164 206f 6e6c  ional): Read onl
-00008320: 7920 6765 6f6d 6574 7269 6573 2069 6e74  y geometries int
-00008330: 6572 7365 6374 696e 6720 7468 6973 2062  ersecting this b
-00008340: 626f 782e 0a20 2020 2020 2020 2020 2020  box..           
-00008350: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00008360: 652c 2074 6865 6e20 616c 6c20 726f 7773  e, then all rows
-00008370: 2061 7265 2072 6561 642e 0a20 2020 2020   are read..     
-00008380: 2020 2072 6f77 7320 285b 7479 7065 5d2c     rows ([type],
-00008390: 206f 7074 696f 6e61 6c29 3a20 5265 6164   optional): Read
-000083a0: 206f 6e6c 7920 7468 6520 726f 7773 2073   only the rows s
-000083b0: 7065 6369 6669 6564 2e0a 2020 2020 2020  pecified..      
-000083c0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-000083d0: 6f20 4e6f 6e65 2c20 7468 656e 2061 6c6c  o None, then all
-000083e0: 2072 6f77 7320 6172 6520 7265 6164 2e0a   rows are read..
-000083f0: 2020 2020 2020 2020 7371 6c5f 7374 6d74          sql_stmt
-00008400: 2028 7374 7229 3a20 7371 6c20 7374 6174   (str): sql stat
-00008410: 656d 656e 7420 746f 2075 7365 2e20 4f6e  ement to use. On
-00008420: 6c79 2073 7570 706f 7274 6564 2077 6974  ly supported wit
-00008430: 6820 2270 796f 6772 696f 2220 656e 6769  h "pyogrio" engi
-00008440: 6e65 2e0a 2020 2020 2020 2020 7371 6c5f  ne..        sql_
-00008450: 6469 616c 6563 7420 2873 7472 2c20 6f70  dialect (str, op
-00008460: 7469 6f6e 616c 293a 2053 716c 2064 6961  tional): Sql dia
-00008470: 6c65 6374 2075 7365 642e 2049 6620 4e6f  lect used. If No
-00008480: 6e65 2c20 666f 7220 6461 7461 2073 6f75  ne, for data sou
-00008490: 7263 6573 2077 6974 680a 2020 2020 2020  rces with.      
-000084a0: 2020 2020 2020 6578 706c 6963 6974 2053        explicit S
-000084b0: 514c 2073 7570 706f 7274 2074 6865 2073  QL support the s
-000084c0: 7461 7465 6d65 6e74 2069 7320 7072 6f63  tatement is proc
-000084d0: 6573 7365 6420 6279 2074 6865 2064 6566  essed by the def
-000084e0: 6175 6c74 2053 514c 2065 6e67 696e 650a  ault SQL engine.
-000084f0: 2020 2020 2020 2020 2020 2020 2865 2e67              (e.g
-00008500: 2e20 506f 7374 4749 532c 2047 656f 7061  . PostGIS, Geopa
-00008510: 636b 6167 652c 2053 7061 7469 616c 6974  ckage, Spatialit
-00008520: 652c 2e2e 2e29 2e20 466f 7220 6461 7461  e,...). For data
-00008530: 2073 6f75 7263 6573 0a20 2020 2020 2020   sources.       
-00008540: 2020 2020 2077 6974 686f 7574 2053 514c       without SQL
-00008550: 2073 7570 706f 7274 2c20 7468 6520 224f   support, the "O
-00008560: 4752 5351 4c22 2064 6961 6c65 6374 2069  GRSQL" dialect i
-00008570: 7320 7468 6520 6465 6661 756c 742e 2044  s the default. D
-00008580: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00008590: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
-000085a0: 6765 6f6d 6574 7279 2028 626f 6f6c 2c20  geometry (bool, 
-000085b0: 6f70 7469 6f6e 616c 293a 2054 7275 6520  optional): True 
-000085c0: 6e6f 7420 746f 2072 6561 642f 7265 7475  not to read/retu
-000085d0: 726e 2074 6865 2067 656f 6d65 7472 792e  rn the geometry.
-000085e0: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-000085f0: 6175 6c74 7320 746f 2046 616c 7365 2e0a  aults to False..
-00008600: 2020 2020 2020 2020 6669 645f 6173 5f69          fid_as_i
-00008610: 6e64 6578 2028 626f 6f6c 2c20 6f70 7469  ndex (bool, opti
-00008620: 6f6e 616c 293a 2049 6620 5472 7565 2c20  onal): If True, 
-00008630: 7769 6c6c 2075 7365 2074 6865 2046 4944  will use the FID
-00008640: 7320 6f66 2074 6865 2066 6561 7475 7265  s of the feature
-00008650: 7320 7468 6174 0a20 2020 2020 2020 2020  s that.         
-00008660: 2020 2077 6572 6520 7265 6164 2061 7320     were read as 
-00008670: 7468 6520 696e 6465 7820 6f66 2074 6865  the index of the
-00008680: 2047 656f 4461 7461 4672 616d 652e 204d   GeoDataFrame. M
-00008690: 6179 2073 7461 7274 2061 7420 3020 6f72  ay start at 0 or
-000086a0: 2031 2064 6570 656e 6469 6e67 206f 6e0a   1 depending on.
-000086b0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-000086c0: 6472 6976 6572 2e20 4465 6661 756c 7473  driver. Defaults
-000086d0: 2074 6f20 4661 6c73 652e 0a0a 2020 2020   to False...    
-000086e0: 5261 6973 6573 3a0a 2020 2020 2020 2020  Raises:.        
-000086f0: 5661 6c75 6545 7272 6f72 3a20 616e 2069  ValueError: an i
-00008700: 6e76 616c 6964 2070 6172 616d 6574 6572  nvalid parameter
-00008710: 2076 616c 7565 2077 6173 2070 6173 7365   value was passe
-00008720: 642e 0a0a 2020 2020 5265 7475 726e 733a  d...    Returns:
-00008730: 0a20 2020 2020 2020 2067 7064 2e47 656f  .        gpd.Geo
-00008740: 4461 7461 4672 616d 653a 2074 6865 2064  DataFrame: the d
-00008750: 6174 6120 7265 6164 2e0a 2020 2020 2222  ata read..    ""
-00008760: 220a 2020 2020 7265 7375 6c74 5f67 6466  ".    result_gdf
-00008770: 203d 205f 7265 6164 5f66 696c 655f 6261   = _read_file_ba
-00008780: 7365 280a 2020 2020 2020 2020 7061 7468  se(.        path
-00008790: 3d70 6174 682c 0a20 2020 2020 2020 206c  =path,.        l
-000087a0: 6179 6572 3d6c 6179 6572 2c0a 2020 2020  ayer=layer,.    
-000087b0: 2020 2020 636f 6c75 6d6e 733d 636f 6c75      columns=colu
-000087c0: 6d6e 732c 0a20 2020 2020 2020 2062 626f  mns,.        bbo
-000087d0: 783d 6262 6f78 2c0a 2020 2020 2020 2020  x=bbox,.        
-000087e0: 726f 7773 3d72 6f77 732c 0a20 2020 2020  rows=rows,.     
-000087f0: 2020 2073 716c 5f73 746d 743d 7371 6c5f     sql_stmt=sql_
-00008800: 7374 6d74 2c0a 2020 2020 2020 2020 7371  stmt,.        sq
-00008810: 6c5f 6469 616c 6563 743d 7371 6c5f 6469  l_dialect=sql_di
-00008820: 616c 6563 742c 0a20 2020 2020 2020 2069  alect,.        i
-00008830: 676e 6f72 655f 6765 6f6d 6574 7279 3d69  gnore_geometry=i
-00008840: 676e 6f72 655f 6765 6f6d 6574 7279 2c0a  gnore_geometry,.
-00008850: 2020 2020 2020 2020 6669 645f 6173 5f69          fid_as_i
-00008860: 6e64 6578 3d66 6964 5f61 735f 696e 6465  ndex=fid_as_inde
-00008870: 782c 0a20 2020 2029 0a0a 2020 2020 2320  x,.    )..    # 
-00008880: 4e6f 2061 7373 6572 7420 746f 206b 6565  No assert to kee
-00008890: 7020 6261 636b 7761 7264 7320 636f 6d70  p backwards comp
-000088a0: 6174 6962 696c 6974 790a 2020 2020 7265  atibility.    re
-000088b0: 7475 726e 2072 6573 756c 745f 6764 6620  turn result_gdf 
-000088c0: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-000088d0: 0a0a 6465 6620 7265 6164 5f66 696c 655f  ..def read_file_
-000088e0: 6e6f 6765 6f6d 280a 2020 2020 7061 7468  nogeom(.    path
-000088f0: 3a20 556e 696f 6e5b 7374 722c 2022 6f73  : Union[str, "os
-00008900: 2e50 6174 684c 696b 655b 416e 795d 225d  .PathLike[Any]"]
-00008910: 2c0a 2020 2020 6c61 7965 723a 204f 7074  ,.    layer: Opt
-00008920: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00008930: 652c 0a20 2020 2063 6f6c 756d 6e73 3a20  e,.    columns: 
-00008940: 4f70 7469 6f6e 616c 5b49 7465 7261 626c  Optional[Iterabl
-00008950: 655b 7374 725d 5d20 3d20 4e6f 6e65 2c0a  e[str]] = None,.
-00008960: 2020 2020 6262 6f78 3d4e 6f6e 652c 0a20      bbox=None,. 
-00008970: 2020 2072 6f77 733d 4e6f 6e65 2c0a 2020     rows=None,.  
-00008980: 2020 7371 6c5f 7374 6d74 3a20 4f70 7469    sql_stmt: Opti
-00008990: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-000089a0: 2c0a 2020 2020 7371 6c5f 6469 616c 6563  ,.    sql_dialec
-000089b0: 743a 204f 7074 696f 6e61 6c5b 4c69 7465  t: Optional[Lite
-000089c0: 7261 6c5b 2253 514c 4954 4522 2c20 224f  ral["SQLITE", "O
-000089d0: 4752 5351 4c22 5d5d 203d 204e 6f6e 652c  GRSQL"]] = None,
-000089e0: 0a20 2020 2066 6964 5f61 735f 696e 6465  .    fid_as_inde
-000089f0: 783a 2062 6f6f 6c20 3d20 4661 6c73 652c  x: bool = False,
-00008a00: 0a29 202d 3e20 7064 2e44 6174 6146 7261  .) -> pd.DataFra
-00008a10: 6d65 3a0a 2020 2020 2222 220a 2020 2020  me:.    """.    
-00008a20: 4445 5052 4543 4154 4544 3a20 706c 6561  DEPRECATED: plea
-00008a30: 7365 2075 7365 2072 6561 645f 6669 6c65  se use read_file
-00008a40: 2077 6974 6820 6f70 7469 6f6e 2069 676e   with option ign
-00008a50: 6f72 655f 6765 6f6d 6574 7279 3d54 7275  ore_geometry=Tru
-00008a60: 652e 0a20 2020 2022 2222 0a20 2020 2077  e..    """.    w
-00008a70: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-00008a80: 2020 2020 2020 2272 6561 645f 6669 6c65        "read_file
-00008a90: 5f6e 6f67 656f 6d20 6973 2064 6570 7265  _nogeom is depre
-00008aa0: 6361 7465 643a 2075 7365 2072 6561 645f  cated: use read_
-00008ab0: 6669 6c65 2077 6974 6820 6967 6e6f 7265  file with ignore
-00008ac0: 5f67 656f 6d65 7472 793d 5472 7565 222c  _geometry=True",
-00008ad0: 0a20 2020 2020 2020 2046 7574 7572 6557  .        FutureW
-00008ae0: 6172 6e69 6e67 2c0a 2020 2020 290a 2020  arning,.    ).  
-00008af0: 2020 7265 7375 6c74 5f67 6466 203d 205f    result_gdf = _
-00008b00: 7265 6164 5f66 696c 655f 6261 7365 280a  read_file_base(.
-00008b10: 2020 2020 2020 2020 7061 7468 3d70 6174          path=pat
-00008b20: 682c 0a20 2020 2020 2020 206c 6179 6572  h,.        layer
-00008b30: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
-00008b40: 636f 6c75 6d6e 733d 636f 6c75 6d6e 732c  columns=columns,
-00008b50: 0a20 2020 2020 2020 2062 626f 783d 6262  .        bbox=bb
-00008b60: 6f78 2c0a 2020 2020 2020 2020 726f 7773  ox,.        rows
-00008b70: 3d72 6f77 732c 0a20 2020 2020 2020 2073  =rows,.        s
-00008b80: 716c 5f73 746d 743d 7371 6c5f 7374 6d74  ql_stmt=sql_stmt
-00008b90: 2c0a 2020 2020 2020 2020 7371 6c5f 6469  ,.        sql_di
-00008ba0: 616c 6563 743d 7371 6c5f 6469 616c 6563  alect=sql_dialec
-00008bb0: 742c 0a20 2020 2020 2020 2069 676e 6f72  t,.        ignor
-00008bc0: 655f 6765 6f6d 6574 7279 3d54 7275 652c  e_geometry=True,
-00008bd0: 0a20 2020 2020 2020 2066 6964 5f61 735f  .        fid_as_
-00008be0: 696e 6465 783d 6669 645f 6173 5f69 6e64  index=fid_as_ind
-00008bf0: 6578 2c0a 2020 2020 290a 2020 2020 6173  ex,.    ).    as
-00008c00: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-00008c10: 7265 7375 6c74 5f67 6466 2c20 7064 2e44  result_gdf, pd.D
-00008c20: 6174 6146 7261 6d65 290a 2020 2020 7265  ataFrame).    re
-00008c30: 7475 726e 2072 6573 756c 745f 6764 660a  turn result_gdf.
-00008c40: 0a0a 6465 6620 5f72 6561 645f 6669 6c65  ..def _read_file
-00008c50: 5f62 6173 6528 0a20 2020 2070 6174 683a  _base(.    path:
-00008c60: 2055 6e69 6f6e 5b73 7472 2c20 226f 732e   Union[str, "os.
-00008c70: 5061 7468 4c69 6b65 5b41 6e79 5d22 5d2c  PathLike[Any]"],
-00008c80: 0a20 2020 206c 6179 6572 3a20 4f70 7469  .    layer: Opti
-00008c90: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00008ca0: 2c0a 2020 2020 636f 6c75 6d6e 733a 204f  ,.    columns: O
-00008cb0: 7074 696f 6e61 6c5b 4974 6572 6162 6c65  ptional[Iterable
-00008cc0: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
-00008cd0: 2020 2062 626f 783d 4e6f 6e65 2c0a 2020     bbox=None,.  
-00008ce0: 2020 726f 7773 3d4e 6f6e 652c 0a20 2020    rows=None,.   
-00008cf0: 2073 716c 5f73 746d 743a 204f 7074 696f   sql_stmt: Optio
-00008d00: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-00008d10: 0a20 2020 2073 716c 5f64 6961 6c65 6374  .    sql_dialect
-00008d20: 3a20 4f70 7469 6f6e 616c 5b4c 6974 6572  : Optional[Liter
-00008d30: 616c 5b22 5351 4c49 5445 222c 2022 4f47  al["SQLITE", "OG
-00008d40: 5253 514c 225d 5d20 3d20 4e6f 6e65 2c0a  RSQL"]] = None,.
-00008d50: 2020 2020 6967 6e6f 7265 5f67 656f 6d65      ignore_geome
-00008d60: 7472 793a 2062 6f6f 6c20 3d20 4661 6c73  try: bool = Fals
-00008d70: 652c 0a20 2020 2066 6964 5f61 735f 696e  e,.    fid_as_in
-00008d80: 6465 783a 2062 6f6f 6c20 3d20 4661 6c73  dex: bool = Fals
-00008d90: 652c 0a29 202d 3e20 556e 696f 6e5b 7064  e,.) -> Union[pd
-00008da0: 2e44 6174 6146 7261 6d65 2c20 6770 642e  .DataFrame, gpd.
-00008db0: 4765 6f44 6174 6146 7261 6d65 5d3a 0a20  GeoDataFrame]:. 
-00008dc0: 2020 2022 2222 0a20 2020 2052 6561 6473     """.    Reads
-00008dd0: 2061 2066 696c 6520 746f 2061 2070 616e   a file to a pan
-00008de0: 6461 7320 4461 7461 6672 616d 652e 0a20  das Dataframe.. 
-00008df0: 2020 2022 2222 0a20 2020 2023 2043 6865     """.    # Che
-00008e00: 636b 2069 6620 7468 6520 6669 6420 636f  ck if the fid co
-00008e10: 6c75 6d6e 206e 6565 6473 2074 6f20 6265  lumn needs to be
-00008e20: 2072 6561 6420 6173 2063 6f6c 756d 6e20   read as column 
-00008e30: 7669 6120 7468 6520 636f 6c75 6d6e 7320  via the columns 
-00008e40: 7061 7261 6d65 7465 720a 2020 2020 6669  parameter.    fi
-00008e50: 645f 6173 5f63 6f6c 756d 6e20 3d20 4661  d_as_column = Fa
-00008e60: 6c73 650a 2020 2020 6966 2063 6f6c 756d  lse.    if colum
-00008e70: 6e73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ns is not None:.
-00008e80: 2020 2020 2020 2020 6966 2022 6669 6422          if "fid"
-00008e90: 2069 6e20 5b63 6f6c 756d 6e2e 6c6f 7765   in [column.lowe
-00008ea0: 7228 2920 666f 7220 636f 6c75 6d6e 2069  r() for column i
-00008eb0: 6e20 636f 6c75 6d6e 735d 3a0a 2020 2020  n columns]:.    
-00008ec0: 2020 2020 2020 2020 6669 645f 6173 5f63          fid_as_c
-00008ed0: 6f6c 756d 6e20 3d20 5472 7565 0a0a 2020  olumn = True..  
-00008ee0: 2020 2320 5265 6164 2077 6974 6820 7468    # Read with th
-00008ef0: 6520 656e 6769 6e65 2073 7065 6369 6669  e engine specifi
-00008f00: 6564 0a20 2020 2065 6e67 696e 6520 3d20  ed.    engine = 
-00008f10: 5f67 6574 5f65 6e67 696e 6528 290a 2020  _get_engine().  
-00008f20: 2020 6966 2065 6e67 696e 6520 3d3d 2022    if engine == "
-00008f30: 7079 6f67 7269 6f22 3a0a 2020 2020 2020  pyogrio":.      
-00008f40: 2020 6764 6620 3d20 5f72 6561 645f 6669    gdf = _read_fi
-00008f50: 6c65 5f62 6173 655f 7079 6f67 7269 6f28  le_base_pyogrio(
-00008f60: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00008f70: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
-00008f80: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
-00008f90: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00008fa0: 756d 6e73 3d63 6f6c 756d 6e73 2c0a 2020  umns=columns,.  
-00008fb0: 2020 2020 2020 2020 2020 6262 6f78 3d62            bbox=b
-00008fc0: 626f 782c 0a20 2020 2020 2020 2020 2020  box,.           
-00008fd0: 2072 6f77 733d 726f 7773 2c0a 2020 2020   rows=rows,.    
-00008fe0: 2020 2020 2020 2020 7371 6c5f 7374 6d74          sql_stmt
-00008ff0: 3d73 716c 5f73 746d 742c 0a20 2020 2020  =sql_stmt,.     
-00009000: 2020 2020 2020 2073 716c 5f64 6961 6c65         sql_diale
-00009010: 6374 3d73 716c 5f64 6961 6c65 6374 2c0a  ct=sql_dialect,.
-00009020: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
-00009030: 7265 5f67 656f 6d65 7472 793d 6967 6e6f  re_geometry=igno
-00009040: 7265 5f67 656f 6d65 7472 792c 0a20 2020  re_geometry,.   
-00009050: 2020 2020 2020 2020 2066 6964 5f61 735f           fid_as_
-00009060: 696e 6465 783d 6669 645f 6173 5f69 6e64  index=fid_as_ind
-00009070: 6578 206f 7220 6669 645f 6173 5f63 6f6c  ex or fid_as_col
-00009080: 756d 6e2c 0a20 2020 2020 2020 2029 0a20  umn,.        ). 
-00009090: 2020 2065 6c69 6620 656e 6769 6e65 203d     elif engine =
-000090a0: 3d20 2266 696f 6e61 223a 0a20 2020 2020  = "fiona":.     
-000090b0: 2020 2067 6466 203d 205f 7265 6164 5f66     gdf = _read_f
-000090c0: 696c 655f 6261 7365 5f66 696f 6e61 280a  ile_base_fiona(.
-000090d0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000090e0: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
-000090f0: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-00009100: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-00009110: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
-00009120: 2020 2020 2020 2020 2062 626f 783d 6262           bbox=bb
-00009130: 6f78 2c0a 2020 2020 2020 2020 2020 2020  ox,.            
-00009140: 726f 7773 3d72 6f77 732c 0a20 2020 2020  rows=rows,.     
-00009150: 2020 2020 2020 2073 716c 5f73 746d 743d         sql_stmt=
-00009160: 7371 6c5f 7374 6d74 2c0a 2020 2020 2020  sql_stmt,.      
-00009170: 2020 2020 2020 7371 6c5f 6469 616c 6563        sql_dialec
-00009180: 743d 7371 6c5f 6469 616c 6563 742c 0a20  t=sql_dialect,. 
-00009190: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-000091a0: 655f 6765 6f6d 6574 7279 3d69 676e 6f72  e_geometry=ignor
-000091b0: 655f 6765 6f6d 6574 7279 2c0a 2020 2020  e_geometry,.    
-000091c0: 2020 2020 2020 2020 6669 645f 6173 5f69          fid_as_i
-000091d0: 6e64 6578 3d66 6964 5f61 735f 696e 6465  ndex=fid_as_inde
-000091e0: 7820 6f72 2066 6964 5f61 735f 636f 6c75  x or fid_as_colu
-000091f0: 6d6e 2c0a 2020 2020 2020 2020 290a 2020  mn,.        ).  
-00009200: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009210: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00009220: 2866 2255 6e73 7570 706f 7274 6564 2065  (f"Unsupported e
-00009230: 6e67 696e 653a 207b 656e 6769 6e65 7d22  ngine: {engine}"
-00009240: 290a 0a20 2020 2023 2043 6f70 7920 7468  )..    # Copy th
-00009250: 6520 696e 6465 7820 746f 2061 2063 6f6c  e index to a col
-00009260: 756d 6e20 6966 206e 6565 6465 642e 2e2e  umn if needed...
-00009270: 0a20 2020 2069 6620 6669 645f 6173 5f63  .    if fid_as_c
-00009280: 6f6c 756d 6e3a 0a20 2020 2020 2020 2067  olumn:.        g
-00009290: 6466 5b22 6669 6422 5d20 3d20 6764 662e  df["fid"] = gdf.
-000092a0: 696e 6465 780a 2020 2020 2020 2020 6966  index.        if
-000092b0: 206e 6f74 2066 6964 5f61 735f 696e 6465   not fid_as_inde
-000092c0: 783a 0a20 2020 2020 2020 2020 2020 2067  x:.            g
-000092d0: 6466 203d 2067 6466 2e72 6573 6574 5f69  df = gdf.reset_i
-000092e0: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
-000092f0: 0a20 2020 2072 6574 7572 6e20 6764 660a  .    return gdf.
-00009300: 0a0a 6465 6620 5f72 6561 645f 6669 6c65  ..def _read_file
-00009310: 5f62 6173 655f 6669 6f6e 6128 0a20 2020  _base_fiona(.   
-00009320: 2070 6174 683a 2055 6e69 6f6e 5b73 7472   path: Union[str
-00009330: 2c20 226f 732e 5061 7468 4c69 6b65 5b41  , "os.PathLike[A
-00009340: 6e79 5d22 5d2c 0a20 2020 206c 6179 6572  ny]"],.    layer
-00009350: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00009360: 3d20 4e6f 6e65 2c0a 2020 2020 636f 6c75  = None,.    colu
-00009370: 6d6e 733a 204f 7074 696f 6e61 6c5b 4974  mns: Optional[It
-00009380: 6572 6162 6c65 5b73 7472 5d5d 203d 204e  erable[str]] = N
-00009390: 6f6e 652c 0a20 2020 2062 626f 783d 4e6f  one,.    bbox=No
-000093a0: 6e65 2c0a 2020 2020 726f 7773 3d4e 6f6e  ne,.    rows=Non
-000093b0: 652c 0a20 2020 2073 716c 5f73 746d 743a  e,.    sql_stmt:
-000093c0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-000093d0: 204e 6f6e 652c 0a20 2020 2073 716c 5f64   None,.    sql_d
-000093e0: 6961 6c65 6374 3a20 4f70 7469 6f6e 616c  ialect: Optional
-000093f0: 5b4c 6974 6572 616c 5b22 5351 4c49 5445  [Literal["SQLITE
-00009400: 222c 2022 4f47 5253 514c 225d 5d20 3d20  ", "OGRSQL"]] = 
-00009410: 4e6f 6e65 2c0a 2020 2020 6967 6e6f 7265  None,.    ignore
-00009420: 5f67 656f 6d65 7472 793a 2062 6f6f 6c20  _geometry: bool 
-00009430: 3d20 4661 6c73 652c 0a20 2020 2066 6964  = False,.    fid
-00009440: 5f61 735f 696e 6465 783a 2062 6f6f 6c20  _as_index: bool 
-00009450: 3d20 4661 6c73 652c 0a29 202d 3e20 556e  = False,.) -> Un
-00009460: 696f 6e5b 7064 2e44 6174 6146 7261 6d65  ion[pd.DataFrame
-00009470: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
-00009480: 6d65 5d3a 0a20 2020 2022 2222 0a20 2020  me]:.    """.   
-00009490: 2052 6561 6473 2061 2066 696c 6520 746f   Reads a file to
-000094a0: 2061 2070 616e 6461 7320 4461 7461 6672   a pandas Datafr
-000094b0: 616d 6520 7573 696e 6720 6669 6f6e 612e  ame using fiona.
-000094c0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-000094d0: 6967 6e6f 7265 5f67 656f 6d65 7472 7920  ignore_geometry 
-000094e0: 616e 6420 636f 6c75 6d6e 7320 3d3d 205b  and columns == [
-000094f0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
-00009500: 6e20 7064 2e44 6174 6146 7261 6d65 2829  n pd.DataFrame()
-00009510: 0a20 2020 2069 6620 7371 6c5f 7374 6d74  .    if sql_stmt
-00009520: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00009530: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00009540: 6545 7272 6f72 2822 7371 6c5f 7374 6d74  eError("sql_stmt
-00009550: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
-00009560: 6420 7769 7468 2066 696f 6e61 2065 6e67  d with fiona eng
-00009570: 696e 6522 290a 0a20 2020 2023 2049 6e69  ine")..    # Ini
-00009580: 740a 2020 2020 7061 7468 203d 2050 6174  t.    path = Pat
-00009590: 6828 7061 7468 290a 2020 2020 6966 2070  h(path).    if p
-000095a0: 6174 682e 6578 6973 7473 2829 2069 7320  ath.exists() is 
-000095b0: 4661 6c73 653a 0a20 2020 2020 2020 2072  False:.        r
-000095c0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000095d0: 6622 6669 6c65 2064 6f65 736e 2774 2065  f"file doesn't e
-000095e0: 7869 7374 3a20 7b70 6174 687d 2229 0a0a  xist: {path}")..
-000095f0: 2020 2020 2320 4966 206e 6f20 6c61 7965      # If no laye
-00009600: 7220 6e61 6d65 2073 7065 6369 6669 6564  r name specified
-00009610: 2c20 6368 6563 6b20 6966 2074 6865 7265  , check if there
-00009620: 2069 7320 6f6e 6c79 206f 6e65 206c 6179   is only one lay
-00009630: 6572 2069 6e20 7468 6520 6669 6c65 2e0a  er in the file..
-00009640: 2020 2020 6966 206c 6179 6572 2069 7320      if layer is 
-00009650: 4e6f 6e65 3a0a 2020 2020 2020 2020 6c61  None:.        la
-00009660: 7965 7220 3d20 6765 745f 6f6e 6c79 5f6c  yer = get_only_l
-00009670: 6179 6572 2870 6174 6829 0a0a 2020 2020  ayer(path)..    
-00009680: 2320 5645 5259 2044 4952 5459 2068 6163  # VERY DIRTY hac
-00009690: 6b20 746f 2067 6574 2074 6865 2066 6964  k to get the fid
-000096a0: 0a20 2020 2069 6620 6669 645f 6173 5f69  .    if fid_as_i
-000096b0: 6e64 6578 3a0a 2020 2020 2020 2020 2320  ndex:.        # 
-000096c0: 4d61 6b65 2061 2063 6f70 792f 636f 7079  Make a copy/copy
-000096d0: 2069 6e70 7574 2066 696c 6520 746f 2067   input file to g
-000096e0: 656f 7061 636b 6167 652c 2061 7320 7765  eopackage, as we
-000096f0: 2077 696c 6c20 6164 6420 616e 2066 6964   will add an fid
-00009700: 2f72 6f77 6420 636f 6c75 6d6e 0a20 2020  /rowd column.   
-00009710: 2020 2020 2074 6d70 5f66 6964 5f70 6174       tmp_fid_pat
-00009720: 6820 3d20 5061 7468 2874 656d 7066 696c  h = Path(tempfil
-00009730: 652e 6d6b 6474 656d 7028 2929 202f 2066  e.mkdtemp()) / f
-00009740: 227b 7061 7468 2e73 7465 6d7d 2e67 706b  "{path.stem}.gpk
-00009750: 6722 0a20 2020 2020 2020 2074 7279 3a0a  g".        try:.
-00009760: 2020 2020 2020 2020 2020 2020 6966 2047              if G
-00009770: 656f 6669 6c65 5479 7065 2870 6174 6829  eofileType(path)
-00009780: 203d 3d20 4765 6f66 696c 6554 7970 652e   == GeofileType.
-00009790: 4750 4b47 3a0a 2020 2020 2020 2020 2020  GPKG:.          
-000097a0: 2020 2020 2020 636f 7079 2870 6174 682c        copy(path,
-000097b0: 2074 6d70 5f66 6964 5f70 6174 6829 0a20   tmp_fid_path). 
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000097d0: 6464 5f63 6f6c 756d 6e28 746d 705f 6669  dd_column(tmp_fi
-000097e0: 645f 7061 7468 2c20 225f 5f54 4d50 5f47  d_path, "__TMP_G
-000097f0: 454f 4649 4c45 4f50 535f 4649 4422 2c20  EOFILEOPS_FID", 
-00009800: 2249 4e54 4547 4552 222c 2022 6669 6422  "INTEGER", "fid"
-00009810: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00009820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009830: 2020 2020 636f 7079 5f6c 6179 6572 2870      copy_layer(p
-00009840: 6174 682c 2074 6d70 5f66 6964 5f70 6174  ath, tmp_fid_pat
-00009850: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-00009860: 2020 2023 2066 6964 2069 6e20 7368 6170     # fid in shap
-00009870: 6566 696c 6520 6973 2030 2062 6173 6564  efile is 0 based
-00009880: 2c20 736f 2066 6964 2d31 0a20 2020 2020  , so fid-1.     
-00009890: 2020 2020 2020 2020 2020 2061 6464 5f63             add_c
-000098a0: 6f6c 756d 6e28 746d 705f 6669 645f 7061  olumn(tmp_fid_pa
-000098b0: 7468 2c20 225f 5f54 4d50 5f47 454f 4649  th, "__TMP_GEOFI
-000098c0: 4c45 4f50 535f 4649 4422 2c20 2249 4e54  LEOPS_FID", "INT
-000098d0: 4547 4552 222c 2022 6669 642d 3122 290a  EGER", "fid-1").
-000098e0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-000098f0: 6820 3d20 746d 705f 6669 645f 7061 7468  h = tmp_fid_path
-00009900: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-00009910: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00009920: 2074 6d70 5f66 6964 5f70 6174 682e 7061   tmp_fid_path.pa
-00009930: 7265 6e74 2e65 7869 7374 7328 293a 0a20  rent.exists():. 
-00009940: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009950: 6875 7469 6c2e 726d 7472 6565 2874 6d70  hutil.rmtree(tmp
-00009960: 5f66 6964 5f70 6174 682c 2069 676e 6f72  _fid_path, ignor
-00009970: 655f 6572 726f 7273 3d54 7275 6529 0a0a  e_errors=True)..
-00009980: 2020 2020 2320 4368 6563 6b69 6e67 2069      # Checking i
-00009990: 6620 6669 656c 642f 636f 6c75 6d6e 206e  f field/column n
-000099a0: 616d 6573 2073 686f 756c 6420 6265 2072  ames should be r
-000099b0: 6561 6420 6973 2063 6173 6520 7365 6e73  ead is case sens
-000099c0: 6974 6976 6520 696e 2066 696f 6e61 2c20  itive in fiona, 
-000099d0: 736f 0a20 2020 2023 206d 616b 6520 7375  so.    # make su
-000099e0: 7265 2074 6865 2063 6f6c 756d 6e20 6e61  re the column na
-000099f0: 6d65 7320 7370 6563 6966 6965 6420 6861  mes specified ha
-00009a00: 7665 2074 6865 2073 616d 6520 6361 7369  ve the same casi
-00009a10: 6e67 2e0a 2020 2020 636f 6c75 6d6e 735f  ng..    columns_
-00009a20: 7072 6570 6172 6564 203d 204e 6f6e 650a  prepared = None.
-00009a30: 2020 2020 6966 2063 6f6c 756d 6e73 2069      if columns i
-00009a40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00009a50: 2020 2020 6c61 7965 7269 6e66 6f20 3d20      layerinfo = 
-00009a60: 6765 745f 6c61 7965 7269 6e66 6f28 7061  get_layerinfo(pa
-00009a70: 7468 2c20 6c61 7965 723d 6c61 7965 7229  th, layer=layer)
-00009a80: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-00009a90: 5f75 7070 6572 5f6c 6f6f 6b75 7020 3d20  _upper_lookup = 
-00009aa0: 7b63 6f6c 756d 6e2e 7570 7065 7228 293a  {column.upper():
-00009ab0: 2063 6f6c 756d 6e20 666f 7220 636f 6c75   column for colu
-00009ac0: 6d6e 2069 6e20 636f 6c75 6d6e 737d 0a20  mn in columns}. 
-00009ad0: 2020 2020 2020 2063 6f6c 756d 6e73 5f70         columns_p
-00009ae0: 7265 7061 7265 6420 3d20 7b0a 2020 2020  repared = {.    
-00009af0: 2020 2020 2020 2020 636f 6c75 6d6e 3a20          column: 
-00009b00: 636f 6c75 6d6e 735f 7570 7065 725f 6c6f  columns_upper_lo
-00009b10: 6f6b 7570 5b63 6f6c 756d 6e2e 7570 7065  okup[column.uppe
-00009b20: 7228 295d 0a20 2020 2020 2020 2020 2020  r()].           
-00009b30: 2066 6f72 2063 6f6c 756d 6e20 696e 206c   for column in l
-00009b40: 6179 6572 696e 666f 2e63 6f6c 756d 6e73  ayerinfo.columns
-00009b50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009b60: 636f 6c75 6d6e 2e75 7070 6572 2829 2069  column.upper() i
-00009b70: 6e20 636f 6c75 6d6e 735f 7570 7065 725f  n columns_upper_
-00009b80: 6c6f 6f6b 7570 0a20 2020 2020 2020 207d  lookup.        }
-00009b90: 0a0a 2020 2020 2320 5265 6164 2e2e 2e0a  ..    # Read....
-00009ba0: 2020 2020 636f 6c75 6d6e 735f 6c69 7374      columns_list
-00009bb0: 203d 204e 6f6e 6520 6966 2063 6f6c 756d   = None if colum
-00009bc0: 6e73 5f70 7265 7061 7265 6420 6973 204e  ns_prepared is N
-00009bd0: 6f6e 6520 656c 7365 206c 6973 7428 636f  one else list(co
-00009be0: 6c75 6d6e 735f 7072 6570 6172 6564 290a  lumns_prepared).
-00009bf0: 2020 2020 7265 7375 6c74 5f67 6466 203d      result_gdf =
-00009c00: 2067 7064 2e72 6561 645f 6669 6c65 280a   gpd.read_file(.
-00009c10: 2020 2020 2020 2020 7374 7228 7061 7468          str(path
-00009c20: 292c 0a20 2020 2020 2020 206c 6179 6572  ),.        layer
-00009c30: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
-00009c40: 6262 6f78 3d62 626f 782c 0a20 2020 2020  bbox=bbox,.     
-00009c50: 2020 2072 6f77 733d 726f 7773 2c0a 2020     rows=rows,.  
-00009c60: 2020 2020 2020 696e 636c 7564 655f 6669        include_fi
-00009c70: 656c 6473 3d63 6f6c 756d 6e73 5f6c 6973  elds=columns_lis
-00009c80: 742c 0a20 2020 2020 2020 2073 716c 3d73  t,.        sql=s
-00009c90: 716c 5f73 746d 742c 0a20 2020 2020 2020  ql_stmt,.       
-00009ca0: 2073 716c 5f64 6961 6c65 6374 3d73 716c   sql_dialect=sql
-00009cb0: 5f64 6961 6c65 6374 2c0a 2020 2020 2020  _dialect,.      
-00009cc0: 2020 6967 6e6f 7265 5f67 656f 6d65 7472    ignore_geometr
-00009cd0: 793d 6967 6e6f 7265 5f67 656f 6d65 7472  y=ignore_geometr
-00009ce0: 792c 0a20 2020 2029 0a0a 2020 2020 2320  y,.    )..    # 
-00009cf0: 5365 7420 7468 6520 696e 6465 7820 746f  Set the index to
-00009d00: 2074 6865 2062 6163 6b65 642d 7570 2066   the backed-up f
-00009d10: 6964 0a20 2020 2069 6620 6669 645f 6173  id.    if fid_as
-00009d20: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-00009d30: 7265 7375 6c74 5f67 6466 203d 2072 6573  result_gdf = res
-00009d40: 756c 745f 6764 662e 7365 745f 696e 6465  ult_gdf.set_inde
-00009d50: 7828 225f 5f54 4d50 5f47 454f 4649 4c45  x("__TMP_GEOFILE
-00009d60: 4f50 535f 4649 4422 290a 0a20 2020 2023  OPS_FID")..    #
-00009d70: 2052 656f 7264 6572 2063 6f6c 756d 6e73   Reorder columns
-00009d80: 202b 2063 6861 6e67 6520 6361 7369 6e67   + change casing
-00009d90: 2073 6f20 7468 6579 2061 7265 2074 6865   so they are the
-00009da0: 2073 616d 6520 6173 2063 6f6c 756d 6e73   same as columns
-00009db0: 2070 6172 616d 6574 6572 0a20 2020 2069   parameter.    i
-00009dc0: 6620 636f 6c75 6d6e 735f 7072 6570 6172  f columns_prepar
-00009dd0: 6564 2069 7320 6e6f 7420 4e6f 6e65 2061  ed is not None a
-00009de0: 6e64 206c 656e 2863 6f6c 756d 6e73 5f70  nd len(columns_p
-00009df0: 7265 7061 7265 6429 203e 2030 3a0a 2020  repared) > 0:.  
-00009e00: 2020 2020 2020 7265 7375 6c74 5f67 6466        result_gdf
-00009e10: 203d 2072 6573 756c 745f 6764 665b 6c69   = result_gdf[li
-00009e20: 7374 2863 6f6c 756d 6e73 5f70 7265 7061  st(columns_prepa
-00009e30: 7265 6429 202b 205b 2267 656f 6d65 7472  red) + ["geometr
-00009e40: 7922 5d5d 0a20 2020 2020 2020 2072 6573  y"]].        res
-00009e50: 756c 745f 6764 6620 3d20 7265 7375 6c74  ult_gdf = result
-00009e60: 5f67 6466 2e72 656e 616d 6528 636f 6c75  _gdf.rename(colu
-00009e70: 6d6e 733d 636f 6c75 6d6e 735f 7072 6570  mns=columns_prep
-00009e80: 6172 6564 2920 2023 2074 7970 653a 2069  ared)  # type: i
-00009e90: 676e 6f72 650a 0a20 2020 2023 2053 7461  gnore..    # Sta
-00009ea0: 7274 696e 6720 6672 6f6d 2066 696f 6e61  rting from fiona
-00009eb0: 2031 2e39 2c20 7374 7269 6e67 2063 6f6c   1.9, string col
-00009ec0: 756d 6e73 2077 6974 6820 616c 6c20 4e6f  umns with all No
-00009ed0: 6e65 2076 616c 7565 7320 6172 6520 7265  ne values are re
-00009ee0: 6164 2061 7320 6265 696e 670a 2020 2020  ad as being.    
-00009ef0: 2320 666c 6f61 7420 636f 6c75 6d6e 732e  # float columns.
-00009f00: 2043 6f6e 7665 7274 2074 6865 6d20 746f   Convert them to
-00009f10: 206f 626a 6563 7420 7479 7065 2e0a 2020   object type..  
-00009f20: 2020 666c 6f61 745f 636f 6c73 203d 206c    float_cols = l
-00009f30: 6973 7428 7265 7375 6c74 5f67 6466 2e73  ist(result_gdf.s
-00009f40: 656c 6563 745f 6474 7970 6573 285b 2266  elect_dtypes(["f
-00009f50: 6c6f 6174 3634 225d 292e 636f 6c75 6d6e  loat64"]).column
-00009f60: 7329 0a20 2020 2069 6620 6c65 6e28 666c  s).    if len(fl
-00009f70: 6f61 745f 636f 6c73 2920 3e20 303a 0a20  oat_cols) > 0:. 
-00009f80: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
-00009f90: 6f72 2061 6c6c 2066 6c6f 6174 2063 6f6c  or all float col
-00009fa0: 756d 6e73 2066 6f75 6e64 2069 6620 7468  umns found if th
-00009fb0: 6579 2073 686f 756c 6420 6265 206f 626a  ey should be obj
-00009fc0: 6563 7420 636f 6c75 6d6e 7320 696e 7374  ect columns inst
-00009fd0: 6561 640a 2020 2020 2020 2020 7769 7468  ead.        with
-00009fe0: 2066 696f 6e61 2e6f 7065 6e28 7061 7468   fiona.open(path
-00009ff0: 2c20 6c61 7965 723d 6c61 7965 7229 2061  , layer=layer) a
-0000a000: 7320 636f 6c6c 6563 7469 6f6e 3a0a 2020  s collection:.  
-0000a010: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0000a020: 2063 6f6c 6c65 6374 696f 6e2e 7363 6865   collection.sche
-0000a030: 6d61 2069 7320 6e6f 7420 4e6f 6e65 0a20  ma is not None. 
-0000a040: 2020 2020 2020 2020 2020 2070 726f 7065             prope
-0000a050: 7274 6965 7320 3d20 636f 6c6c 6563 7469  rties = collecti
-0000a060: 6f6e 2e73 6368 656d 615b 2270 726f 7065  on.schema["prope
-0000a070: 7274 6965 7322 5d0a 2020 2020 2020 2020  rties"].        
-0000a080: 2020 2020 666f 7220 636f 6c20 696e 2066      for col in f
-0000a090: 6c6f 6174 5f63 6f6c 733a 0a20 2020 2020  loat_cols:.     
-0000a0a0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0000a0b0: 6c20 696e 2070 726f 7065 7274 6965 7320  l in properties 
-0000a0c0: 616e 6420 7072 6f70 6572 7469 6573 5b63  and properties[c
-0000a0d0: 6f6c 5d2e 7374 6172 7473 7769 7468 2822  ol].startswith("
-0000a0e0: 7374 7222 293a 0a20 2020 2020 2020 2020  str"):.         
-0000a0f0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000a100: 745f 6764 665b 636f 6c5d 203d 2028 0a20  t_gdf[col] = (. 
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2020 2020 2072 6573 756c 745f 6764         result_gd
-0000a130: 665b 636f 6c5d 2020 2320 7479 7065 3a20  f[col]  # type: 
-0000a140: 6967 6e6f 7265 0a20 2020 2020 2020 2020  ignore.         
-0000a150: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-0000a160: 6173 7479 7065 286f 626a 6563 7429 2020  astype(object)  
-0000a170: 2320 7479 7065 3a20 6967 6e6f 7265 0a20  # type: ignore. 
-0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a190: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
-0000a1a0: 6e70 2e6e 616e 2c20 4e6f 6e65 290a 2020  np.nan, None).  
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 2020 290a 0a20 2020 2023 2061 7373 6572    )..    # asser
-0000a1d0: 7420 746f 2065 7661 6465 2070 794c 616e  t to evade pyLan
-0000a1e0: 6365 2077 6172 6e69 6e67 0a20 2020 2061  ce warning.    a
-0000a1f0: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-0000a200: 2872 6573 756c 745f 6764 662c 2070 642e  (result_gdf, pd.
-0000a210: 4461 7461 4672 616d 6529 206f 7220 6973  DataFrame) or is
-0000a220: 696e 7374 616e 6365 280a 2020 2020 2020  instance(.      
-0000a230: 2020 7265 7375 6c74 5f67 6466 2c20 6770    result_gdf, gp
-0000a240: 642e 4765 6f44 6174 6146 7261 6d65 0a20  d.GeoDataFrame. 
-0000a250: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-0000a260: 7265 7375 6c74 5f67 6466 0a0a 0a64 6566  result_gdf...def
-0000a270: 205f 7265 6164 5f66 696c 655f 6261 7365   _read_file_base
-0000a280: 5f70 796f 6772 696f 280a 2020 2020 7061  _pyogrio(.    pa
-0000a290: 7468 3a20 556e 696f 6e5b 7374 722c 2022  th: Union[str, "
-0000a2a0: 6f73 2e50 6174 684c 696b 655b 416e 795d  os.PathLike[Any]
-0000a2b0: 225d 2c0a 2020 2020 6c61 7965 723a 204f  "],.    layer: O
-0000a2c0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000a2d0: 6f6e 652c 0a20 2020 2063 6f6c 756d 6e73  one,.    columns
-0000a2e0: 3a20 4f70 7469 6f6e 616c 5b49 7465 7261  : Optional[Itera
-0000a2f0: 626c 655b 7374 725d 5d20 3d20 4e6f 6e65  ble[str]] = None
-0000a300: 2c0a 2020 2020 6262 6f78 3d4e 6f6e 652c  ,.    bbox=None,
-0000a310: 0a20 2020 2072 6f77 733d 4e6f 6e65 2c0a  .    rows=None,.
-0000a320: 2020 2020 7371 6c5f 7374 6d74 3a20 4f70      sql_stmt: Op
-0000a330: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0000a340: 6e65 2c0a 2020 2020 7371 6c5f 6469 616c  ne,.    sql_dial
-0000a350: 6563 743a 204f 7074 696f 6e61 6c5b 4c69  ect: Optional[Li
-0000a360: 7465 7261 6c5b 2253 514c 4954 4522 2c20  teral["SQLITE", 
-0000a370: 224f 4752 5351 4c22 5d5d 203d 204e 6f6e  "OGRSQL"]] = Non
-0000a380: 652c 0a20 2020 2069 676e 6f72 655f 6765  e,.    ignore_ge
-0000a390: 6f6d 6574 7279 3a20 626f 6f6c 203d 2046  ometry: bool = F
-0000a3a0: 616c 7365 2c0a 2020 2020 6669 645f 6173  alse,.    fid_as
-0000a3b0: 5f69 6e64 6578 3a20 626f 6f6c 203d 2046  _index: bool = F
-0000a3c0: 616c 7365 2c0a 2920 2d3e 2055 6e69 6f6e  alse,.) -> Union
-0000a3d0: 5b70 642e 4461 7461 4672 616d 652c 2067  [pd.DataFrame, g
-0000a3e0: 7064 2e47 656f 4461 7461 4672 616d 655d  pd.GeoDataFrame]
-0000a3f0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-0000a400: 6164 7320 6120 6669 6c65 2074 6f20 6120  ads a file to a 
-0000a410: 7061 6e64 6173 2044 6174 6166 7261 6d65  pandas Dataframe
-0000a420: 2075 7369 6e67 2070 796f 6772 696f 2e0a   using pyogrio..
-0000a430: 2020 2020 2222 220a 2020 2020 2320 496e      """.    # In
-0000a440: 6974 0a20 2020 2070 6174 6820 3d20 5061  it.    path = Pa
-0000a450: 7468 2870 6174 6829 0a20 2020 2069 6620  th(path).    if 
-0000a460: 7061 7468 2e65 7869 7374 7328 2920 6973  path.exists() is
-0000a470: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-0000a480: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000a490: 2866 2266 696c 6520 646f 6573 6e27 7420  (f"file doesn't 
-0000a4a0: 6578 6973 743a 207b 7061 7468 7d22 290a  exist: {path}").
-0000a4b0: 0a20 2020 2023 2043 6f6e 7665 7274 2073  .    # Convert s
-0000a4c0: 6c69 6365 206f 626a 6563 7420 746f 2070  lice object to p
-0000a4d0: 796f 6772 696f 2070 6172 616d 6574 6572  yogrio parameter
-0000a4e0: 730a 2020 2020 6966 2072 6f77 7320 6973  s.    if rows is
-0000a4f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000a500: 2020 2073 6b69 705f 6665 6174 7572 6573     skip_features
-0000a510: 203d 2072 6f77 732e 7374 6172 740a 2020   = rows.start.  
-0000a520: 2020 2020 2020 6d61 785f 6665 6174 7572        max_featur
-0000a530: 6573 203d 2072 6f77 732e 7374 6f70 202d  es = rows.stop -
-0000a540: 2072 6f77 732e 7374 6172 740a 2020 2020   rows.start.    
-0000a550: 656c 7365 3a0a 2020 2020 2020 2020 736b  else:.        sk
-0000a560: 6970 5f66 6561 7475 7265 7320 3d20 300a  ip_features = 0.
-0000a570: 2020 2020 2020 2020 6d61 785f 6665 6174          max_feat
-0000a580: 7572 6573 203d 204e 6f6e 650a 0a20 2020  ures = None..   
-0000a590: 2023 2049 6620 6e6f 2073 716c 5f73 746d   # If no sql_stm
-0000a5a0: 7420 7370 6563 6966 6965 640a 2020 2020  t specified.    
-0000a5b0: 636f 6c75 6d6e 735f 7072 6570 6172 6564  columns_prepared
-0000a5c0: 203d 204e 6f6e 650a 2020 2020 6966 2073   = None.    if s
-0000a5d0: 716c 5f73 746d 7420 6973 204e 6f6e 653a  ql_stmt is None:
-0000a5e0: 0a20 2020 2020 2020 2023 2049 6620 6e6f  .        # If no
-0000a5f0: 206c 6179 6572 2073 7065 6369 6669 6564   layer specified
-0000a600: 2c20 7468 6572 6520 7368 6f75 6c64 2062  , there should b
-0000a610: 6520 6f6e 6c79 206f 6e65 206c 6179 6572  e only one layer
-0000a620: 2069 6e20 7468 6520 6669 6c65 2e0a 2020   in the file..  
-0000a630: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
-0000a640: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000a650: 2020 2020 6c61 7965 7220 3d20 6765 745f      layer = get_
-0000a660: 6f6e 6c79 5f6c 6179 6572 2870 6174 6829  only_layer(path)
-0000a670: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
-0000a680: 6b69 6e67 2069 6620 636f 6c75 6d6e 206e  king if column n
-0000a690: 616d 6573 2073 686f 756c 6420 6265 2072  ames should be r
-0000a6a0: 6561 6420 6973 2063 6173 6520 7365 6e73  ead is case sens
-0000a6b0: 6974 6976 6520 696e 2070 796f 6772 696f  itive in pyogrio
-0000a6c0: 2c20 736f 0a20 2020 2020 2020 2023 206d  , so.        # m
-0000a6d0: 616b 6520 7375 7265 2074 6865 2063 6f6c  ake sure the col
-0000a6e0: 756d 6e20 6e61 6d65 7320 7370 6563 6966  umn names specif
-0000a6f0: 6965 6420 6861 7665 2074 6865 2073 616d  ied have the sam
-0000a700: 6520 6361 7369 6e67 2e0a 2020 2020 2020  e casing..      
-0000a710: 2020 6966 2063 6f6c 756d 6e73 2069 7320    if columns is 
-0000a720: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000a730: 2020 2020 2020 6c61 7965 7269 6e66 6f20        layerinfo 
-0000a740: 3d20 6765 745f 6c61 7965 7269 6e66 6f28  = get_layerinfo(
-0000a750: 7061 7468 2c20 6c61 7965 723d 6c61 7965  path, layer=laye
-0000a760: 7229 0a20 2020 2020 2020 2020 2020 2063  r).            c
-0000a770: 6f6c 756d 6e73 5f75 7070 6572 5f6c 6f6f  olumns_upper_loo
-0000a780: 6b75 7020 3d20 7b63 6f6c 756d 6e2e 7570  kup = {column.up
-0000a790: 7065 7228 293a 2063 6f6c 756d 6e20 666f  per(): column fo
-0000a7a0: 7220 636f 6c75 6d6e 2069 6e20 636f 6c75  r column in colu
-0000a7b0: 6d6e 737d 0a20 2020 2020 2020 2020 2020  mns}.           
-0000a7c0: 2063 6f6c 756d 6e73 5f70 7265 7061 7265   columns_prepare
-0000a7d0: 6420 3d20 7b0a 2020 2020 2020 2020 2020  d = {.          
-0000a7e0: 2020 2020 2020 636f 6c75 6d6e 3a20 636f        column: co
-0000a7f0: 6c75 6d6e 735f 7570 7065 725f 6c6f 6f6b  lumns_upper_look
-0000a800: 7570 5b63 6f6c 756d 6e2e 7570 7065 7228  up[column.upper(
-0000a810: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-0000a820: 2020 2066 6f72 2063 6f6c 756d 6e20 696e     for column in
-0000a830: 206c 6179 6572 696e 666f 2e63 6f6c 756d   layerinfo.colum
-0000a840: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
-0000a850: 2020 2069 6620 636f 6c75 6d6e 2e75 7070     if column.upp
-0000a860: 6572 2829 2069 6e20 636f 6c75 6d6e 735f  er() in columns_
-0000a870: 7570 7065 725f 6c6f 6f6b 7570 0a20 2020  upper_lookup.   
-0000a880: 2020 2020 2020 2020 207d 0a20 2020 2065           }.    e
-0000a890: 6c73 653a 0a20 2020 2020 2020 2023 2046  lse:.        # F
-0000a8a0: 696c 6c20 6f75 7420 706c 6163 6568 6f6c  ill out placehol
-0000a8b0: 6465 7273 2c20 6b65 6570 2063 6f6c 756d  ders, keep colum
-0000a8c0: 6e73 5f70 7265 7061 7265 6420 4e6f 6e65  ns_prepared None
-0000a8d0: 2062 6563 6175 7365 2063 6f6c 756d 6e20   because column 
-0000a8e0: 6669 6c74 6572 696e 670a 2020 2020 2020  filtering.      
-0000a8f0: 2020 2320 7368 6f75 6c64 2068 6170 7065    # should happe
-0000a900: 6e20 696e 2073 716c 5f73 746d 742e 0a20  n in sql_stmt.. 
-0000a910: 2020 2020 2020 2073 716c 5f73 746d 7420         sql_stmt 
-0000a920: 3d20 5f66 696c 6c5f 6f75 745f 7371 6c5f  = _fill_out_sql_
-0000a930: 706c 6163 6568 6f6c 6465 7273 280a 2020  placeholders(.  
-0000a940: 2020 2020 2020 2020 2020 7061 7468 3d70            path=p
-0000a950: 6174 682c 206c 6179 6572 3d6c 6179 6572  ath, layer=layer
-0000a960: 2c20 7371 6c5f 7374 6d74 3d73 716c 5f73  , sql_stmt=sql_s
-0000a970: 746d 742c 2063 6f6c 756d 6e73 3d63 6f6c  tmt, columns=col
-0000a980: 756d 6e73 0a20 2020 2020 2020 2029 0a0a  umns.        )..
-0000a990: 2020 2020 2320 5265 6164 210a 2020 2020      # Read!.    
-0000a9a0: 636f 6c75 6d6e 735f 6c69 7374 203d 204e  columns_list = N
-0000a9b0: 6f6e 6520 6966 2063 6f6c 756d 6e73 5f70  one if columns_p
-0000a9c0: 7265 7061 7265 6420 6973 204e 6f6e 6520  repared is None 
-0000a9d0: 656c 7365 206c 6973 7428 636f 6c75 6d6e  else list(column
-0000a9e0: 735f 7072 6570 6172 6564 290a 2020 2020  s_prepared).    
-0000a9f0: 7265 7375 6c74 5f67 6466 203d 2070 796f  result_gdf = pyo
-0000aa00: 6772 696f 2e72 6561 645f 6461 7461 6672  grio.read_datafr
-0000aa10: 616d 6528 0a20 2020 2020 2020 2070 6174  ame(.        pat
-0000aa20: 682c 0a20 2020 2020 2020 206c 6179 6572  h,.        layer
-0000aa30: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
-0000aa40: 636f 6c75 6d6e 733d 636f 6c75 6d6e 735f  columns=columns_
-0000aa50: 6c69 7374 2c0a 2020 2020 2020 2020 6262  list,.        bb
-0000aa60: 6f78 3d62 626f 782c 0a20 2020 2020 2020  ox=bbox,.       
-0000aa70: 2073 6b69 705f 6665 6174 7572 6573 3d73   skip_features=s
-0000aa80: 6b69 705f 6665 6174 7572 6573 2c0a 2020  kip_features,.  
-0000aa90: 2020 2020 2020 6d61 785f 6665 6174 7572        max_featur
-0000aaa0: 6573 3d6d 6178 5f66 6561 7475 7265 732c  es=max_features,
-0000aab0: 0a20 2020 2020 2020 2073 716c 3d73 716c  .        sql=sql
-0000aac0: 5f73 746d 742c 0a20 2020 2020 2020 2073  _stmt,.        s
-0000aad0: 716c 5f64 6961 6c65 6374 3d73 716c 5f64  ql_dialect=sql_d
-0000aae0: 6961 6c65 6374 2c0a 2020 2020 2020 2020  ialect,.        
-0000aaf0: 7265 6164 5f67 656f 6d65 7472 793d 6e6f  read_geometry=no
-0000ab00: 7420 6967 6e6f 7265 5f67 656f 6d65 7472  t ignore_geometr
-0000ab10: 792c 0a20 2020 2020 2020 2066 6964 5f61  y,.        fid_a
-0000ab20: 735f 696e 6465 783d 6669 645f 6173 5f69  s_index=fid_as_i
-0000ab30: 6e64 6578 2c0a 2020 2020 290a 0a20 2020  ndex,.    )..   
-0000ab40: 2023 2052 656f 7264 6572 2063 6f6c 756d   # Reorder colum
-0000ab50: 6e73 202b 2063 6861 6e67 6520 6361 7369  ns + change casi
-0000ab60: 6e67 2073 6f20 7468 6579 2061 7265 2074  ng so they are t
-0000ab70: 6865 2073 616d 6520 6173 2063 6f6c 756d  he same as colum
-0000ab80: 6e73 2070 6172 616d 6574 6572 0a20 2020  ns parameter.   
-0000ab90: 2069 6620 636f 6c75 6d6e 735f 7072 6570   if columns_prep
-0000aba0: 6172 6564 2069 7320 6e6f 7420 4e6f 6e65  ared is not None
-0000abb0: 2061 6e64 206c 656e 2863 6f6c 756d 6e73   and len(columns
-0000abc0: 5f70 7265 7061 7265 6429 203e 2030 3a0a  _prepared) > 0:.
-0000abd0: 2020 2020 2020 2020 7265 7375 6c74 5f67          result_g
-0000abe0: 6466 203d 2072 6573 756c 745f 6764 665b  df = result_gdf[
-0000abf0: 6c69 7374 2863 6f6c 756d 6e73 5f70 7265  list(columns_pre
-0000ac00: 7061 7265 6429 202b 205b 2267 656f 6d65  pared) + ["geome
-0000ac10: 7472 7922 5d5d 0a20 2020 2020 2020 2072  try"]].        r
-0000ac20: 6573 756c 745f 6764 6620 3d20 7265 7375  esult_gdf = resu
-0000ac30: 6c74 5f67 6466 2e72 656e 616d 6528 636f  lt_gdf.rename(co
-0000ac40: 6c75 6d6e 733d 636f 6c75 6d6e 735f 7072  lumns=columns_pr
-0000ac50: 6570 6172 6564 2920 2023 2074 7970 653a  epared)  # type:
-0000ac60: 2069 676e 6f72 650a 0a20 2020 2023 2061   ignore..    # a
-0000ac70: 7373 6572 7420 746f 2065 7661 6465 2070  ssert to evade p
-0000ac80: 794c 616e 6365 2077 6172 6e69 6e67 0a20  yLance warning. 
-0000ac90: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
-0000aca0: 616e 6365 2872 6573 756c 745f 6764 662c  ance(result_gdf,
-0000acb0: 2070 642e 4461 7461 4672 616d 6529 206f   pd.DataFrame) o
-0000acc0: 7220 6973 696e 7374 616e 6365 280a 2020  r isinstance(.  
-0000acd0: 2020 2020 2020 7265 7375 6c74 5f67 6466        result_gdf
-0000ace0: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
-0000acf0: 6d65 0a20 2020 2029 0a20 2020 2072 6574  me.    ).    ret
-0000ad00: 7572 6e20 7265 7375 6c74 5f67 6466 0a0a  urn result_gdf..
-0000ad10: 0a64 6566 205f 6669 6c6c 5f6f 7574 5f73  .def _fill_out_s
-0000ad20: 716c 5f70 6c61 6365 686f 6c64 6572 7328  ql_placeholders(
-0000ad30: 0a20 2020 2070 6174 683a 2050 6174 682c  .    path: Path,
-0000ad40: 206c 6179 6572 3a20 4f70 7469 6f6e 616c   layer: Optional
-0000ad50: 5b73 7472 5d2c 2073 716c 5f73 746d 743a  [str], sql_stmt:
-0000ad60: 2073 7472 2c20 636f 6c75 6d6e 733a 204f   str, columns: O
-0000ad70: 7074 696f 6e61 6c5b 4974 6572 6162 6c65  ptional[Iterable
-0000ad80: 5b73 7472 5d5d 0a29 202d 3e20 7374 723a  [str]].) -> str:
-0000ad90: 0a20 2020 2023 2046 696c 6c20 6f75 7420  .    # Fill out 
-0000ada0: 706c 6163 6568 6f6c 6465 7273 2069 6e20  placeholders in 
-0000adb0: 7468 6520 7371 6c5f 7374 6d74 2069 6620  the sql_stmt if 
-0000adc0: 6e65 6564 6564 3a0a 2020 2020 706c 6163  needed:.    plac
-0000add0: 6568 6f6c 6465 7273 203d 205b 0a20 2020  eholders = [.   
-0000ade0: 2020 2020 206e 616d 6520 666f 7220 5f2c       name for _,
-0000adf0: 206e 616d 652c 205f 2c20 5f20 696e 2073   name, _, _ in s
-0000ae00: 7472 696e 672e 466f 726d 6174 7465 7228  tring.Formatter(
-0000ae10: 292e 7061 7273 6528 7371 6c5f 7374 6d74  ).parse(sql_stmt
-0000ae20: 2920 6966 206e 616d 650a 2020 2020 5d0a  ) if name.    ].
-0000ae30: 2020 2020 6c61 7965 725f 746d 7020 3d20      layer_tmp = 
-0000ae40: 6c61 7965 720a 2020 2020 6c61 7965 7269  layer.    layeri
-0000ae50: 6e66 6f20 3d20 4e6f 6e65 0a20 2020 2066  nfo = None.    f
-0000ae60: 6f72 6d61 745f 6b77 6172 6773 203d 207b  ormat_kwargs = {
-0000ae70: 7d0a 2020 2020 666f 7220 706c 6163 6568  }.    for placeh
-0000ae80: 6f6c 6465 7220 696e 2070 6c61 6365 686f  older in placeho
-0000ae90: 6c64 6572 733a 0a20 2020 2020 2020 2069  lders:.        i
-0000aea0: 6620 6c61 7965 725f 746d 7020 6973 204e  f layer_tmp is N
-0000aeb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000aec0: 206c 6179 6572 5f74 6d70 203d 2067 6574   layer_tmp = get
-0000aed0: 5f6f 6e6c 795f 6c61 7965 7228 7061 7468  _only_layer(path
-0000aee0: 290a 2020 2020 2020 2020 6966 2070 6c61  ).        if pla
-0000aef0: 6365 686f 6c64 6572 203d 3d20 2269 6e70  ceholder == "inp
-0000af00: 7574 5f6c 6179 6572 223a 0a20 2020 2020  ut_layer":.     
-0000af10: 2020 2020 2020 2066 6f72 6d61 745f 6b77         format_kw
-0000af20: 6172 6773 5b70 6c61 6365 686f 6c64 6572  args[placeholder
-0000af30: 5d20 3d20 6c61 7965 725f 746d 700a 2020  ] = layer_tmp.  
-0000af40: 2020 2020 2020 656c 6966 2070 6c61 6365        elif place
-0000af50: 686f 6c64 6572 203d 3d20 2267 656f 6d65  holder == "geome
-0000af60: 7472 7963 6f6c 756d 6e22 3a0a 2020 2020  trycolumn":.    
-0000af70: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
-0000af80: 696e 666f 2069 7320 4e6f 6e65 3a0a 2020  info is None:.  
-0000af90: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000afa0: 7965 7269 6e66 6f20 3d20 6765 745f 6c61  yerinfo = get_la
-0000afb0: 7965 7269 6e66 6f28 7061 7468 2c20 6c61  yerinfo(path, la
-0000afc0: 7965 725f 746d 7029 0a20 2020 2020 2020  yer_tmp).       
-0000afd0: 2020 2020 2066 6f72 6d61 745f 6b77 6172       format_kwar
-0000afe0: 6773 5b70 6c61 6365 686f 6c64 6572 5d20  gs[placeholder] 
-0000aff0: 3d20 6c61 7965 7269 6e66 6f2e 6765 6f6d  = layerinfo.geom
-0000b000: 6574 7279 636f 6c75 6d6e 0a20 2020 2020  etrycolumn.     
-0000b010: 2020 2065 6c69 6620 706c 6163 6568 6f6c     elif placehol
-0000b020: 6465 7220 3d3d 2022 636f 6c75 6d6e 735f  der == "columns_
-0000b030: 746f 5f73 656c 6563 745f 7374 7222 3a0a  to_select_str":.
-0000b040: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000b050: 6179 6572 696e 666f 2069 7320 4e6f 6e65  ayerinfo is None
-0000b060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b070: 2020 6c61 7965 7269 6e66 6f20 3d20 6765    layerinfo = ge
-0000b080: 745f 6c61 7965 7269 6e66 6f28 7061 7468  t_layerinfo(path
-0000b090: 2c20 6c61 7965 725f 746d 7029 0a20 2020  , layer_tmp).   
-0000b0a0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-0000b0b0: 5f61 736b 6564 203d 204e 6f6e 6520 6966  _asked = None if
-0000b0c0: 2063 6f6c 756d 6e73 2069 7320 4e6f 6e65   columns is None
-0000b0d0: 2065 6c73 6520 6c69 7374 2863 6f6c 756d   else list(colum
-0000b0e0: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
-0000b0f0: 666f 726d 6174 7465 7220 3d20 5f6f 6772  formatter = _ogr
-0000b100: 5f73 716c 5f75 7469 6c2e 436f 6c75 6d6e  _sql_util.Column
-0000b110: 466f 726d 6174 7465 7228 0a20 2020 2020  Formatter(.     
-0000b120: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0000b130: 6e73 5f61 736b 6564 3d63 6f6c 756d 6e73  ns_asked=columns
-0000b140: 5f61 736b 6564 2c0a 2020 2020 2020 2020  _asked,.        
-0000b150: 2020 2020 2020 2020 636f 6c75 6d6e 735f          columns_
-0000b160: 696e 5f6c 6179 6572 3d6c 6179 6572 696e  in_layer=layerin
-0000b170: 666f 2e63 6f6c 756d 6e73 2c0a 2020 2020  fo.columns,.    
-0000b180: 2020 2020 2020 2020 2020 2020 6669 645f              fid_
-0000b190: 636f 6c75 6d6e 3d6c 6179 6572 696e 666f  column=layerinfo
-0000b1a0: 2e66 6964 5f63 6f6c 756d 6e2c 0a20 2020  .fid_column,.   
-0000b1b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000b1c0: 2020 2020 2020 2066 6f72 6d61 745f 6b77         format_kw
-0000b1d0: 6172 6773 5b70 6c61 6365 686f 6c64 6572  args[placeholder
-0000b1e0: 5d20 3d20 666f 726d 6174 7465 722e 7072  ] = formatter.pr
-0000b1f0: 6566 6978 6564 5f61 6c69 6173 6564 2829  efixed_aliased()
-0000b200: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
-0000b210: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000b220: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0000b230: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000b240: 756e 6b6e 6f77 6e20 706c 6163 6568 6f6c  unknown placehol
-0000b250: 6465 7220 7b70 6c61 6365 686f 6c64 6572  der {placeholder
-0000b260: 7d20 696e 2073 716c 5f73 746d 743a 207b  } in sql_stmt: {
-0000b270: 7371 6c5f 7374 6d74 7d22 0a20 2020 2020  sql_stmt}".     
-0000b280: 2020 2020 2020 2029 0a0a 2020 2020 6966         )..    if
-0000b290: 206c 656e 2866 6f72 6d61 745f 6b77 6172   len(format_kwar
-0000b2a0: 6773 2920 3e20 303a 0a20 2020 2020 2020  gs) > 0:.       
-0000b2b0: 2073 716c 5f73 746d 7420 3d20 7371 6c5f   sql_stmt = sql_
-0000b2c0: 7374 6d74 2e66 6f72 6d61 7428 2a2a 666f  stmt.format(**fo
-0000b2d0: 726d 6174 5f6b 7761 7267 7329 0a20 2020  rmat_kwargs).   
-0000b2e0: 2072 6574 7572 6e20 7371 6c5f 7374 6d74   return sql_stmt
-0000b2f0: 0a0a 0a64 6566 2072 6561 645f 6669 6c65  ...def read_file
-0000b300: 5f73 716c 280a 2020 2020 7061 7468 3a20  _sql(.    path: 
-0000b310: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
-0000b320: 6174 684c 696b 655b 416e 795d 225d 2c0a  athLike[Any]"],.
-0000b330: 2020 2020 7371 6c5f 7374 6d74 3a20 7374      sql_stmt: st
-0000b340: 722c 0a20 2020 2073 716c 5f64 6961 6c65  r,.    sql_diale
-0000b350: 6374 3a20 4f70 7469 6f6e 616c 5b4c 6974  ct: Optional[Lit
-0000b360: 6572 616c 5b22 5351 4c49 5445 222c 2022  eral["SQLITE", "
-0000b370: 4f47 5253 514c 225d 5d20 3d20 2253 514c  OGRSQL"]] = "SQL
-0000b380: 4954 4522 2c0a 2020 2020 6c61 7965 723a  ITE",.    layer:
-0000b390: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0000b3a0: 204e 6f6e 652c 0a20 2020 2069 676e 6f72   None,.    ignor
-0000b3b0: 655f 6765 6f6d 6574 7279 3a20 626f 6f6c  e_geometry: bool
-0000b3c0: 203d 2046 616c 7365 2c0a 2920 2d3e 2055   = False,.) -> U
-0000b3d0: 6e69 6f6e 5b70 642e 4461 7461 4672 616d  nion[pd.DataFram
-0000b3e0: 652c 2067 7064 2e47 656f 4461 7461 4672  e, gpd.GeoDataFr
-0000b3f0: 616d 655d 3a0a 2020 2020 2222 220a 2020  ame]:.    """.  
-0000b400: 2020 4445 5052 4543 4154 4544 3a20 5265    DEPRECATED: Re
-0000b410: 6164 7320 6120 6669 6c65 2075 7369 6e67  ads a file using
-0000b420: 2061 6e20 7371 6c20 7374 6174 656d 656e   an sql statemen
-0000b430: 742e 0a0a 2020 2020 4172 6773 3a0a 2020  t...    Args:.  
-0000b440: 2020 2020 2020 7061 7468 2028 6669 6c65        path (file
-0000b450: 2070 6174 6829 3a20 7061 7468 2074 6f20   path): path to 
-0000b460: 7468 6520 6669 6c65 2074 6f20 7265 6164  the file to read
-0000b470: 2066 726f 6d0a 2020 2020 2020 2020 7371   from.        sq
-0000b480: 6c5f 7374 6d74 2028 7374 7229 3a20 7371  l_stmt (str): sq
-0000b490: 6c20 7374 6174 656d 656e 7420 746f 2075  l statement to u
-0000b4a0: 7365 0a20 2020 2020 2020 2073 716c 5f64  se.        sql_d
-0000b4b0: 6961 6c65 6374 2028 7374 722c 206f 7074  ialect (str, opt
-0000b4c0: 696f 6e61 6c29 3a20 5371 6c20 6469 616c  ional): Sql dial
-0000b4d0: 6563 7420 7573 6564 2e20 4465 6661 756c  ect used. Defaul
-0000b4e0: 7473 2074 6f20 2753 514c 4954 4527 2e0a  ts to 'SQLITE'..
-0000b4f0: 2020 2020 2020 2020 6c61 7965 7220 2873          layer (s
-0000b500: 7472 2c20 6f70 7469 6f6e 616c 293a 2054  tr, optional): T
-0000b510: 6865 206c 6179 6572 2074 6f20 7265 6164  he layer to read
-0000b520: 2e20 4966 206e 6f20 6c61 7965 7220 6973  . If no layer is
-0000b530: 2073 7065 6369 6669 6564 2c0a 2020 2020   specified,.    
-0000b540: 2020 2020 2020 2020 7265 6164 7320 7468          reads th
-0000b550: 6520 6f6e 6c79 206c 6179 6572 2069 6e20  e only layer in 
-0000b560: 7468 6520 6669 6c65 206f 7220 7468 726f  the file or thro
-0000b570: 7773 2061 6e20 4578 6365 7074 696f 6e2e  ws an Exception.
-0000b580: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
-0000b590: 6765 6f6d 6574 7279 2028 626f 6f6c 2c20  geometry (bool, 
-0000b5a0: 6f70 7469 6f6e 616c 293a 2054 7275 6520  optional): True 
-0000b5b0: 6e6f 7420 746f 2072 6561 642f 7265 7475  not to read/retu
-0000b5c0: 726e 2074 6865 2067 656f 6d61 7472 792e  rn the geomatry.
-0000b5d0: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-0000b5e0: 6175 6c74 7320 746f 2046 616c 7365 2e0a  aults to False..
-0000b5f0: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
-0000b600: 2020 2020 2020 556e 696f 6e5b 7064 2e44        Union[pd.D
-0000b610: 6174 6146 7261 6d65 2c20 6770 642e 4765  ataFrame, gpd.Ge
-0000b620: 6f44 6174 6146 7261 6d65 5d3a 2054 6865  oDataFrame]: The
-0000b630: 2064 6174 6120 7265 6164 2e0a 2020 2020   data read..    
-0000b640: 2222 220a 2020 2020 7761 726e 696e 6773  """.    warnings
-0000b650: 2e77 6172 6e28 0a20 2020 2020 2020 2027  .warn(.        '
-0000b660: 7265 6164 5f66 696c 655f 7371 6c20 6973  read_file_sql is
-0000b670: 2064 6570 7265 6361 7465 643a 2075 7365   deprecated: use
-0000b680: 2072 6561 645f 6669 6c65 2120 4d69 6e64   read_file! Mind
-0000b690: 3a20 7371 6c5f 6469 616c 6563 7420 6973  : sql_dialect is
-0000b6a0: 206e 6f74 2022 5351 4c49 5445 2220 270a   not "SQLITE" '.
-0000b6b0: 2020 2020 2020 2020 2262 7920 6465 6661          "by defa
-0000b6c0: 756c 7420 7468 6572 6521 222c 0a20 2020  ult there!",.   
-0000b6d0: 2020 2020 2046 7574 7572 6557 6172 6e69       FutureWarni
-0000b6e0: 6e67 2c0a 2020 2020 290a 0a20 2020 2023  ng,.    )..    #
-0000b6f0: 2052 756e 0a20 2020 2072 6574 7572 6e20   Run.    return 
-0000b700: 5f72 6561 645f 6669 6c65 5f62 6173 6528  _read_file_base(
-0000b710: 0a20 2020 2020 2020 2070 6174 682c 0a20  .        path,. 
-0000b720: 2020 2020 2020 2073 716c 5f73 746d 743d         sql_stmt=
-0000b730: 7371 6c5f 7374 6d74 2c0a 2020 2020 2020  sql_stmt,.      
-0000b740: 2020 7371 6c5f 6469 616c 6563 743d 7371    sql_dialect=sq
-0000b750: 6c5f 6469 616c 6563 742c 0a20 2020 2020  l_dialect,.     
-0000b760: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-0000b770: 2020 2020 2020 2020 6967 6e6f 7265 5f67          ignore_g
-0000b780: 656f 6d65 7472 793d 6967 6e6f 7265 5f67  eometry=ignore_g
-0000b790: 656f 6d65 7472 792c 0a20 2020 2029 0a0a  eometry,.    )..
-0000b7a0: 0a64 6566 2074 6f5f 6669 6c65 280a 2020  .def to_file(.  
-0000b7b0: 2020 6764 663a 2055 6e69 6f6e 5b70 642e    gdf: Union[pd.
-0000b7c0: 4461 7461 4672 616d 652c 2067 7064 2e47  DataFrame, gpd.G
-0000b7d0: 656f 4461 7461 4672 616d 655d 2c0a 2020  eoDataFrame],.  
-0000b7e0: 2020 7061 7468 3a20 556e 696f 6e5b 7374    path: Union[st
-0000b7f0: 722c 2022 6f73 2e50 6174 684c 696b 655b  r, "os.PathLike[
-0000b800: 416e 795d 225d 2c0a 2020 2020 6c61 7965  Any]"],.    laye
-0000b810: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
-0000b820: 203d 204e 6f6e 652c 0a20 2020 2066 6f72   = None,.    for
-0000b830: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
-0000b840: 7279 7479 7065 3a20 556e 696f 6e5b 4765  rytype: Union[Ge
-0000b850: 6f6d 6574 7279 5479 7065 2c20 7374 722c  ometryType, str,
-0000b860: 204e 6f6e 655d 203d 204e 6f6e 652c 0a20   None] = None,. 
-0000b870: 2020 2066 6f72 6365 5f6d 756c 7469 7479     force_multity
-0000b880: 7065 3a20 626f 6f6c 203d 2046 616c 7365  pe: bool = False
-0000b890: 2c0a 2020 2020 6170 7065 6e64 3a20 626f  ,.    append: bo
-0000b8a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000b8b0: 6170 7065 6e64 5f74 696d 656f 7574 5f73  append_timeout_s
-0000b8c0: 3a20 696e 7420 3d20 3630 302c 0a20 2020  : int = 600,.   
-0000b8d0: 2069 6e64 6578 3a20 4f70 7469 6f6e 616c   index: Optional
-0000b8e0: 5b62 6f6f 6c5d 203d 204e 6f6e 652c 0a20  [bool] = None,. 
-0000b8f0: 2020 2063 7265 6174 655f 7370 6174 6961     create_spatia
-0000b900: 6c5f 696e 6465 783a 204f 7074 696f 6e61  l_index: Optiona
-0000b910: 6c5b 626f 6f6c 5d20 3d20 5472 7565 2c0a  l[bool] = True,.
-0000b920: 293a 0a20 2020 2022 2222 0a20 2020 2057  ):.    """.    W
-0000b930: 7269 7465 7320 6120 7061 6e64 6173 2064  rites a pandas d
-0000b940: 6174 6166 7261 6d65 2074 6f20 6669 6c65  ataframe to file
-0000b950: 2e0a 0a20 2020 2054 6865 2066 696c 6566  ...    The filef
-0000b960: 6f72 6d61 7420 6973 2064 6574 6563 7465  ormat is detecte
-0000b970: 6420 6261 7365 6420 6f6e 2074 6865 2066  d based on the f
-0000b980: 696c 6570 6174 6820 6578 7465 6e73 696f  ilepath extensio
-0000b990: 6e2e 0a0a 2020 2020 5468 6520 756e 6465  n...    The unde
-0000b9a0: 726c 7969 6e67 206c 6962 7261 7279 2075  rlying library u
-0000b9b0: 7365 6420 746f 2077 7269 7465 2074 6865  sed to write the
-0000b9c0: 2066 696c 6520 6361 6e20 6265 2063 686f   file can be cho
-0000b9d0: 6f73 656e 2075 7369 6e67 2074 6865 0a20  osen using the. 
-0000b9e0: 2020 2022 4746 4f5f 494f 5f45 4e47 494e     "GFO_IO_ENGIN
-0000b9f0: 4522 2065 6e76 6972 6f6e 6d65 6e74 2076  E" environment v
-0000ba00: 6172 6961 626c 652e 2050 6f73 7369 626c  ariable. Possibl
-0000ba10: 6520 7661 6c75 6573 2061 7265 2022 6669  e values are "fi
-0000ba20: 6f6e 6122 2061 6e64 2022 7079 6f67 7269  ona" and "pyogri
-0000ba30: 6f22 2e0a 2020 2020 4465 6661 756c 7420  o"..    Default 
-0000ba40: 656e 6769 6e65 2069 7320 2270 796f 6772  engine is "pyogr
-0000ba50: 696f 222e 0a0a 2020 2020 4172 6773 3a0a  io"...    Args:.
-0000ba60: 2020 2020 2020 2020 6764 6620 2867 7064          gdf (gpd
-0000ba70: 2e47 656f 4461 7461 4672 616d 6529 3a20  .GeoDataFrame): 
-0000ba80: 5468 6520 4765 6f44 6174 6146 7261 6d65  The GeoDataFrame
-0000ba90: 2074 6f20 6578 706f 7274 2074 6f20 6669   to export to fi
-0000baa0: 6c65 2e0a 2020 2020 2020 2020 7061 7468  le..        path
-0000bab0: 2028 556e 696f 6e5b 7374 722c 293a 2054   (Union[str,): T
-0000bac0: 6865 2066 696c 6520 7061 7468 2074 6f20  he file path to 
-0000bad0: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
-0000bae0: 2020 6c61 7965 7220 2873 7472 2c20 6f70    layer (str, op
-0000baf0: 7469 6f6e 616c 293a 2054 6865 206c 6179  tional): The lay
-0000bb00: 6572 2074 6f20 7265 6164 2e20 4966 206e  er to read. If n
-0000bb10: 6f20 6c61 7965 7220 6973 2073 7065 6369  o layer is speci
-0000bb20: 6669 6564 2c0a 2020 2020 2020 2020 2020  fied,.          
-0000bb30: 2020 7265 6164 7320 7468 6520 6f6e 6c79    reads the only
-0000bb40: 206c 6179 6572 2069 6e20 7468 6520 6669   layer in the fi
-0000bb50: 6c65 206f 7220 7468 726f 7773 2061 6e20  le or throws an 
-0000bb60: 4578 6365 7074 696f 6e2e 0a20 2020 2020  Exception..     
-0000bb70: 2020 2066 6f72 6365 5f6f 7574 7075 745f     force_output_
-0000bb80: 6765 6f6d 6574 7279 7479 7065 2028 556e  geometrytype (Un
-0000bb90: 696f 6e5b 4765 6f6d 6574 7279 5479 7065  ion[GeometryType
-0000bba0: 2c20 7374 725d 2c20 6f70 7469 6f6e 616c  , str], optional
-0000bbb0: 293a 2047 656f 6d65 7472 7920 7479 7065  ): Geometry type
-0000bbc0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-0000bbd0: 2874 7279 2074 6f29 2066 6f72 6365 2074  (try to) force t
-0000bbe0: 6865 206f 7574 7075 7420 746f 2e20 4465  he output to. De
-0000bbf0: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
-0000bc00: 2020 2020 2020 2020 2020 2020 4d61 726b              Mark
-0000bc10: 3a20 636f 6d70 6172 6564 2074 6f20 6f74  : compared to ot
-0000bc20: 6865 7220 6675 6e63 7469 6f6e 7320 696e  her functions in
-0000bc30: 2067 666f 2077 6974 6820 7468 6973 2070   gfo with this p
-0000bc40: 6172 616d 6574 6572 2c20 7468 6520 6265  arameter, the be
-0000bc50: 6861 7669 6f75 720a 2020 2020 2020 2020  haviour.        
-0000bc60: 2020 2020 6865 7265 2069 7320 6c69 6d69      here is limi
-0000bc70: 7465 6420 746f 2074 6865 2066 6f6c 6c6f  ted to the follo
-0000bc80: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
-0000bc90: 2020 2020 2020 2d20 666f 7220 656d 7074        - for empt
-0000bca0: 7920 696e 7075 7420 6764 6627 732c 2061  y input gdf's, a
-0000bcb0: 2073 7461 6e64 6172 6420 6765 6f6d 6574   standard geomet
-0000bcc0: 7279 2074 7970 6520 2865 672e 2050 6f6c  ry type (eg. Pol
-0000bcd0: 7967 6f6e 2c2e 2e2e 2920 6361 6e0a 2020  ygon,...) can.  
-0000bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcf0: 6265 2075 7365 6420 746f 2066 6f72 6365  be used to force
-0000bd00: 2074 6865 2067 656f 6d65 7472 7920 636f   the geometry co
-0000bd10: 6c75 6d6e 2074 6f20 6265 206f 6620 7468  lumn to be of th
-0000bd20: 6174 2074 7970 652e 0a20 2020 2020 2020  at type..       
-0000bd30: 2020 2020 2020 2020 202d 2069 6620 666f           - if fo
-0000bd40: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
-0000bd50: 7472 7974 7970 6520 6973 2061 204d 554c  trytype is a MUL
-0000bd60: 5449 2074 7970 652c 2070 6172 616d 6574  TI type, paramet
-0000bd70: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0000bd80: 2020 2020 2066 6f72 6365 5f6d 756c 7469       force_multi
-0000bd90: 7479 7065 2062 6563 6f6d 6573 2054 7275  type becomes Tru
-0000bda0: 652e 0a20 2020 2020 2020 2066 6f72 6365  e..        force
-0000bdb0: 5f6d 756c 7469 7479 7065 2028 626f 6f6c  _multitype (bool
-0000bdc0: 2c20 6f70 7469 6f6e 616c 293a 2066 6f72  , optional): for
-0000bdd0: 6365 2074 6865 2067 656f 6d65 7472 7920  ce the geometry 
-0000bde0: 7479 7065 2074 6f20 6120 6d75 6c74 6974  type to a multit
-0000bdf0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-0000be00: 666f 7220 6669 6c65 2074 7970 6573 2074  for file types t
-0000be10: 6861 7420 7265 7175 6972 6520 6f6e 6520  hat require one 
-0000be20: 6765 6f6d 6574 7279 7479 7065 2070 6572  geometrytype per
-0000be30: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-0000be40: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-0000be50: 4661 6c73 652e 0a20 2020 2020 2020 2061  False..        a
-0000be60: 7070 656e 6420 2862 6f6f 6c2c 206f 7074  ppend (bool, opt
-0000be70: 696f 6e61 6c29 3a20 5472 7565 2074 6f20  ional): True to 
-0000be80: 6170 7065 6e64 2074 6f20 7468 6520 6669  append to the fi
-0000be90: 6c65 2f6c 6179 6572 2069 6620 6974 2065  le/layer if it e
-0000bea0: 7869 7374 7320 616c 7265 6164 792e 0a20  xists already.. 
-0000beb0: 2020 2020 2020 2020 2020 2049 6620 6974             If it
-0000bec0: 2064 6f65 736e 2774 2065 7869 7374 2079   doesn't exist y
-0000bed0: 6574 2c20 6974 2069 7320 6372 6561 7465  et, it is create
-0000bee0: 642e 2044 6566 6175 6c74 7320 746f 2046  d. Defaults to F
-0000bef0: 616c 7365 2e0a 2020 2020 2020 2020 6170  alse..        ap
-0000bf00: 7065 6e64 5f74 696d 656f 7574 5f73 2028  pend_timeout_s (
-0000bf10: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
-0000bf20: 5468 6520 6d61 7869 6d75 6d20 7469 6d65  The maximum time
-0000bf30: 6f75 7420 746f 2077 6169 7420 7768 656e  out to wait when
-0000bf40: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0000bf50: 206f 7574 7075 7420 6669 6c65 2069 7320   output file is 
-0000bf60: 616c 7265 6164 7920 6265 696e 6720 7772  already being wr
-0000bf70: 6974 7465 6e20 746f 2062 7920 616e 6f74  itten to by anot
-0000bf80: 6865 7220 7072 6f63 6573 732e 0a20 2020  her process..   
-0000bf90: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-0000bfa0: 7320 746f 2036 3030 2e0a 2020 2020 2020  s to 600..      
-0000bfb0: 2020 696e 6465 7820 2862 6f6f 6c2c 206f    index (bool, o
-0000bfc0: 7074 696f 6e61 6c29 3a20 4966 2054 7275  ptional): If Tru
-0000bfd0: 652c 2077 7269 7465 2069 6e64 6578 2069  e, write index i
-0000bfe0: 6e74 6f20 6f6e 6520 6f72 206d 6f72 6520  nto one or more 
-0000bff0: 636f 6c75 6d6e 7320 2866 6f72 0a20 2020  columns (for.   
-0000c000: 2020 2020 2020 2020 204d 756c 7469 496e           MultiIn
-0000c010: 6465 7829 2e20 4e6f 6e65 2077 7269 7465  dex). None write
-0000c020: 7320 7468 6520 696e 6465 7820 696e 746f  s the index into
-0000c030: 206f 6e65 206f 7220 6d6f 7265 2063 6f6c   one or more col
-0000c040: 756d 6e73 206f 6e6c 7920 6966 2074 6865  umns only if the
-0000c050: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-0000c060: 6578 2069 7320 6e61 6d65 642c 2069 7320  ex is named, is 
-0000c070: 6120 4d75 6c74 6949 6e64 6578 2c20 6f72  a MultiIndex, or
-0000c080: 2068 6173 2061 206e 6f6e 2d69 6e74 6567   has a non-integ
-0000c090: 6572 2064 6174 6120 7479 7065 2e0a 2020  er data type..  
-0000c0a0: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
-0000c0b0: 7365 2c20 6e6f 2069 6e64 6578 2069 7320  se, no index is 
-0000c0c0: 7772 6974 7465 6e2e 2044 6566 6175 6c74  written. Default
-0000c0d0: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-0000c0e0: 2020 2063 7265 6174 655f 7370 6174 6961     create_spatia
-0000c0f0: 6c5f 696e 6465 7820 2862 6f6f 6c2c 206f  l_index (bool, o
-0000c100: 7074 696f 6e61 6c29 3a20 5472 7565 2074  ptional): True t
-0000c110: 6f20 666f 7263 6520 6372 6561 7469 6f6e  o force creation
-0000c120: 206f 6620 7370 6174 6961 6c20 696e 6465   of spatial inde
-0000c130: 782c 0a20 2020 2020 2020 2020 2020 2046  x,.            F
-0000c140: 616c 7365 2074 6f20 6176 6f69 6420 6372  alse to avoid cr
-0000c150: 6561 7469 6f6e 2e20 4e6f 6e65 206c 6561  eation. None lea
-0000c160: 6473 2074 6f20 7468 6520 6465 6661 756c  ds to the defaul
-0000c170: 7420 6265 6861 7669 6f75 7220 6f66 2067  t behaviour of g
-0000c180: 6461 6c2e 0a20 2020 2020 2020 2020 2020  dal..           
-0000c190: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
-0000c1a0: 652e 0a0a 2020 2020 5261 6973 6573 3a0a  e...    Raises:.
-0000c1b0: 2020 2020 2020 2020 5661 6c75 6545 7272          ValueErr
-0000c1c0: 6f72 3a20 616e 2069 6e76 616c 6964 2070  or: an invalid p
-0000c1d0: 6172 616d 6574 6572 2076 616c 7565 2077  arameter value w
-0000c1e0: 6173 2070 6173 7365 642e 0a20 2020 2020  as passed..     
-0000c1f0: 2020 2052 756e 7469 6d65 4572 726f 723a     RuntimeError:
-0000c200: 2074 696d 656f 7574 2077 6173 2072 6561   timeout was rea
-0000c210: 6368 6564 2077 6869 6c65 2074 7279 696e  ched while tryin
-0000c220: 6720 746f 2061 7070 656e 6420 6461 7461  g to append data
-0000c230: 2074 6f20 7061 7468 2e0a 2020 2020 2222   to path..    ""
-0000c240: 220a 2020 2020 2320 4368 6563 6b20 696e  ".    # Check in
-0000c250: 7075 7420 7061 7261 6d65 7465 7273 0a20  put parameters. 
-0000c260: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
-0000c270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-0000c280: 7061 7468 203d 2050 6174 6828 7061 7468  path = Path(path
-0000c290: 290a 0a20 2020 2023 2049 6620 6e6f 206c  )..    # If no l
-0000c2a0: 6179 6572 206e 616d 6520 7370 6563 6966  ayer name specif
-0000c2b0: 6965 642c 2064 6574 6572 6d69 6e65 206f  ied, determine o
-0000c2c0: 6e65 0a20 2020 2069 6620 6c61 7965 7220  ne.    if layer 
-0000c2d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000c2e0: 2069 6620 6170 7065 6e64 2061 6e64 2070   if append and p
-0000c2f0: 6174 682e 6578 6973 7473 2829 3a0a 2020  ath.exists():.  
-0000c300: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-0000c310: 3d20 6765 745f 6f6e 6c79 5f6c 6179 6572  = get_only_layer
-0000c320: 2870 6174 6829 0a20 2020 2020 2020 2065  (path).        e
-0000c330: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000c340: 206c 6179 6572 203d 2050 6174 6828 7061   layer = Path(pa
-0000c350: 7468 292e 7374 656d 0a0a 2020 2020 2320  th).stem..    # 
-0000c360: 4966 2066 6f72 6365 5f6f 7574 7075 745f  If force_output_
-0000c370: 6765 6f6d 6574 7279 7479 7065 2069 7320  geometrytype is 
-0000c380: 6120 7374 7269 6e67 2c20 6368 6563 6b20  a string, check 
-0000c390: 6966 2069 7420 6973 2061 2022 7374 616e  if it is a "stan
-0000c3a0: 6461 7264 2220 6765 6f6d 6574 7279 0a20  dard" geometry. 
-0000c3b0: 2020 2023 2074 7970 652c 2061 7320 4744     # type, as GD
-0000c3c0: 414c 2061 6c73 6f20 7375 7070 6f72 7473  AL also supports
-0000c3d0: 2073 7065 6369 616c 2067 656f 6d65 7472   special geometr
-0000c3e0: 7920 7479 7065 7320 6c69 6b65 2022 5052  y types like "PR
-0000c3f0: 4f4d 4f54 455f 544f 5f4d 554c 5449 220a  OMOTE_TO_MULTI".
-0000c400: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000c410: 6528 666f 7263 655f 6f75 7470 7574 5f67  e(force_output_g
-0000c420: 656f 6d65 7472 7974 7970 652c 2073 7472  eometrytype, str
-0000c430: 293a 0a20 2020 2020 2020 2066 6f72 6365  ):.        force
-0000c440: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-0000c450: 7479 7065 203d 2066 6f72 6365 5f6f 7574  type = force_out
-0000c460: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
-0000c470: 2e75 7070 6572 2829 0a20 2020 2020 2020  .upper().       
-0000c480: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000c490: 2020 2320 5665 7269 6679 2069 6620 6974    # Verify if it
-0000c4a0: 2069 7320 6120 2273 7461 6e64 6172 6422   is a "standard"
-0000c4b0: 2067 656f 6d65 7472 7920 7479 7065 2c20   geometry type, 
-0000c4c0: 6173 2047 4441 4c20 616c 736f 2073 7570  as GDAL also sup
-0000c4d0: 706f 7274 730a 2020 2020 2020 2020 2020  ports.          
-0000c4e0: 2020 2320 7370 6563 6961 6c20 6765 6f6d    # special geom
-0000c4f0: 6574 7279 2074 7970 6573 206c 696b 6520  etry types like 
-0000c500: 2250 524f 4d4f 5445 5f54 4f5f 4d55 4c54  "PROMOTE_TO_MULT
-0000c510: 4922 0a20 2020 2020 2020 2020 2020 2066  I".            f
-0000c520: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
-0000c530: 6574 7279 7479 7065 203d 2047 656f 6d65  etrytype = Geome
-0000c540: 7472 7954 7970 655b 666f 7263 655f 6f75  tryType[force_ou
-0000c550: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
-0000c560: 655d 0a20 2020 2020 2020 2065 7863 6570  e].        excep
-0000c570: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-0000c580: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000c590: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000c5a0: 2020 2020 2020 2020 2020 2066 2255 6e73             f"Uns
-0000c5b0: 7570 706f 7274 6564 2066 6f72 6365 5f6f  upported force_o
-0000c5c0: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
-0000c5d0: 7065 3a20 7b66 6f72 6365 5f6f 7574 7075  pe: {force_outpu
-0000c5e0: 745f 6765 6f6d 6574 7279 7479 7065 7d22  t_geometrytype}"
-0000c5f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000c600: 2020 2069 6620 666f 7263 655f 6f75 7470     if force_outp
-0000c610: 7574 5f67 656f 6d65 7472 7974 7970 6520  ut_geometrytype 
-0000c620: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000c630: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
-0000c640: 6d65 7472 7974 7970 652e 6973 5f6d 756c  metrytype.is_mul
-0000c650: 7469 7479 7065 3a0a 2020 2020 2020 2020  titype:.        
-0000c660: 666f 7263 655f 6d75 6c74 6974 7970 6520  force_multitype 
-0000c670: 3d20 5472 7565 0a0a 2020 2020 2320 4966  = True..    # If
-0000c680: 2074 6865 7265 2069 7320 6e6f 2067 656f   there is no geo
-0000c690: 6d65 7472 7920 636f 6c75 6d6e 2069 6e20  metry column in 
-0000c6a0: 7468 6520 696e 7075 742c 2061 6c77 6179  the input, alway
-0000c6b0: 7320 7573 6520 6669 6f6e 612c 2061 7320  s use fiona, as 
-0000c6c0: 7079 6f67 7269 6f20 646f 6573 6e27 740a  pyogrio doesn't.
-0000c6d0: 2020 2020 2320 7375 7070 6f72 7420 7468      # support th
-0000c6e0: 6174 2079 6574 2061 7420 7469 6d65 206f  at yet at time o
-0000c6f0: 6620 7772 6974 696e 672e 0a20 2020 2069  f writing..    i
-0000c700: 6620 6973 696e 7374 616e 6365 2867 6466  f isinstance(gdf
-0000c710: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
-0000c720: 6d65 2920 6973 2046 616c 7365 206f 7220  me) is False or 
-0000c730: 280a 2020 2020 2020 2020 6973 696e 7374  (.        isinst
-0000c740: 616e 6365 2867 6466 2c20 6770 642e 4765  ance(gdf, gpd.Ge
-0000c750: 6f44 6174 6146 7261 6d65 2920 616e 6420  oDataFrame) and 
-0000c760: 2267 656f 6d65 7472 7922 206e 6f74 2069  "geometry" not i
-0000c770: 6e20 6764 662e 636f 6c75 6d6e 730a 2020  n gdf.columns.  
-0000c780: 2020 293a 0a20 2020 2020 2020 2065 6e67    ):.        eng
-0000c790: 696e 6520 3d20 2266 696f 6e61 220a 2020  ine = "fiona".  
-0000c7a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c7b0: 656e 6769 6e65 203d 205f 6765 745f 656e  engine = _get_en
-0000c7c0: 6769 6e65 2829 0a0a 2020 2020 2320 4e6f  gine()..    # No
-0000c7d0: 7720 7772 6974 6520 7769 7468 2074 6865  w write with the
-0000c7e0: 2063 6f72 7265 6374 2065 6e67 696e 650a   correct engine.
-0000c7f0: 2020 2020 6966 2065 6e67 696e 6520 3d3d      if engine ==
-0000c800: 2022 7079 6f67 7269 6f22 3a0a 2020 2020   "pyogrio":.    
-0000c810: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-0000c820: 7461 6e63 6528 6764 662c 2067 7064 2e47  tance(gdf, gpd.G
-0000c830: 656f 4461 7461 4672 616d 6529 0a20 2020  eoDataFrame).   
-0000c840: 2020 2020 2072 6574 7572 6e20 5f74 6f5f       return _to_
-0000c850: 6669 6c65 5f70 796f 6772 696f 280a 2020  file_pyogrio(.  
-0000c860: 2020 2020 2020 2020 2020 6764 663d 6764            gdf=gd
-0000c870: 662c 0a20 2020 2020 2020 2020 2020 2070  f,.            p
-0000c880: 6174 683d 7061 7468 2c0a 2020 2020 2020  ath=path,.      
-0000c890: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
-0000c8a0: 722c 0a20 2020 2020 2020 2020 2020 2066  r,.            f
-0000c8b0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
-0000c8c0: 6574 7279 7479 7065 3d66 6f72 6365 5f6f  etrytype=force_o
-0000c8d0: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
-0000c8e0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0000c8f0: 666f 7263 655f 6d75 6c74 6974 7970 653d  force_multitype=
-0000c900: 666f 7263 655f 6d75 6c74 6974 7970 652c  force_multitype,
-0000c910: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-0000c920: 656e 643d 6170 7065 6e64 2c0a 2020 2020  end=append,.    
-0000c930: 2020 2020 2020 2020 6170 7065 6e64 5f74          append_t
-0000c940: 696d 656f 7574 5f73 3d61 7070 656e 645f  imeout_s=append_
-0000c950: 7469 6d65 6f75 745f 732c 0a20 2020 2020  timeout_s,.     
-0000c960: 2020 2020 2020 2069 6e64 6578 3d69 6e64         index=ind
-0000c970: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
-0000c980: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
-0000c990: 6e64 6578 3d63 7265 6174 655f 7370 6174  ndex=create_spat
-0000c9a0: 6961 6c5f 696e 6465 782c 0a20 2020 2020  ial_index,.     
-0000c9b0: 2020 2029 0a20 2020 2065 6c69 6620 656e     ).    elif en
-0000c9c0: 6769 6e65 203d 3d20 2266 696f 6e61 223a  gine == "fiona":
-0000c9d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c9e0: 5f74 6f5f 6669 6c65 5f66 696f 6e61 280a  _to_file_fiona(.
-0000c9f0: 2020 2020 2020 2020 2020 2020 6764 663d              gdf=
-0000ca00: 6764 662c 0a20 2020 2020 2020 2020 2020  gdf,.           
-0000ca10: 2070 6174 683d 7061 7468 2c0a 2020 2020   path=path,.    
-0000ca20: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
-0000ca30: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
-0000ca40: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
-0000ca50: 6f6d 6574 7279 7479 7065 3d66 6f72 6365  ometrytype=force
-0000ca60: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-0000ca70: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-0000ca80: 2020 666f 7263 655f 6d75 6c74 6974 7970    force_multityp
-0000ca90: 653d 666f 7263 655f 6d75 6c74 6974 7970  e=force_multityp
-0000caa0: 652c 0a20 2020 2020 2020 2020 2020 2061  e,.            a
-0000cab0: 7070 656e 643d 6170 7065 6e64 2c0a 2020  ppend=append,.  
-0000cac0: 2020 2020 2020 2020 2020 6170 7065 6e64            append
-0000cad0: 5f74 696d 656f 7574 5f73 3d61 7070 656e  _timeout_s=appen
-0000cae0: 645f 7469 6d65 6f75 745f 732c 0a20 2020  d_timeout_s,.   
-0000caf0: 2020 2020 2020 2020 2069 6e64 6578 3d69           index=i
-0000cb00: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-0000cb10: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
-0000cb20: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
-0000cb30: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
-0000cb40: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
-0000cb50: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-0000cb60: 616c 7565 4572 726f 7228 6622 556e 7375  alueError(f"Unsu
-0000cb70: 7070 6f72 7465 6420 656e 6769 6e65 3a20  pported engine: 
-0000cb80: 7b65 6e67 696e 657d 2229 0a0a 0a64 6566  {engine}")...def
-0000cb90: 205f 6765 745f 656e 6769 6e65 2829 3a0a   _get_engine():.
-0000cba0: 2020 2020 7265 7475 726e 206f 732e 656e      return os.en
-0000cbb0: 7669 726f 6e2e 6765 7428 2247 464f 5f49  viron.get("GFO_I
-0000cbc0: 4f5f 454e 4749 4e45 222c 2022 7079 6f67  O_ENGINE", "pyog
-0000cbd0: 7269 6f22 290a 0a0a 6465 6620 5f74 6f5f  rio")...def _to_
-0000cbe0: 6669 6c65 5f66 696f 6e61 280a 2020 2020  file_fiona(.    
-0000cbf0: 6764 663a 2055 6e69 6f6e 5b70 642e 4461  gdf: Union[pd.Da
-0000cc00: 7461 4672 616d 652c 2067 7064 2e47 656f  taFrame, gpd.Geo
-0000cc10: 4461 7461 4672 616d 655d 2c0a 2020 2020  DataFrame],.    
-0000cc20: 7061 7468 3a20 5061 7468 2c0a 2020 2020  path: Path,.    
-0000cc30: 6c61 7965 723a 2073 7472 2c0a 2020 2020  layer: str,.    
-0000cc40: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
-0000cc50: 6d65 7472 7974 7970 653a 2055 6e69 6f6e  metrytype: Union
-0000cc60: 5b47 656f 6d65 7472 7954 7970 652c 2073  [GeometryType, s
-0000cc70: 7472 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65  tr, None] = None
-0000cc80: 2c0a 2020 2020 666f 7263 655f 6d75 6c74  ,.    force_mult
-0000cc90: 6974 7970 653a 2062 6f6f 6c20 3d20 4661  itype: bool = Fa
-0000cca0: 6c73 652c 0a20 2020 2061 7070 656e 643a  lse,.    append:
-0000ccb0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000ccc0: 2020 2061 7070 656e 645f 7469 6d65 6f75     append_timeou
-0000ccd0: 745f 733a 2069 6e74 203d 2036 3030 2c0a  t_s: int = 600,.
-0000cce0: 2020 2020 696e 6465 783a 204f 7074 696f      index: Optio
-0000ccf0: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
-0000cd00: 2c0a 2020 2020 6372 6561 7465 5f73 7061  ,.    create_spa
-0000cd10: 7469 616c 5f69 6e64 6578 3a20 4f70 7469  tial_index: Opti
-0000cd20: 6f6e 616c 5b62 6f6f 6c5d 203d 2054 7275  onal[bool] = Tru
-0000cd30: 652c 0a29 3a0a 2020 2020 2222 220a 2020  e,.):.    """.  
-0000cd40: 2020 5772 6974 6573 2061 2070 616e 6461    Writes a panda
-0000cd50: 7320 6461 7461 6672 616d 6520 746f 2066  s dataframe to f
-0000cd60: 696c 6520 7573 696e 6720 6669 6f6e 612e  ile using fiona.
-0000cd70: 0a20 2020 2022 2222 0a20 2020 2023 2048  .    """.    # H
-0000cd80: 616e 646c 6520 736f 6d65 2073 7065 6369  andle some speci
-0000cd90: 6669 6320 6361 7365 7320 7768 6572 6520  fic cases where 
-0000cda0: 7468 6520 6669 6c65 2073 6368 656d 6120  the file schema 
-0000cdb0: 6e65 6564 7320 746f 2062 6520 6d61 6e69  needs to be mani
-0000cdc0: 7075 6c61 7465 642e 0a20 2020 2073 6368  pulated..    sch
-0000cdd0: 656d 6120 3d20 4e6f 6e65 0a20 2020 2069  ema = None.    i
-0000cde0: 6620 6973 696e 7374 616e 6365 2867 6466  f isinstance(gdf
-0000cdf0: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
-0000ce00: 6d65 2920 6973 2046 616c 7365 206f 7220  me) is False or 
-0000ce10: 280a 2020 2020 2020 2020 6973 696e 7374  (.        isinst
-0000ce20: 616e 6365 2867 6466 2c20 6770 642e 4765  ance(gdf, gpd.Ge
-0000ce30: 6f44 6174 6146 7261 6d65 2920 616e 6420  oDataFrame) and 
-0000ce40: 2267 656f 6d65 7472 7922 206e 6f74 2069  "geometry" not i
-0000ce50: 6e20 6764 662e 636f 6c75 6d6e 730a 2020  n gdf.columns.  
-0000ce60: 2020 293a 0a20 2020 2020 2020 2023 204e    ):.        # N
-0000ce70: 6f20 6765 6f6d 6574 7279 2c20 736f 2070  o geometry, so p
-0000ce80: 7265 7061 7265 2074 6f20 6265 2077 7269  repare to be wri
-0000ce90: 7474 656e 2061 7320 6174 7472 6962 7574  tten as attribut
-0000cea0: 6520 7461 626c 653a 2061 6464 2067 656f  e table: add geo
-0000ceb0: 6d65 7472 7920 636f 6c75 6d6e 0a20 2020  metry column.   
-0000cec0: 2020 2020 2023 2077 6974 6820 4e6f 6e65       # with None
-0000ced0: 2067 656f 6d65 7472 7920 7479 7065 2069   geometry type i
-0000cee0: 6e20 7363 6865 6d61 0a20 2020 2020 2020  n schema.       
-0000cef0: 2067 6466 203d 2067 7064 2e47 656f 4461   gdf = gpd.GeoDa
-0000cf00: 7461 4672 616d 6528 6764 662c 2067 656f  taFrame(gdf, geo
-0000cf10: 6d65 7472 793d 5b4e 6f6e 6520 666f 7220  metry=[None for 
-0000cf20: 6920 696e 2067 6466 2e69 6e64 6578 5d29  i in gdf.index])
-0000cf30: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-0000cf40: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-0000cf50: 3d20 6770 645f 696f 5f66 696c 652e 696e  = gpd_io_file.in
-0000cf60: 6665 725f 7363 6865 6d61 2867 6466 290a  fer_schema(gdf).
-0000cf70: 2020 2020 2020 2020 7363 6865 6d61 5b22          schema["
-0000cf80: 6765 6f6d 6574 7279 225d 203d 2022 4e6f  geometry"] = "No
-0000cf90: 6e65 220a 2020 2020 656c 6966 2028 0a20  ne".    elif (. 
-0000cfa0: 2020 2020 2020 206c 656e 2867 6466 2920         len(gdf) 
-0000cfb0: 3d3d 2030 0a20 2020 2020 2020 2061 6e64  == 0.        and
-0000cfc0: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
-0000cfd0: 6f6d 6574 7279 7479 7065 2069 7320 6e6f  ometrytype is no
-0000cfe0: 7420 4e6f 6e65 0a20 2020 2020 2020 2061  t None.        a
-0000cff0: 6e64 2069 7369 6e73 7461 6e63 6528 666f  nd isinstance(fo
-0000d000: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
-0000d010: 7472 7974 7970 652c 2047 656f 6d65 7472  trytype, Geometr
-0000d020: 7954 7970 6529 0a20 2020 2029 3a0a 2020  yType).    ):.  
-0000d030: 2020 2020 2020 2320 4966 2074 6865 2067        # If the g
-0000d040: 6466 2069 7320 656d 7074 7920 6275 7420  df is empty but 
-0000d050: 6120 6765 6f6d 6574 7279 2074 7970 6520  a geometry type 
-0000d060: 6973 2073 7065 6369 6669 6564 2c20 7573  is specified, us
-0000d070: 6520 7468 6520 7370 6563 6966 6965 6420  e the specified 
-0000d080: 7479 7065 0a20 2020 2020 2020 2073 6368  type.        sch
-0000d090: 656d 6120 3d20 6770 645f 696f 5f66 696c  ema = gpd_io_fil
-0000d0a0: 652e 696e 6665 725f 7363 6865 6d61 2867  e.infer_schema(g
-0000d0b0: 6466 290a 2020 2020 2020 2020 2320 4765  df).        # Ge
-0000d0c0: 6f6d 6574 7279 2074 7970 6520 6d75 7374  ometry type must
-0000d0d0: 2062 6520 696e 2063 616d 656c 6361 7365   be in camelcase
-0000d0e0: 2066 6f72 2066 696f 6e61 0a20 2020 2020   for fiona.     
-0000d0f0: 2020 2073 6368 656d 615b 2267 656f 6d65     schema["geome
-0000d100: 7472 7922 5d20 3d20 666f 7263 655f 6f75  try"] = force_ou
-0000d110: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
-0000d120: 652e 6e61 6d65 5f63 616d 656c 6361 7365  e.name_camelcase
-0000d130: 0a20 2020 2061 7373 6572 7420 6973 696e  .    assert isin
-0000d140: 7374 616e 6365 2867 6466 2c20 6770 642e  stance(gdf, gpd.
-0000d150: 4765 6f44 6174 6146 7261 6d65 290a 0a20  GeoDataFrame).. 
-0000d160: 2020 2023 2043 6f6e 7665 7274 2066 6f72     # Convert for
-0000d170: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
-0000d180: 7279 7479 7065 2074 6f20 7374 7269 6e67  rytype to string
-0000d190: 2074 6f20 7369 6d70 6c69 6679 2063 6f64   to simplify cod
-0000d1a0: 6520 6166 7465 7277 6172 6473 0a20 2020  e afterwards.   
-0000d1b0: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
-0000d1c0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
-0000d1d0: 6574 7279 7479 7065 2c20 4765 6f6d 6574  etrytype, Geomet
-0000d1e0: 7279 5479 7065 293a 0a20 2020 2020 2020  ryType):.       
-0000d1f0: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
-0000d200: 6f6d 6574 7279 7479 7065 203d 2066 6f72  ometrytype = for
-0000d210: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
-0000d220: 7279 7479 7065 2e6e 616d 650a 0a20 2020  rytype.name..   
-0000d230: 2023 204e 6f20 7468 6520 6669 6c65 2063   # No the file c
-0000d240: 616e 2061 6374 7561 6c6c 7920 6265 2077  an actually be w
-0000d250: 7269 7474 656e 0a20 2020 2023 202d 2d2d  ritten.    # ---
-0000d260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000d270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000d280: 0a20 2020 2023 2046 696f 6e61 2064 6f65  .    # Fiona doe
-0000d290: 736e 2774 2073 7570 706f 7274 2074 6865  sn't support the
-0000d2a0: 206f 7574 7075 7420 6765 6f6d 6574 7279   output geometry
-0000d2b0: 7479 7065 2070 6172 616d 6574 6572 2061  type parameter a
-0000d2c0: 7320 7573 6564 2069 6e20 6764 616c 2c20  s used in gdal, 
-0000d2d0: 736f 2061 7320 610a 2020 2020 2320 6c69  so as a.    # li
-0000d2e0: 6768 7477 6569 6768 7420 696d 706c 656d  ghtweight implem
-0000d2f0: 656e 7461 7469 6f6e 206a 7573 7420 7365  entation just se
-0000d300: 7420 666f 7263 650a 2020 2020 6465 6620  t force.    def 
-0000d310: 7772 6974 655f 746f 5f66 696c 6528 0a20  write_to_file(. 
-0000d320: 2020 2020 2020 2067 6466 3a20 6770 642e         gdf: gpd.
-0000d330: 4765 6f44 6174 6146 7261 6d65 2c0a 2020  GeoDataFrame,.  
-0000d340: 2020 2020 2020 7061 7468 3a20 5061 7468        path: Path
-0000d350: 2c0a 2020 2020 2020 2020 6c61 7965 723a  ,.        layer:
-0000d360: 2073 7472 2c0a 2020 2020 2020 2020 696e   str,.        in
-0000d370: 6465 783a 204f 7074 696f 6e61 6c5b 626f  dex: Optional[bo
-0000d380: 6f6c 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ol] = None,.    
-0000d390: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
-0000d3a0: 5f67 656f 6d65 7472 7974 7970 653a 204f  _geometrytype: O
-0000d3b0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000d3c0: 6f6e 652c 0a20 2020 2020 2020 2066 6f72  one,.        for
-0000d3d0: 6365 5f6d 756c 7469 7479 7065 3a20 626f  ce_multitype: bo
-0000d3e0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000d3f0: 2020 2020 6170 7065 6e64 3a20 626f 6f6c      append: bool
-0000d400: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-0000d410: 2020 7363 6865 6d61 3a20 4f70 7469 6f6e    schema: Option
-0000d420: 616c 5b64 6963 745d 203d 204e 6f6e 652c  al[dict] = None,
-0000d430: 0a20 2020 2020 2020 2063 7265 6174 655f  .        create_
-0000d440: 7370 6174 6961 6c5f 696e 6465 783a 204f  spatial_index: O
-0000d450: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
-0000d460: 5472 7565 2c0a 2020 2020 293a 0a20 2020  True,.    ):.   
-0000d470: 2020 2020 2023 2050 7265 7061 7265 2061       # Prepare a
-0000d480: 7267 7320 666f 7220 746f 5f66 696c 650a  rgs for to_file.
-0000d490: 2020 2020 2020 2020 6966 2061 7070 656e          if appen
-0000d4a0: 6420 6973 2054 7275 653a 0a20 2020 2020  d is True:.     
-0000d4b0: 2020 2020 2020 2069 6620 7061 7468 2e65         if path.e
-0000d4c0: 7869 7374 7328 293a 0a20 2020 2020 2020  xists():.       
-0000d4d0: 2020 2020 2020 2020 206d 6f64 6520 3d20           mode = 
-0000d4e0: 2261 220a 2020 2020 2020 2020 2020 2020  "a".            
-0000d4f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d500: 2020 2020 2020 6d6f 6465 203d 2022 7722        mode = "w"
-0000d510: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000d520: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
-0000d530: 3d20 2277 220a 0a20 2020 2020 2020 206b  = "w"..        k
-0000d540: 7761 7267 7320 3d20 7b7d 0a20 2020 2020  wargs = {}.     
-0000d550: 2020 206b 7761 7267 735b 2265 6e67 696e     kwargs["engin
-0000d560: 6522 5d20 3d20 2266 696f 6e61 220a 2020  e"] = "fiona".  
-0000d570: 2020 2020 2020 6b77 6172 6773 5b22 6d6f        kwargs["mo
-0000d580: 6465 225d 203d 206d 6f64 650a 2020 2020  de"] = mode.    
-0000d590: 2020 2020 6765 6f66 696c 6574 7970 6520      geofiletype 
-0000d5a0: 3d20 4765 6f66 696c 6554 7970 6528 7061  = GeofileType(pa
-0000d5b0: 7468 290a 2020 2020 2020 2020 6b77 6172  th).        kwar
-0000d5c0: 6773 5b22 6472 6976 6572 225d 203d 2067  gs["driver"] = g
-0000d5d0: 656f 6669 6c65 7479 7065 2e6f 6772 6472  eofiletype.ogrdr
-0000d5e0: 6976 6572 0a20 2020 2020 2020 206b 7761  iver.        kwa
-0000d5f0: 7267 735b 2269 6e64 6578 225d 203d 2069  rgs["index"] = i
-0000d600: 6e64 6578 0a20 2020 2020 2020 2069 6620  ndex.        if 
-0000d610: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
-0000d620: 6e64 6578 2069 7320 6e6f 7420 4e6f 6e65  ndex is not None
-0000d630: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
-0000d640: 6172 6773 5b22 5350 4154 4941 4c5f 494e  args["SPATIAL_IN
-0000d650: 4445 5822 5d20 3d20 6372 6561 7465 5f73  DEX"] = create_s
-0000d660: 7061 7469 616c 5f69 6e64 6578 0a20 2020  patial_index.   
-0000d670: 2020 2020 2069 6620 666f 7263 655f 6f75       if force_ou
-0000d680: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
-0000d690: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000d6a0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-0000d6b0: 735b 2267 656f 6d65 7472 7974 7970 6522  s["geometrytype"
-0000d6c0: 5d20 3d20 666f 7263 655f 6f75 7470 7574  ] = force_output
-0000d6d0: 5f67 656f 6d65 7472 7974 7970 650a 2020  _geometrytype.  
-0000d6e0: 2020 2020 2020 6966 2073 6368 656d 6120        if schema 
-0000d6f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000d700: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-0000d710: 2273 6368 656d 6122 5d20 3d20 7363 6865  "schema"] = sche
-0000d720: 6d61 0a0a 2020 2020 2020 2020 2320 4e6f  ma..        # No
-0000d730: 7720 7765 2063 616e 2077 7269 7465 0a20  w we can write. 
-0000d740: 2020 2020 2020 2069 6620 6765 6f66 696c         if geofil
-0000d750: 6574 7970 6520 3d3d 2047 656f 6669 6c65  etype == Geofile
-0000d760: 5479 7065 2e45 5352 4953 6861 7065 6669  Type.ESRIShapefi
-0000d770: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0000d780: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0000d790: 6966 2069 6e64 6578 2069 7320 5472 7565  if index is True
-0000d7a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d7b0: 2020 6764 665f 746f 5f77 7269 7465 203d    gdf_to_write =
-0000d7c0: 2067 6466 2e72 6573 6574 5f69 6e64 6578   gdf.reset_index
-0000d7d0: 2864 726f 703d 5472 7565 290a 2020 2020  (drop=True).    
-0000d7e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000d7f0: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-0000d800: 665f 746f 5f77 7269 7465 203d 2067 6466  f_to_write = gdf
-0000d810: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-0000d820: 0a20 2020 2020 2020 2020 2020 2067 6466  .            gdf
-0000d830: 5f74 6f5f 7772 6974 6520 3d20 6764 660a  _to_write = gdf.
-0000d840: 2020 2020 2020 2020 2020 2020 6764 665f              gdf_
-0000d850: 746f 5f77 7269 7465 2e74 6f5f 6669 6c65  to_write.to_file
-0000d860: 2873 7472 2870 6174 6829 2c20 2a2a 6b77  (str(path), **kw
-0000d870: 6172 6773 2920 2023 2074 7970 653a 2069  args)  # type: i
-0000d880: 676e 6f72 650a 2020 2020 2020 2020 656c  gnore.        el
-0000d890: 6966 2067 656f 6669 6c65 7479 7065 203d  if geofiletype =
-0000d8a0: 3d20 4765 6f66 696c 6554 7970 652e 4750  = GeofileType.GP
-0000d8b0: 4b47 3a0a 2020 2020 2020 2020 2020 2020  KG:.            
-0000d8c0: 2320 5472 7920 746f 2068 6172 6d6f 6e69  # Try to harmoni
-0000d8d0: 7a65 2074 6865 2067 656f 6d65 7472 7974  ze the geometryt
-0000d8e0: 7970 6520 746f 206f 6e65 2028 6d75 6c74  ype to one (mult
-0000d8f0: 6929 7479 7065 2c20 6173 2047 504b 470a  i)type, as GPKG.
-0000d900: 2020 2020 2020 2020 2020 2020 2320 646f              # do
-0000d910: 6573 6e27 7420 6c69 6b65 203e 2031 2074  esn't like > 1 t
-0000d920: 7970 6520 696e 2061 206c 6179 6572 0a20  ype in a layer. 
-0000d930: 2020 2020 2020 2020 2020 2069 6620 7363             if sc
-0000d940: 6865 6d61 2069 7320 4e6f 6e65 206f 7220  hema is None or 
-0000d950: 286c 656e 2867 6466 2920 3e20 3020 616e  (len(gdf) > 0 an
-0000d960: 6420 7363 6865 6d61 5b22 6765 6f6d 6574  d schema["geomet
-0000d970: 7279 225d 2021 3d20 224e 6f6e 6522 293a  ry"] != "None"):
-0000d980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d990: 2067 6466 5f74 6f5f 7772 6974 6520 3d20   gdf_to_write = 
-0000d9a0: 6764 662e 636f 7079 2829 0a20 2020 2020  gdf.copy().     
-0000d9b0: 2020 2020 2020 2020 2020 2067 6466 5f74             gdf_t
-0000d9c0: 6f5f 7772 6974 652e 6765 6f6d 6574 7279  o_write.geometry
-0000d9d0: 203d 2067 656f 7365 7269 6573 5f75 7469   = geoseries_uti
-0000d9e0: 6c2e 6861 726d 6f6e 697a 655f 6765 6f6d  l.harmonize_geom
-0000d9f0: 6574 7279 7479 7065 7328 0a20 2020 2020  etrytypes(.     
-0000da00: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000da10: 6466 2e67 656f 6d65 7472 792c 2066 6f72  df.geometry, for
-0000da20: 6365 5f6d 756c 7469 7479 7065 3d66 6f72  ce_multitype=for
-0000da30: 6365 5f6d 756c 7469 7479 7065 0a20 2020  ce_multitype.   
-0000da40: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000da50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000da60: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-0000da70: 2867 6466 5f74 6f5f 7772 6974 652c 2067  (gdf_to_write, g
-0000da80: 7064 2e47 656f 4461 7461 4672 616d 6529  pd.GeoDataFrame)
-0000da90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000daa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000dab0: 2020 2067 6466 5f74 6f5f 7772 6974 6520     gdf_to_write 
-0000dac0: 3d20 6764 660a 2020 2020 2020 2020 2020  = gdf.          
-0000dad0: 2020 6764 665f 746f 5f77 7269 7465 2e74    gdf_to_write.t
-0000dae0: 6f5f 6669 6c65 2873 7472 2870 6174 6829  o_file(str(path)
-0000daf0: 2c20 6c61 7965 723d 6c61 7965 722c 202a  , layer=layer, *
-0000db00: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0000db10: 2065 6c69 6620 6765 6f66 696c 6574 7970   elif geofiletyp
-0000db20: 6520 3d3d 2047 656f 6669 6c65 5479 7065  e == GeofileType
-0000db30: 2e53 514c 6974 653a 0a20 2020 2020 2020  .SQLite:.       
-0000db40: 2020 2020 2067 6466 2e74 6f5f 6669 6c65       gdf.to_file
-0000db50: 2873 7472 2870 6174 6829 2c20 6c61 7965  (str(path), laye
-0000db60: 723d 6c61 7965 722c 202a 2a6b 7761 7267  r=layer, **kwarg
-0000db70: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
-0000db80: 6765 6f66 696c 6574 7970 6520 3d3d 2047  geofiletype == G
-0000db90: 656f 6669 6c65 5479 7065 2e47 656f 4a53  eofileType.GeoJS
-0000dba0: 4f4e 3a0a 2020 2020 2020 2020 2020 2020  ON:.            
-0000dbb0: 6764 662e 746f 5f66 696c 6528 7374 7228  gdf.to_file(str(
-0000dbc0: 7061 7468 292c 202a 2a6b 7761 7267 7329  path), **kwargs)
-0000dbd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000dbe0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000dbf0: 2056 616c 7565 4572 726f 7228 6622 4e6f   ValueError(f"No
-0000dc00: 7420 696d 706c 656d 656e 7465 6420 666f  t implemented fo
-0000dc10: 7220 6765 6f66 696c 6574 7970 6520 7b67  r geofiletype {g
-0000dc20: 656f 6669 6c65 7479 7065 7d22 290a 0a20  eofiletype}").. 
-0000dc30: 2020 2023 2049 6620 6e6f 2061 7070 656e     # If no appen
-0000dc40: 642c 206a 7573 7420 7772 6974 6520 746f  d, just write to
-0000dc50: 206f 7574 7075 7420 7061 7468 0a20 2020   output path.   
-0000dc60: 2069 6620 6e6f 7420 6170 7065 6e64 3a0a   if not append:.
-0000dc70: 2020 2020 2020 2020 7772 6974 655f 746f          write_to
-0000dc80: 5f66 696c 6528 0a20 2020 2020 2020 2020  _file(.         
-0000dc90: 2020 2067 6466 3d67 6466 2c0a 2020 2020     gdf=gdf,.    
-0000dca0: 2020 2020 2020 2020 7061 7468 3d70 6174          path=pat
-0000dcb0: 682c 0a20 2020 2020 2020 2020 2020 206c  h,.            l
-0000dcc0: 6179 6572 3d6c 6179 6572 2c0a 2020 2020  ayer=layer,.    
-0000dcd0: 2020 2020 2020 2020 696e 6465 783d 696e          index=in
-0000dce0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
-0000dcf0: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
-0000dd00: 6f6d 6574 7279 7479 7065 3d66 6f72 6365  ometrytype=force
-0000dd10: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-0000dd20: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-0000dd30: 2020 666f 7263 655f 6d75 6c74 6974 7970    force_multityp
-0000dd40: 653d 666f 7263 655f 6d75 6c74 6974 7970  e=force_multityp
-0000dd50: 652c 0a20 2020 2020 2020 2020 2020 2061  e,.            a
-0000dd60: 7070 656e 643d 6170 7065 6e64 2c0a 2020  ppend=append,.  
-0000dd70: 2020 2020 2020 2020 2020 7363 6865 6d61            schema
-0000dd80: 3d73 6368 656d 612c 0a20 2020 2020 2020  =schema,.       
-0000dd90: 2020 2020 2063 7265 6174 655f 7370 6174       create_spat
-0000dda0: 6961 6c5f 696e 6465 783d 6372 6561 7465  ial_index=create
-0000ddb0: 5f73 7061 7469 616c 5f69 6e64 6578 2c0a  _spatial_index,.
-0000ddc0: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
-0000ddd0: 7365 3a0a 2020 2020 2020 2020 2320 4170  se:.        # Ap
-0000dde0: 7065 6e64 2069 7320 6173 6b65 642c 2063  pend is asked, c
-0000ddf0: 6865 636b 2069 6620 7468 6520 6669 6f6e  heck if the fion
-0000de00: 6120 6472 6976 6572 2073 7570 706f 7274  a driver support
-0000de10: 7320 6170 7065 6e64 696e 672e 2049 660a  s appending. If.
-0000de20: 2020 2020 2020 2020 2320 6e6f 742c 2077          # not, w
-0000de30: 7269 7465 2074 6f20 7465 6d70 6f72 6172  rite to temporar
-0000de40: 7920 6f75 7470 7574 2066 696c 650a 0a20  y output file.. 
-0000de50: 2020 2020 2020 2023 2052 656d 6172 6b3a         # Remark:
-0000de60: 2066 696f 6e61 2070 7265 2d31 2e38 2e31   fiona pre-1.8.1
-0000de70: 3420 6469 646e 2774 2073 7570 706f 7274  4 didn't support
-0000de80: 2061 7070 656e 6469 6e67 2074 6f20 6765   appending to ge
-0000de90: 6f70 6163 6b61 6765 2e20 4f6e 6365 0a20  opackage. Once. 
-0000dea0: 2020 2020 2020 2023 206f 6c64 6572 2076         # older v
-0000deb0: 6572 7369 6f6e 7320 6265 636f 6d65 7320  ersions becomes 
-0000dec0: 7261 7265 2c20 6465 7065 6e64 656e 6379  rare, dependency
-0000ded0: 2063 616e 2062 6520 7075 7420 746f 2074   can be put to t
-0000dee0: 6869 7320 7665 7273 696f 6e2c 2061 6e64  his version, and
-0000def0: 0a20 2020 2020 2020 2023 2074 6869 7320  .        # this 
-0000df00: 636f 6465 2063 616e 2062 6520 636c 6561  code can be clea
-0000df10: 6e65 6420 7570 2e2e 2e0a 2020 2020 2020  ned up....      
-0000df20: 2020 6765 6f66 696c 6574 7970 6520 3d20    geofiletype = 
-0000df30: 4765 6f66 696c 6554 7970 6528 7061 7468  GeofileType(path
-0000df40: 290a 2020 2020 2020 2020 6764 6674 656d  ).        gdftem
-0000df50: 705f 7061 7468 203d 204e 6f6e 650a 2020  p_path = None.  
-0000df60: 2020 2020 2020 6764 6674 656d 705f 6c6f        gdftemp_lo
-0000df70: 636b 7061 7468 203d 204e 6f6e 650a 2020  ckpath = None.  
-0000df80: 2020 2020 2020 6966 2022 6122 206e 6f74        if "a" not
-0000df90: 2069 6e20 6669 6f6e 612e 7375 7070 6f72   in fiona.suppor
-0000dfa0: 7465 645f 6472 6976 6572 735b 6765 6f66  ted_drivers[geof
-0000dfb0: 696c 6574 7970 652e 6f67 7264 7269 7665  iletype.ogrdrive
-0000dfc0: 725d 3a0a 2020 2020 2020 2020 2020 2020  r]:.            
-0000dfd0: 2320 4765 7420 6120 756e 6971 7565 2074  # Get a unique t
-0000dfe0: 656d 7020 6669 6c65 2070 6174 682e 2054  emp file path. T
-0000dff0: 6865 2066 696c 6520 6361 6e6e 6f74 2062  he file cannot b
-0000e000: 6520 6372 6561 7465 6420 7965 742c 2073  e created yet, s
-0000e010: 6f0a 2020 2020 2020 2020 2020 2020 2320  o.            # 
-0000e020: 6f6e 6c79 2063 7265 6174 6520 6120 6c6f  only create a lo
-0000e030: 636b 2066 696c 6520 746f 2065 7661 6465  ck file to evade
-0000e040: 206f 7468 6572 2070 726f 6365 7373 6573   other processes
-0000e050: 2075 7369 6e67 2074 6865 2073 616d 650a   using the same.
-0000e060: 2020 2020 2020 2020 2020 2020 2320 7465              # te
-0000e070: 6d70 2066 696c 6520 6e61 6d65 0a20 2020  mp file name.   
-0000e080: 2020 2020 2020 2020 2067 6466 7465 6d70           gdftemp
-0000e090: 5f70 6174 682c 2067 6466 7465 6d70 5f6c  _path, gdftemp_l
-0000e0a0: 6f63 6b70 6174 6820 3d20 5f69 6f5f 7574  ockpath = _io_ut
-0000e0b0: 696c 2e67 6574 5f74 656d 7066 696c 655f  il.get_tempfile_
-0000e0c0: 6c6f 636b 6564 280a 2020 2020 2020 2020  locked(.        
-0000e0d0: 2020 2020 2020 2020 6261 7365 5f66 696c          base_fil
-0000e0e0: 656e 616d 653d 2267 6466 7465 6d70 222c  ename="gdftemp",
-0000e0f0: 2073 7566 6669 783d 7061 7468 2e73 7566   suffix=path.suf
-0000e100: 6669 782c 2064 6972 6e61 6d65 3d22 6765  fix, dirname="ge
-0000e110: 6f66 696c 655f 746f 5f66 696c 6522 0a20  ofile_to_file". 
-0000e120: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000e130: 2020 2020 2020 2020 2077 7269 7465 5f74           write_t
-0000e140: 6f5f 6669 6c65 280a 2020 2020 2020 2020  o_file(.        
-0000e150: 2020 2020 2020 2020 6764 662c 0a20 2020          gdf,.   
-0000e160: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-0000e170: 683d 6764 6674 656d 705f 7061 7468 2c0a  h=gdftemp_path,.
-0000e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e190: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
-0000e1a0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0000e1b0: 6578 3d69 6e64 6578 2c0a 2020 2020 2020  ex=index,.      
-0000e1c0: 2020 2020 2020 2020 2020 666f 7263 655f            force_
-0000e1d0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-0000e1e0: 7970 653d 666f 7263 655f 6f75 7470 7574  ype=force_output
-0000e1f0: 5f67 656f 6d65 7472 7974 7970 652c 0a20  _geometrytype,. 
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e210: 6f72 6365 5f6d 756c 7469 7479 7065 3d66  orce_multitype=f
-0000e220: 6f72 6365 5f6d 756c 7469 7479 7065 2c0a  orce_multitype,.
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 7363 6865 6d61 3d73 6368 656d 612c 0a20  schema=schema,. 
-0000e250: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000e260: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
-0000e270: 6465 783d 6372 6561 7465 5f73 7061 7469  dex=create_spati
-0000e280: 616c 5f69 6e64 6578 2c0a 2020 2020 2020  al_index,.      
-0000e290: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000e2a0: 2023 2046 696c 6573 2064 6f6e 2774 2074   # Files don't t
-0000e2b0: 7970 6963 616c 6c79 2073 7570 706f 7274  ypically support
-0000e2c0: 2068 6176 696e 6720 6d75 6c74 6970 6c65   having multiple
-0000e2d0: 2070 726f 6365 7373 6573 2077 7269 7469   processes writi
-0000e2e0: 6e67 0a20 2020 2020 2020 2023 2073 696d  ng.        # sim
-0000e2f0: 756c 7461 6e6f 7573 6c79 2074 6f20 7468  ultanously to th
-0000e300: 656d 2c20 736f 2075 7365 206c 6f63 6b20  em, so use lock 
-0000e310: 6669 6c65 2074 6f20 7379 6e63 6872 6f6e  file to synchron
-0000e320: 697a 6520 6163 6365 7373 2e0a 2020 2020  ize access..    
-0000e330: 2020 2020 6c6f 636b 6669 6c65 203d 2050      lockfile = P
-0000e340: 6174 6828 6622 7b73 7472 2870 6174 6829  ath(f"{str(path)
-0000e350: 7d2e 6c6f 636b 2229 0a20 2020 2020 2020  }.lock").       
-0000e360: 2073 7461 7274 5f74 696d 6520 3d20 6461   start_time = da
-0000e370: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-0000e380: 6e6f 7728 290a 2020 2020 2020 2020 7265  now().        re
-0000e390: 6164 7920 3d20 4661 6c73 650a 2020 2020  ady = False.    
-0000e3a0: 2020 2020 7768 696c 6520 6e6f 7420 7265      while not re
-0000e3b0: 6164 793a 0a20 2020 2020 2020 2020 2020  ady:.           
-0000e3c0: 2069 6620 5f69 6f5f 7574 696c 2e63 7265   if _io_util.cre
-0000e3d0: 6174 655f 6669 6c65 5f61 746f 6d69 6328  ate_file_atomic(
-0000e3e0: 6c6f 636b 6669 6c65 2920 6973 2054 7275  lockfile) is Tru
-0000e3f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000e400: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000e410: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-0000e420: 2067 6466 2077 6173 6e27 7420 7772 6974   gdf wasn't writ
-0000e430: 7465 6e20 746f 2074 656d 7020 6669 6c65  ten to temp file
-0000e440: 2c20 7573 6520 7374 616e 6461 7264 2077  , use standard w
-0000e450: 7269 7465 2d74 6f2d 6669 6c65 0a20 2020  rite-to-file.   
-0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e470: 2069 6620 6764 6674 656d 705f 7061 7468   if gdftemp_path
-0000e480: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4a0: 2020 7772 6974 655f 746f 5f66 696c 6528    write_to_file(
-0000e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e4c0: 2020 2020 2020 2020 2020 2020 2067 6466               gdf
-0000e4d0: 3d67 6466 2c0a 2020 2020 2020 2020 2020  =gdf,.          
-0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4f0: 2020 7061 7468 3d70 6174 682c 0a20 2020    path=path,.   
-0000e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e510: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
-0000e520: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e540: 2020 696e 6465 783d 696e 6465 782c 0a20    index=index,. 
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e560: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-0000e570: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-0000e580: 7479 7065 3d66 6f72 6365 5f6f 7574 7075  type=force_outpu
-0000e590: 745f 6765 6f6d 6574 7279 7479 7065 2c0a  t_geometrytype,.
+00003050: 2020 2020 2020 2069 6620 4765 6f66 696c         if Geofil
+00003060: 6554 7970 6528 7061 7468 2920 3d3d 2047  eType(path) == G
+00003070: 656f 6669 6c65 5479 7065 2e45 5352 4953  eofileType.ESRIS
+00003080: 6861 7065 6669 6c65 3a0a 2020 2020 2020  hapefile:.      
+00003090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000030a0: 2020 2020 2020 7072 6a5f 7061 7468 203d        prj_path =
+000030b0: 2070 6174 682e 7061 7265 6e74 202f 2066   path.parent / f
+000030c0: 227b 7061 7468 2e73 7465 6d7d 2e70 726a  "{path.stem}.prj
+000030d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000030e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000030f0: 2070 726a 5f70 6174 682e 6578 6973 7473   prj_path.exists
+00003100: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00003110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003120: 2020 2020 7072 6a5f 7265 6e61 6d65 5f70      prj_rename_p
+00003130: 6174 6820 3d20 7061 7468 2e70 6172 656e  ath = path.paren
+00003140: 7420 2f20 6622 7b70 6174 682e 7374 656d  t / f"{path.stem
+00003150: 7d5f 6f72 6967 2e70 726a 220a 2020 2020  }_orig.prj".    
+00003160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003170: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00003180: 6f74 2070 726a 5f72 656e 616d 655f 7061  ot prj_rename_pa
+00003190: 7468 2e65 7869 7374 7328 293a 0a20 2020  th.exists():.   
+000031a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031c0: 2070 726a 5f70 6174 682e 7265 6e61 6d65   prj_path.rename
+000031d0: 2870 726a 5f72 656e 616d 655f 7061 7468  (prj_rename_path
+000031e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000031f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003200: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003220: 2020 2020 2020 2020 2020 2020 7072 6a5f              prj_
+00003230: 7061 7468 2e75 6e6c 696e 6b28 290a 2020  path.unlink().  
+00003240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003250: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00003260: 6a5f 7061 7468 2e77 7269 7465 5f74 6578  j_path.write_tex
+00003270: 7428 5052 4a5f 4550 5347 5f33 3133 3730  t(PRJ_EPSG_31370
+00003280: 290a 2020 2020 2020 2020 656c 6966 2072  ).        elif r
+00003290: 6169 7365 5f6f 6e5f 6e6f 6765 6f6d 3a0a  aise_on_nogeom:.
+000032a0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000032b0: 7273 2e61 7070 656e 6428 224c 6179 6572  rs.append("Layer
+000032c0: 2064 6f65 736e 2774 2068 6176 6520 6120   doesn't have a 
+000032d0: 6765 6f6d 6574 7279 2063 6f6c 756d 6e21  geometry column!
+000032e0: 2229 0a0a 2020 2020 2020 2020 2320 4966  ")..        # If
+000032f0: 2074 6865 7265 2077 6572 6520 6e6f 2065   there were no e
+00003300: 7272 6f72 732c 2065 7665 7279 7468 696e  rrors, everythin
+00003310: 6720 7761 7320 4f4b 2073 6f20 7765 2063  g was OK so we c
+00003320: 616e 2072 6574 7572 6e2e 0a20 2020 2020  an return..     
+00003330: 2020 2069 6620 6c65 6e28 6572 726f 7273     if len(errors
+00003340: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00003350: 2020 2020 7265 7475 726e 204c 6179 6572      return Layer
+00003360: 496e 666f 280a 2020 2020 2020 2020 2020  Info(.          
+00003370: 2020 2020 2020 6e61 6d65 3d64 6174 6173        name=datas
+00003380: 6f75 7263 655f 6c61 7965 722e 4765 744e  ource_layer.GetN
+00003390: 616d 6528 292c 0a20 2020 2020 2020 2020  ame(),.         
+000033a0: 2020 2020 2020 2066 6561 7475 7265 636f         featureco
+000033b0: 756e 743d 6461 7461 736f 7572 6365 5f6c  unt=datasource_l
+000033c0: 6179 6572 2e47 6574 4665 6174 7572 6543  ayer.GetFeatureC
+000033d0: 6f75 6e74 2829 2c0a 2020 2020 2020 2020  ount(),.        
+000033e0: 2020 2020 2020 2020 746f 7461 6c5f 626f          total_bo
+000033f0: 756e 6473 3d74 6f74 616c 5f62 6f75 6e64  unds=total_bound
+00003400: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00003410: 2020 2067 656f 6d65 7472 7963 6f6c 756d     geometrycolum
+00003420: 6e3d 6765 6f6d 6574 7279 636f 6c75 6d6e  n=geometrycolumn
+00003430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003440: 2020 6765 6f6d 6574 7279 7479 7065 6e61    geometrytypena
+00003450: 6d65 3d67 656f 6d65 7472 7974 7970 656e  me=geometrytypen
+00003460: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00003470: 2020 2020 2067 656f 6d65 7472 7974 7970       geometrytyp
+00003480: 653d 6765 6f6d 6574 7279 7479 7065 2c0a  e=geometrytype,.
+00003490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034a0: 636f 6c75 6d6e 733d 636f 6c75 6d6e 732c  columns=columns,
+000034b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000034c0: 2066 6964 5f63 6f6c 756d 6e3d 6461 7461   fid_column=data
+000034d0: 736f 7572 6365 5f6c 6179 6572 2e47 6574  source_layer.Get
+000034e0: 4649 4443 6f6c 756d 6e28 292c 0a20 2020  FIDColumn(),.   
+000034f0: 2020 2020 2020 2020 2020 2020 2063 7273               crs
+00003500: 3d63 7273 2c0a 2020 2020 2020 2020 2020  =crs,.          
+00003510: 2020 2020 2020 6572 726f 7273 3d65 7272        errors=err
+00003520: 6f72 732c 0a20 2020 2020 2020 2020 2020  ors,.           
+00003530: 2029 0a0a 2020 2020 6578 6365 7074 2045   )..    except E
+00003540: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
+00003550: 2020 2020 2020 2020 6578 2e61 7267 7320          ex.args 
+00003560: 3d20 2866 2267 6574 5f6c 6179 6572 696e  = (f"get_layerin
+00003570: 666f 2065 7272 6f72 2066 6f72 207b 7061  fo error for {pa
+00003580: 7468 7d2e 7b6c 6179 6572 7d3a 5c6e 2020  th}.{layer}:\n  
+00003590: 7b65 787d 222c 290a 2020 2020 2020 2020  {ex}",).        
+000035a0: 7261 6973 650a 2020 2020 6669 6e61 6c6c  raise.    finall
+000035b0: 793a 0a20 2020 2020 2020 2064 6174 6173  y:.        datas
+000035c0: 6f75 7263 6520 3d20 4e6f 6e65 0a0a 2020  ource = None..  
+000035d0: 2020 2320 4966 2077 6520 6469 646e 2774    # If we didn't
+000035e0: 2072 6574 7572 6e20 6f72 2072 6169 7365   return or raise
+000035f0: 2079 6574 2068 6572 652c 2074 6865 7265   yet here, there
+00003600: 206d 7573 7420 6861 7665 2062 6565 6e20   must have been 
+00003610: 6572 726f 7273 0a20 2020 2065 7272 6f72  errors.    error
+00003620: 735f 7374 7220 3d20 7070 7269 6e74 2e70  s_str = pprint.p
+00003630: 666f 726d 6174 2865 7272 6f72 7329 0a20  format(errors). 
+00003640: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00003650: 726f 7228 0a20 2020 2020 2020 2066 2245  ror(.        f"E
+00003660: 7272 6f72 7320 696e 206c 6179 6572 2064  rrors in layer d
+00003670: 6566 696e 6974 696f 6e20 6f66 2066 696c  efinition of fil
+00003680: 6520 7b70 6174 687d 2c20 6c61 7965 7220  e {path}, layer 
+00003690: 7b6c 6179 6572 7d3a 205c 6e7b 6572 726f  {layer}: \n{erro
+000036a0: 7273 5f73 7472 7d22 0a20 2020 2029 0a0a  rs_str}".    )..
+000036b0: 0a64 6566 2067 6574 5f6f 6e6c 795f 6c61  .def get_only_la
+000036c0: 7965 7228 7061 7468 3a20 556e 696f 6e5b  yer(path: Union[
+000036d0: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
+000036e0: 655b 416e 795d 225d 2920 2d3e 2073 7472  e[Any]"]) -> str
+000036f0: 3a0a 2020 2020 2222 220a 2020 2020 4765  :.    """.    Ge
+00003700: 7420 7468 6520 6c61 7965 726e 616d 6520  t the layername 
+00003710: 666f 7220 6120 6669 6c65 2074 6861 7420  for a file that 
+00003720: 6f6e 6c79 2063 6f6e 7461 696e 7320 6f6e  only contains on
+00003730: 6520 6c61 7965 722e 0a0a 2020 2020 4966  e layer...    If
+00003740: 2074 6865 2066 696c 6520 636f 6e74 6169   the file contai
+00003750: 6e73 206d 756c 7469 706c 6520 6c61 7965  ns multiple laye
+00003760: 7273 2c20 616e 2065 7863 6570 7469 6f6e  rs, an exception
+00003770: 2069 7320 7468 726f 776e 2e0a 0a20 2020   is thrown...   
+00003780: 2041 7267 733a 0a20 2020 2020 2020 2070   Args:.        p
+00003790: 6174 6820 2850 6174 684c 696b 6529 3a20  ath (PathLike): 
+000037a0: 7468 6520 6669 6c65 2e0a 0a20 2020 2052  the file...    R
+000037b0: 6169 7365 733a 0a20 2020 2020 2020 2056  aises:.        V
+000037c0: 616c 7565 4572 726f 723a 2061 6e20 696e  alueError: an in
+000037d0: 7661 6c69 6420 7061 7261 6d65 7465 7220  valid parameter 
+000037e0: 7661 6c75 6520 7761 7320 7061 7373 6564  value was passed
+000037f0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+00003800: 2020 2020 2020 2020 7374 723a 2074 6865          str: the
+00003810: 206c 6179 6572 206e 616d 650a 2020 2020   layer name.    
+00003820: 2222 220a 2020 2020 6461 7461 736f 7572  """.    datasour
+00003830: 6365 203d 204e 6f6e 650a 2020 2020 7472  ce = None.    tr
+00003840: 793a 0a20 2020 2020 2020 2064 6174 6173  y:.        datas
+00003850: 6f75 7263 655f 6c61 7965 7220 3d20 4e6f  ource_layer = No
+00003860: 6e65 0a20 2020 2020 2020 2064 6174 6173  ne.        datas
+00003870: 6f75 7263 6520 3d20 6764 616c 2e4f 7065  ource = gdal.Ope
+00003880: 6e45 7828 0a20 2020 2020 2020 2020 2020  nEx(.           
+00003890: 2073 7472 2870 6174 6829 2c20 6e4f 7065   str(path), nOpe
+000038a0: 6e46 6c61 6773 3d67 6461 6c2e 4f46 5f56  nFlags=gdal.OF_V
+000038b0: 4543 544f 5220 7c20 6764 616c 2e4f 465f  ECTOR | gdal.OF_
+000038c0: 5245 4144 4f4e 4c59 207c 2067 6461 6c2e  READONLY | gdal.
+000038d0: 4f46 5f53 4841 5245 440a 2020 2020 2020  OF_SHARED.      
+000038e0: 2020 290a 2020 2020 2020 2020 6e62 5f6c    ).        nb_l
+000038f0: 6179 6572 7320 3d20 6461 7461 736f 7572  ayers = datasour
+00003900: 6365 2e47 6574 4c61 7965 7243 6f75 6e74  ce.GetLayerCount
+00003910: 2829 0a20 2020 2020 2020 2069 6620 6e62  ().        if nb
+00003920: 5f6c 6179 6572 7320 3d3d 2031 3a0a 2020  _layers == 1:.  
+00003930: 2020 2020 2020 2020 2020 6461 7461 736f            dataso
+00003940: 7572 6365 5f6c 6179 6572 203d 2064 6174  urce_layer = dat
+00003950: 6173 6f75 7263 652e 4765 744c 6179 6572  asource.GetLayer
+00003960: 4279 496e 6465 7828 3029 0a20 2020 2020  ByIndex(0).     
+00003970: 2020 2065 6c69 6620 6e62 5f6c 6179 6572     elif nb_layer
+00003980: 7320 3d3d 2030 3a0a 2020 2020 2020 2020  s == 0:.        
+00003990: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000039a0: 7272 6f72 2866 2245 7272 6f72 3a20 4e6f  rror(f"Error: No
+000039b0: 206c 6179 6572 7320 666f 756e 6420 696e   layers found in
+000039c0: 207b 7061 7468 7d22 290a 2020 2020 2020   {path}").      
+000039d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000039e0: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+000039f0: 6865 7265 2069 7320 6f6e 6c79 206f 6e65  here is only one
+00003a00: 2073 7061 7469 616c 206c 6179 6572 0a20   spatial layer. 
+00003a10: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00003a20: 7320 3d20 6c69 7374 6c61 7965 7273 2870  s = listlayers(p
+00003a30: 6174 682c 206f 6e6c 795f 7370 6174 6961  ath, only_spatia
+00003a40: 6c5f 6c61 7965 7273 3d54 7275 6529 0a20  l_layers=True). 
+00003a50: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00003a60: 6e28 6c61 7965 7273 2920 3d3d 2031 3a0a  n(layers) == 1:.
+00003a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a80: 6461 7461 736f 7572 6365 5f6c 6179 6572  datasource_layer
+00003a90: 203d 2064 6174 6173 6f75 7263 652e 4765   = datasource.Ge
+00003aa0: 744c 6179 6572 286c 6179 6572 735b 305d  tLayer(layers[0]
+00003ab0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00003ac0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00003ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00003ae0: 7272 6f72 2866 224c 6179 6572 2068 6173  rror(f"Layer has
+00003af0: 203e 2031 206c 6179 6572 3a20 7b70 6174   > 1 layer: {pat
+00003b00: 687d 3a20 7b6c 6179 6572 737d 2229 0a0a  h}: {layers}")..
+00003b10: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00003b20: 6174 6173 6f75 7263 655f 6c61 7965 722e  atasource_layer.
+00003b30: 4765 744e 616d 6528 290a 0a20 2020 2065  GetName()..    e
+00003b40: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00003b50: 6173 2065 783a 0a20 2020 2020 2020 2065  as ex:.        e
+00003b60: 782e 6172 6773 203d 2028 6622 6765 745f  x.args = (f"get_
+00003b70: 6f6e 6c79 5f6c 6179 6572 2065 7272 6f72  only_layer error
+00003b80: 2066 6f72 207b 7061 7468 7d3a 5c6e 2020   for {path}:\n  
+00003b90: 7b65 787d 222c 290a 2020 2020 2020 2020  {ex}",).        
+00003ba0: 7261 6973 650a 2020 2020 6669 6e61 6c6c  raise.    finall
+00003bb0: 793a 0a20 2020 2020 2020 2064 6174 6173  y:.        datas
+00003bc0: 6f75 7263 6520 3d20 4e6f 6e65 0a0a 0a64  ource = None...d
+00003bd0: 6566 2067 6574 5f64 6566 6175 6c74 5f6c  ef get_default_l
+00003be0: 6179 6572 2870 6174 683a 2055 6e69 6f6e  ayer(path: Union
+00003bf0: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
+00003c00: 6b65 5b41 6e79 5d22 5d29 202d 3e20 7374  ke[Any]"]) -> st
+00003c10: 723a 0a20 2020 2022 2222 0a20 2020 2047  r:.    """.    G
+00003c20: 6574 2074 6865 2064 6566 6175 6c74 206c  et the default l
+00003c30: 6179 6572 206e 616d 6520 746f 2062 6520  ayer name to be 
+00003c40: 7573 6564 2066 6f72 2061 206c 6179 6572  used for a layer
+00003c50: 2069 6e20 7468 6973 2066 696c 652e 0a0a   in this file...
+00003c60: 2020 2020 5468 6973 2069 7320 7468 6520      This is the 
+00003c70: 7374 656d 206f 6620 7468 6520 6669 6c65  stem of the file
+00003c80: 7061 7468 2e0a 0a20 2020 2041 7267 733a  path...    Args:
+00003c90: 0a20 2020 2020 2020 2070 6174 6820 2855  .        path (U
+00003ca0: 6e69 6f6e 5b73 7472 2c29 3a20 5468 6520  nion[str,): The 
+00003cb0: 7061 7468 2074 6f20 7468 6520 6669 6c65  path to the file
+00003cc0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+00003cd0: 2020 2020 2020 2020 7374 723a 2054 6865          str: The
+00003ce0: 2064 6566 6175 6c74 206c 6179 6572 206e   default layer n
+00003cf0: 616d 652e 0a20 2020 2022 2222 0a20 2020  ame..    """.   
+00003d00: 2072 6574 7572 6e20 5061 7468 2870 6174   return Path(pat
+00003d10: 6829 2e73 7465 6d0a 0a0a 6465 6620 6578  h).stem...def ex
+00003d20: 6563 7574 655f 7371 6c28 0a20 2020 2070  ecute_sql(.    p
+00003d30: 6174 683a 2055 6e69 6f6e 5b73 7472 2c20  ath: Union[str, 
+00003d40: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
+00003d50: 5d22 5d2c 0a20 2020 2073 716c 5f73 746d  ]"],.    sql_stm
+00003d60: 743a 2073 7472 2c0a 2020 2020 7371 6c5f  t: str,.    sql_
+00003d70: 6469 616c 6563 743a 204f 7074 696f 6e61  dialect: Optiona
+00003d80: 6c5b 7374 725d 203d 204e 6f6e 652c 0a29  l[str] = None,.)
+00003d90: 3a0a 2020 2020 2222 220a 2020 2020 4578  :.    """.    Ex
+00003da0: 6563 7574 6520 6120 7371 6c20 7374 6174  ecute a sql stat
+00003db0: 656d 656e 7420 2844 4d4c 206f 7220 4444  ement (DML or DD
+00003dc0: 4c29 206f 6e20 7468 6520 6669 6c65 2e0a  L) on the file..
+00003dd0: 0a20 2020 2054 6f20 7275 6e20 5345 4c45  .    To run SELE
+00003de0: 4354 2073 716c 2073 7461 7465 6d65 6e74  CT sql statement
+00003df0: 7320 6f6e 2061 2066 696c 652c 2075 7365  s on a file, use
+00003e00: 203a 6d65 7468 3a60 7e72 6561 645f 6669   :meth:`~read_fi
+00003e10: 6c65 602e 0a0a 2020 2020 4172 6773 3a0a  le`...    Args:.
+00003e20: 2020 2020 2020 2020 7061 7468 2028 5061          path (Pa
+00003e30: 7468 4c69 6b65 293a 2054 6865 2070 6174  thLike): The pat
+00003e40: 6820 746f 2074 6865 2066 696c 652e 0a20  h to the file.. 
+00003e50: 2020 2020 2020 2073 716c 5f73 746d 7420         sql_stmt 
+00003e60: 2873 7472 293a 2054 6865 2073 716c 2073  (str): The sql s
+00003e70: 7461 7465 6d65 6e74 2074 6f20 6578 6563  tatement to exec
+00003e80: 7574 652e 0a20 2020 2020 2020 2073 716c  ute..        sql
+00003e90: 5f64 6961 6c65 6374 2028 7374 7229 3a20  _dialect (str): 
+00003ea0: 5468 6520 7371 6c20 6469 616c 6563 7420  The sql dialect 
+00003eb0: 746f 2075 7365 3a0a 2020 2020 2020 2020  to use:.        
+00003ec0: 2020 2020 2a20 4e6f 6e65 3a20 7573 6520      * None: use 
+00003ed0: 7468 6520 6e61 7469 7665 2053 514c 2064  the native SQL d
+00003ee0: 6961 6c65 6374 206f 6620 7468 6520 6765  ialect of the ge
+00003ef0: 6f66 696c 652e 0a20 2020 2020 2020 2020  ofile..         
+00003f00: 2020 202a 2027 4f47 5253 514c 273a 2066     * 'OGRSQL': f
+00003f10: 6f72 6365 2074 6865 2075 7365 206f 6620  orce the use of 
+00003f20: 7468 6520 4f47 5220 5351 4c20 6469 616c  the OGR SQL dial
+00003f30: 6563 742e 0a20 2020 2020 2020 2020 2020  ect..           
+00003f40: 202a 2027 5351 4c49 5445 273a 2066 6f72   * 'SQLITE': for
+00003f50: 6365 2074 6865 2075 7365 206f 6620 7468  ce the use of th
+00003f60: 6520 5351 4c49 5445 2064 6961 6c65 6374  e SQLITE dialect
+00003f70: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
+00003f80: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00003f90: 2020 2020 2222 220a 2020 2020 6461 7461      """.    data
+00003fa0: 736f 7572 6365 203d 204e 6f6e 650a 2020  source = None.  
+00003fb0: 2020 7472 793a 0a20 2020 2020 2020 2064    try:.        d
+00003fc0: 6174 6173 6f75 7263 6520 3d20 6764 616c  atasource = gdal
+00003fd0: 2e4f 7065 6e45 7828 7374 7228 7061 7468  .OpenEx(str(path
+00003fe0: 292c 206e 4f70 656e 466c 6167 733d 6764  ), nOpenFlags=gd
+00003ff0: 616c 2e4f 465f 5550 4441 5445 290a 2020  al.OF_UPDATE).  
+00004000: 2020 2020 2020 7265 7375 6c74 203d 2064        result = d
+00004010: 6174 6173 6f75 7263 652e 4578 6563 7574  atasource.Execut
+00004020: 6553 514c 2873 716c 5f73 746d 742c 2064  eSQL(sql_stmt, d
+00004030: 6961 6c65 6374 3d73 716c 5f64 6961 6c65  ialect=sql_diale
+00004040: 6374 290a 2020 2020 2020 2020 6461 7461  ct).        data
+00004050: 736f 7572 6365 2e52 656c 6561 7365 5265  source.ReleaseRe
+00004060: 7375 6c74 5365 7428 7265 7375 6c74 290a  sultSet(result).
+00004070: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+00004080: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00004090: 2020 2020 2065 782e 6172 6773 203d 2028       ex.args = (
+000040a0: 6622 6578 6563 7574 655f 7371 6c20 6572  f"execute_sql er
+000040b0: 726f 7220 666f 7220 7b70 6174 687d 5c6e  ror for {path}\n
+000040c0: 2020 7b65 787d 222c 290a 2020 2020 2020    {ex}",).      
+000040d0: 2020 7261 6973 650a 2020 2020 6669 6e61    raise.    fina
+000040e0: 6c6c 793a 0a20 2020 2020 2020 2064 6174  lly:.        dat
+000040f0: 6173 6f75 7263 6520 3d20 4e6f 6e65 0a0a  asource = None..
+00004100: 0a64 6566 2063 7265 6174 655f 7370 6174  .def create_spat
+00004110: 6961 6c5f 696e 6465 7828 0a20 2020 2070  ial_index(.    p
+00004120: 6174 683a 2055 6e69 6f6e 5b73 7472 2c20  ath: Union[str, 
+00004130: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
+00004140: 5d22 5d2c 0a20 2020 206c 6179 6572 3a20  ]"],.    layer: 
+00004150: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00004160: 4e6f 6e65 2c0a 2020 2020 6361 6368 655f  None,.    cache_
+00004170: 7369 7a65 5f6d 623a 204f 7074 696f 6e61  size_mb: Optiona
+00004180: 6c5b 696e 745d 203d 2031 3238 2c0a 2020  l[int] = 128,.  
+00004190: 2020 6578 6973 745f 6f6b 3a20 626f 6f6c    exist_ok: bool
+000041a0: 203d 2046 616c 7365 2c0a 2020 2020 666f   = False,.    fo
+000041b0: 7263 655f 7265 6275 696c 643a 2062 6f6f  rce_rebuild: boo
+000041c0: 6c20 3d20 4661 6c73 652c 0a29 3a0a 2020  l = False,.):.  
+000041d0: 2020 2222 220a 2020 2020 4372 6561 7465    """.    Create
+000041e0: 2061 2073 7061 7469 616c 2069 6e64 6578   a spatial index
+000041f0: 206f 6e20 7468 6520 6c61 7965 7220 7370   on the layer sp
+00004200: 6563 6966 6965 642e 0a0a 2020 2020 4172  ecified...    Ar
+00004210: 6773 3a0a 2020 2020 2020 2020 7061 7468  gs:.        path
+00004220: 2028 5061 7468 4c69 6b65 293a 2054 6865   (PathLike): The
+00004230: 2066 696c 6520 7061 7468 2e0a 2020 2020   file path..    
+00004240: 2020 2020 6c61 7965 7220 2873 7472 2c20      layer (str, 
+00004250: 6f70 7469 6f6e 616c 293a 2054 6865 206c  optional): The l
+00004260: 6179 6572 2e20 4966 206e 6f74 2073 7065  ayer. If not spe
+00004270: 6369 6669 6564 2c20 616e 6420 7468 6572  cified, and ther
+00004280: 6520 6973 206f 6e6c 790a 2020 2020 2020  e is only.      
+00004290: 2020 2020 2020 6f6e 6520 6c61 7965 7220        one layer 
+000042a0: 696e 2074 6865 2066 696c 652c 2074 6869  in the file, thi
+000042b0: 7320 6c61 7965 7220 6973 2075 7365 642e  s layer is used.
+000042c0: 204f 7468 6572 7769 7365 2065 7863 6570   Otherwise excep
+000042d0: 7469 6f6e 2e0a 2020 2020 2020 2020 6361  tion..        ca
+000042e0: 6368 655f 7369 7a65 5f6d 6220 2869 6e74  che_size_mb (int
+000042f0: 2c20 6f70 7469 6f6e 616c 293a 2063 6163  , optional): cac
+00004300: 6865 206d 656d 6f72 7920 696e 204d 4220  he memory in MB 
+00004310: 7468 6174 2063 616e 2062 6520 7573 6564  that can be used
+00004320: 2077 6869 6c65 0a20 2020 2020 2020 2020   while.         
+00004330: 2020 2063 7265 6174 696e 6720 7370 6174     creating spat
+00004340: 6961 6c20 696e 6465 7820 666f 7220 7370  ial index for sp
+00004350: 6174 6961 6c69 7465 2066 696c 6573 2028  atialite files (
+00004360: 2e67 706b 6720 6f72 202e 7371 6c69 7465  .gpkg or .sqlite
+00004370: 292e 2049 6620 4e6f 6e65 2c0a 2020 2020  ). If None,.    
+00004380: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
+00004390: 756c 7420 6361 6368 655f 7369 7a65 2066  ult cache_size f
+000043a0: 726f 6d20 7371 6c69 7465 2069 7320 7573  rom sqlite is us
+000043b0: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
+000043c0: 3132 382e 0a20 2020 2020 2020 2065 7869  128..        exi
+000043d0: 7374 5f6f 6b20 2862 6f6f 6c2c 206f 7074  st_ok (bool, opt
+000043e0: 696f 6e73 293a 2049 6620 5472 7565 2061  ions): If True a
+000043f0: 6e64 2074 6865 2069 6e64 6578 2065 7869  nd the index exi
+00004400: 7374 7320 616c 7265 6164 792c 2064 6f6e  sts already, don
+00004410: 2774 0a20 2020 2020 2020 2020 2020 2074  't.            t
+00004420: 6872 6f77 2061 6e20 6572 726f 722e 0a20  hrow an error.. 
+00004430: 2020 2020 2020 2066 6f72 6365 5f72 6562         force_reb
+00004440: 7569 6c64 2028 626f 6f6c 2c20 6f70 7469  uild (bool, opti
+00004450: 6f6e 7329 3a20 5472 7565 2074 6f20 666f  ons): True to fo
+00004460: 7263 6520 7265 6275 696c 6420 6576 656e  rce rebuild even
+00004470: 2069 6620 696e 6465 780a 2020 2020 2020   if index.      
+00004480: 2020 2020 2020 6578 6973 7473 2061 6c72        exists alr
+00004490: 6561 6479 2e20 4465 6661 756c 7473 2074  eady. Defaults t
+000044a0: 6f20 4661 6c73 652e 0a20 2020 2022 2222  o False..    """
+000044b0: 0a20 2020 2023 2049 6e69 740a 2020 2020  .    # Init.    
+000044c0: 7061 7468 203d 2050 6174 6828 7061 7468  path = Path(path
+000044d0: 290a 2020 2020 6966 206c 6179 6572 2069  ).    if layer i
+000044e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000044f0: 6c61 7965 7220 3d20 6765 745f 6f6e 6c79  layer = get_only
+00004500: 5f6c 6179 6572 2870 6174 6829 0a0a 2020  _layer(path)..  
+00004510: 2020 2320 4966 2069 6e64 6578 2061 6c72    # If index alr
+00004520: 6561 6479 2065 7869 7374 732c 2072 656d  eady exists, rem
+00004530: 6f76 6520 696e 6465 7820 6f72 2072 6574  ove index or ret
+00004540: 7572 6e0a 2020 2020 6966 2068 6173 5f73  urn.    if has_s
+00004550: 7061 7469 616c 5f69 6e64 6578 2870 6174  patial_index(pat
+00004560: 682c 206c 6179 6572 293a 0a20 2020 2020  h, layer):.     
+00004570: 2020 2069 6620 666f 7263 655f 7265 6275     if force_rebu
+00004580: 696c 643a 0a20 2020 2020 2020 2020 2020  ild:.           
+00004590: 2072 656d 6f76 655f 7370 6174 6961 6c5f   remove_spatial_
+000045a0: 696e 6465 7828 7061 7468 2c20 6c61 7965  index(path, laye
+000045b0: 7229 0a20 2020 2020 2020 2065 6c69 6620  r).        elif 
+000045c0: 6578 6973 745f 6f6b 3a0a 2020 2020 2020  exist_ok:.      
+000045d0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+000045e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000045f0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00004600: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00004610: 2020 2020 2020 2020 6622 4572 726f 7220          f"Error 
+00004620: 6164 6469 6e67 2073 7061 7469 616c 2069  adding spatial i
+00004630: 6e64 6578 2074 6f20 7b70 6174 687d 2e7b  ndex to {path}.{
+00004640: 6c61 7965 727d 2c20 6974 2065 7869 7374  layer}, it exist
+00004650: 7320 616c 7265 6164 7922 0a20 2020 2020  s already".     
+00004660: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
+00004670: 4e6f 7720 7265 616c 6c79 2061 6464 2069  Now really add i
+00004680: 6e64 6578 0a20 2020 2064 6174 6173 6f75  ndex.    datasou
+00004690: 7263 6520 3d20 4e6f 6e65 0a20 2020 2074  rce = None.    t
+000046a0: 7279 3a0a 2020 2020 2020 2020 6765 6f66  ry:.        geof
+000046b0: 696c 6574 7970 6520 3d20 4765 6f66 696c  iletype = Geofil
+000046c0: 6554 7970 6528 7061 7468 290a 2020 2020  eType(path).    
+000046d0: 2020 2020 6966 2067 656f 6669 6c65 7479      if geofilety
+000046e0: 7065 2e69 735f 7370 6174 6961 6c69 7465  pe.is_spatialite
+000046f0: 5f62 6173 6564 3a0a 2020 2020 2020 2020  _based:.        
+00004700: 2020 2020 2320 5468 6520 636f 6e66 6967      # The config
+00004710: 206f 7074 696f 6e73 206e 6565 6420 746f   options need to
+00004720: 2062 6520 7365 7420 6265 666f 7265 206f   be set before o
+00004730: 7065 6e69 6e67 2074 6865 2066 696c 6521  pening the file!
+00004740: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00004750: 6572 696e 666f 203d 2067 6574 5f6c 6179  erinfo = get_lay
+00004760: 6572 696e 666f 2870 6174 682c 206c 6179  erinfo(path, lay
+00004770: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+00004780: 7769 7468 205f 6f67 725f 7574 696c 2e73  with _ogr_util.s
+00004790: 6574 5f63 6f6e 6669 675f 6f70 7469 6f6e  et_config_option
+000047a0: 7328 7b22 4f47 525f 5351 4c49 5445 5f43  s({"OGR_SQLITE_C
+000047b0: 4143 4845 223a 2063 6163 6865 5f73 697a  ACHE": cache_siz
+000047c0: 655f 6d62 7d29 3a0a 2020 2020 2020 2020  e_mb}):.        
+000047d0: 2020 2020 2020 2020 6461 7461 736f 7572          datasour
+000047e0: 6365 203d 2067 6461 6c2e 4f70 656e 4578  ce = gdal.OpenEx
+000047f0: 2873 7472 2870 6174 6829 2c20 6e4f 7065  (str(path), nOpe
+00004800: 6e46 6c61 6773 3d67 6461 6c2e 4f46 5f55  nFlags=gdal.OF_U
+00004810: 5044 4154 4529 0a20 2020 2020 2020 2020  PDATE).         
+00004820: 2020 2020 2020 2067 656f 6d65 7472 7963         geometryc
+00004830: 6f6c 756d 6e20 3d20 6c61 7965 7269 6e66  olumn = layerinf
+00004840: 6f2e 6765 6f6d 6574 7279 636f 6c75 6d6e  o.geometrycolumn
+00004850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004860: 2073 716c 203d 2066 2253 454c 4543 5420   sql = f"SELECT 
+00004870: 4372 6561 7465 5370 6174 6961 6c49 6e64  CreateSpatialInd
+00004880: 6578 2827 7b6c 6179 6572 7d27 2c20 277b  ex('{layer}', '{
+00004890: 6765 6f6d 6574 7279 636f 6c75 6d6e 7d27  geometrycolumn}'
+000048a0: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
+000048b0: 2020 2072 6573 756c 7420 3d20 6461 7461     result = data
+000048c0: 736f 7572 6365 2e45 7865 6375 7465 5351  source.ExecuteSQ
+000048d0: 4c28 7371 6c2c 2064 6961 6c65 6374 3d22  L(sql, dialect="
+000048e0: 5351 4c49 5445 2229 0a20 2020 2020 2020  SQLITE").       
+000048f0: 2020 2020 2020 2020 2064 6174 6173 6f75           datasou
+00004900: 7263 652e 5265 6c65 6173 6552 6573 756c  rce.ReleaseResul
+00004910: 7453 6574 2872 6573 756c 7429 0a20 2020  tSet(result).   
+00004920: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00004930: 2020 2020 2020 2064 6174 6173 6f75 7263         datasourc
+00004940: 6520 3d20 6764 616c 2e4f 7065 6e45 7828  e = gdal.OpenEx(
+00004950: 7374 7228 7061 7468 292c 206e 4f70 656e  str(path), nOpen
+00004960: 466c 6167 733d 6764 616c 2e4f 465f 5550  Flags=gdal.OF_UP
+00004970: 4441 5445 290a 2020 2020 2020 2020 2020  DATE).          
+00004980: 2020 7265 7375 6c74 203d 2064 6174 6173    result = datas
+00004990: 6f75 7263 652e 4578 6563 7574 6553 514c  ource.ExecuteSQL
+000049a0: 2866 2743 5245 4154 4520 5350 4154 4941  (f'CREATE SPATIA
+000049b0: 4c20 494e 4445 5820 4f4e 2022 7b6c 6179  L INDEX ON "{lay
+000049c0: 6572 7d22 2729 0a20 2020 2020 2020 2020  er}"').         
+000049d0: 2020 2064 6174 6173 6f75 7263 652e 5265     datasource.Re
+000049e0: 6c65 6173 6552 6573 756c 7453 6574 2872  leaseResultSet(r
+000049f0: 6573 756c 7429 0a0a 2020 2020 6578 6365  esult)..    exce
+00004a00: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00004a10: 6578 3a0a 2020 2020 2020 2020 6578 2e61  ex:.        ex.a
+00004a20: 7267 7320 3d20 2866 2263 7265 6174 655f  rgs = (f"create_
+00004a30: 7370 6174 6961 6c5f 696e 6465 7820 6572  spatial_index er
+00004a40: 726f 7220 666f 7220 7b70 6174 687d 2e7b  ror for {path}.{
+00004a50: 6c61 7965 727d 3a5c 6e20 207b 6578 7d22  layer}:\n  {ex}"
+00004a60: 2c29 0a20 2020 2020 2020 2072 6169 7365  ,).        raise
+00004a70: 0a20 2020 2066 696e 616c 6c79 3a0a 2020  .    finally:.  
+00004a80: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
+00004a90: 203d 204e 6f6e 650a 0a20 2020 2069 6620   = None..    if 
+00004aa0: 6e6f 7420 6861 735f 7370 6174 6961 6c5f  not has_spatial_
+00004ab0: 696e 6465 7828 7061 7468 2c20 6c61 7965  index(path, laye
+00004ac0: 7229 3a0a 2020 2020 2020 2020 7261 6973  r):.        rais
+00004ad0: 6520 5275 6e74 696d 6545 7272 6f72 2866  e RuntimeError(f
+00004ae0: 2263 7265 6174 655f 7370 6174 6961 6c5f  "create_spatial_
+00004af0: 696e 6465 7820 6661 696c 6564 206f 6e20  index failed on 
+00004b00: 7b70 6174 687d 2c20 6c61 7965 723a 207b  {path}, layer: {
+00004b10: 6c61 7965 727d 2229 0a0a 0a64 6566 2068  layer}")...def h
+00004b20: 6173 5f73 7061 7469 616c 5f69 6e64 6578  as_spatial_index
+00004b30: 280a 2020 2020 7061 7468 3a20 556e 696f  (.    path: Unio
+00004b40: 6e5b 7374 722c 2022 6f73 2e50 6174 684c  n[str, "os.PathL
+00004b50: 696b 655b 416e 795d 225d 2c20 6c61 7965  ike[Any]"], laye
+00004b60: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
+00004b70: 203d 204e 6f6e 650a 2920 2d3e 2062 6f6f   = None.) -> boo
+00004b80: 6c3a 0a20 2020 2022 2222 0a20 2020 2043  l:.    """.    C
+00004b90: 6865 636b 2069 6620 7468 6520 6c61 7965  heck if the laye
+00004ba0: 722f 636f 6c75 6d6e 2068 6173 2061 2073  r/column has a s
+00004bb0: 7061 7469 616c 2069 6e64 6578 2e0a 0a20  patial index... 
+00004bc0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00004bd0: 2070 6174 6820 2850 6174 684c 696b 6529   path (PathLike)
+00004be0: 3a20 5468 6520 6669 6c65 2070 6174 682e  : The file path.
+00004bf0: 0a20 2020 2020 2020 206c 6179 6572 2028  .        layer (
+00004c00: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00004c10: 5468 6520 6c61 7965 722e 2044 6566 6175  The layer. Defau
+00004c20: 6c74 7320 746f 204e 6f6e 652e 0a0a 2020  lts to None...  
+00004c30: 2020 5261 6973 6573 3a0a 2020 2020 2020    Raises:.      
+00004c40: 2020 5661 6c75 6545 7272 6f72 3a20 616e    ValueError: an
+00004c50: 2069 6e76 616c 6964 2070 6172 616d 6574   invalid paramet
+00004c60: 6572 2076 616c 7565 2077 6173 2070 6173  er value was pas
+00004c70: 7365 642e 0a0a 2020 2020 5265 7475 726e  sed...    Return
+00004c80: 733a 0a20 2020 2020 2020 2062 6f6f 6c3a  s:.        bool:
+00004c90: 2054 7275 6520 6966 2074 6865 2073 7061   True if the spa
+00004ca0: 7469 616c 2063 6f6c 756d 6e20 6578 6973  tial column exis
+00004cb0: 7473 2e0a 2020 2020 2222 220a 2020 2020  ts..    """.    
+00004cc0: 2320 496e 6974 0a20 2020 2070 6174 6820  # Init.    path 
+00004cd0: 3d20 5061 7468 2870 6174 6829 0a0a 2020  = Path(path)..  
+00004ce0: 2020 2320 4e6f 7720 6368 6563 6b20 7468    # Now check th
+00004cf0: 6520 696e 6465 780a 2020 2020 6461 7461  e index.    data
+00004d00: 736f 7572 6365 203d 204e 6f6e 650a 2020  source = None.  
+00004d10: 2020 6765 6f66 696c 6574 7970 6520 3d20    geofiletype = 
+00004d20: 4765 6f66 696c 6554 7970 6528 7061 7468  GeofileType(path
+00004d30: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+00004d40: 2020 2069 6620 6765 6f66 696c 6574 7970     if geofiletyp
+00004d50: 652e 6973 5f73 7061 7469 616c 6974 655f  e.is_spatialite_
+00004d60: 6261 7365 643a 0a20 2020 2020 2020 2020  based:.         
+00004d70: 2020 206c 6179 6572 696e 666f 203d 2067     layerinfo = g
+00004d80: 6574 5f6c 6179 6572 696e 666f 2870 6174  et_layerinfo(pat
+00004d90: 682c 206c 6179 6572 290a 2020 2020 2020  h, layer).      
+00004da0: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
+00004db0: 203d 2067 6461 6c2e 4f70 656e 4578 2873   = gdal.OpenEx(s
+00004dc0: 7472 2870 6174 6829 2c20 6e4f 7065 6e46  tr(path), nOpenF
+00004dd0: 6c61 6773 3d67 6461 6c2e 4f46 5f52 4541  lags=gdal.OF_REA
+00004de0: 444f 4e4c 5929 0a20 2020 2020 2020 2020  DONLY).         
+00004df0: 2020 2073 716c 203d 2066 2222 220a 2020     sql = f""".  
+00004e00: 2020 2020 2020 2020 2020 2020 2020 5345                SE
+00004e10: 4c45 4354 2048 6173 5370 6174 6961 6c49  LECT HasSpatialI
+00004e20: 6e64 6578 2827 7b6c 6179 6572 696e 666f  ndex('{layerinfo
+00004e30: 2e6e 616d 657d 272c 0a20 2020 2020 2020  .name}',.       
+00004e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e60: 277b 6c61 7965 7269 6e66 6f2e 6765 6f6d  '{layerinfo.geom
+00004e70: 6574 7279 636f 6c75 6d6e 7d27 290a 2020  etrycolumn}').  
+00004e80: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+00004e90: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00004ea0: 203d 2064 6174 6173 6f75 7263 652e 4578   = datasource.Ex
+00004eb0: 6563 7574 6553 514c 2873 716c 2c20 6469  ecuteSQL(sql, di
+00004ec0: 616c 6563 743d 2253 514c 4954 4522 290a  alect="SQLITE").
+00004ed0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+00004ee0: 7370 6174 6961 6c5f 696e 6465 7820 3d20  spatial_index = 
+00004ef0: 7265 7375 6c74 2e47 6574 4e65 7874 4665  result.GetNextFe
+00004f00: 6174 7572 6528 292e 4765 7446 6965 6c64  ature().GetField
+00004f10: 2830 2920 3d3d 2031 0a20 2020 2020 2020  (0) == 1.       
+00004f20: 2020 2020 2064 6174 6173 6f75 7263 652e       datasource.
+00004f30: 5265 6c65 6173 6552 6573 756c 7453 6574  ReleaseResultSet
+00004f40: 2872 6573 756c 7429 0a20 2020 2020 2020  (result).       
+00004f50: 2020 2020 2072 6574 7572 6e20 6861 735f       return has_
+00004f60: 7370 6174 6961 6c5f 696e 6465 780a 2020  spatial_index.  
+00004f70: 2020 2020 2020 656c 6966 2067 656f 6669        elif geofi
+00004f80: 6c65 7479 7065 203d 3d20 4765 6f66 696c  letype == Geofil
+00004f90: 6554 7970 652e 4553 5249 5368 6170 6566  eType.ESRIShapef
+00004fa0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00004fb0: 2069 6e64 6578 5f70 6174 6820 3d20 7061   index_path = pa
+00004fc0: 7468 2e70 6172 656e 7420 2f20 6622 7b70  th.parent / f"{p
+00004fd0: 6174 682e 7374 656d 7d2e 7169 7822 0a20  ath.stem}.qix". 
+00004fe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004ff0: 6e20 696e 6465 785f 7061 7468 2e65 7869  n index_path.exi
+00005000: 7374 7328 290a 2020 2020 2020 2020 656c  sts().        el
+00005010: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005020: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00005030: 2866 2268 6173 5f73 7061 7469 616c 5f69  (f"has_spatial_i
+00005040: 6e64 6578 206e 6f74 2073 7570 706f 7274  ndex not support
+00005050: 6564 2066 6f72 207b 7061 7468 7d22 290a  ed for {path}").
+00005060: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+00005070: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00005080: 2020 2020 2065 782e 6172 6773 203d 2028       ex.args = (
+00005090: 6622 6861 735f 7370 6174 6961 6c5f 696e  f"has_spatial_in
+000050a0: 6465 7820 6572 726f 7220 666f 7220 7b70  dex error for {p
+000050b0: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
+000050c0: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
+000050d0: 2072 6169 7365 0a20 2020 2066 696e 616c   raise.    final
+000050e0: 6c79 3a0a 2020 2020 2020 2020 6461 7461  ly:.        data
+000050f0: 736f 7572 6365 203d 204e 6f6e 650a 0a0a  source = None...
+00005100: 6465 6620 7265 6d6f 7665 5f73 7061 7469  def remove_spati
+00005110: 616c 5f69 6e64 6578 280a 2020 2020 7061  al_index(.    pa
+00005120: 7468 3a20 556e 696f 6e5b 7374 722c 2022  th: Union[str, "
+00005130: 6f73 2e50 6174 684c 696b 655b 416e 795d  os.PathLike[Any]
+00005140: 225d 2c20 6c61 7965 723a 204f 7074 696f  "], layer: Optio
+00005150: 6e61 6c5b 7374 725d 203d 204e 6f6e 650a  nal[str] = None.
+00005160: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+00005170: 656d 6f76 6520 7468 6520 7370 6174 6961  emove the spatia
+00005180: 6c20 696e 6465 7820 6672 6f6d 2074 6865  l index from the
+00005190: 206c 6179 6572 2073 7065 6369 6669 6564   layer specified
+000051a0: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
+000051b0: 2020 2020 2070 6174 6820 2850 6174 684c       path (PathL
+000051c0: 696b 6529 3a20 5468 6520 6669 6c65 2070  ike): The file p
+000051d0: 6174 682e 0a20 2020 2020 2020 206c 6179  ath..        lay
+000051e0: 6572 2028 7374 722c 206f 7074 696f 6e61  er (str, optiona
+000051f0: 6c29 3a20 5468 6520 6c61 7965 722e 2049  l): The layer. I
+00005200: 6620 6e6f 7420 7370 6563 6966 6965 642c  f not specified,
+00005210: 2061 6e64 2074 6865 7265 2069 7320 6f6e   and there is on
+00005220: 6c79 0a20 2020 2020 2020 2020 2020 206f  ly.            o
+00005230: 6e65 206c 6179 6572 2069 6e20 7468 6520  ne layer in the 
+00005240: 6669 6c65 2c20 7468 6973 206c 6179 6572  file, this layer
+00005250: 2069 7320 7573 6564 2e20 4f74 6865 7277   is used. Otherw
+00005260: 6973 6520 6578 6365 7074 696f 6e2e 0a20  ise exception.. 
+00005270: 2020 2022 2222 0a20 2020 2023 2049 6e69     """.    # Ini
+00005280: 740a 2020 2020 7061 7468 203d 2050 6174  t.    path = Pat
+00005290: 6828 7061 7468 290a 0a20 2020 2023 204e  h(path)..    # N
+000052a0: 6f77 2072 6561 6c6c 7920 7265 6d6f 7665  ow really remove
+000052b0: 2069 6e64 6578 0a20 2020 2064 6174 6173   index.    datas
+000052c0: 6f75 7263 6520 3d20 4e6f 6e65 0a20 2020  ource = None.   
+000052d0: 2067 656f 6669 6c65 7479 7065 203d 2047   geofiletype = G
+000052e0: 656f 6669 6c65 5479 7065 2870 6174 6829  eofileType(path)
+000052f0: 0a20 2020 206c 6179 6572 696e 666f 203d  .    layerinfo =
+00005300: 2067 6574 5f6c 6179 6572 696e 666f 2870   get_layerinfo(p
+00005310: 6174 682c 206c 6179 6572 290a 2020 2020  ath, layer).    
+00005320: 7472 793a 0a20 2020 2020 2020 2069 6620  try:.        if 
+00005330: 6765 6f66 696c 6574 7970 652e 6973 5f73  geofiletype.is_s
+00005340: 7061 7469 616c 6974 655f 6261 7365 643a  patialite_based:
+00005350: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00005360: 6173 6f75 7263 6520 3d20 6764 616c 2e4f  asource = gdal.O
+00005370: 7065 6e45 7828 7374 7228 7061 7468 292c  penEx(str(path),
+00005380: 206e 4f70 656e 466c 6167 733d 6764 616c   nOpenFlags=gdal
+00005390: 2e4f 465f 5550 4441 5445 290a 2020 2020  .OF_UPDATE).    
+000053a0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000053b0: 2064 6174 6173 6f75 7263 652e 4578 6563   datasource.Exec
+000053c0: 7574 6553 514c 280a 2020 2020 2020 2020  uteSQL(.        
+000053d0: 2020 2020 2020 2020 6622 5345 4c45 4354          f"SELECT
+000053e0: 2044 6973 6162 6c65 5370 6174 6961 6c49   DisableSpatialI
+000053f0: 6e64 6578 2827 7b6c 6179 6572 696e 666f  ndex('{layerinfo
+00005400: 2e6e 616d 657d 272c 2027 7b6c 6179 6572  .name}', '{layer
+00005410: 696e 666f 2e67 656f 6d65 7472 7963 6f6c  info.geometrycol
+00005420: 756d 6e7d 2729 222c 2020 2320 6e6f 7161  umn}')",  # noqa
+00005430: 3a20 4535 3031 0a20 2020 2020 2020 2020  : E501.         
+00005440: 2020 2020 2020 2064 6961 6c65 6374 3d22         dialect="
+00005450: 5351 4c49 5445 222c 0a20 2020 2020 2020  SQLITE",.       
+00005460: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005470: 2020 2064 6174 6173 6f75 7263 652e 5265     datasource.Re
+00005480: 6c65 6173 6552 6573 756c 7453 6574 2872  leaseResultSet(r
+00005490: 6573 756c 7429 0a20 2020 2020 2020 2065  esult).        e
+000054a0: 6c69 6620 6765 6f66 696c 6574 7970 6520  lif geofiletype 
+000054b0: 3d3d 2047 656f 6669 6c65 5479 7065 2e45  == GeofileType.E
+000054c0: 5352 4953 6861 7065 6669 6c65 3a0a 2020  SRIShapefile:.  
+000054d0: 2020 2020 2020 2020 2020 2320 4452 4f50            # DROP
+000054e0: 2053 5041 5449 414c 2049 4e44 4558 204f   SPATIAL INDEX O
+000054f0: 4e20 2e2e 2e20 636f 6d6d 616e 6420 6769  N ... command gi
+00005500: 7665 7320 616e 2065 7272 6f72 2c20 736f  ves an error, so
+00005510: 206a 7573 7420 7265 6d6f 7665 202e 7169   just remove .qi
+00005520: 780a 2020 2020 2020 2020 2020 2020 696e  x.            in
+00005530: 6465 785f 7061 7468 203d 2070 6174 682e  dex_path = path.
+00005540: 7061 7265 6e74 202f 2066 227b 7061 7468  parent / f"{path
+00005550: 2e73 7465 6d7d 2e71 6978 220a 2020 2020  .stem}.qix".    
+00005560: 2020 2020 2020 2020 696e 6465 785f 7061          index_pa
+00005570: 7468 2e75 6e6c 696e 6b28 290a 2020 2020  th.unlink().    
+00005580: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005590: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+000055a0: 696d 6545 7272 6f72 280a 2020 2020 2020  imeError(.      
+000055b0: 2020 2020 2020 2020 2020 6622 7265 6d6f            f"remo
+000055c0: 7665 5f73 7061 7469 616c 5f69 6e64 6578  ve_spatial_index
+000055d0: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
+000055e0: 6420 666f 7220 7b70 6174 682e 7375 6666  d for {path.suff
+000055f0: 6978 7d20 6669 6c65 220a 2020 2020 2020  ix} file".      
+00005600: 2020 2020 2020 290a 0a20 2020 2065 7863        )..    exc
+00005610: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00005620: 2065 783a 0a20 2020 2020 2020 2065 782e   ex:.        ex.
+00005630: 6172 6773 203d 2028 6622 7265 6d6f 7665  args = (f"remove
+00005640: 5f73 7061 7469 616c 5f69 6e64 6578 2065  _spatial_index e
+00005650: 7272 6f72 2066 6f72 207b 7061 7468 7d2e  rror for {path}.
+00005660: 7b6c 6179 6572 7d3a 5c6e 2020 7b65 787d  {layer}:\n  {ex}
+00005670: 222c 290a 2020 2020 2020 2020 7261 6973  ",).        rais
+00005680: 650a 2020 2020 6669 6e61 6c6c 793a 0a20  e.    finally:. 
+00005690: 2020 2020 2020 2064 6174 6173 6f75 7263         datasourc
+000056a0: 6520 3d20 4e6f 6e65 0a0a 0a64 6566 2072  e = None...def r
+000056b0: 656e 616d 655f 6c61 7965 7228 0a20 2020  ename_layer(.   
+000056c0: 2070 6174 683a 2055 6e69 6f6e 5b73 7472   path: Union[str
+000056d0: 2c20 226f 732e 5061 7468 4c69 6b65 5b41  , "os.PathLike[A
+000056e0: 6e79 5d22 5d2c 206e 6577 5f6c 6179 6572  ny]"], new_layer
+000056f0: 3a20 7374 722c 206c 6179 6572 3a20 4f70  : str, layer: Op
+00005700: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00005710: 6e65 0a29 3a0a 2020 2020 2222 220a 2020  ne.):.    """.  
+00005720: 2020 5265 6e61 6d65 2074 6865 206c 6179    Rename the lay
+00005730: 6572 2073 7065 6369 6669 6564 2e0a 0a20  er specified... 
+00005740: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00005750: 2070 6174 6820 2850 6174 684c 696b 6529   path (PathLike)
+00005760: 3a20 5468 6520 6669 6c65 2070 6174 682e  : The file path.
+00005770: 0a20 2020 2020 2020 206c 6179 6572 2028  .        layer (
+00005780: 4f70 7469 6f6e 616c 5b73 7472 5d29 3a20  Optional[str]): 
+00005790: 5468 6520 6c61 7965 7220 6e61 6d65 2e20  The layer name. 
+000057a0: 4966 206e 6f74 2073 7065 6369 6669 6564  If not specified
+000057b0: 2c20 616e 6420 7468 6572 6520 6973 206f  , and there is o
+000057c0: 6e6c 790a 2020 2020 2020 2020 2020 2020  nly.            
+000057d0: 6f6e 6520 6c61 7965 7220 696e 2074 6865  one layer in the
+000057e0: 2066 696c 652c 2074 6869 7320 6c61 7965   file, this laye
+000057f0: 7220 6973 2075 7365 642e 204f 7468 6572  r is used. Other
+00005800: 7769 7365 2065 7863 6570 7469 6f6e 2e0a  wise exception..
+00005810: 2020 2020 2020 2020 6e65 775f 6c61 7965          new_laye
+00005820: 7220 2873 7472 293a 2054 6865 206e 6577  r (str): The new
+00005830: 206c 6179 6572 206e 616d 652e 2049 6620   layer name. If 
+00005840: 6e6f 7420 7370 6563 6966 6965 642c 2061  not specified, a
+00005850: 6e64 2074 6865 7265 2069 7320 6f6e 6c79  nd there is only
+00005860: 0a20 2020 2020 2020 2020 2020 206f 6e65  .            one
+00005870: 206c 6179 6572 2069 6e20 7468 6520 6669   layer in the fi
+00005880: 6c65 2c20 7468 6973 206c 6179 6572 2069  le, this layer i
+00005890: 7320 7573 6564 2e20 4f74 6865 7277 6973  s used. Otherwis
+000058a0: 6520 6578 6365 7074 696f 6e2e 0a20 2020  e exception..   
+000058b0: 2022 2222 0a20 2020 2023 2043 6865 636b   """.    # Check
+000058c0: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
+000058d0: 730a 2020 2020 7061 7468 203d 2050 6174  s.    path = Pat
+000058e0: 6828 7061 7468 290a 2020 2020 6966 206c  h(path).    if l
+000058f0: 6179 6572 2069 7320 4e6f 6e65 3a0a 2020  ayer is None:.  
+00005900: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
+00005910: 745f 6f6e 6c79 5f6c 6179 6572 2870 6174  t_only_layer(pat
+00005920: 6829 0a0a 2020 2020 2320 4e6f 7720 7265  h)..    # Now re
+00005930: 616c 6c79 2072 656e 616d 650a 2020 2020  ally rename.    
+00005940: 6461 7461 736f 7572 6365 203d 204e 6f6e  datasource = Non
+00005950: 650a 2020 2020 6765 6f66 696c 6574 7970  e.    geofiletyp
+00005960: 6520 3d20 4765 6f66 696c 6554 7970 6528  e = GeofileType(
+00005970: 7061 7468 290a 2020 2020 6966 2067 656f  path).    if geo
+00005980: 6669 6c65 7479 7065 2e69 735f 7370 6174  filetype.is_spat
+00005990: 6961 6c69 7465 5f62 6173 6564 3a0a 2020  ialite_based:.  
+000059a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000059b0: 2020 2020 2020 2064 6174 6173 6f75 7263         datasourc
+000059c0: 6520 3d20 6764 616c 2e4f 7065 6e45 7828  e = gdal.OpenEx(
+000059d0: 7374 7228 7061 7468 292c 206e 4f70 656e  str(path), nOpen
+000059e0: 466c 6167 733d 6764 616c 2e4f 465f 5550  Flags=gdal.OF_UP
+000059f0: 4441 5445 290a 2020 2020 2020 2020 2020  DATE).          
+00005a00: 2020 7371 6c5f 7374 6d74 203d 2066 2741    sql_stmt = f'A
+00005a10: 4c54 4552 2054 4142 4c45 2022 7b6c 6179  LTER TABLE "{lay
+00005a20: 6572 7d22 2052 454e 414d 4520 544f 2022  er}" RENAME TO "
+00005a30: 7b6e 6577 5f6c 6179 6572 7d22 270a 2020  {new_layer}"'.  
+00005a40: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00005a50: 203d 2064 6174 6173 6f75 7263 652e 4578   = datasource.Ex
+00005a60: 6563 7574 6553 514c 2873 716c 5f73 746d  ecuteSQL(sql_stm
+00005a70: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
+00005a80: 6174 6173 6f75 7263 652e 5265 6c65 6173  atasource.Releas
+00005a90: 6552 6573 756c 7453 6574 2872 6573 756c  eResultSet(resul
+00005aa0: 7429 0a20 2020 2020 2020 2065 7863 6570  t).        excep
+00005ab0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00005ac0: 783a 0a20 2020 2020 2020 2020 2020 2065  x:.            e
+00005ad0: 782e 6172 6773 203d 2028 6622 7265 6e61  x.args = (f"rena
+00005ae0: 6d65 5f6c 6179 6572 2065 7272 6f72 2066  me_layer error f
+00005af0: 6f72 207b 7061 7468 7d2e 7b6c 6179 6572  or {path}.{layer
+00005b00: 7d3a 5c6e 2020 7b65 787d 222c 290a 2020  }:\n  {ex}",).  
+00005b10: 2020 2020 2020 2020 2020 7261 6973 650a            raise.
+00005b20: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+00005b30: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00005b40: 6173 6f75 7263 6520 3d20 4e6f 6e65 0a20  asource = None. 
+00005b50: 2020 2065 6c69 6620 6765 6f66 696c 6574     elif geofilet
+00005b60: 7970 6520 3d3d 2047 656f 6669 6c65 5479  ype == GeofileTy
+00005b70: 7065 2e45 5352 4953 6861 7065 6669 6c65  pe.ESRIShapefile
+00005b80: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00005b90: 5661 6c75 6545 7272 6f72 2866 2272 656e  ValueError(f"ren
+00005ba0: 616d 655f 6c61 7965 7220 6e6f 7420 706f  ame_layer not po
+00005bb0: 7373 6962 6c65 2066 6f72 207b 6765 6f66  ssible for {geof
+00005bc0: 696c 6574 7970 657d 2066 696c 6522 290a  iletype} file").
+00005bd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005be0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00005bf0: 6f72 2866 2272 656e 616d 655f 6c61 7965  or(f"rename_laye
+00005c00: 7220 6e6f 7420 696d 706c 656d 656e 7465  r not implemente
+00005c10: 6420 666f 7220 7b70 6174 682e 7375 6666  d for {path.suff
+00005c20: 6978 7d20 6669 6c65 2229 0a0a 0a64 6566  ix} file")...def
+00005c30: 2072 656e 616d 655f 636f 6c75 6d6e 280a   rename_column(.
+00005c40: 2020 2020 7061 7468 3a20 556e 696f 6e5b      path: Union[
+00005c50: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
+00005c60: 655b 416e 795d 225d 2c0a 2020 2020 636f  e[Any]"],.    co
+00005c70: 6c75 6d6e 5f6e 616d 653a 2073 7472 2c0a  lumn_name: str,.
+00005c80: 2020 2020 6e65 775f 636f 6c75 6d6e 5f6e      new_column_n
+00005c90: 616d 653a 2073 7472 2c0a 2020 2020 6c61  ame: str,.    la
+00005ca0: 7965 723a 204f 7074 696f 6e61 6c5b 7374  yer: Optional[st
+00005cb0: 725d 203d 204e 6f6e 652c 0a29 3a0a 2020  r] = None,.):.  
+00005cc0: 2020 2222 220a 2020 2020 5265 6e61 6d65    """.    Rename
+00005cd0: 2074 6865 2063 6f6c 756d 6e20 7370 6563   the column spec
+00005ce0: 6966 6965 642e 0a0a 2020 2020 4172 6773  ified...    Args
+00005cf0: 3a0a 2020 2020 2020 2020 7061 7468 2028  :.        path (
+00005d00: 5061 7468 4c69 6b65 293a 2054 6865 2066  PathLike): The f
+00005d10: 696c 6520 7061 7468 2e0a 2020 2020 2020  ile path..      
+00005d20: 2020 636f 6c75 6d6e 5f6e 616d 6520 2873    column_name (s
+00005d30: 7472 293a 2074 6865 2063 7572 7265 6e74  tr): the current
+00005d40: 2063 6f6c 756d 6e20 6e61 6d65 2e0a 2020   column name..  
+00005d50: 2020 2020 2020 6e65 775f 636f 6c75 6d6e        new_column
+00005d60: 5f6e 616d 6520 2873 7472 293a 2074 6865  _name (str): the
+00005d70: 206e 6577 2063 6f6c 756d 6e20 6e61 6d65   new column name
+00005d80: 2e0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
+00005d90: 284f 7074 696f 6e61 6c5b 7374 725d 293a  (Optional[str]):
+00005da0: 2054 6865 206c 6179 6572 206e 616d 652e   The layer name.
+00005db0: 2049 6620 6e6f 7420 7370 6563 6966 6965   If not specifie
+00005dc0: 642c 2061 6e64 2074 6865 7265 2069 7320  d, and there is 
+00005dd0: 6f6e 6c79 0a20 2020 2020 2020 2020 2020  only.           
+00005de0: 206f 6e65 206c 6179 6572 2069 6e20 7468   one layer in th
+00005df0: 6520 6669 6c65 2c20 7468 6973 206c 6179  e file, this lay
+00005e00: 6572 2069 7320 7573 6564 2e20 4f74 6865  er is used. Othe
+00005e10: 7277 6973 6520 6578 6365 7074 696f 6e2e  rwise exception.
+00005e20: 0a20 2020 2022 2222 0a20 2020 2023 2043  .    """.    # C
+00005e30: 6865 636b 2069 6e70 7574 2070 6172 616d  heck input param
+00005e40: 6574 6572 730a 2020 2020 7061 7468 203d  eters.    path =
+00005e50: 2050 6174 6828 7061 7468 290a 2020 2020   Path(path).    
+00005e60: 6966 206c 6179 6572 2069 7320 4e6f 6e65  if layer is None
+00005e70: 3a0a 2020 2020 2020 2020 6c61 7965 7220  :.        layer 
+00005e80: 3d20 6765 745f 6f6e 6c79 5f6c 6179 6572  = get_only_layer
+00005e90: 2870 6174 6829 0a20 2020 2069 6e66 6f20  (path).    info 
+00005ea0: 3d20 6765 745f 6c61 7965 7269 6e66 6f28  = get_layerinfo(
+00005eb0: 7061 7468 2c20 6c61 7965 7229 0a20 2020  path, layer).   
+00005ec0: 2069 6620 636f 6c75 6d6e 5f6e 616d 6520   if column_name 
+00005ed0: 6e6f 7420 696e 2069 6e66 6f2e 636f 6c75  not in info.colu
+00005ee0: 6d6e 7320 616e 6420 6e65 775f 636f 6c75  mns and new_colu
+00005ef0: 6d6e 5f6e 616d 6520 696e 2069 6e66 6f2e  mn_name in info.
+00005f00: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
+00005f10: 206c 6f67 6765 722e 696e 666f 280a 2020   logger.info(.  
+00005f20: 2020 2020 2020 2020 2020 6622 436f 6c75            f"Colu
+00005f30: 6d6e 207b 636f 6c75 6d6e 5f6e 616d 657d  mn {column_name}
+00005f40: 2073 6565 6d73 2074 6f20 6265 2072 656e   seems to be ren
+00005f50: 616d 6564 2061 6c72 6561 6479 2074 6f20  amed already to 
+00005f60: 7b6e 6577 5f63 6f6c 756d 6e5f 6e61 6d65  {new_column_name
+00005f70: 7d22 0a20 2020 2020 2020 2029 0a20 2020  }".        ).   
+00005f80: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00005f90: 2023 204e 6f77 2072 6561 6c6c 7920 7265   # Now really re
+00005fa0: 6e61 6d65 0a20 2020 2064 6174 6173 6f75  name.    datasou
+00005fb0: 7263 6520 3d20 4e6f 6e65 0a20 2020 2067  rce = None.    g
+00005fc0: 656f 6669 6c65 7479 7065 203d 2047 656f  eofiletype = Geo
+00005fd0: 6669 6c65 5479 7065 2870 6174 6829 0a20  fileType(path). 
+00005fe0: 2020 2069 6620 6765 6f66 696c 6574 7970     if geofiletyp
+00005ff0: 652e 6973 5f73 7061 7469 616c 6974 655f  e.is_spatialite_
+00006000: 6261 7365 643a 0a20 2020 2020 2020 2074  based:.        t
+00006010: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00006020: 6461 7461 736f 7572 6365 203d 2067 6461  datasource = gda
+00006030: 6c2e 4f70 656e 4578 2873 7472 2870 6174  l.OpenEx(str(pat
+00006040: 6829 2c20 6e4f 7065 6e46 6c61 6773 3d67  h), nOpenFlags=g
+00006050: 6461 6c2e 4f46 5f55 5044 4154 4529 0a20  dal.OF_UPDATE). 
+00006060: 2020 2020 2020 2020 2020 2073 716c 5f73             sql_s
+00006070: 746d 7420 3d20 280a 2020 2020 2020 2020  tmt = (.        
+00006080: 2020 2020 2020 2020 6627 414c 5445 5220          f'ALTER 
+00006090: 5441 424c 4520 227b 6c61 7965 727d 2220  TABLE "{layer}" 
+000060a0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000060b0: 2020 6627 5245 4e41 4d45 2043 4f4c 554d    f'RENAME COLUM
+000060c0: 4e20 227b 636f 6c75 6d6e 5f6e 616d 657d  N "{column_name}
+000060d0: 2220 544f 2022 7b6e 6577 5f63 6f6c 756d  " TO "{new_colum
+000060e0: 6e5f 6e61 6d65 7d22 270a 2020 2020 2020  n_name}"'.      
+000060f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006100: 2020 2020 7265 7375 6c74 203d 2064 6174      result = dat
+00006110: 6173 6f75 7263 652e 4578 6563 7574 6553  asource.ExecuteS
+00006120: 514c 2873 716c 5f73 746d 7429 0a20 2020  QL(sql_stmt).   
+00006130: 2020 2020 2020 2020 2064 6174 6173 6f75           datasou
+00006140: 7263 652e 5265 6c65 6173 6552 6573 756c  rce.ReleaseResul
+00006150: 7453 6574 2872 6573 756c 7429 0a20 2020  tSet(result).   
+00006160: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00006170: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00006180: 2020 2020 2020 2020 2065 782e 6172 6773           ex.args
+00006190: 203d 2028 6622 7265 6e61 6d65 5f63 6f6c   = (f"rename_col
+000061a0: 756d 6e20 6572 726f 7220 666f 7220 7b70  umn error for {p
+000061b0: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
+000061c0: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
+000061d0: 2020 2020 2072 6169 7365 0a20 2020 2020       raise.     
+000061e0: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+000061f0: 2020 2020 2020 2020 6461 7461 736f 7572          datasour
+00006200: 6365 203d 204e 6f6e 650a 0a20 2020 2065  ce = None..    e
+00006210: 6c69 6620 6765 6f66 696c 6574 7970 6520  lif geofiletype 
+00006220: 3d3d 2047 656f 6669 6c65 5479 7065 2e45  == GeofileType.E
+00006230: 5352 4953 6861 7065 6669 6c65 3a0a 2020  SRIShapefile:.  
+00006240: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00006250: 6545 7272 6f72 2866 2272 656e 616d 655f  eError(f"rename_
+00006260: 636f 6c75 6d6e 2069 7320 6e6f 7420 706f  column is not po
+00006270: 7373 6962 6c65 2066 6f72 207b 6765 6f66  ssible for {geof
+00006280: 696c 6574 7970 657d 2066 696c 6522 290a  iletype} file").
+00006290: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000062a0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000062b0: 6f72 2866 2272 656e 616d 655f 636f 6c75  or(f"rename_colu
+000062c0: 6d6e 2069 7320 6e6f 7420 696d 706c 656d  mn is not implem
+000062d0: 656e 7465 6420 666f 7220 7b70 6174 682e  ented for {path.
+000062e0: 7375 6666 6978 7d20 6669 6c65 2229 0a0a  suffix} file")..
+000062f0: 0a63 6c61 7373 2044 6174 6154 7970 6528  .class DataType(
+00006300: 656e 756d 2e45 6e75 6d29 3a0a 2020 2020  enum.Enum):.    
+00006310: 2222 220a 2020 2020 5468 6973 2065 6e75  """.    This enu
+00006320: 6d20 6465 6669 6e65 7320 7468 6520 7374  m defines the st
+00006330: 616e 6461 7264 2064 6174 6120 7479 7065  andard data type
+00006340: 7320 7468 6174 2063 616e 2062 6520 7573  s that can be us
+00006350: 6564 2066 6f72 2063 6f6c 756d 6e73 2e0a  ed for columns..
+00006360: 2020 2020 2222 220a 0a20 2020 2054 4558      """..    TEX
+00006370: 5420 3d20 2254 4558 5422 0a20 2020 2022  T = "TEXT".    "
+00006380: 2222 436f 6c75 6d6e 2077 6974 6820 7465  ""Column with te
+00006390: 7874 2064 6174 613a 207e 2073 7472 696e  xt data: ~ strin
+000063a0: 672c 2063 6861 722c 2076 6172 6368 6172  g, char, varchar
+000063b0: 2c20 636c 6f62 2e22 2222 0a20 2020 2049  , clob.""".    I
+000063c0: 4e54 4547 4552 203d 2022 494e 5445 4745  NTEGER = "INTEGE
+000063d0: 5222 0a20 2020 2022 2222 436f 6c75 6d6e  R".    """Column
+000063e0: 2077 6974 6820 696e 7465 6765 7220 6461   with integer da
+000063f0: 7461 2e22 2222 0a20 2020 2052 4541 4c20  ta.""".    REAL 
+00006400: 3d20 2252 4541 4c22 0a20 2020 2022 2222  = "REAL".    """
+00006410: 436f 6c75 6d6e 2077 6974 6820 666c 6f61  Column with floa
+00006420: 7469 6e67 2070 6f69 6e74 2064 6174 613a  ting point data:
+00006430: 207e 2066 6c6f 6174 2c20 646f 7562 6c65   ~ float, double
+00006440: 2e22 2222 0a20 2020 2044 4154 4520 3d20  .""".    DATE = 
+00006450: 2244 4154 4522 0a20 2020 2022 2222 436f  "DATE".    """Co
+00006460: 6c75 6d6e 2077 6974 6820 6461 7465 2064  lumn with date d
+00006470: 6174 612e 2222 220a 2020 2020 5449 4d45  ata.""".    TIME
+00006480: 5354 414d 5020 3d20 2254 494d 4553 5441  STAMP = "TIMESTA
+00006490: 4d50 220a 2020 2020 2222 2243 6f6c 756d  MP".    """Colum
+000064a0: 6e20 7769 7468 2074 696d 6573 7461 6d70  n with timestamp
+000064b0: 2064 6174 613a 207e 2064 6174 6574 696d   data: ~ datetim
+000064c0: 652e 2222 220a 2020 2020 424f 4f4c 4541  e.""".    BOOLEA
+000064d0: 4e20 3d20 2242 4f4f 4c45 414e 220a 2020  N = "BOOLEAN".  
+000064e0: 2020 2222 2243 6f6c 756d 6e20 7769 7468    """Column with
+000064f0: 2062 6f6f 6c65 616e 2064 6174 612e 2222   boolean data.""
+00006500: 220a 2020 2020 424c 4f42 203d 2022 424c  ".    BLOB = "BL
+00006510: 4f42 220a 2020 2020 2222 2243 6f6c 756d  OB".    """Colum
+00006520: 6e20 7769 7468 2062 696e 6172 7920 6461  n with binary da
+00006530: 7461 2e22 2222 0a20 2020 204e 554d 4552  ta.""".    NUMER
+00006540: 4943 203d 2022 4e55 4d45 5249 4322 0a20  IC = "NUMERIC". 
+00006550: 2020 2022 2222 436f 6c75 6d6e 2077 6974     """Column wit
+00006560: 6820 6e75 6d65 7269 6320 6461 7461 3a20  h numeric data: 
+00006570: 6578 6163 7420 6465 6369 6d61 6c20 6461  exact decimal da
+00006580: 7461 2e22 2222 0a0a 0a64 6566 2061 6464  ta."""...def add
+00006590: 5f63 6f6c 756d 6e28 0a20 2020 2070 6174  _column(.    pat
+000065a0: 683a 2055 6e69 6f6e 5b73 7472 2c20 226f  h: Union[str, "o
+000065b0: 732e 5061 7468 4c69 6b65 5b41 6e79 5d22  s.PathLike[Any]"
+000065c0: 5d2c 0a20 2020 206e 616d 653a 2073 7472  ],.    name: str
+000065d0: 2c0a 2020 2020 7479 7065 3a20 556e 696f  ,.    type: Unio
+000065e0: 6e5b 4461 7461 5479 7065 2c20 7374 725d  n[DataType, str]
+000065f0: 2c0a 2020 2020 6578 7072 6573 7369 6f6e  ,.    expression
+00006600: 3a20 556e 696f 6e5b 7374 722c 2069 6e74  : Union[str, int
+00006610: 2c20 666c 6f61 742c 204e 6f6e 655d 203d  , float, None] =
+00006620: 204e 6f6e 652c 0a20 2020 2065 7870 7265   None,.    expre
+00006630: 7373 696f 6e5f 6469 616c 6563 743a 204f  ssion_dialect: O
+00006640: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00006650: 6f6e 652c 0a20 2020 206c 6179 6572 3a20  one,.    layer: 
+00006660: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00006670: 4e6f 6e65 2c0a 2020 2020 666f 7263 655f  None,.    force_
+00006680: 7570 6461 7465 3a20 626f 6f6c 203d 2046  update: bool = F
+00006690: 616c 7365 2c0a 2020 2020 7769 6474 683a  alse,.    width:
+000066a0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+000066b0: 204e 6f6e 652c 0a29 3a0a 2020 2020 2222   None,.):.    ""
+000066c0: 220a 2020 2020 4164 6420 6120 636f 6c75  ".    Add a colu
+000066d0: 6d6e 2074 6f20 6120 6c61 7965 7220 6f66  mn to a layer of
+000066e0: 2074 6865 2067 656f 6669 6c65 2e0a 0a20   the geofile... 
+000066f0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00006700: 2070 6174 6820 2850 6174 684c 696b 6529   path (PathLike)
+00006710: 3a20 5061 7468 2074 6f20 7468 6520 6765  : Path to the ge
+00006720: 6f66 696c 652e 0a20 2020 2020 2020 206e  ofile..        n
+00006730: 616d 6520 2873 7472 293a 204e 616d 6520  ame (str): Name 
+00006740: 666f 7220 7468 6520 6e65 7720 636f 6c75  for the new colu
+00006750: 6d6e 2e0a 2020 2020 2020 2020 7479 7065  mn..        type
+00006760: 2028 7374 7229 3a20 436f 6c75 6d6e 2074   (str): Column t
+00006770: 7970 6520 6f66 2074 6865 206e 6577 2063  ype of the new c
+00006780: 6f6c 756d 6e2e 0a20 2020 2020 2020 2065  olumn..        e
+00006790: 7870 7265 7373 696f 6e20 2873 7472 2c20  xpression (str, 
+000067a0: 6f70 7469 6f6e 616c 293a 2053 514c 6974  optional): SQLit
+000067b0: 6520 6578 7072 6573 7369 6f6e 2074 6f20  e expression to 
+000067c0: 7573 6520 746f 2075 7064 6174 650a 2020  use to update.  
+000067d0: 2020 2020 2020 2020 2020 7468 6520 7661            the va
+000067e0: 6c75 652e 2044 6566 6175 6c74 7320 746f  lue. Defaults to
+000067f0: 204e 6f6e 652e 0a20 2020 2020 2020 2065   None..        e
+00006800: 7870 7265 7373 696f 6e5f 6469 616c 6563  xpression_dialec
+00006810: 7420 2873 7472 2c20 6f70 7469 6f6e 616c  t (str, optional
+00006820: 293a 2053 514c 2064 6961 6c65 6374 2075  ): SQL dialect u
+00006830: 7365 6420 666f 7220 7468 6520 6578 7072  sed for the expr
+00006840: 6573 7369 6f6e 2e0a 2020 2020 2020 2020  ession..        
+00006850: 6c61 7965 7220 2873 7472 2c20 6f70 7469  layer (str, opti
+00006860: 6f6e 616c 293a 2054 6865 206c 6179 6572  onal): The layer
+00006870: 206e 616d 652e 2049 6620 4e6f 6e65 2061   name. If None a
+00006880: 6e64 2074 6865 2067 656f 6669 6c65 0a20  nd the geofile. 
+00006890: 2020 2020 2020 2020 2020 2068 6173 206f             has o
+000068a0: 6e6c 7920 6f6e 6520 6c61 7965 722c 2074  nly one layer, t
+000068b0: 6861 7420 6c61 7965 7220 6973 2075 7365  hat layer is use
+000068c0: 642e 2044 6566 6175 6c74 7320 746f 204e  d. Defaults to N
+000068d0: 6f6e 652e 0a20 2020 2020 2020 2066 6f72  one..        for
+000068e0: 6365 5f75 7064 6174 6520 2862 6f6f 6c2c  ce_update (bool,
+000068f0: 206f 7074 696f 6e61 6c29 3a20 4966 2074   optional): If t
+00006900: 6865 2063 6f6c 756d 6e20 616c 7265 6164  he column alread
+00006910: 7920 6578 6973 7473 2c20 6578 6563 7574  y exists, execut
+00006920: 650a 2020 2020 2020 2020 2020 2020 7468  e.            th
+00006930: 6520 7570 6461 7465 2061 6e79 7761 792e  e update anyway.
+00006940: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
+00006950: 7365 2e0a 2020 2020 2020 2020 7769 6474  se..        widt
+00006960: 6820 2869 6e74 2c20 6f70 7469 6f6e 616c  h (int, optional
+00006970: 293a 2074 6865 2077 6964 7468 206f 6620  ): the width of 
+00006980: 7468 6520 6669 656c 642e 0a0a 2020 2020  the field...    
+00006990: 5261 6973 6573 3a0a 2020 2020 2020 2020  Raises:.        
+000069a0: 6578 3a20 5b64 6573 6372 6970 7469 6f6e  ex: [description
+000069b0: 5d0a 2020 2020 2222 220a 2020 2020 2320  ].    """.    # 
+000069c0: 496e 6974 0a20 2020 2069 6620 6973 696e  Init.    if isin
+000069d0: 7374 616e 6365 2874 7970 652c 2044 6174  stance(type, Dat
+000069e0: 6154 7970 6529 3a0a 2020 2020 2020 2020  aType):.        
+000069f0: 7479 7065 5f73 7472 203d 2074 7970 652e  type_str = type.
+00006a00: 7661 6c75 650a 2020 2020 656c 7365 3a0a  value.    else:.
+00006a10: 2020 2020 2020 2020 7479 7065 5f6c 6f77          type_low
+00006a20: 6572 203d 2074 7970 652e 6c6f 7765 7228  er = type.lower(
+00006a30: 290a 2020 2020 2020 2020 6966 2074 7970  ).        if typ
+00006a40: 655f 6c6f 7765 7220 3d3d 2022 7374 7269  e_lower == "stri
+00006a50: 6e67 223a 0a20 2020 2020 2020 2020 2020  ng":.           
+00006a60: 2023 2054 4f44 4f3a 2074 6869 6e6b 2077   # TODO: think w
+00006a70: 6865 7468 6572 2062 6569 6e67 2066 6c65  hether being fle
+00006a80: 7869 626c 6520 6865 7265 2069 7320 6120  xible here is a 
+00006a90: 676f 6f64 2069 6465 612e 2e2e 0a20 2020  good idea....   
+00006aa0: 2020 2020 2020 2020 2074 7970 655f 7374           type_st
+00006ab0: 7220 3d20 2254 4558 5422 0a20 2020 2020  r = "TEXT".     
+00006ac0: 2020 2065 6c69 6620 7479 7065 5f6c 6f77     elif type_low
+00006ad0: 6572 203d 3d20 2262 696e 6172 7922 3a0a  er == "binary":.
+00006ae0: 2020 2020 2020 2020 2020 2020 7479 7065              type
+00006af0: 5f73 7472 203d 2022 424c 4f42 220a 2020  _str = "BLOB".  
+00006b00: 2020 2020 2020 656c 6966 2074 7970 655f        elif type_
+00006b10: 6c6f 7765 7220 3d3d 2022 7469 6d65 223a  lower == "time":
+00006b20: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+00006b30: 655f 7374 7220 3d20 2244 4154 4554 494d  e_str = "DATETIM
+00006b40: 4522 0a20 2020 2020 2020 2065 6c73 653a  E".        else:
+00006b50: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+00006b60: 655f 7374 7220 3d20 7479 7065 0a20 2020  e_str = type.   
+00006b70: 2070 6174 6820 3d20 5061 7468 2870 6174   path = Path(pat
+00006b80: 6829 0a20 2020 2069 6620 6c61 7965 7220  h).    if layer 
+00006b90: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00006ba0: 206c 6179 6572 203d 2067 6574 5f6f 6e6c   layer = get_onl
+00006bb0: 795f 6c61 7965 7228 7061 7468 290a 2020  y_layer(path).  
+00006bc0: 2020 6c61 7965 7269 6e66 6f5f 6f72 6967    layerinfo_orig
+00006bd0: 203d 2067 6574 5f6c 6179 6572 696e 666f   = get_layerinfo
+00006be0: 2870 6174 682c 206c 6179 6572 290a 0a20  (path, layer).. 
+00006bf0: 2020 2023 2047 6f21 0a20 2020 2064 6174     # Go!.    dat
+00006c00: 6173 6f75 7263 6520 3d20 4e6f 6e65 0a20  asource = None. 
+00006c10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00006c20: 2320 4966 2063 6f6c 756d 6e20 646f 6573  # If column does
+00006c30: 6e27 7420 6578 6973 7420 7965 742c 2063  n't exist yet, c
+00006c40: 7265 6174 6520 6974 0a20 2020 2020 2020  reate it.       
+00006c50: 2063 6f6c 756d 6e73 5f75 7070 6572 203d   columns_upper =
+00006c60: 205b 636f 6c75 6d6e 2e75 7070 6572 2829   [column.upper()
+00006c70: 2066 6f72 2063 6f6c 756d 6e20 696e 206c   for column in l
+00006c80: 6179 6572 696e 666f 5f6f 7269 672e 636f  ayerinfo_orig.co
+00006c90: 6c75 6d6e 735d 0a20 2020 2020 2020 2069  lumns].        i
+00006ca0: 6620 6e61 6d65 2e75 7070 6572 2829 206e  f name.upper() n
+00006cb0: 6f74 2069 6e20 636f 6c75 6d6e 735f 7570  ot in columns_up
+00006cc0: 7065 723a 0a20 2020 2020 2020 2020 2020  per:.           
+00006cd0: 2077 6964 7468 5f73 7472 203d 2066 2228   width_str = f"(
+00006ce0: 7b77 6964 7468 7d29 2220 6966 2077 6964  {width})" if wid
+00006cf0: 7468 2069 7320 6e6f 7420 4e6f 6e65 2065  th is not None e
+00006d00: 6c73 6520 2222 0a20 2020 2020 2020 2020  lse "".         
+00006d10: 2020 2073 716c 5f73 746d 7420 3d20 280a     sql_stmt = (.
+00006d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d30: 6627 414c 5445 5220 5441 424c 4520 227b  f'ALTER TABLE "{
+00006d40: 6c61 7965 727d 2220 4144 4420 434f 4c55  layer}" ADD COLU
+00006d50: 4d4e 2022 7b6e 616d 657d 2220 7b74 7970  MN "{name}" {typ
+00006d60: 655f 7374 727d 7b77 6964 7468 5f73 7472  e_str}{width_str
+00006d70: 7d27 0a20 2020 2020 2020 2020 2020 2029  }'.            )
+00006d80: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00006d90: 6173 6f75 7263 6520 3d20 6764 616c 2e4f  asource = gdal.O
+00006da0: 7065 6e45 7828 7374 7228 7061 7468 292c  penEx(str(path),
+00006db0: 206e 4f70 656e 466c 6167 733d 6764 616c   nOpenFlags=gdal
+00006dc0: 2e4f 465f 5550 4441 5445 290a 2020 2020  .OF_UPDATE).    
+00006dd0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00006de0: 2064 6174 6173 6f75 7263 652e 4578 6563   datasource.Exec
+00006df0: 7574 6553 514c 2873 716c 5f73 746d 7429  uteSQL(sql_stmt)
+00006e00: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00006e10: 6173 6f75 7263 652e 5265 6c65 6173 6552  asource.ReleaseR
+00006e20: 6573 756c 7453 6574 2872 6573 756c 7429  esultSet(result)
+00006e30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00006e40: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00006e50: 722e 7761 726e 696e 6728 6622 436f 6c75  r.warning(f"Colu
+00006e60: 6d6e 207b 6e61 6d65 7d20 6578 6973 7465  mn {name} existe
+00006e70: 6420 616c 7265 6164 7920 696e 207b 7061  d already in {pa
+00006e80: 7468 7d2c 206c 6179 6572 207b 6c61 7965  th}, layer {laye
+00006e90: 727d 2229 0a0a 2020 2020 2020 2020 2320  r}")..        # 
+00006ea0: 4966 2061 6e20 6578 7072 6573 7369 6f6e  If an expression
+00006eb0: 2077 6173 2070 726f 7669 6465 6420 616e   was provided an
+00006ec0: 6420 7570 6461 7465 2063 616e 2062 6520  d update can be 
+00006ed0: 646f 6e65 2c20 676f 2066 6f72 2069 742e  done, go for it.
+00006ee0: 2e2e 0a20 2020 2020 2020 2069 6620 6578  ...        if ex
+00006ef0: 7072 6573 7369 6f6e 2069 7320 6e6f 7420  pression is not 
+00006f00: 4e6f 6e65 2061 6e64 2028 0a20 2020 2020  None and (.     
+00006f10: 2020 2020 2020 206e 616d 6520 6e6f 7420         name not 
+00006f20: 696e 206c 6179 6572 696e 666f 5f6f 7269  in layerinfo_ori
+00006f30: 672e 636f 6c75 6d6e 7320 6f72 2066 6f72  g.columns or for
+00006f40: 6365 5f75 7064 6174 6520 6973 2054 7275  ce_update is Tru
+00006f50: 650a 2020 2020 2020 2020 293a 0a20 2020  e.        ):.   
+00006f60: 2020 2020 2020 2020 2069 6620 6461 7461           if data
+00006f70: 736f 7572 6365 2069 7320 4e6f 6e65 3a0a  source is None:.
+00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 6461 7461 736f 7572 6365 203d 2067 6461  datasource = gda
+00006fa0: 6c2e 4f70 656e 4578 2873 7472 2870 6174  l.OpenEx(str(pat
+00006fb0: 6829 2c20 6e4f 7065 6e46 6c61 6773 3d67  h), nOpenFlags=g
+00006fc0: 6461 6c2e 4f46 5f55 5044 4154 4529 0a20  dal.OF_UPDATE). 
+00006fd0: 2020 2020 2020 2020 2020 2073 716c 5f73             sql_s
+00006fe0: 746d 7420 3d20 6627 5550 4441 5445 2022  tmt = f'UPDATE "
+00006ff0: 7b6c 6179 6572 7d22 2053 4554 2022 7b6e  {layer}" SET "{n
+00007000: 616d 657d 2220 3d20 7b65 7870 7265 7373  ame}" = {express
+00007010: 696f 6e7d 270a 2020 2020 2020 2020 2020  ion}'.          
+00007020: 2020 7265 7375 6c74 203d 2064 6174 6173    result = datas
+00007030: 6f75 7263 652e 4578 6563 7574 6553 514c  ource.ExecuteSQL
+00007040: 2873 716c 5f73 746d 742c 2064 6961 6c65  (sql_stmt, diale
+00007050: 6374 3d65 7870 7265 7373 696f 6e5f 6469  ct=expression_di
+00007060: 616c 6563 7429 0a20 2020 2020 2020 2020  alect).         
+00007070: 2020 2064 6174 6173 6f75 7263 652e 5265     datasource.Re
+00007080: 6c65 6173 6552 6573 756c 7453 6574 2872  leaseResultSet(r
+00007090: 6573 756c 7429 0a0a 2020 2020 6578 6365  esult)..    exce
+000070a0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+000070b0: 6578 3a0a 2020 2020 2020 2020 6578 2e61  ex:.        ex.a
+000070c0: 7267 7320 3d20 2866 2261 6464 5f63 6f6c  rgs = (f"add_col
+000070d0: 756d 6e20 6572 726f 7220 666f 7220 7b70  umn error for {p
+000070e0: 6174 687d 2e7b 6c61 7965 727d 3a5c 6e20  ath}.{layer}:\n 
+000070f0: 207b 6578 7d22 2c29 0a20 2020 2020 2020   {ex}",).       
+00007100: 2072 6169 7365 0a20 2020 2066 696e 616c   raise.    final
+00007110: 6c79 3a0a 2020 2020 2020 2020 6461 7461  ly:.        data
+00007120: 736f 7572 6365 203d 204e 6f6e 650a 0a0a  source = None...
+00007130: 6465 6620 6472 6f70 5f63 6f6c 756d 6e28  def drop_column(
+00007140: 0a20 2020 2070 6174 683a 2055 6e69 6f6e  .    path: Union
+00007150: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
+00007160: 6b65 5b41 6e79 5d22 5d2c 2063 6f6c 756d  ke[Any]"], colum
+00007170: 6e5f 6e61 6d65 3a20 7374 722c 206c 6179  n_name: str, lay
+00007180: 6572 3a20 4f70 7469 6f6e 616c 5b73 7472  er: Optional[str
+00007190: 5d20 3d20 4e6f 6e65 0a29 3a0a 2020 2020  ] = None.):.    
+000071a0: 2222 220a 2020 2020 4472 6f70 2074 6865  """.    Drop the
+000071b0: 2063 6f6c 756d 6e20 7370 6563 6966 6965   column specifie
+000071c0: 642e 0a0a 2020 2020 4172 6773 3a0a 2020  d...    Args:.  
+000071d0: 2020 2020 2020 7061 7468 2028 5061 7468        path (Path
+000071e0: 4c69 6b65 293a 2054 6865 2066 696c 6520  Like): The file 
+000071f0: 7061 7468 2e0a 2020 2020 2020 2020 636f  path..        co
+00007200: 6c75 6d6e 5f6e 616d 6520 2873 7472 293a  lumn_name (str):
+00007210: 2074 6865 2063 6f6c 756d 6e20 6e61 6d65   the column name
+00007220: 2e0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
+00007230: 284f 7074 696f 6e61 6c5b 7374 725d 293a  (Optional[str]):
+00007240: 2054 6865 206c 6179 6572 206e 616d 652e   The layer name.
+00007250: 2049 6620 6e6f 7420 7370 6563 6966 6965   If not specifie
+00007260: 642c 2061 6e64 2074 6865 7265 2069 7320  d, and there is 
+00007270: 6f6e 6c79 0a20 2020 2020 2020 2020 2020  only.           
+00007280: 206f 6e65 206c 6179 6572 2069 6e20 7468   one layer in th
+00007290: 6520 6669 6c65 2c20 7468 6973 206c 6179  e file, this lay
+000072a0: 6572 2069 7320 7573 6564 2e20 4f74 6865  er is used. Othe
+000072b0: 7277 6973 6520 6120 5661 6c75 6545 7272  rwise a ValueErr
+000072c0: 6f72 2069 730a 2020 2020 2020 2020 2020  or is.          
+000072d0: 2020 7261 6973 6564 2e0a 2020 2020 2222    raised..    ""
+000072e0: 220a 2020 2020 2320 4368 6563 6b20 696e  ".    # Check in
+000072f0: 7075 7420 7061 7261 6d65 7465 7273 0a20  put parameters. 
+00007300: 2020 2070 6174 6820 3d20 5061 7468 2870     path = Path(p
+00007310: 6174 6829 0a20 2020 2069 6620 6c61 7965  ath).    if laye
+00007320: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+00007330: 2020 206c 6179 6572 203d 2067 6574 5f6f     layer = get_o
+00007340: 6e6c 795f 6c61 7965 7228 7061 7468 290a  nly_layer(path).
+00007350: 2020 2020 696e 666f 203d 2067 6574 5f6c      info = get_l
+00007360: 6179 6572 696e 666f 2870 6174 682c 206c  ayerinfo(path, l
+00007370: 6179 6572 290a 2020 2020 6966 2063 6f6c  ayer).    if col
+00007380: 756d 6e5f 6e61 6d65 206e 6f74 2069 6e20  umn_name not in 
+00007390: 696e 666f 2e63 6f6c 756d 6e73 3a0a 2020  info.columns:.  
+000073a0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+000073b0: 6f28 6622 436f 6c75 6d6e 207b 636f 6c75  o(f"Column {colu
+000073c0: 6d6e 5f6e 616d 657d 206e 6f74 2070 7265  mn_name} not pre
+000073d0: 7365 6e74 2073 6f20 6361 6e6e 6f74 2062  sent so cannot b
+000073e0: 6520 6472 6f70 7065 642e 2229 0a20 2020  e dropped.").   
+000073f0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00007400: 2023 204e 6f77 2072 6561 6c6c 7920 7265   # Now really re
+00007410: 6e61 6d65 0a20 2020 2064 6174 6173 6f75  name.    datasou
+00007420: 7263 6520 3d20 4e6f 6e65 0a20 2020 2074  rce = None.    t
+00007430: 7279 3a0a 2020 2020 2020 2020 6461 7461  ry:.        data
+00007440: 736f 7572 6365 203d 2067 6461 6c2e 4f70  source = gdal.Op
+00007450: 656e 4578 2873 7472 2870 6174 6829 2c20  enEx(str(path), 
+00007460: 6e4f 7065 6e46 6c61 6773 3d67 6461 6c2e  nOpenFlags=gdal.
+00007470: 4f46 5f55 5044 4154 4529 0a20 2020 2020  OF_UPDATE).     
+00007480: 2020 2073 716c 5f73 746d 7420 3d20 6627     sql_stmt = f'
+00007490: 414c 5445 5220 5441 424c 4520 227b 6c61  ALTER TABLE "{la
+000074a0: 7965 727d 2220 4452 4f50 2043 4f4c 554d  yer}" DROP COLUM
+000074b0: 4e20 227b 636f 6c75 6d6e 5f6e 616d 657d  N "{column_name}
+000074c0: 2227 0a20 2020 2020 2020 2072 6573 756c  "'.        resul
+000074d0: 7420 3d20 6461 7461 736f 7572 6365 2e45  t = datasource.E
+000074e0: 7865 6375 7465 5351 4c28 7371 6c5f 7374  xecuteSQL(sql_st
+000074f0: 6d74 290a 2020 2020 2020 2020 6461 7461  mt).        data
+00007500: 736f 7572 6365 2e52 656c 6561 7365 5265  source.ReleaseRe
+00007510: 7375 6c74 5365 7428 7265 7375 6c74 290a  sultSet(result).
+00007520: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+00007530: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00007540: 2020 2020 2065 782e 6172 6773 203d 2028       ex.args = (
+00007550: 6622 6472 6f70 5f63 6f6c 756d 6e20 6572  f"drop_column er
+00007560: 726f 7220 666f 7220 7b70 6174 687d 2e7b  ror for {path}.{
+00007570: 6c61 7965 727d 3a5c 6e20 207b 6578 7d22  layer}:\n  {ex}"
+00007580: 2c29 0a20 2020 2020 2020 2072 6169 7365  ,).        raise
+00007590: 0a20 2020 2066 696e 616c 6c79 3a0a 2020  .    finally:.  
+000075a0: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
+000075b0: 203d 204e 6f6e 650a 0a0a 6465 6620 7570   = None...def up
+000075c0: 6461 7465 5f63 6f6c 756d 6e28 0a20 2020  date_column(.   
+000075d0: 2070 6174 683a 2055 6e69 6f6e 5b73 7472   path: Union[str
+000075e0: 2c20 226f 732e 5061 7468 4c69 6b65 5b41  , "os.PathLike[A
+000075f0: 6e79 5d22 5d2c 0a20 2020 206e 616d 653a  ny]"],.    name:
+00007600: 2073 7472 2c0a 2020 2020 6578 7072 6573   str,.    expres
+00007610: 7369 6f6e 3a20 7374 722c 0a20 2020 206c  sion: str,.    l
+00007620: 6179 6572 3a20 4f70 7469 6f6e 616c 5b73  ayer: Optional[s
+00007630: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00007640: 7768 6572 653a 204f 7074 696f 6e61 6c5b  where: Optional[
+00007650: 7374 725d 203d 204e 6f6e 652c 0a29 3a0a  str] = None,.):.
+00007660: 2020 2020 2222 220a 2020 2020 5570 6461      """.    Upda
+00007670: 7465 2061 2063 6f6c 756d 6e20 6672 6f6d  te a column from
+00007680: 2061 206c 6179 6572 206f 6620 7468 6520   a layer of the 
+00007690: 6765 6f66 696c 652e 0a0a 2020 2020 4172  geofile...    Ar
+000076a0: 6773 3a0a 2020 2020 2020 2020 7061 7468  gs:.        path
+000076b0: 2028 5061 7468 4c69 6b65 293a 2050 6174   (PathLike): Pat
+000076c0: 6820 746f 2074 6865 2067 656f 6669 6c65  h to the geofile
+000076d0: 0a20 2020 2020 2020 206e 616d 6520 2873  .        name (s
+000076e0: 7472 293a 204e 616d 6520 666f 7220 7468  tr): Name for th
+000076f0: 6520 6e65 7720 636f 6c75 6d6e 0a20 2020  e new column.   
+00007700: 2020 2020 2065 7870 7265 7373 696f 6e20       expression 
+00007710: 2873 7472 293a 2053 514c 6974 6520 6578  (str): SQLite ex
+00007720: 7072 6573 7369 6f6e 2074 6f20 7573 6520  pression to use 
+00007730: 746f 2075 7064 6174 650a 2020 2020 2020  to update.      
+00007740: 2020 2020 2020 7468 6520 7661 6c75 652e        the value.
+00007750: 0a20 2020 2020 2020 206c 6179 6572 2028  .        layer (
+00007760: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00007770: 5468 6520 6c61 7965 7220 6e61 6d65 2e20  The layer name. 
+00007780: 4966 204e 6f6e 6520 616e 6420 7468 6520  If None and the 
+00007790: 6765 6f66 696c 650a 2020 2020 2020 2020  geofile.        
+000077a0: 2020 2020 6861 7320 6f6e 6c79 206f 6e65      has only one
+000077b0: 206c 6179 6572 2c20 7468 6174 206c 6179   layer, that lay
+000077c0: 6572 2069 7320 7573 6564 2e20 4465 6661  er is used. Defa
+000077d0: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
+000077e0: 2020 2020 2020 6c61 7965 7220 2873 7472        layer (str
+000077f0: 2c20 6f70 7469 6f6e 616c 293a 2053 514c  , optional): SQL
+00007800: 2077 6865 7265 2063 6c61 7573 6520 746f   where clause to
+00007810: 2072 6573 7472 6963 7420 7468 6520 726f   restrict the ro
+00007820: 7773 2074 6861 7420 7769 6c6c 0a20 2020  ws that will.   
+00007830: 2020 2020 2020 2020 2062 6520 7570 6461           be upda
+00007840: 7465 642e 2044 6566 6175 6c74 7320 746f  ted. Defaults to
+00007850: 204e 6f6e 652e 0a0a 2020 2020 5261 6973   None...    Rais
+00007860: 6573 3a0a 2020 2020 2020 2020 5661 6c75  es:.        Valu
+00007870: 6545 7272 6f72 3a20 616e 2069 6e76 616c  eError: an inval
+00007880: 6964 2070 6172 616d 6574 6572 2076 616c  id parameter val
+00007890: 7565 2077 6173 2070 6173 7365 642e 0a20  ue was passed.. 
+000078a0: 2020 2022 2222 0a0a 2020 2020 2320 496e     """..    # In
+000078b0: 6974 0a20 2020 2070 6174 6820 3d20 5061  it.    path = Pa
+000078c0: 7468 2870 6174 6829 0a20 2020 2069 6620  th(path).    if 
+000078d0: 6c61 7965 7220 6973 204e 6f6e 653a 0a20  layer is None:. 
+000078e0: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
+000078f0: 6574 5f6f 6e6c 795f 6c61 7965 7228 7061  et_only_layer(pa
+00007900: 7468 290a 2020 2020 6c61 7965 7269 6e66  th).    layerinf
+00007910: 6f5f 6f72 6967 203d 2067 6574 5f6c 6179  o_orig = get_lay
+00007920: 6572 696e 666f 2870 6174 682c 206c 6179  erinfo(path, lay
+00007930: 6572 290a 2020 2020 636f 6c75 6d6e 735f  er).    columns_
+00007940: 7570 7065 7220 3d20 5b63 6f6c 756d 6e2e  upper = [column.
+00007950: 7570 7065 7228 2920 666f 7220 636f 6c75  upper() for colu
+00007960: 6d6e 2069 6e20 6c61 7965 7269 6e66 6f5f  mn in layerinfo_
+00007970: 6f72 6967 2e63 6f6c 756d 6e73 5d0a 2020  orig.columns].  
+00007980: 2020 6966 206e 616d 652e 7570 7065 7228    if name.upper(
+00007990: 2920 6e6f 7420 696e 2063 6f6c 756d 6e73  ) not in columns
+000079a0: 5f75 7070 6572 3a0a 2020 2020 2020 2020  _upper:.        
+000079b0: 2320 4966 2063 6f6c 756d 6e20 646f 6573  # If column does
+000079c0: 6e27 7420 6578 6973 7420 7965 742c 2065  n't exist yet, e
+000079d0: 7272 6f72 210a 2020 2020 2020 2020 7261  rror!.        ra
+000079e0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+000079f0: 2243 6f6c 756d 6e20 7b6e 616d 657d 2064  "Column {name} d
+00007a00: 6f65 736e 2774 2065 7869 7374 2069 6e20  oesn't exist in 
+00007a10: 7b70 6174 687d 2c20 6c61 7965 7220 7b6c  {path}, layer {l
+00007a20: 6179 6572 7d22 290a 0a20 2020 2023 2047  ayer}")..    # G
+00007a30: 6f21 0a20 2020 2064 6174 6173 6f75 7263  o!.    datasourc
+00007a40: 6520 3d20 4e6f 6e65 0a20 2020 2074 7279  e = None.    try
+00007a50: 3a0a 2020 2020 2020 2020 6461 7461 736f  :.        dataso
+00007a60: 7572 6365 203d 2067 6461 6c2e 4f70 656e  urce = gdal.Open
+00007a70: 4578 2873 7472 2870 6174 6829 2c20 6e4f  Ex(str(path), nO
+00007a80: 7065 6e46 6c61 6773 3d67 6461 6c2e 4f46  penFlags=gdal.OF
+00007a90: 5f55 5044 4154 4529 0a20 2020 2020 2020  _UPDATE).       
+00007aa0: 2073 716c 6974 655f 7374 6d74 203d 2066   sqlite_stmt = f
+00007ab0: 2755 5044 4154 4520 227b 6c61 7965 727d  'UPDATE "{layer}
+00007ac0: 2220 5345 5420 227b 6e61 6d65 7d22 203d  " SET "{name}" =
+00007ad0: 207b 6578 7072 6573 7369 6f6e 7d27 0a20   {expression}'. 
+00007ae0: 2020 2020 2020 2069 6620 7768 6572 6520         if where 
+00007af0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007b00: 2020 2020 2020 2020 2073 716c 6974 655f           sqlite_
+00007b10: 7374 6d74 202b 3d20 6622 5c6e 2057 4845  stmt += f"\n WHE
+00007b20: 5245 207b 7768 6572 657d 220a 2020 2020  RE {where}".    
+00007b30: 2020 2020 7265 7375 6c74 203d 2064 6174      result = dat
+00007b40: 6173 6f75 7263 652e 4578 6563 7574 6553  asource.ExecuteS
+00007b50: 514c 2873 716c 6974 655f 7374 6d74 2c20  QL(sqlite_stmt, 
+00007b60: 6469 616c 6563 743d 2253 514c 4954 4522  dialect="SQLITE"
+00007b70: 290a 2020 2020 2020 2020 6461 7461 736f  ).        dataso
+00007b80: 7572 6365 2e52 656c 6561 7365 5265 7375  urce.ReleaseResu
+00007b90: 6c74 5365 7428 7265 7375 6c74 290a 0a20  ltSet(result).. 
+00007ba0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00007bb0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+00007bc0: 2020 2065 782e 6172 6773 203d 2028 6622     ex.args = (f"
+00007bd0: 7570 6461 7465 5f63 6f6c 756d 6e20 6572  update_column er
+00007be0: 726f 7220 666f 7220 7b70 6174 687d 2e7b  ror for {path}.{
+00007bf0: 6c61 7965 727d 3a5c 6e20 207b 6578 7d22  layer}:\n  {ex}"
+00007c00: 2c29 0a20 2020 2020 2020 2072 6169 7365  ,).        raise
+00007c10: 0a20 2020 2066 696e 616c 6c79 3a0a 2020  .    finally:.  
+00007c20: 2020 2020 2020 6461 7461 736f 7572 6365        datasource
+00007c30: 203d 204e 6f6e 650a 0a0a 6465 6620 7265   = None...def re
+00007c40: 6164 5f66 696c 6528 0a20 2020 2070 6174  ad_file(.    pat
+00007c50: 683a 2055 6e69 6f6e 5b73 7472 2c20 226f  h: Union[str, "o
+00007c60: 732e 5061 7468 4c69 6b65 5b41 6e79 5d22  s.PathLike[Any]"
+00007c70: 5d2c 0a20 2020 206c 6179 6572 3a20 4f70  ],.    layer: Op
+00007c80: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00007c90: 6e65 2c0a 2020 2020 636f 6c75 6d6e 733a  ne,.    columns:
+00007ca0: 204f 7074 696f 6e61 6c5b 4974 6572 6162   Optional[Iterab
+00007cb0: 6c65 5b73 7472 5d5d 203d 204e 6f6e 652c  le[str]] = None,
+00007cc0: 0a20 2020 2062 626f 783d 4e6f 6e65 2c0a  .    bbox=None,.
+00007cd0: 2020 2020 726f 7773 3d4e 6f6e 652c 0a20      rows=None,. 
+00007ce0: 2020 2073 716c 5f73 746d 743a 204f 7074     sql_stmt: Opt
+00007cf0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00007d00: 652c 0a20 2020 2073 716c 5f64 6961 6c65  e,.    sql_diale
+00007d10: 6374 3a20 4f70 7469 6f6e 616c 5b4c 6974  ct: Optional[Lit
+00007d20: 6572 616c 5b22 5351 4c49 5445 222c 2022  eral["SQLITE", "
+00007d30: 4f47 5253 514c 225d 5d20 3d20 4e6f 6e65  OGRSQL"]] = None
+00007d40: 2c0a 2020 2020 6967 6e6f 7265 5f67 656f  ,.    ignore_geo
+00007d50: 6d65 7472 793a 2062 6f6f 6c20 3d20 4661  metry: bool = Fa
+00007d60: 6c73 652c 0a20 2020 2066 6964 5f61 735f  lse,.    fid_as_
+00007d70: 696e 6465 783a 2062 6f6f 6c20 3d20 4661  index: bool = Fa
+00007d80: 6c73 652c 0a29 202d 3e20 6770 642e 4765  lse,.) -> gpd.Ge
+00007d90: 6f44 6174 6146 7261 6d65 3a0a 2020 2020  oDataFrame:.    
+00007da0: 2222 220a 2020 2020 5265 6164 7320 6120  """.    Reads a 
+00007db0: 6669 6c65 2074 6f20 6120 6765 6f70 616e  file to a geopan
+00007dc0: 6461 7320 4765 6f44 6174 6166 7261 6d65  das GeoDataframe
+00007dd0: 2e0a 0a20 2020 2054 6865 2066 696c 6520  ...    The file 
+00007de0: 666f 726d 6174 2069 7320 6465 7465 6374  format is detect
+00007df0: 6564 2062 6173 6564 206f 6e20 7468 6520  ed based on the 
+00007e00: 6669 6c65 7061 7468 2065 7874 656e 7369  filepath extensi
+00007e10: 6f6e 2e0a 0a20 2020 2049 6620 616e 2073  on...    If an s
+00007e20: 716c 5f73 746d 7420 6973 2073 7065 6369  ql_stmt is speci
+00007e30: 6669 6564 2c20 7468 6520 7371 6c69 7465  fied, the sqlite
+00007e40: 2071 7565 7279 2063 616e 2063 6f6e 7461   query can conta
+00007e50: 696e 2066 6f6c 6c6f 7769 6e67 2070 6c61  in following pla
+00007e60: 6365 686f 6c64 6572 730a 2020 2020 7468  ceholders.    th
+00007e70: 6174 2077 696c 6c20 6265 2061 7574 6f6d  at will be autom
+00007e80: 6174 6963 616c 6c79 2072 6570 6c61 6365  atically replace
+00007e90: 6420 666f 7220 796f 753a 0a0a 2020 2020  d for you:..    
+00007ea0: 2020 2a20 7b67 656f 6d65 7472 7963 6f6c    * {geometrycol
+00007eb0: 756d 6e7d 3a20 7468 6520 636f 6c75 6d6e  umn}: the column
+00007ec0: 2077 6865 7265 2074 6865 2070 7269 6d61   where the prima
+00007ed0: 7279 2067 656f 6d65 7472 7920 6973 2073  ry geometry is s
+00007ee0: 746f 7265 642e 0a20 2020 2020 202a 207b  tored..      * {
+00007ef0: 636f 6c75 6d6e 735f 746f 5f73 656c 6563  columns_to_selec
+00007f00: 745f 7374 727d 3a20 6966 2027 636f 6c75  t_str}: if 'colu
+00007f10: 6d6e 7327 2069 7320 6e6f 7420 4e6f 6e65  mns' is not None
+00007f20: 2c20 7468 6f73 6520 636f 6c75 6d6e 732c  , those columns,
+00007f30: 0a20 2020 2020 2020 206f 7468 6572 7769  .        otherwi
+00007f40: 7365 2061 6c6c 2063 6f6c 756d 6e73 206f  se all columns o
+00007f50: 6620 7468 6520 6c61 7965 722e 0a20 2020  f the layer..   
+00007f60: 2020 202a 207b 696e 7075 745f 6c61 7965     * {input_laye
+00007f70: 727d 3a20 7468 6520 6c61 7965 7220 6e61  r}: the layer na
+00007f80: 6d65 206f 6620 7468 6520 696e 7075 7420  me of the input 
+00007f90: 6c61 7965 722e 0a0a 2020 2020 4578 616d  layer...    Exam
+00007fa0: 706c 6520 7371 6c20 7374 6174 656d 656e  ple sql statemen
+00007fb0: 7420 7769 7468 2070 6c61 6365 686f 6c64  t with placehold
+00007fc0: 6572 733a 0a20 2020 203a 3a0a 0a20 2020  ers:.    ::..   
+00007fd0: 2020 2020 2053 454c 4543 5420 7b67 656f       SELECT {geo
+00007fe0: 6d65 7472 7963 6f6c 756d 6e7d 0a20 2020  metrycolumn}.   
+00007ff0: 2020 2020 2020 2020 2020 207b 636f 6c75             {colu
+00008000: 6d6e 735f 746f 5f73 656c 6563 745f 7374  mns_to_select_st
+00008010: 727d 0a20 2020 2020 2020 2020 2046 524f  r}.          FRO
+00008020: 4d20 227b 696e 7075 745f 6c61 7965 727d  M "{input_layer}
+00008030: 2220 6c61 7965 720a 0a20 2020 2054 6865  " layer..    The
+00008040: 2075 6e64 6572 6c79 696e 6720 6c69 6272   underlying libr
+00008050: 6172 7920 7573 6564 2074 6f20 7265 6164  ary used to read
+00008060: 2074 6865 2066 696c 6520 6361 6e20 6265   the file can be
+00008070: 2063 686f 6f73 656e 2075 7369 6e67 2074   choosen using t
+00008080: 6865 0a20 2020 2022 4746 4f5f 494f 5f45  he.    "GFO_IO_E
+00008090: 4e47 494e 4522 2065 6e76 6972 6f6e 6d65  NGINE" environme
+000080a0: 6e74 2076 6172 6961 626c 652e 2050 6f73  nt variable. Pos
+000080b0: 7369 626c 6520 7661 6c75 6573 2061 7265  sible values are
+000080c0: 2022 6669 6f6e 6122 2061 6e64 2022 7079   "fiona" and "py
+000080d0: 6f67 7269 6f22 2e0a 2020 2020 5468 6973  ogrio"..    This
+000080e0: 206f 7074 696f 6e20 6973 2063 7265 6174   option is creat
+000080f0: 6564 2061 7320 6120 7465 6d70 6f72 6172  ed as a temporar
+00008100: 7920 6661 6c6c 6261 636b 2074 6f20 2266  y fallback to "f
+00008110: 696f 6e61 2220 666f 7220 6361 7365 7320  iona" for cases 
+00008120: 7768 6572 6520 2270 796f 6772 696f 220a  where "pyogrio".
+00008130: 2020 2020 6769 7665 7320 6973 7375 6573      gives issues
+00008140: 2c20 736f 2070 6c65 6173 6520 7265 706f  , so please repo
+00008150: 7274 2069 7373 7565 7320 6966 2074 6865  rt issues if the
+00008160: 7920 6172 6520 656e 636f 756e 7465 7265  y are encountere
+00008170: 642e 2049 6e20 7468 6520 6675 7475 7265  d. In the future
+00008180: 2073 7570 706f 7274 0a20 2020 2066 6f72   support.    for
+00008190: 2074 6865 2022 6669 6f6e 6122 2065 6e67   the "fiona" eng
+000081a0: 696e 6520 6d6f 7374 206c 696b 656c 7920  ine most likely 
+000081b0: 7769 6c6c 2062 6520 7265 6d6f 7665 642e  will be removed.
+000081c0: 2044 6566 6175 6c74 2065 6e67 696e 6520   Default engine 
+000081d0: 6973 2022 7079 6f67 7269 6f22 2e0a 0a20  is "pyogrio"... 
+000081e0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+000081f0: 2070 6174 6820 2866 696c 6520 7061 7468   path (file path
+00008200: 293a 2070 6174 6820 746f 2074 6865 2066  ): path to the f
+00008210: 696c 6520 746f 2072 6561 6420 6672 6f6d  ile to read from
+00008220: 0a20 2020 2020 2020 206c 6179 6572 2028  .        layer (
+00008230: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00008240: 5468 6520 6c61 7965 7220 746f 2072 6561  The layer to rea
+00008250: 642e 2044 6566 6175 6c74 7320 746f 204e  d. Defaults to N
+00008260: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00008270: 2074 6865 6e20 7265 6164 7320 7468 6520   then reads the 
+00008280: 6f6e 6c79 206c 6179 6572 2069 6e20 7468  only layer in th
+00008290: 6520 6669 6c65 206f 7220 7468 726f 7773  e file or throws
+000082a0: 2065 7272 6f72 2e0a 2020 2020 2020 2020   error..        
+000082b0: 636f 6c75 6d6e 7320 2849 7465 7261 626c  columns (Iterabl
+000082c0: 655b 7374 725d 2c20 6f70 7469 6f6e 616c  e[str], optional
+000082d0: 293a 2054 6865 2028 6e6f 6e2d 6765 6f6d  ): The (non-geom
+000082e0: 6574 7279 2920 636f 6c75 6d6e 7320 746f  etry) columns to
+000082f0: 2072 6561 6420 7769 6c6c 0a20 2020 2020   read will.     
+00008300: 2020 2020 2020 2062 6520 7265 7475 726e         be return
+00008310: 6564 2069 6e20 7468 6520 6f72 6465 7220  ed in the order 
+00008320: 7370 6563 6966 6965 642e 2049 6620 4e6f  specified. If No
+00008330: 6e65 2c20 616c 6c20 7374 616e 6461 7264  ne, all standard
+00008340: 2063 6f6c 756d 6e73 2061 7265 2072 6561   columns are rea
+00008350: 642e 0a20 2020 2020 2020 2020 2020 2049  d..            I
+00008360: 6e20 6164 6469 7469 6f6e 2074 6f20 7374  n addition to st
+00008370: 616e 6461 7264 2063 6f6c 756d 6e73 2c20  andard columns, 
+00008380: 6974 2069 7320 616c 736f 2070 6f73 7369  it is also possi
+00008390: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+000083a0: 746f 2073 7065 6369 6679 2022 6669 6422  to specify "fid"
+000083b0: 2c20 6120 756e 6971 7565 2069 6e64 6578  , a unique index
+000083c0: 2061 7661 696c 6162 6c65 2069 6e20 616c   available in al
+000083d0: 6c20 696e 7075 7420 6669 6c65 732e 204e  l input files. N
+000083e0: 6f74 6520 7468 6174 2074 6865 0a20 2020  ote that the.   
+000083f0: 2020 2020 2020 2020 2022 6669 6422 2077           "fid" w
+00008400: 696c 6c20 6265 2061 6c69 6173 6564 2065  ill be aliased e
+00008410: 672e 2074 6f20 2266 6964 5f31 222e 2044  g. to "fid_1". D
+00008420: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
+00008430: 0a20 2020 2020 2020 2062 626f 7820 285b  .        bbox ([
+00008440: 7479 7065 5d2c 206f 7074 696f 6e61 6c29  type], optional)
+00008450: 3a20 5265 6164 206f 6e6c 7920 6765 6f6d  : Read only geom
+00008460: 6574 7269 6573 2069 6e74 6572 7365 6374  etries intersect
+00008470: 696e 6720 7468 6973 2062 626f 782e 0a20  ing this bbox.. 
+00008480: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00008490: 6c74 7320 746f 204e 6f6e 652c 2074 6865  lts to None, the
+000084a0: 6e20 616c 6c20 726f 7773 2061 7265 2072  n all rows are r
+000084b0: 6561 642e 0a20 2020 2020 2020 2072 6f77  ead..        row
+000084c0: 7320 285b 7479 7065 5d2c 206f 7074 696f  s ([type], optio
+000084d0: 6e61 6c29 3a20 5265 6164 206f 6e6c 7920  nal): Read only 
+000084e0: 7468 6520 726f 7773 2073 7065 6369 6669  the rows specifi
+000084f0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00008500: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+00008510: 2c20 7468 656e 2061 6c6c 2072 6f77 7320  , then all rows 
+00008520: 6172 6520 7265 6164 2e0a 2020 2020 2020  are read..      
+00008530: 2020 7371 6c5f 7374 6d74 2028 7374 7229    sql_stmt (str)
+00008540: 3a20 7371 6c20 7374 6174 656d 656e 7420  : sql statement 
+00008550: 746f 2075 7365 2e20 4f6e 6c79 2073 7570  to use. Only sup
+00008560: 706f 7274 6564 2077 6974 6820 2270 796f  ported with "pyo
+00008570: 6772 696f 2220 656e 6769 6e65 2e0a 2020  grio" engine..  
+00008580: 2020 2020 2020 7371 6c5f 6469 616c 6563        sql_dialec
+00008590: 7420 2873 7472 2c20 6f70 7469 6f6e 616c  t (str, optional
+000085a0: 293a 2053 716c 2064 6961 6c65 6374 2075  ): Sql dialect u
+000085b0: 7365 642e 2049 6620 4e6f 6e65 2c20 666f  sed. If None, fo
+000085c0: 7220 6461 7461 2073 6f75 7263 6573 2077  r data sources w
+000085d0: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
+000085e0: 6578 706c 6963 6974 2053 514c 2073 7570  explicit SQL sup
+000085f0: 706f 7274 2074 6865 2073 7461 7465 6d65  port the stateme
+00008600: 6e74 2069 7320 7072 6f63 6573 7365 6420  nt is processed 
+00008610: 6279 2074 6865 2064 6566 6175 6c74 2053  by the default S
+00008620: 514c 2065 6e67 696e 650a 2020 2020 2020  QL engine.      
+00008630: 2020 2020 2020 2865 2e67 2e20 506f 7374        (e.g. Post
+00008640: 4749 532c 2047 656f 7061 636b 6167 652c  GIS, Geopackage,
+00008650: 2053 7061 7469 616c 6974 652c 2e2e 2e29   Spatialite,...)
+00008660: 2e20 466f 7220 6461 7461 2073 6f75 7263  . For data sourc
+00008670: 6573 0a20 2020 2020 2020 2020 2020 2077  es.            w
+00008680: 6974 686f 7574 2053 514c 2073 7570 706f  ithout SQL suppo
+00008690: 7274 2c20 7468 6520 224f 4752 5351 4c22  rt, the "OGRSQL"
+000086a0: 2064 6961 6c65 6374 2069 7320 7468 6520   dialect is the 
+000086b0: 6465 6661 756c 742e 2044 6566 6175 6c74  default. Default
+000086c0: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
+000086d0: 2020 2069 676e 6f72 655f 6765 6f6d 6574     ignore_geomet
+000086e0: 7279 2028 626f 6f6c 2c20 6f70 7469 6f6e  ry (bool, option
+000086f0: 616c 293a 2054 7275 6520 6e6f 7420 746f  al): True not to
+00008700: 2072 6561 642f 7265 7475 726e 2074 6865   read/return the
+00008710: 2067 656f 6d65 7472 792e 0a20 2020 2020   geometry..     
+00008720: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+00008730: 746f 2046 616c 7365 2e0a 2020 2020 2020  to False..      
+00008740: 2020 6669 645f 6173 5f69 6e64 6578 2028    fid_as_index (
+00008750: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+00008760: 2049 6620 5472 7565 2c20 7769 6c6c 2075   If True, will u
+00008770: 7365 2074 6865 2046 4944 7320 6f66 2074  se the FIDs of t
+00008780: 6865 2066 6561 7475 7265 7320 7468 6174  he features that
+00008790: 0a20 2020 2020 2020 2020 2020 2077 6572  .            wer
+000087a0: 6520 7265 6164 2061 7320 7468 6520 696e  e read as the in
+000087b0: 6465 7820 6f66 2074 6865 2047 656f 4461  dex of the GeoDa
+000087c0: 7461 4672 616d 652e 204d 6179 2073 7461  taFrame. May sta
+000087d0: 7274 2061 7420 3020 6f72 2031 2064 6570  rt at 0 or 1 dep
+000087e0: 656e 6469 6e67 206f 6e0a 2020 2020 2020  ending on.      
+000087f0: 2020 2020 2020 7468 6520 6472 6976 6572        the driver
+00008800: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
+00008810: 6c73 652e 0a0a 2020 2020 5261 6973 6573  lse...    Raises
+00008820: 3a0a 2020 2020 2020 2020 5661 6c75 6545  :.        ValueE
+00008830: 7272 6f72 3a20 616e 2069 6e76 616c 6964  rror: an invalid
+00008840: 2070 6172 616d 6574 6572 2076 616c 7565   parameter value
+00008850: 2077 6173 2070 6173 7365 642e 0a0a 2020   was passed...  
+00008860: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00008870: 2020 2067 7064 2e47 656f 4461 7461 4672     gpd.GeoDataFr
+00008880: 616d 653a 2074 6865 2064 6174 6120 7265  ame: the data re
+00008890: 6164 2e0a 2020 2020 2222 220a 2020 2020  ad..    """.    
+000088a0: 7265 7375 6c74 5f67 6466 203d 205f 7265  result_gdf = _re
+000088b0: 6164 5f66 696c 655f 6261 7365 280a 2020  ad_file_base(.  
+000088c0: 2020 2020 2020 7061 7468 3d70 6174 682c        path=path,
+000088d0: 0a20 2020 2020 2020 206c 6179 6572 3d6c  .        layer=l
+000088e0: 6179 6572 2c0a 2020 2020 2020 2020 636f  ayer,.        co
+000088f0: 6c75 6d6e 733d 636f 6c75 6d6e 732c 0a20  lumns=columns,. 
+00008900: 2020 2020 2020 2062 626f 783d 6262 6f78         bbox=bbox
+00008910: 2c0a 2020 2020 2020 2020 726f 7773 3d72  ,.        rows=r
+00008920: 6f77 732c 0a20 2020 2020 2020 2073 716c  ows,.        sql
+00008930: 5f73 746d 743d 7371 6c5f 7374 6d74 2c0a  _stmt=sql_stmt,.
+00008940: 2020 2020 2020 2020 7371 6c5f 6469 616c          sql_dial
+00008950: 6563 743d 7371 6c5f 6469 616c 6563 742c  ect=sql_dialect,
+00008960: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
+00008970: 6765 6f6d 6574 7279 3d69 676e 6f72 655f  geometry=ignore_
+00008980: 6765 6f6d 6574 7279 2c0a 2020 2020 2020  geometry,.      
+00008990: 2020 6669 645f 6173 5f69 6e64 6578 3d66    fid_as_index=f
+000089a0: 6964 5f61 735f 696e 6465 782c 0a20 2020  id_as_index,.   
+000089b0: 2029 0a0a 2020 2020 2320 4e6f 2061 7373   )..    # No ass
+000089c0: 6572 7420 746f 206b 6565 7020 6261 636b  ert to keep back
+000089d0: 7761 7264 7320 636f 6d70 6174 6962 696c  wards compatibil
+000089e0: 6974 790a 2020 2020 7265 7475 726e 2072  ity.    return r
+000089f0: 6573 756c 745f 6764 660a 0a0a 6465 6620  esult_gdf...def 
+00008a00: 7265 6164 5f66 696c 655f 6e6f 6765 6f6d  read_file_nogeom
+00008a10: 280a 2020 2020 7061 7468 3a20 556e 696f  (.    path: Unio
+00008a20: 6e5b 7374 722c 2022 6f73 2e50 6174 684c  n[str, "os.PathL
+00008a30: 696b 655b 416e 795d 225d 2c0a 2020 2020  ike[Any]"],.    
+00008a40: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
+00008a50: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00008a60: 2063 6f6c 756d 6e73 3a20 4f70 7469 6f6e   columns: Option
+00008a70: 616c 5b49 7465 7261 626c 655b 7374 725d  al[Iterable[str]
+00008a80: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 6262  ] = None,.    bb
+00008a90: 6f78 3d4e 6f6e 652c 0a20 2020 2072 6f77  ox=None,.    row
+00008aa0: 733d 4e6f 6e65 2c0a 2020 2020 7371 6c5f  s=None,.    sql_
+00008ab0: 7374 6d74 3a20 4f70 7469 6f6e 616c 5b73  stmt: Optional[s
+00008ac0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00008ad0: 7371 6c5f 6469 616c 6563 743a 204f 7074  sql_dialect: Opt
+00008ae0: 696f 6e61 6c5b 4c69 7465 7261 6c5b 2253  ional[Literal["S
+00008af0: 514c 4954 4522 2c20 224f 4752 5351 4c22  QLITE", "OGRSQL"
+00008b00: 5d5d 203d 204e 6f6e 652c 0a20 2020 2066  ]] = None,.    f
+00008b10: 6964 5f61 735f 696e 6465 783a 2062 6f6f  id_as_index: boo
+00008b20: 6c20 3d20 4661 6c73 652c 0a29 202d 3e20  l = False,.) -> 
+00008b30: 7064 2e44 6174 6146 7261 6d65 3a0a 2020  pd.DataFrame:.  
+00008b40: 2020 2222 220a 2020 2020 4445 5052 4543    """.    DEPREC
+00008b50: 4154 4544 3a20 706c 6561 7365 2075 7365  ATED: please use
+00008b60: 2072 6561 645f 6669 6c65 2077 6974 6820   read_file with 
+00008b70: 6f70 7469 6f6e 2069 676e 6f72 655f 6765  option ignore_ge
+00008b80: 6f6d 6574 7279 3d54 7275 652e 0a20 2020  ometry=True..   
+00008b90: 2022 2222 0a20 2020 2077 6172 6e69 6e67   """.    warning
+00008ba0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+00008bb0: 2272 6561 645f 6669 6c65 5f6e 6f67 656f  "read_file_nogeo
+00008bc0: 6d20 6973 2064 6570 7265 6361 7465 643a  m is deprecated:
+00008bd0: 2075 7365 2072 6561 645f 6669 6c65 2077   use read_file w
+00008be0: 6974 6820 6967 6e6f 7265 5f67 656f 6d65  ith ignore_geome
+00008bf0: 7472 793d 5472 7565 222c 0a20 2020 2020  try=True",.     
+00008c00: 2020 2046 7574 7572 6557 6172 6e69 6e67     FutureWarning
+00008c10: 2c0a 2020 2020 2020 2020 7374 6163 6b6c  ,.        stackl
+00008c20: 6576 656c 3d32 2c0a 2020 2020 290a 2020  evel=2,.    ).  
+00008c30: 2020 7265 7375 6c74 5f67 6466 203d 205f    result_gdf = _
+00008c40: 7265 6164 5f66 696c 655f 6261 7365 280a  read_file_base(.
+00008c50: 2020 2020 2020 2020 7061 7468 3d70 6174          path=pat
+00008c60: 682c 0a20 2020 2020 2020 206c 6179 6572  h,.        layer
+00008c70: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
+00008c80: 636f 6c75 6d6e 733d 636f 6c75 6d6e 732c  columns=columns,
+00008c90: 0a20 2020 2020 2020 2062 626f 783d 6262  .        bbox=bb
+00008ca0: 6f78 2c0a 2020 2020 2020 2020 726f 7773  ox,.        rows
+00008cb0: 3d72 6f77 732c 0a20 2020 2020 2020 2073  =rows,.        s
+00008cc0: 716c 5f73 746d 743d 7371 6c5f 7374 6d74  ql_stmt=sql_stmt
+00008cd0: 2c0a 2020 2020 2020 2020 7371 6c5f 6469  ,.        sql_di
+00008ce0: 616c 6563 743d 7371 6c5f 6469 616c 6563  alect=sql_dialec
+00008cf0: 742c 0a20 2020 2020 2020 2069 676e 6f72  t,.        ignor
+00008d00: 655f 6765 6f6d 6574 7279 3d54 7275 652c  e_geometry=True,
+00008d10: 0a20 2020 2020 2020 2066 6964 5f61 735f  .        fid_as_
+00008d20: 696e 6465 783d 6669 645f 6173 5f69 6e64  index=fid_as_ind
+00008d30: 6578 2c0a 2020 2020 290a 2020 2020 6173  ex,.    ).    as
+00008d40: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+00008d50: 7265 7375 6c74 5f67 6466 2c20 7064 2e44  result_gdf, pd.D
+00008d60: 6174 6146 7261 6d65 290a 2020 2020 7265  ataFrame).    re
+00008d70: 7475 726e 2072 6573 756c 745f 6764 660a  turn result_gdf.
+00008d80: 0a0a 6465 6620 5f72 6561 645f 6669 6c65  ..def _read_file
+00008d90: 5f62 6173 6528 0a20 2020 2070 6174 683a  _base(.    path:
+00008da0: 2055 6e69 6f6e 5b73 7472 2c20 226f 732e   Union[str, "os.
+00008db0: 5061 7468 4c69 6b65 5b41 6e79 5d22 5d2c  PathLike[Any]"],
+00008dc0: 0a20 2020 206c 6179 6572 3a20 4f70 7469  .    layer: Opti
+00008dd0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00008de0: 2c0a 2020 2020 636f 6c75 6d6e 733a 204f  ,.    columns: O
+00008df0: 7074 696f 6e61 6c5b 4974 6572 6162 6c65  ptional[Iterable
+00008e00: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
+00008e10: 2020 2062 626f 783d 4e6f 6e65 2c0a 2020     bbox=None,.  
+00008e20: 2020 726f 7773 3d4e 6f6e 652c 0a20 2020    rows=None,.   
+00008e30: 2073 716c 5f73 746d 743a 204f 7074 696f   sql_stmt: Optio
+00008e40: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00008e50: 0a20 2020 2073 716c 5f64 6961 6c65 6374  .    sql_dialect
+00008e60: 3a20 4f70 7469 6f6e 616c 5b4c 6974 6572  : Optional[Liter
+00008e70: 616c 5b22 5351 4c49 5445 222c 2022 4f47  al["SQLITE", "OG
+00008e80: 5253 514c 225d 5d20 3d20 4e6f 6e65 2c0a  RSQL"]] = None,.
+00008e90: 2020 2020 6967 6e6f 7265 5f67 656f 6d65      ignore_geome
+00008ea0: 7472 793a 2062 6f6f 6c20 3d20 4661 6c73  try: bool = Fals
+00008eb0: 652c 0a20 2020 2066 6964 5f61 735f 696e  e,.    fid_as_in
+00008ec0: 6465 783a 2062 6f6f 6c20 3d20 4661 6c73  dex: bool = Fals
+00008ed0: 652c 0a29 202d 3e20 556e 696f 6e5b 7064  e,.) -> Union[pd
+00008ee0: 2e44 6174 6146 7261 6d65 2c20 6770 642e  .DataFrame, gpd.
+00008ef0: 4765 6f44 6174 6146 7261 6d65 5d3a 0a20  GeoDataFrame]:. 
+00008f00: 2020 2022 2222 0a20 2020 2052 6561 6473     """.    Reads
+00008f10: 2061 2066 696c 6520 746f 2061 2070 616e   a file to a pan
+00008f20: 6461 7320 4461 7461 6672 616d 652e 0a20  das Dataframe.. 
+00008f30: 2020 2022 2222 0a20 2020 2023 2043 6865     """.    # Che
+00008f40: 636b 2069 6620 7468 6520 6669 6420 636f  ck if the fid co
+00008f50: 6c75 6d6e 206e 6565 6473 2074 6f20 6265  lumn needs to be
+00008f60: 2072 6561 6420 6173 2063 6f6c 756d 6e20   read as column 
+00008f70: 7669 6120 7468 6520 636f 6c75 6d6e 7320  via the columns 
+00008f80: 7061 7261 6d65 7465 720a 2020 2020 6669  parameter.    fi
+00008f90: 645f 6173 5f63 6f6c 756d 6e20 3d20 4661  d_as_column = Fa
+00008fa0: 6c73 650a 2020 2020 6966 2063 6f6c 756d  lse.    if colum
+00008fb0: 6e73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ns is not None:.
+00008fc0: 2020 2020 2020 2020 6966 2022 6669 6422          if "fid"
+00008fd0: 2069 6e20 5b63 6f6c 756d 6e2e 6c6f 7765   in [column.lowe
+00008fe0: 7228 2920 666f 7220 636f 6c75 6d6e 2069  r() for column i
+00008ff0: 6e20 636f 6c75 6d6e 735d 3a0a 2020 2020  n columns]:.    
+00009000: 2020 2020 2020 2020 6669 645f 6173 5f63          fid_as_c
+00009010: 6f6c 756d 6e20 3d20 5472 7565 0a0a 2020  olumn = True..  
+00009020: 2020 2320 5265 6164 2077 6974 6820 7468    # Read with th
+00009030: 6520 656e 6769 6e65 2073 7065 6369 6669  e engine specifi
+00009040: 6564 0a20 2020 2065 6e67 696e 6520 3d20  ed.    engine = 
+00009050: 5f67 6574 5f65 6e67 696e 6528 290a 2020  _get_engine().  
+00009060: 2020 6966 2065 6e67 696e 6520 3d3d 2022    if engine == "
+00009070: 7079 6f67 7269 6f22 3a0a 2020 2020 2020  pyogrio":.      
+00009080: 2020 6764 6620 3d20 5f72 6561 645f 6669    gdf = _read_fi
+00009090: 6c65 5f62 6173 655f 7079 6f67 7269 6f28  le_base_pyogrio(
+000090a0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000090b0: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
+000090c0: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
+000090d0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+000090e0: 756d 6e73 3d63 6f6c 756d 6e73 2c0a 2020  umns=columns,.  
+000090f0: 2020 2020 2020 2020 2020 6262 6f78 3d62            bbox=b
+00009100: 626f 782c 0a20 2020 2020 2020 2020 2020  box,.           
+00009110: 2072 6f77 733d 726f 7773 2c0a 2020 2020   rows=rows,.    
+00009120: 2020 2020 2020 2020 7371 6c5f 7374 6d74          sql_stmt
+00009130: 3d73 716c 5f73 746d 742c 0a20 2020 2020  =sql_stmt,.     
+00009140: 2020 2020 2020 2073 716c 5f64 6961 6c65         sql_diale
+00009150: 6374 3d73 716c 5f64 6961 6c65 6374 2c0a  ct=sql_dialect,.
+00009160: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+00009170: 7265 5f67 656f 6d65 7472 793d 6967 6e6f  re_geometry=igno
+00009180: 7265 5f67 656f 6d65 7472 792c 0a20 2020  re_geometry,.   
+00009190: 2020 2020 2020 2020 2066 6964 5f61 735f           fid_as_
+000091a0: 696e 6465 783d 6669 645f 6173 5f69 6e64  index=fid_as_ind
+000091b0: 6578 206f 7220 6669 645f 6173 5f63 6f6c  ex or fid_as_col
+000091c0: 756d 6e2c 0a20 2020 2020 2020 2029 0a20  umn,.        ). 
+000091d0: 2020 2065 6c69 6620 656e 6769 6e65 203d     elif engine =
+000091e0: 3d20 2266 696f 6e61 223a 0a20 2020 2020  = "fiona":.     
+000091f0: 2020 2067 6466 203d 205f 7265 6164 5f66     gdf = _read_f
+00009200: 696c 655f 6261 7365 5f66 696f 6e61 280a  ile_base_fiona(.
+00009210: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00009220: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
+00009230: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
+00009240: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00009250: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
+00009260: 2020 2020 2020 2020 2062 626f 783d 6262           bbox=bb
+00009270: 6f78 2c0a 2020 2020 2020 2020 2020 2020  ox,.            
+00009280: 726f 7773 3d72 6f77 732c 0a20 2020 2020  rows=rows,.     
+00009290: 2020 2020 2020 2073 716c 5f73 746d 743d         sql_stmt=
+000092a0: 7371 6c5f 7374 6d74 2c0a 2020 2020 2020  sql_stmt,.      
+000092b0: 2020 2020 2020 7371 6c5f 6469 616c 6563        sql_dialec
+000092c0: 743d 7371 6c5f 6469 616c 6563 742c 0a20  t=sql_dialect,. 
+000092d0: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+000092e0: 655f 6765 6f6d 6574 7279 3d69 676e 6f72  e_geometry=ignor
+000092f0: 655f 6765 6f6d 6574 7279 2c0a 2020 2020  e_geometry,.    
+00009300: 2020 2020 2020 2020 6669 645f 6173 5f69          fid_as_i
+00009310: 6e64 6578 3d66 6964 5f61 735f 696e 6465  ndex=fid_as_inde
+00009320: 7820 6f72 2066 6964 5f61 735f 636f 6c75  x or fid_as_colu
+00009330: 6d6e 2c0a 2020 2020 2020 2020 290a 2020  mn,.        ).  
+00009340: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00009350: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00009360: 2866 2255 6e73 7570 706f 7274 6564 2065  (f"Unsupported e
+00009370: 6e67 696e 653a 207b 656e 6769 6e65 7d22  ngine: {engine}"
+00009380: 290a 0a20 2020 2023 2043 6f70 7920 7468  )..    # Copy th
+00009390: 6520 696e 6465 7820 746f 2061 2063 6f6c  e index to a col
+000093a0: 756d 6e20 6966 206e 6565 6465 642e 2e2e  umn if needed...
+000093b0: 0a20 2020 2069 6620 6669 645f 6173 5f63  .    if fid_as_c
+000093c0: 6f6c 756d 6e3a 0a20 2020 2020 2020 2067  olumn:.        g
+000093d0: 6466 5b22 6669 6422 5d20 3d20 6764 662e  df["fid"] = gdf.
+000093e0: 696e 6465 780a 2020 2020 2020 2020 6966  index.        if
+000093f0: 206e 6f74 2066 6964 5f61 735f 696e 6465   not fid_as_inde
+00009400: 783a 0a20 2020 2020 2020 2020 2020 2067  x:.            g
+00009410: 6466 203d 2067 6466 2e72 6573 6574 5f69  df = gdf.reset_i
+00009420: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
+00009430: 0a20 2020 2072 6574 7572 6e20 6764 660a  .    return gdf.
+00009440: 0a0a 6465 6620 5f72 6561 645f 6669 6c65  ..def _read_file
+00009450: 5f62 6173 655f 6669 6f6e 6128 0a20 2020  _base_fiona(.   
+00009460: 2070 6174 683a 2055 6e69 6f6e 5b73 7472   path: Union[str
+00009470: 2c20 226f 732e 5061 7468 4c69 6b65 5b41  , "os.PathLike[A
+00009480: 6e79 5d22 5d2c 0a20 2020 206c 6179 6572  ny]"],.    layer
+00009490: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+000094a0: 3d20 4e6f 6e65 2c0a 2020 2020 636f 6c75  = None,.    colu
+000094b0: 6d6e 733a 204f 7074 696f 6e61 6c5b 4974  mns: Optional[It
+000094c0: 6572 6162 6c65 5b73 7472 5d5d 203d 204e  erable[str]] = N
+000094d0: 6f6e 652c 0a20 2020 2062 626f 783d 4e6f  one,.    bbox=No
+000094e0: 6e65 2c0a 2020 2020 726f 7773 3d4e 6f6e  ne,.    rows=Non
+000094f0: 652c 0a20 2020 2073 716c 5f73 746d 743a  e,.    sql_stmt:
+00009500: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00009510: 204e 6f6e 652c 0a20 2020 2073 716c 5f64   None,.    sql_d
+00009520: 6961 6c65 6374 3a20 4f70 7469 6f6e 616c  ialect: Optional
+00009530: 5b4c 6974 6572 616c 5b22 5351 4c49 5445  [Literal["SQLITE
+00009540: 222c 2022 4f47 5253 514c 225d 5d20 3d20  ", "OGRSQL"]] = 
+00009550: 4e6f 6e65 2c0a 2020 2020 6967 6e6f 7265  None,.    ignore
+00009560: 5f67 656f 6d65 7472 793a 2062 6f6f 6c20  _geometry: bool 
+00009570: 3d20 4661 6c73 652c 0a20 2020 2066 6964  = False,.    fid
+00009580: 5f61 735f 696e 6465 783a 2062 6f6f 6c20  _as_index: bool 
+00009590: 3d20 4661 6c73 652c 0a29 202d 3e20 556e  = False,.) -> Un
+000095a0: 696f 6e5b 7064 2e44 6174 6146 7261 6d65  ion[pd.DataFrame
+000095b0: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
+000095c0: 6d65 5d3a 0a20 2020 2022 2222 0a20 2020  me]:.    """.   
+000095d0: 2052 6561 6473 2061 2066 696c 6520 746f   Reads a file to
+000095e0: 2061 2070 616e 6461 7320 4461 7461 6672   a pandas Datafr
+000095f0: 616d 6520 7573 696e 6720 6669 6f6e 612e  ame using fiona.
+00009600: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00009610: 6967 6e6f 7265 5f67 656f 6d65 7472 7920  ignore_geometry 
+00009620: 616e 6420 636f 6c75 6d6e 7320 3d3d 205b  and columns == [
+00009630: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+00009640: 6e20 7064 2e44 6174 6146 7261 6d65 2829  n pd.DataFrame()
+00009650: 0a20 2020 2069 6620 7371 6c5f 7374 6d74  .    if sql_stmt
+00009660: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00009670: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00009680: 6545 7272 6f72 2822 7371 6c5f 7374 6d74  eError("sql_stmt
+00009690: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
+000096a0: 6420 7769 7468 2066 696f 6e61 2065 6e67  d with fiona eng
+000096b0: 696e 6522 290a 0a20 2020 2023 2049 6e69  ine")..    # Ini
+000096c0: 740a 2020 2020 7061 7468 203d 2050 6174  t.    path = Pat
+000096d0: 6828 7061 7468 290a 2020 2020 6966 2070  h(path).    if p
+000096e0: 6174 682e 6578 6973 7473 2829 2069 7320  ath.exists() is 
+000096f0: 4661 6c73 653a 0a20 2020 2020 2020 2072  False:.        r
+00009700: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00009710: 6622 6669 6c65 2064 6f65 736e 2774 2065  f"file doesn't e
+00009720: 7869 7374 3a20 7b70 6174 687d 2229 0a0a  xist: {path}")..
+00009730: 2020 2020 2320 4966 206e 6f20 6c61 7965      # If no laye
+00009740: 7220 6e61 6d65 2073 7065 6369 6669 6564  r name specified
+00009750: 2c20 6368 6563 6b20 6966 2074 6865 7265  , check if there
+00009760: 2069 7320 6f6e 6c79 206f 6e65 206c 6179   is only one lay
+00009770: 6572 2069 6e20 7468 6520 6669 6c65 2e0a  er in the file..
+00009780: 2020 2020 6966 206c 6179 6572 2069 7320      if layer is 
+00009790: 4e6f 6e65 3a0a 2020 2020 2020 2020 6c61  None:.        la
+000097a0: 7965 7220 3d20 6765 745f 6f6e 6c79 5f6c  yer = get_only_l
+000097b0: 6179 6572 2870 6174 6829 0a0a 2020 2020  ayer(path)..    
+000097c0: 2320 5645 5259 2044 4952 5459 2068 6163  # VERY DIRTY hac
+000097d0: 6b20 746f 2067 6574 2074 6865 2066 6964  k to get the fid
+000097e0: 0a20 2020 2069 6620 6669 645f 6173 5f69  .    if fid_as_i
+000097f0: 6e64 6578 3a0a 2020 2020 2020 2020 2320  ndex:.        # 
+00009800: 4d61 6b65 2061 2063 6f70 792f 636f 7079  Make a copy/copy
+00009810: 2069 6e70 7574 2066 696c 6520 746f 2067   input file to g
+00009820: 656f 7061 636b 6167 652c 2061 7320 7765  eopackage, as we
+00009830: 2077 696c 6c20 6164 6420 616e 2066 6964   will add an fid
+00009840: 2f72 6f77 6420 636f 6c75 6d6e 0a20 2020  /rowd column.   
+00009850: 2020 2020 2074 6d70 5f66 6964 5f70 6174       tmp_fid_pat
+00009860: 6820 3d20 5061 7468 2874 656d 7066 696c  h = Path(tempfil
+00009870: 652e 6d6b 6474 656d 7028 2929 202f 2066  e.mkdtemp()) / f
+00009880: 227b 7061 7468 2e73 7465 6d7d 2e67 706b  "{path.stem}.gpk
+00009890: 6722 0a20 2020 2020 2020 2074 7279 3a0a  g".        try:.
+000098a0: 2020 2020 2020 2020 2020 2020 6966 2047              if G
+000098b0: 656f 6669 6c65 5479 7065 2870 6174 6829  eofileType(path)
+000098c0: 203d 3d20 4765 6f66 696c 6554 7970 652e   == GeofileType.
+000098d0: 4750 4b47 3a0a 2020 2020 2020 2020 2020  GPKG:.          
+000098e0: 2020 2020 2020 636f 7079 2870 6174 682c        copy(path,
+000098f0: 2074 6d70 5f66 6964 5f70 6174 6829 0a20   tmp_fid_path). 
+00009900: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00009910: 6464 5f63 6f6c 756d 6e28 746d 705f 6669  dd_column(tmp_fi
+00009920: 645f 7061 7468 2c20 225f 5f54 4d50 5f47  d_path, "__TMP_G
+00009930: 454f 4649 4c45 4f50 535f 4649 4422 2c20  EOFILEOPS_FID", 
+00009940: 2249 4e54 4547 4552 222c 2022 6669 6422  "INTEGER", "fid"
+00009950: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00009960: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00009970: 2020 2020 636f 7079 5f6c 6179 6572 2870      copy_layer(p
+00009980: 6174 682c 2074 6d70 5f66 6964 5f70 6174  ath, tmp_fid_pat
+00009990: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+000099a0: 2020 2023 2066 6964 2069 6e20 7368 6170     # fid in shap
+000099b0: 6566 696c 6520 6973 2030 2062 6173 6564  efile is 0 based
+000099c0: 2c20 736f 2066 6964 2d31 0a20 2020 2020  , so fid-1.     
+000099d0: 2020 2020 2020 2020 2020 2061 6464 5f63             add_c
+000099e0: 6f6c 756d 6e28 746d 705f 6669 645f 7061  olumn(tmp_fid_pa
+000099f0: 7468 2c20 225f 5f54 4d50 5f47 454f 4649  th, "__TMP_GEOFI
+00009a00: 4c45 4f50 535f 4649 4422 2c20 2249 4e54  LEOPS_FID", "INT
+00009a10: 4547 4552 222c 2022 6669 642d 3122 290a  EGER", "fid-1").
+00009a20: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00009a30: 6820 3d20 746d 705f 6669 645f 7061 7468  h = tmp_fid_path
+00009a40: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+00009a50: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00009a60: 2074 6d70 5f66 6964 5f70 6174 682e 7061   tmp_fid_path.pa
+00009a70: 7265 6e74 2e65 7869 7374 7328 293a 0a20  rent.exists():. 
+00009a80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009a90: 6875 7469 6c2e 726d 7472 6565 2874 6d70  hutil.rmtree(tmp
+00009aa0: 5f66 6964 5f70 6174 682c 2069 676e 6f72  _fid_path, ignor
+00009ab0: 655f 6572 726f 7273 3d54 7275 6529 0a0a  e_errors=True)..
+00009ac0: 2020 2020 2320 4368 6563 6b69 6e67 2069      # Checking i
+00009ad0: 6620 6669 656c 642f 636f 6c75 6d6e 206e  f field/column n
+00009ae0: 616d 6573 2073 686f 756c 6420 6265 2072  ames should be r
+00009af0: 6561 6420 6973 2063 6173 6520 7365 6e73  ead is case sens
+00009b00: 6974 6976 6520 696e 2066 696f 6e61 2c20  itive in fiona, 
+00009b10: 736f 0a20 2020 2023 206d 616b 6520 7375  so.    # make su
+00009b20: 7265 2074 6865 2063 6f6c 756d 6e20 6e61  re the column na
+00009b30: 6d65 7320 7370 6563 6966 6965 6420 6861  mes specified ha
+00009b40: 7665 2074 6865 2073 616d 6520 6361 7369  ve the same casi
+00009b50: 6e67 2e0a 2020 2020 636f 6c75 6d6e 735f  ng..    columns_
+00009b60: 7072 6570 6172 6564 203d 204e 6f6e 650a  prepared = None.
+00009b70: 2020 2020 6966 2063 6f6c 756d 6e73 2069      if columns i
+00009b80: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00009b90: 2020 2020 6c61 7965 7269 6e66 6f20 3d20      layerinfo = 
+00009ba0: 6765 745f 6c61 7965 7269 6e66 6f28 7061  get_layerinfo(pa
+00009bb0: 7468 2c20 6c61 7965 723d 6c61 7965 7229  th, layer=layer)
+00009bc0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
+00009bd0: 5f75 7070 6572 5f6c 6f6f 6b75 7020 3d20  _upper_lookup = 
+00009be0: 7b63 6f6c 756d 6e2e 7570 7065 7228 293a  {column.upper():
+00009bf0: 2063 6f6c 756d 6e20 666f 7220 636f 6c75   column for colu
+00009c00: 6d6e 2069 6e20 636f 6c75 6d6e 737d 0a20  mn in columns}. 
+00009c10: 2020 2020 2020 2063 6f6c 756d 6e73 5f70         columns_p
+00009c20: 7265 7061 7265 6420 3d20 7b0a 2020 2020  repared = {.    
+00009c30: 2020 2020 2020 2020 636f 6c75 6d6e 3a20          column: 
+00009c40: 636f 6c75 6d6e 735f 7570 7065 725f 6c6f  columns_upper_lo
+00009c50: 6f6b 7570 5b63 6f6c 756d 6e2e 7570 7065  okup[column.uppe
+00009c60: 7228 295d 0a20 2020 2020 2020 2020 2020  r()].           
+00009c70: 2066 6f72 2063 6f6c 756d 6e20 696e 206c   for column in l
+00009c80: 6179 6572 696e 666f 2e63 6f6c 756d 6e73  ayerinfo.columns
+00009c90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009ca0: 636f 6c75 6d6e 2e75 7070 6572 2829 2069  column.upper() i
+00009cb0: 6e20 636f 6c75 6d6e 735f 7570 7065 725f  n columns_upper_
+00009cc0: 6c6f 6f6b 7570 0a20 2020 2020 2020 207d  lookup.        }
+00009cd0: 0a0a 2020 2020 2320 5265 6164 2e2e 2e0a  ..    # Read....
+00009ce0: 2020 2020 636f 6c75 6d6e 735f 6c69 7374      columns_list
+00009cf0: 203d 204e 6f6e 6520 6966 2063 6f6c 756d   = None if colum
+00009d00: 6e73 5f70 7265 7061 7265 6420 6973 204e  ns_prepared is N
+00009d10: 6f6e 6520 656c 7365 206c 6973 7428 636f  one else list(co
+00009d20: 6c75 6d6e 735f 7072 6570 6172 6564 290a  lumns_prepared).
+00009d30: 2020 2020 7265 7375 6c74 5f67 6466 203d      result_gdf =
+00009d40: 2067 7064 2e72 6561 645f 6669 6c65 280a   gpd.read_file(.
+00009d50: 2020 2020 2020 2020 7374 7228 7061 7468          str(path
+00009d60: 292c 0a20 2020 2020 2020 206c 6179 6572  ),.        layer
+00009d70: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
+00009d80: 6262 6f78 3d62 626f 782c 0a20 2020 2020  bbox=bbox,.     
+00009d90: 2020 2072 6f77 733d 726f 7773 2c0a 2020     rows=rows,.  
+00009da0: 2020 2020 2020 696e 636c 7564 655f 6669        include_fi
+00009db0: 656c 6473 3d63 6f6c 756d 6e73 5f6c 6973  elds=columns_lis
+00009dc0: 742c 0a20 2020 2020 2020 2073 716c 3d73  t,.        sql=s
+00009dd0: 716c 5f73 746d 742c 0a20 2020 2020 2020  ql_stmt,.       
+00009de0: 2073 716c 5f64 6961 6c65 6374 3d73 716c   sql_dialect=sql
+00009df0: 5f64 6961 6c65 6374 2c0a 2020 2020 2020  _dialect,.      
+00009e00: 2020 6967 6e6f 7265 5f67 656f 6d65 7472    ignore_geometr
+00009e10: 793d 6967 6e6f 7265 5f67 656f 6d65 7472  y=ignore_geometr
+00009e20: 792c 0a20 2020 2029 0a0a 2020 2020 2320  y,.    )..    # 
+00009e30: 5365 7420 7468 6520 696e 6465 7820 746f  Set the index to
+00009e40: 2074 6865 2062 6163 6b65 642d 7570 2066   the backed-up f
+00009e50: 6964 0a20 2020 2069 6620 6669 645f 6173  id.    if fid_as
+00009e60: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
+00009e70: 7265 7375 6c74 5f67 6466 203d 2072 6573  result_gdf = res
+00009e80: 756c 745f 6764 662e 7365 745f 696e 6465  ult_gdf.set_inde
+00009e90: 7828 225f 5f54 4d50 5f47 454f 4649 4c45  x("__TMP_GEOFILE
+00009ea0: 4f50 535f 4649 4422 290a 0a20 2020 2023  OPS_FID")..    #
+00009eb0: 2052 656f 7264 6572 2063 6f6c 756d 6e73   Reorder columns
+00009ec0: 202b 2063 6861 6e67 6520 6361 7369 6e67   + change casing
+00009ed0: 2073 6f20 7468 6579 2061 7265 2074 6865   so they are the
+00009ee0: 2073 616d 6520 6173 2063 6f6c 756d 6e73   same as columns
+00009ef0: 2070 6172 616d 6574 6572 0a20 2020 2069   parameter.    i
+00009f00: 6620 636f 6c75 6d6e 735f 7072 6570 6172  f columns_prepar
+00009f10: 6564 2069 7320 6e6f 7420 4e6f 6e65 2061  ed is not None a
+00009f20: 6e64 206c 656e 2863 6f6c 756d 6e73 5f70  nd len(columns_p
+00009f30: 7265 7061 7265 6429 203e 2030 3a0a 2020  repared) > 0:.  
+00009f40: 2020 2020 2020 7265 7375 6c74 5f67 6466        result_gdf
+00009f50: 203d 2072 6573 756c 745f 6764 665b 6c69   = result_gdf[li
+00009f60: 7374 2863 6f6c 756d 6e73 5f70 7265 7061  st(columns_prepa
+00009f70: 7265 6429 202b 205b 2267 656f 6d65 7472  red) + ["geometr
+00009f80: 7922 5d5d 0a20 2020 2020 2020 2072 6573  y"]].        res
+00009f90: 756c 745f 6764 6620 3d20 7265 7375 6c74  ult_gdf = result
+00009fa0: 5f67 6466 2e72 656e 616d 6528 636f 6c75  _gdf.rename(colu
+00009fb0: 6d6e 733d 636f 6c75 6d6e 735f 7072 6570  mns=columns_prep
+00009fc0: 6172 6564 290a 0a20 2020 2023 2053 7461  ared)..    # Sta
+00009fd0: 7274 696e 6720 6672 6f6d 2066 696f 6e61  rting from fiona
+00009fe0: 2031 2e39 2c20 7374 7269 6e67 2063 6f6c   1.9, string col
+00009ff0: 756d 6e73 2077 6974 6820 616c 6c20 4e6f  umns with all No
+0000a000: 6e65 2076 616c 7565 7320 6172 6520 7265  ne values are re
+0000a010: 6164 2061 7320 6265 696e 670a 2020 2020  ad as being.    
+0000a020: 2320 666c 6f61 7420 636f 6c75 6d6e 732e  # float columns.
+0000a030: 2043 6f6e 7665 7274 2074 6865 6d20 746f   Convert them to
+0000a040: 206f 626a 6563 7420 7479 7065 2e0a 2020   object type..  
+0000a050: 2020 666c 6f61 745f 636f 6c73 203d 206c    float_cols = l
+0000a060: 6973 7428 7265 7375 6c74 5f67 6466 2e73  ist(result_gdf.s
+0000a070: 656c 6563 745f 6474 7970 6573 285b 2266  elect_dtypes(["f
+0000a080: 6c6f 6174 3634 225d 292e 636f 6c75 6d6e  loat64"]).column
+0000a090: 7329 0a20 2020 2069 6620 6c65 6e28 666c  s).    if len(fl
+0000a0a0: 6f61 745f 636f 6c73 2920 3e20 303a 0a20  oat_cols) > 0:. 
+0000a0b0: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+0000a0c0: 6f72 2061 6c6c 2066 6c6f 6174 2063 6f6c  or all float col
+0000a0d0: 756d 6e73 2066 6f75 6e64 2069 6620 7468  umns found if th
+0000a0e0: 6579 2073 686f 756c 6420 6265 206f 626a  ey should be obj
+0000a0f0: 6563 7420 636f 6c75 6d6e 7320 696e 7374  ect columns inst
+0000a100: 6561 640a 2020 2020 2020 2020 7769 7468  ead.        with
+0000a110: 2066 696f 6e61 2e6f 7065 6e28 7061 7468   fiona.open(path
+0000a120: 2c20 6c61 7965 723d 6c61 7965 7229 2061  , layer=layer) a
+0000a130: 7320 636f 6c6c 6563 7469 6f6e 3a0a 2020  s collection:.  
+0000a140: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000a150: 2063 6f6c 6c65 6374 696f 6e2e 7363 6865   collection.sche
+0000a160: 6d61 2069 7320 6e6f 7420 4e6f 6e65 0a20  ma is not None. 
+0000a170: 2020 2020 2020 2020 2020 2070 726f 7065             prope
+0000a180: 7274 6965 7320 3d20 636f 6c6c 6563 7469  rties = collecti
+0000a190: 6f6e 2e73 6368 656d 615b 2270 726f 7065  on.schema["prope
+0000a1a0: 7274 6965 7322 5d0a 2020 2020 2020 2020  rties"].        
+0000a1b0: 2020 2020 666f 7220 636f 6c20 696e 2066      for col in f
+0000a1c0: 6c6f 6174 5f63 6f6c 733a 0a20 2020 2020  loat_cols:.     
+0000a1d0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+0000a1e0: 6c20 696e 2070 726f 7065 7274 6965 7320  l in properties 
+0000a1f0: 616e 6420 7072 6f70 6572 7469 6573 5b63  and properties[c
+0000a200: 6f6c 5d2e 7374 6172 7473 7769 7468 2822  ol].startswith("
+0000a210: 7374 7222 293a 0a20 2020 2020 2020 2020  str"):.         
+0000a220: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000a230: 745f 6764 665b 636f 6c5d 203d 2028 0a20  t_gdf[col] = (. 
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a250: 2020 2020 2020 2072 6573 756c 745f 6764         result_gd
+0000a260: 665b 636f 6c5d 2e61 7374 7970 6528 6f62  f[col].astype(ob
+0000a270: 6a65 6374 292e 7265 706c 6163 6528 6e70  ject).replace(np
+0000a280: 2e6e 616e 2c20 4e6f 6e65 290a 2020 2020  .nan, None).    
+0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2a0: 290a 0a20 2020 2023 2061 7373 6572 7420  )..    # assert 
+0000a2b0: 746f 2065 7661 6465 2070 794c 616e 6365  to evade pyLance
+0000a2c0: 2077 6172 6e69 6e67 0a20 2020 2061 7373   warning.    ass
+0000a2d0: 6572 7420 6973 696e 7374 616e 6365 2872  ert isinstance(r
+0000a2e0: 6573 756c 745f 6764 662c 2028 6770 642e  esult_gdf, (gpd.
+0000a2f0: 4765 6f44 6174 6146 7261 6d65 2c20 7064  GeoDataFrame, pd
+0000a300: 2e44 6174 6146 7261 6d65 2929 0a20 2020  .DataFrame)).   
+0000a310: 2072 6574 7572 6e20 7265 7375 6c74 5f67   return result_g
+0000a320: 6466 0a0a 0a64 6566 205f 7265 6164 5f66  df...def _read_f
+0000a330: 696c 655f 6261 7365 5f70 796f 6772 696f  ile_base_pyogrio
+0000a340: 280a 2020 2020 7061 7468 3a20 556e 696f  (.    path: Unio
+0000a350: 6e5b 7374 722c 2022 6f73 2e50 6174 684c  n[str, "os.PathL
+0000a360: 696b 655b 416e 795d 225d 2c0a 2020 2020  ike[Any]"],.    
+0000a370: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
+0000a380: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+0000a390: 2063 6f6c 756d 6e73 3a20 4f70 7469 6f6e   columns: Option
+0000a3a0: 616c 5b49 7465 7261 626c 655b 7374 725d  al[Iterable[str]
+0000a3b0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 6262  ] = None,.    bb
+0000a3c0: 6f78 3d4e 6f6e 652c 0a20 2020 2072 6f77  ox=None,.    row
+0000a3d0: 733d 4e6f 6e65 2c0a 2020 2020 7371 6c5f  s=None,.    sql_
+0000a3e0: 7374 6d74 3a20 4f70 7469 6f6e 616c 5b73  stmt: Optional[s
+0000a3f0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+0000a400: 7371 6c5f 6469 616c 6563 743a 204f 7074  sql_dialect: Opt
+0000a410: 696f 6e61 6c5b 4c69 7465 7261 6c5b 2253  ional[Literal["S
+0000a420: 514c 4954 4522 2c20 224f 4752 5351 4c22  QLITE", "OGRSQL"
+0000a430: 5d5d 203d 204e 6f6e 652c 0a20 2020 2069  ]] = None,.    i
+0000a440: 676e 6f72 655f 6765 6f6d 6574 7279 3a20  gnore_geometry: 
+0000a450: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0000a460: 2020 6669 645f 6173 5f69 6e64 6578 3a20    fid_as_index: 
+0000a470: 626f 6f6c 203d 2046 616c 7365 2c0a 2920  bool = False,.) 
+0000a480: 2d3e 2055 6e69 6f6e 5b70 642e 4461 7461  -> Union[pd.Data
+0000a490: 4672 616d 652c 2067 7064 2e47 656f 4461  Frame, gpd.GeoDa
+0000a4a0: 7461 4672 616d 655d 3a0a 2020 2020 2222  taFrame]:.    ""
+0000a4b0: 220a 2020 2020 5265 6164 7320 6120 6669  ".    Reads a fi
+0000a4c0: 6c65 2074 6f20 6120 7061 6e64 6173 2044  le to a pandas D
+0000a4d0: 6174 6166 7261 6d65 2075 7369 6e67 2070  ataframe using p
+0000a4e0: 796f 6772 696f 2e0a 2020 2020 2222 220a  yogrio..    """.
+0000a4f0: 2020 2020 2320 496e 6974 0a20 2020 2070      # Init.    p
+0000a500: 6174 6820 3d20 5061 7468 2870 6174 6829  ath = Path(path)
+0000a510: 0a20 2020 2069 6620 7061 7468 2e65 7869  .    if path.exi
+0000a520: 7374 7328 2920 6973 2046 616c 7365 3a0a  sts() is False:.
+0000a530: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000a540: 6c75 6545 7272 6f72 2866 2266 696c 6520  lueError(f"file 
+0000a550: 646f 6573 6e27 7420 6578 6973 743a 207b  doesn't exist: {
+0000a560: 7061 7468 7d22 290a 0a20 2020 2023 2043  path}")..    # C
+0000a570: 6f6e 7665 7274 2073 6c69 6365 206f 626a  onvert slice obj
+0000a580: 6563 7420 746f 2070 796f 6772 696f 2070  ect to pyogrio p
+0000a590: 6172 616d 6574 6572 730a 2020 2020 6966  arameters.    if
+0000a5a0: 2072 6f77 7320 6973 206e 6f74 204e 6f6e   rows is not Non
+0000a5b0: 653a 0a20 2020 2020 2020 2073 6b69 705f  e:.        skip_
+0000a5c0: 6665 6174 7572 6573 203d 2072 6f77 732e  features = rows.
+0000a5d0: 7374 6172 740a 2020 2020 2020 2020 6d61  start.        ma
+0000a5e0: 785f 6665 6174 7572 6573 203d 2072 6f77  x_features = row
+0000a5f0: 732e 7374 6f70 202d 2072 6f77 732e 7374  s.stop - rows.st
+0000a600: 6172 740a 2020 2020 656c 7365 3a0a 2020  art.    else:.  
+0000a610: 2020 2020 2020 736b 6970 5f66 6561 7475        skip_featu
+0000a620: 7265 7320 3d20 300a 2020 2020 2020 2020  res = 0.        
+0000a630: 6d61 785f 6665 6174 7572 6573 203d 204e  max_features = N
+0000a640: 6f6e 650a 0a20 2020 2023 2049 6620 6e6f  one..    # If no
+0000a650: 2073 716c 5f73 746d 7420 7370 6563 6966   sql_stmt specif
+0000a660: 6965 640a 2020 2020 636f 6c75 6d6e 735f  ied.    columns_
+0000a670: 7072 6570 6172 6564 203d 204e 6f6e 650a  prepared = None.
+0000a680: 2020 2020 6966 2073 716c 5f73 746d 7420      if sql_stmt 
+0000a690: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000a6a0: 2023 2049 6620 6e6f 206c 6179 6572 2073   # If no layer s
+0000a6b0: 7065 6369 6669 6564 2c20 7468 6572 6520  pecified, there 
+0000a6c0: 7368 6f75 6c64 2062 6520 6f6e 6c79 206f  should be only o
+0000a6d0: 6e65 206c 6179 6572 2069 6e20 7468 6520  ne layer in the 
+0000a6e0: 6669 6c65 2e0a 2020 2020 2020 2020 6966  file..        if
+0000a6f0: 206c 6179 6572 2069 7320 4e6f 6e65 3a0a   layer is None:.
+0000a700: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000a710: 7220 3d20 6765 745f 6f6e 6c79 5f6c 6179  r = get_only_lay
+0000a720: 6572 2870 6174 6829 0a0a 2020 2020 2020  er(path)..      
+0000a730: 2020 2320 4368 6563 6b69 6e67 2069 6620    # Checking if 
+0000a740: 636f 6c75 6d6e 206e 616d 6573 2073 686f  column names sho
+0000a750: 756c 6420 6265 2072 6561 6420 6973 2063  uld be read is c
+0000a760: 6173 6520 7365 6e73 6974 6976 6520 696e  ase sensitive in
+0000a770: 2070 796f 6772 696f 2c20 736f 0a20 2020   pyogrio, so.   
+0000a780: 2020 2020 2023 206d 616b 6520 7375 7265       # make sure
+0000a790: 2074 6865 2063 6f6c 756d 6e20 6e61 6d65   the column name
+0000a7a0: 7320 7370 6563 6966 6965 6420 6861 7665  s specified have
+0000a7b0: 2074 6865 2073 616d 6520 6361 7369 6e67   the same casing
+0000a7c0: 2e0a 2020 2020 2020 2020 6966 2063 6f6c  ..        if col
+0000a7d0: 756d 6e73 2069 7320 6e6f 7420 4e6f 6e65  umns is not None
+0000a7e0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+0000a7f0: 7965 7269 6e66 6f20 3d20 6765 745f 6c61  yerinfo = get_la
+0000a800: 7965 7269 6e66 6f28 7061 7468 2c20 6c61  yerinfo(path, la
+0000a810: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+0000a820: 2020 2020 2020 2063 6f6c 756d 6e73 5f75         columns_u
+0000a830: 7070 6572 5f6c 6f6f 6b75 7020 3d20 7b63  pper_lookup = {c
+0000a840: 6f6c 756d 6e2e 7570 7065 7228 293a 2063  olumn.upper(): c
+0000a850: 6f6c 756d 6e20 666f 7220 636f 6c75 6d6e  olumn for column
+0000a860: 2069 6e20 636f 6c75 6d6e 737d 0a20 2020   in columns}.   
+0000a870: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+0000a880: 5f70 7265 7061 7265 6420 3d20 7b0a 2020  _prepared = {.  
+0000a890: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000a8a0: 6c75 6d6e 3a20 636f 6c75 6d6e 735f 7570  lumn: columns_up
+0000a8b0: 7065 725f 6c6f 6f6b 7570 5b63 6f6c 756d  per_lookup[colum
+0000a8c0: 6e2e 7570 7065 7228 295d 0a20 2020 2020  n.upper()].     
+0000a8d0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+0000a8e0: 6f6c 756d 6e20 696e 206c 6179 6572 696e  olumn in layerin
+0000a8f0: 666f 2e63 6f6c 756d 6e73 0a20 2020 2020  fo.columns.     
+0000a900: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+0000a910: 6c75 6d6e 2e75 7070 6572 2829 2069 6e20  lumn.upper() in 
+0000a920: 636f 6c75 6d6e 735f 7570 7065 725f 6c6f  columns_upper_lo
+0000a930: 6f6b 7570 0a20 2020 2020 2020 2020 2020  okup.           
+0000a940: 207d 0a20 2020 2065 6c73 653a 0a20 2020   }.    else:.   
+0000a950: 2020 2020 2023 2046 696c 6c20 6f75 7420       # Fill out 
+0000a960: 706c 6163 6568 6f6c 6465 7273 2c20 6b65  placeholders, ke
+0000a970: 6570 2063 6f6c 756d 6e73 5f70 7265 7061  ep columns_prepa
+0000a980: 7265 6420 4e6f 6e65 2062 6563 6175 7365  red None because
+0000a990: 2063 6f6c 756d 6e20 6669 6c74 6572 696e   column filterin
+0000a9a0: 670a 2020 2020 2020 2020 2320 7368 6f75  g.        # shou
+0000a9b0: 6c64 2068 6170 7065 6e20 696e 2073 716c  ld happen in sql
+0000a9c0: 5f73 746d 742e 0a20 2020 2020 2020 2073  _stmt..        s
+0000a9d0: 716c 5f73 746d 7420 3d20 5f66 696c 6c5f  ql_stmt = _fill_
+0000a9e0: 6f75 745f 7371 6c5f 706c 6163 6568 6f6c  out_sql_placehol
+0000a9f0: 6465 7273 280a 2020 2020 2020 2020 2020  ders(.          
+0000aa00: 2020 7061 7468 3d70 6174 682c 206c 6179    path=path, lay
+0000aa10: 6572 3d6c 6179 6572 2c20 7371 6c5f 7374  er=layer, sql_st
+0000aa20: 6d74 3d73 716c 5f73 746d 742c 2063 6f6c  mt=sql_stmt, col
+0000aa30: 756d 6e73 3d63 6f6c 756d 6e73 0a20 2020  umns=columns.   
+0000aa40: 2020 2020 2029 0a0a 2020 2020 2320 5265       )..    # Re
+0000aa50: 6164 210a 2020 2020 636f 6c75 6d6e 735f  ad!.    columns_
+0000aa60: 6c69 7374 203d 204e 6f6e 6520 6966 2063  list = None if c
+0000aa70: 6f6c 756d 6e73 5f70 7265 7061 7265 6420  olumns_prepared 
+0000aa80: 6973 204e 6f6e 6520 656c 7365 206c 6973  is None else lis
+0000aa90: 7428 636f 6c75 6d6e 735f 7072 6570 6172  t(columns_prepar
+0000aaa0: 6564 290a 2020 2020 7265 7375 6c74 5f67  ed).    result_g
+0000aab0: 6466 203d 2070 796f 6772 696f 2e72 6561  df = pyogrio.rea
+0000aac0: 645f 6461 7461 6672 616d 6528 0a20 2020  d_dataframe(.   
+0000aad0: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
+0000aae0: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
+0000aaf0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+0000ab00: 636f 6c75 6d6e 735f 6c69 7374 2c0a 2020  columns_list,.  
+0000ab10: 2020 2020 2020 6262 6f78 3d62 626f 782c        bbox=bbox,
+0000ab20: 0a20 2020 2020 2020 2073 6b69 705f 6665  .        skip_fe
+0000ab30: 6174 7572 6573 3d73 6b69 705f 6665 6174  atures=skip_feat
+0000ab40: 7572 6573 2c0a 2020 2020 2020 2020 6d61  ures,.        ma
+0000ab50: 785f 6665 6174 7572 6573 3d6d 6178 5f66  x_features=max_f
+0000ab60: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+0000ab70: 2073 716c 3d73 716c 5f73 746d 742c 0a20   sql=sql_stmt,. 
+0000ab80: 2020 2020 2020 2073 716c 5f64 6961 6c65         sql_diale
+0000ab90: 6374 3d73 716c 5f64 6961 6c65 6374 2c0a  ct=sql_dialect,.
+0000aba0: 2020 2020 2020 2020 7265 6164 5f67 656f          read_geo
+0000abb0: 6d65 7472 793d 6e6f 7420 6967 6e6f 7265  metry=not ignore
+0000abc0: 5f67 656f 6d65 7472 792c 0a20 2020 2020  _geometry,.     
+0000abd0: 2020 2066 6964 5f61 735f 696e 6465 783d     fid_as_index=
+0000abe0: 6669 645f 6173 5f69 6e64 6578 2c0a 2020  fid_as_index,.  
+0000abf0: 2020 290a 0a20 2020 2023 2052 656f 7264    )..    # Reord
+0000ac00: 6572 2063 6f6c 756d 6e73 202b 2063 6861  er columns + cha
+0000ac10: 6e67 6520 6361 7369 6e67 2073 6f20 7468  nge casing so th
+0000ac20: 6579 2061 7265 2074 6865 2073 616d 6520  ey are the same 
+0000ac30: 6173 2063 6f6c 756d 6e73 2070 6172 616d  as columns param
+0000ac40: 6574 6572 0a20 2020 2069 6620 636f 6c75  eter.    if colu
+0000ac50: 6d6e 735f 7072 6570 6172 6564 2069 7320  mns_prepared is 
+0000ac60: 6e6f 7420 4e6f 6e65 2061 6e64 206c 656e  not None and len
+0000ac70: 2863 6f6c 756d 6e73 5f70 7265 7061 7265  (columns_prepare
+0000ac80: 6429 203e 2030 3a0a 2020 2020 2020 2020  d) > 0:.        
+0000ac90: 7265 7375 6c74 5f67 6466 203d 2072 6573  result_gdf = res
+0000aca0: 756c 745f 6764 665b 6c69 7374 2863 6f6c  ult_gdf[list(col
+0000acb0: 756d 6e73 5f70 7265 7061 7265 6429 202b  umns_prepared) +
+0000acc0: 205b 2267 656f 6d65 7472 7922 5d5d 0a20   ["geometry"]]. 
+0000acd0: 2020 2020 2020 2072 6573 756c 745f 6764         result_gd
+0000ace0: 6620 3d20 7265 7375 6c74 5f67 6466 2e72  f = result_gdf.r
+0000acf0: 656e 616d 6528 636f 6c75 6d6e 733d 636f  ename(columns=co
+0000ad00: 6c75 6d6e 735f 7072 6570 6172 6564 290a  lumns_prepared).
+0000ad10: 0a20 2020 2061 7373 6572 7420 6973 696e  .    assert isin
+0000ad20: 7374 616e 6365 2872 6573 756c 745f 6764  stance(result_gd
+0000ad30: 662c 2028 6770 642e 4765 6f44 6174 6146  f, (gpd.GeoDataF
+0000ad40: 7261 6d65 2c20 7064 2e44 6174 6146 7261  rame, pd.DataFra
+0000ad50: 6d65 2929 0a20 2020 2072 6574 7572 6e20  me)).    return 
+0000ad60: 7265 7375 6c74 5f67 6466 0a0a 0a64 6566  result_gdf...def
+0000ad70: 205f 6669 6c6c 5f6f 7574 5f73 716c 5f70   _fill_out_sql_p
+0000ad80: 6c61 6365 686f 6c64 6572 7328 0a20 2020  laceholders(.   
+0000ad90: 2070 6174 683a 2050 6174 682c 206c 6179   path: Path, lay
+0000ada0: 6572 3a20 4f70 7469 6f6e 616c 5b73 7472  er: Optional[str
+0000adb0: 5d2c 2073 716c 5f73 746d 743a 2073 7472  ], sql_stmt: str
+0000adc0: 2c20 636f 6c75 6d6e 733a 204f 7074 696f  , columns: Optio
+0000add0: 6e61 6c5b 4974 6572 6162 6c65 5b73 7472  nal[Iterable[str
+0000ade0: 5d5d 0a29 202d 3e20 7374 723a 0a20 2020  ]].) -> str:.   
+0000adf0: 2023 2046 696c 6c20 6f75 7420 706c 6163   # Fill out plac
+0000ae00: 6568 6f6c 6465 7273 2069 6e20 7468 6520  eholders in the 
+0000ae10: 7371 6c5f 7374 6d74 2069 6620 6e65 6564  sql_stmt if need
+0000ae20: 6564 3a0a 2020 2020 706c 6163 6568 6f6c  ed:.    placehol
+0000ae30: 6465 7273 203d 205b 0a20 2020 2020 2020  ders = [.       
+0000ae40: 206e 616d 6520 666f 7220 5f2c 206e 616d   name for _, nam
+0000ae50: 652c 205f 2c20 5f20 696e 2073 7472 696e  e, _, _ in strin
+0000ae60: 672e 466f 726d 6174 7465 7228 292e 7061  g.Formatter().pa
+0000ae70: 7273 6528 7371 6c5f 7374 6d74 2920 6966  rse(sql_stmt) if
+0000ae80: 206e 616d 650a 2020 2020 5d0a 2020 2020   name.    ].    
+0000ae90: 6c61 7965 725f 746d 7020 3d20 6c61 7965  layer_tmp = laye
+0000aea0: 720a 2020 2020 6c61 7965 7269 6e66 6f20  r.    layerinfo 
+0000aeb0: 3d20 4e6f 6e65 0a20 2020 2066 6f72 6d61  = None.    forma
+0000aec0: 745f 6b77 6172 6773 203d 207b 7d0a 2020  t_kwargs = {}.  
+0000aed0: 2020 666f 7220 706c 6163 6568 6f6c 6465    for placeholde
+0000aee0: 7220 696e 2070 6c61 6365 686f 6c64 6572  r in placeholder
+0000aef0: 733a 0a20 2020 2020 2020 2069 6620 6c61  s:.        if la
+0000af00: 7965 725f 746d 7020 6973 204e 6f6e 653a  yer_tmp is None:
+0000af10: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0000af20: 6572 5f74 6d70 203d 2067 6574 5f6f 6e6c  er_tmp = get_onl
+0000af30: 795f 6c61 7965 7228 7061 7468 290a 2020  y_layer(path).  
+0000af40: 2020 2020 2020 6966 2070 6c61 6365 686f        if placeho
+0000af50: 6c64 6572 203d 3d20 2269 6e70 7574 5f6c  lder == "input_l
+0000af60: 6179 6572 223a 0a20 2020 2020 2020 2020  ayer":.         
+0000af70: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
+0000af80: 5b70 6c61 6365 686f 6c64 6572 5d20 3d20  [placeholder] = 
+0000af90: 6c61 7965 725f 746d 700a 2020 2020 2020  layer_tmp.      
+0000afa0: 2020 656c 6966 2070 6c61 6365 686f 6c64    elif placehold
+0000afb0: 6572 203d 3d20 2267 656f 6d65 7472 7963  er == "geometryc
+0000afc0: 6f6c 756d 6e22 3a0a 2020 2020 2020 2020  olumn":.        
+0000afd0: 2020 2020 6966 206c 6179 6572 696e 666f      if layerinfo
+0000afe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000aff0: 2020 2020 2020 2020 2020 6c61 7965 7269            layeri
+0000b000: 6e66 6f20 3d20 6765 745f 6c61 7965 7269  nfo = get_layeri
+0000b010: 6e66 6f28 7061 7468 2c20 6c61 7965 725f  nfo(path, layer_
+0000b020: 746d 7029 0a20 2020 2020 2020 2020 2020  tmp).           
+0000b030: 2066 6f72 6d61 745f 6b77 6172 6773 5b70   format_kwargs[p
+0000b040: 6c61 6365 686f 6c64 6572 5d20 3d20 6c61  laceholder] = la
+0000b050: 7965 7269 6e66 6f2e 6765 6f6d 6574 7279  yerinfo.geometry
+0000b060: 636f 6c75 6d6e 0a20 2020 2020 2020 2065  column.        e
+0000b070: 6c69 6620 706c 6163 6568 6f6c 6465 7220  lif placeholder 
+0000b080: 3d3d 2022 636f 6c75 6d6e 735f 746f 5f73  == "columns_to_s
+0000b090: 656c 6563 745f 7374 7222 3a0a 2020 2020  elect_str":.    
+0000b0a0: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+0000b0b0: 696e 666f 2069 7320 4e6f 6e65 3a0a 2020  info is None:.  
+0000b0c0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000b0d0: 7965 7269 6e66 6f20 3d20 6765 745f 6c61  yerinfo = get_la
+0000b0e0: 7965 7269 6e66 6f28 7061 7468 2c20 6c61  yerinfo(path, la
+0000b0f0: 7965 725f 746d 7029 0a20 2020 2020 2020  yer_tmp).       
+0000b100: 2020 2020 2063 6f6c 756d 6e73 5f61 736b       columns_ask
+0000b110: 6564 203d 204e 6f6e 6520 6966 2063 6f6c  ed = None if col
+0000b120: 756d 6e73 2069 7320 4e6f 6e65 2065 6c73  umns is None els
+0000b130: 6520 6c69 7374 2863 6f6c 756d 6e73 290a  e list(columns).
+0000b140: 2020 2020 2020 2020 2020 2020 666f 726d              form
+0000b150: 6174 7465 7220 3d20 5f6f 6772 5f73 716c  atter = _ogr_sql
+0000b160: 5f75 7469 6c2e 436f 6c75 6d6e 466f 726d  _util.ColumnForm
+0000b170: 6174 7465 7228 0a20 2020 2020 2020 2020  atter(.         
+0000b180: 2020 2020 2020 2063 6f6c 756d 6e73 5f61         columns_a
+0000b190: 736b 6564 3d63 6f6c 756d 6e73 5f61 736b  sked=columns_ask
+0000b1a0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+0000b1b0: 2020 2020 636f 6c75 6d6e 735f 696e 5f6c      columns_in_l
+0000b1c0: 6179 6572 3d6c 6179 6572 696e 666f 2e63  ayer=layerinfo.c
+0000b1d0: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+0000b1e0: 2020 2020 2020 2020 6669 645f 636f 6c75          fid_colu
+0000b1f0: 6d6e 3d6c 6179 6572 696e 666f 2e66 6964  mn=layerinfo.fid
+0000b200: 5f63 6f6c 756d 6e2c 0a20 2020 2020 2020  _column,.       
+0000b210: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000b220: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
+0000b230: 5b70 6c61 6365 686f 6c64 6572 5d20 3d20  [placeholder] = 
+0000b240: 666f 726d 6174 7465 722e 7072 6566 6978  formatter.prefix
+0000b250: 6564 5f61 6c69 6173 6564 2829 0a0a 2020  ed_aliased()..  
+0000b260: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000b270: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000b280: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0000b290: 2020 2020 2020 2020 2020 6622 756e 6b6e            f"unkn
+0000b2a0: 6f77 6e20 706c 6163 6568 6f6c 6465 7220  own placeholder 
+0000b2b0: 7b70 6c61 6365 686f 6c64 6572 7d20 696e  {placeholder} in
+0000b2c0: 2073 716c 5f73 746d 743a 207b 7371 6c5f   sql_stmt: {sql_
+0000b2d0: 7374 6d74 7d22 0a20 2020 2020 2020 2020  stmt}".         
+0000b2e0: 2020 2029 0a0a 2020 2020 6966 206c 656e     )..    if len
+0000b2f0: 2866 6f72 6d61 745f 6b77 6172 6773 2920  (format_kwargs) 
+0000b300: 3e20 303a 0a20 2020 2020 2020 2073 716c  > 0:.        sql
+0000b310: 5f73 746d 7420 3d20 7371 6c5f 7374 6d74  _stmt = sql_stmt
+0000b320: 2e66 6f72 6d61 7428 2a2a 666f 726d 6174  .format(**format
+0000b330: 5f6b 7761 7267 7329 0a20 2020 2072 6574  _kwargs).    ret
+0000b340: 7572 6e20 7371 6c5f 7374 6d74 0a0a 0a64  urn sql_stmt...d
+0000b350: 6566 2072 6561 645f 6669 6c65 5f73 716c  ef read_file_sql
+0000b360: 280a 2020 2020 7061 7468 3a20 556e 696f  (.    path: Unio
+0000b370: 6e5b 7374 722c 2022 6f73 2e50 6174 684c  n[str, "os.PathL
+0000b380: 696b 655b 416e 795d 225d 2c0a 2020 2020  ike[Any]"],.    
+0000b390: 7371 6c5f 7374 6d74 3a20 7374 722c 0a20  sql_stmt: str,. 
+0000b3a0: 2020 2073 716c 5f64 6961 6c65 6374 3a20     sql_dialect: 
+0000b3b0: 4f70 7469 6f6e 616c 5b4c 6974 6572 616c  Optional[Literal
+0000b3c0: 5b22 5351 4c49 5445 222c 2022 4f47 5253  ["SQLITE", "OGRS
+0000b3d0: 514c 225d 5d20 3d20 2253 514c 4954 4522  QL"]] = "SQLITE"
+0000b3e0: 2c0a 2020 2020 6c61 7965 723a 204f 7074  ,.    layer: Opt
+0000b3f0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000b400: 652c 0a20 2020 2069 676e 6f72 655f 6765  e,.    ignore_ge
+0000b410: 6f6d 6574 7279 3a20 626f 6f6c 203d 2046  ometry: bool = F
+0000b420: 616c 7365 2c0a 2920 2d3e 2055 6e69 6f6e  alse,.) -> Union
+0000b430: 5b70 642e 4461 7461 4672 616d 652c 2067  [pd.DataFrame, g
+0000b440: 7064 2e47 656f 4461 7461 4672 616d 655d  pd.GeoDataFrame]
+0000b450: 3a0a 2020 2020 2222 220a 2020 2020 4445  :.    """.    DE
+0000b460: 5052 4543 4154 4544 3a20 5265 6164 7320  PRECATED: Reads 
+0000b470: 6120 6669 6c65 2075 7369 6e67 2061 6e20  a file using an 
+0000b480: 7371 6c20 7374 6174 656d 656e 742e 0a0a  sql statement...
+0000b490: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+0000b4a0: 2020 7061 7468 2028 6669 6c65 2070 6174    path (file pat
+0000b4b0: 6829 3a20 7061 7468 2074 6f20 7468 6520  h): path to the 
+0000b4c0: 6669 6c65 2074 6f20 7265 6164 2066 726f  file to read fro
+0000b4d0: 6d0a 2020 2020 2020 2020 7371 6c5f 7374  m.        sql_st
+0000b4e0: 6d74 2028 7374 7229 3a20 7371 6c20 7374  mt (str): sql st
+0000b4f0: 6174 656d 656e 7420 746f 2075 7365 0a20  atement to use. 
+0000b500: 2020 2020 2020 2073 716c 5f64 6961 6c65         sql_diale
+0000b510: 6374 2028 7374 722c 206f 7074 696f 6e61  ct (str, optiona
+0000b520: 6c29 3a20 5371 6c20 6469 616c 6563 7420  l): Sql dialect 
+0000b530: 7573 6564 2e20 4465 6661 756c 7473 2074  used. Defaults t
+0000b540: 6f20 2753 514c 4954 4527 2e0a 2020 2020  o 'SQLITE'..    
+0000b550: 2020 2020 6c61 7965 7220 2873 7472 2c20      layer (str, 
+0000b560: 6f70 7469 6f6e 616c 293a 2054 6865 206c  optional): The l
+0000b570: 6179 6572 2074 6f20 7265 6164 2e20 4966  ayer to read. If
+0000b580: 206e 6f20 6c61 7965 7220 6973 2073 7065   no layer is spe
+0000b590: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
+0000b5a0: 2020 2020 7265 6164 7320 7468 6520 6f6e      reads the on
+0000b5b0: 6c79 206c 6179 6572 2069 6e20 7468 6520  ly layer in the 
+0000b5c0: 6669 6c65 206f 7220 7468 726f 7773 2061  file or throws a
+0000b5d0: 6e20 4578 6365 7074 696f 6e2e 0a20 2020  n Exception..   
+0000b5e0: 2020 2020 2069 676e 6f72 655f 6765 6f6d       ignore_geom
+0000b5f0: 6574 7279 2028 626f 6f6c 2c20 6f70 7469  etry (bool, opti
+0000b600: 6f6e 616c 293a 2054 7275 6520 6e6f 7420  onal): True not 
+0000b610: 746f 2072 6561 642f 7265 7475 726e 2074  to read/return t
+0000b620: 6865 2067 656f 6d61 7472 792e 0a20 2020  he geomatry..   
+0000b630: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+0000b640: 7320 746f 2046 616c 7365 2e0a 0a20 2020  s to False...   
+0000b650: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+0000b660: 2020 556e 696f 6e5b 7064 2e44 6174 6146    Union[pd.DataF
+0000b670: 7261 6d65 2c20 6770 642e 4765 6f44 6174  rame, gpd.GeoDat
+0000b680: 6146 7261 6d65 5d3a 2054 6865 2064 6174  aFrame]: The dat
+0000b690: 6120 7265 6164 2e0a 2020 2020 2222 220a  a read..    """.
+0000b6a0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0000b6b0: 6e28 0a20 2020 2020 2020 2027 7265 6164  n(.        'read
+0000b6c0: 5f66 696c 655f 7371 6c20 6973 2064 6570  _file_sql is dep
+0000b6d0: 7265 6361 7465 643a 2075 7365 2072 6561  recated: use rea
+0000b6e0: 645f 6669 6c65 2120 4d69 6e64 3a20 7371  d_file! Mind: sq
+0000b6f0: 6c5f 6469 616c 6563 7420 6973 206e 6f74  l_dialect is not
+0000b700: 2022 5351 4c49 5445 2220 270a 2020 2020   "SQLITE" '.    
+0000b710: 2020 2020 2262 7920 6465 6661 756c 7420      "by default 
+0000b720: 7468 6572 6521 222c 0a20 2020 2020 2020  there!",.       
+0000b730: 2046 7574 7572 6557 6172 6e69 6e67 2c0a   FutureWarning,.
+0000b740: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
+0000b750: 656c 3d32 2c0a 2020 2020 290a 0a20 2020  el=2,.    )..   
+0000b760: 2023 2052 756e 0a20 2020 2072 6574 7572   # Run.    retur
+0000b770: 6e20 5f72 6561 645f 6669 6c65 5f62 6173  n _read_file_bas
+0000b780: 6528 0a20 2020 2020 2020 2070 6174 682c  e(.        path,
+0000b790: 0a20 2020 2020 2020 2073 716c 5f73 746d  .        sql_stm
+0000b7a0: 743d 7371 6c5f 7374 6d74 2c0a 2020 2020  t=sql_stmt,.    
+0000b7b0: 2020 2020 7371 6c5f 6469 616c 6563 743d      sql_dialect=
+0000b7c0: 7371 6c5f 6469 616c 6563 742c 0a20 2020  sql_dialect,.   
+0000b7d0: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+0000b7e0: 2c0a 2020 2020 2020 2020 6967 6e6f 7265  ,.        ignore
+0000b7f0: 5f67 656f 6d65 7472 793d 6967 6e6f 7265  _geometry=ignore
+0000b800: 5f67 656f 6d65 7472 792c 0a20 2020 2029  _geometry,.    )
+0000b810: 0a0a 0a64 6566 2074 6f5f 6669 6c65 280a  ...def to_file(.
+0000b820: 2020 2020 6764 663a 2055 6e69 6f6e 5b70      gdf: Union[p
+0000b830: 642e 4461 7461 4672 616d 652c 2067 7064  d.DataFrame, gpd
+0000b840: 2e47 656f 4461 7461 4672 616d 655d 2c0a  .GeoDataFrame],.
+0000b850: 2020 2020 7061 7468 3a20 556e 696f 6e5b      path: Union[
+0000b860: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
+0000b870: 655b 416e 795d 225d 2c0a 2020 2020 6c61  e[Any]"],.    la
+0000b880: 7965 723a 204f 7074 696f 6e61 6c5b 7374  yer: Optional[st
+0000b890: 725d 203d 204e 6f6e 652c 0a20 2020 2066  r] = None,.    f
+0000b8a0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+0000b8b0: 6574 7279 7479 7065 3a20 556e 696f 6e5b  etrytype: Union[
+0000b8c0: 4765 6f6d 6574 7279 5479 7065 2c20 7374  GeometryType, st
+0000b8d0: 722c 204e 6f6e 655d 203d 204e 6f6e 652c  r, None] = None,
+0000b8e0: 0a20 2020 2066 6f72 6365 5f6d 756c 7469  .    force_multi
+0000b8f0: 7479 7065 3a20 626f 6f6c 203d 2046 616c  type: bool = Fal
+0000b900: 7365 2c0a 2020 2020 6170 7065 6e64 3a20  se,.    append: 
+0000b910: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0000b920: 2020 6170 7065 6e64 5f74 696d 656f 7574    append_timeout
+0000b930: 5f73 3a20 696e 7420 3d20 3630 302c 0a20  _s: int = 600,. 
+0000b940: 2020 2069 6e64 6578 3a20 4f70 7469 6f6e     index: Option
+0000b950: 616c 5b62 6f6f 6c5d 203d 204e 6f6e 652c  al[bool] = None,
+0000b960: 0a20 2020 2063 7265 6174 655f 7370 6174  .    create_spat
+0000b970: 6961 6c5f 696e 6465 783a 204f 7074 696f  ial_index: Optio
+0000b980: 6e61 6c5b 626f 6f6c 5d20 3d20 5472 7565  nal[bool] = True
+0000b990: 2c0a 293a 0a20 2020 2022 2222 0a20 2020  ,.):.    """.   
+0000b9a0: 2057 7269 7465 7320 6120 7061 6e64 6173   Writes a pandas
+0000b9b0: 2064 6174 6166 7261 6d65 2074 6f20 6669   dataframe to fi
+0000b9c0: 6c65 2e0a 0a20 2020 2054 6865 2066 696c  le...    The fil
+0000b9d0: 6566 6f72 6d61 7420 6973 2064 6574 6563  eformat is detec
+0000b9e0: 7465 6420 6261 7365 6420 6f6e 2074 6865  ted based on the
+0000b9f0: 2066 696c 6570 6174 6820 6578 7465 6e73   filepath extens
+0000ba00: 696f 6e2e 0a0a 2020 2020 5468 6520 756e  ion...    The un
+0000ba10: 6465 726c 7969 6e67 206c 6962 7261 7279  derlying library
+0000ba20: 2075 7365 6420 746f 2077 7269 7465 2074   used to write t
+0000ba30: 6865 2066 696c 6520 6361 6e20 6265 2063  he file can be c
+0000ba40: 686f 6f73 656e 2075 7369 6e67 2074 6865  hoosen using the
+0000ba50: 0a20 2020 2022 4746 4f5f 494f 5f45 4e47  .    "GFO_IO_ENG
+0000ba60: 494e 4522 2065 6e76 6972 6f6e 6d65 6e74  INE" environment
+0000ba70: 2076 6172 6961 626c 652e 2050 6f73 7369   variable. Possi
+0000ba80: 626c 6520 7661 6c75 6573 2061 7265 2022  ble values are "
+0000ba90: 6669 6f6e 6122 2061 6e64 2022 7079 6f67  fiona" and "pyog
+0000baa0: 7269 6f22 2e0a 2020 2020 4465 6661 756c  rio"..    Defaul
+0000bab0: 7420 656e 6769 6e65 2069 7320 2270 796f  t engine is "pyo
+0000bac0: 6772 696f 222e 0a0a 2020 2020 4172 6773  grio"...    Args
+0000bad0: 3a0a 2020 2020 2020 2020 6764 6620 2867  :.        gdf (g
+0000bae0: 7064 2e47 656f 4461 7461 4672 616d 6529  pd.GeoDataFrame)
+0000baf0: 3a20 5468 6520 4765 6f44 6174 6146 7261  : The GeoDataFra
+0000bb00: 6d65 2074 6f20 6578 706f 7274 2074 6f20  me to export to 
+0000bb10: 6669 6c65 2e0a 2020 2020 2020 2020 7061  file..        pa
+0000bb20: 7468 2028 556e 696f 6e5b 7374 722c 293a  th (Union[str,):
+0000bb30: 2054 6865 2066 696c 6520 7061 7468 2074   The file path t
+0000bb40: 6f20 7772 6974 6520 746f 2e0a 2020 2020  o write to..    
+0000bb50: 2020 2020 6c61 7965 7220 2873 7472 2c20      layer (str, 
+0000bb60: 6f70 7469 6f6e 616c 293a 2054 6865 206c  optional): The l
+0000bb70: 6179 6572 2074 6f20 7265 6164 2e20 4966  ayer to read. If
+0000bb80: 206e 6f20 6c61 7965 7220 6973 2073 7065   no layer is spe
+0000bb90: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
+0000bba0: 2020 2020 7265 6164 7320 7468 6520 6f6e      reads the on
+0000bbb0: 6c79 206c 6179 6572 2069 6e20 7468 6520  ly layer in the 
+0000bbc0: 6669 6c65 206f 7220 7468 726f 7773 2061  file or throws a
+0000bbd0: 6e20 4578 6365 7074 696f 6e2e 0a20 2020  n Exception..   
+0000bbe0: 2020 2020 2066 6f72 6365 5f6f 7574 7075       force_outpu
+0000bbf0: 745f 6765 6f6d 6574 7279 7479 7065 2028  t_geometrytype (
+0000bc00: 556e 696f 6e5b 4765 6f6d 6574 7279 5479  Union[GeometryTy
+0000bc10: 7065 2c20 7374 725d 2c20 6f70 7469 6f6e  pe, str], option
+0000bc20: 616c 293a 2047 656f 6d65 7472 7920 7479  al): Geometry ty
+0000bc30: 7065 0a20 2020 2020 2020 2020 2020 2074  pe.            t
+0000bc40: 6f20 2874 7279 2074 6f29 2066 6f72 6365  o (try to) force
+0000bc50: 2074 6865 206f 7574 7075 7420 746f 2e20   the output to. 
+0000bc60: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+0000bc70: 2e0a 2020 2020 2020 2020 2020 2020 4d61  ..            Ma
+0000bc80: 726b 3a20 636f 6d70 6172 6564 2074 6f20  rk: compared to 
+0000bc90: 6f74 6865 7220 6675 6e63 7469 6f6e 7320  other functions 
+0000bca0: 696e 2067 666f 2077 6974 6820 7468 6973  in gfo with this
+0000bcb0: 2070 6172 616d 6574 6572 2c20 7468 6520   parameter, the 
+0000bcc0: 6265 6861 7669 6f75 720a 2020 2020 2020  behaviour.      
+0000bcd0: 2020 2020 2020 6865 7265 2069 7320 6c69        here is li
+0000bce0: 6d69 7465 6420 746f 2074 6865 2066 6f6c  mited to the fol
+0000bcf0: 6c6f 7769 6e67 3a0a 2020 2020 2020 2020  lowing:.        
+0000bd00: 2020 2020 2020 2020 2d20 666f 7220 656d          - for em
+0000bd10: 7074 7920 696e 7075 7420 6764 6627 732c  pty input gdf's,
+0000bd20: 2061 2073 7461 6e64 6172 6420 6765 6f6d   a standard geom
+0000bd30: 6574 7279 2074 7970 6520 2865 672e 2050  etry type (eg. P
+0000bd40: 6f6c 7967 6f6e 2c2e 2e2e 2920 6361 6e0a  olygon,...) can.
+0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd60: 2020 6265 2075 7365 6420 746f 2066 6f72    be used to for
+0000bd70: 6365 2074 6865 2067 656f 6d65 7472 7920  ce the geometry 
+0000bd80: 636f 6c75 6d6e 2074 6f20 6265 206f 6620  column to be of 
+0000bd90: 7468 6174 2074 7970 652e 0a20 2020 2020  that type..     
+0000bda0: 2020 2020 2020 2020 2020 202d 2069 6620             - if 
+0000bdb0: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
+0000bdc0: 6d65 7472 7974 7970 6520 6973 2061 204d  metrytype is a M
+0000bdd0: 554c 5449 2074 7970 652c 2070 6172 616d  ULTI type, param
+0000bde0: 6574 6572 0a20 2020 2020 2020 2020 2020  eter.           
+0000bdf0: 2020 2020 2020 2066 6f72 6365 5f6d 756c         force_mul
+0000be00: 7469 7479 7065 2062 6563 6f6d 6573 2054  titype becomes T
+0000be10: 7275 652e 0a20 2020 2020 2020 2066 6f72  rue..        for
+0000be20: 6365 5f6d 756c 7469 7479 7065 2028 626f  ce_multitype (bo
+0000be30: 6f6c 2c20 6f70 7469 6f6e 616c 293a 2066  ol, optional): f
+0000be40: 6f72 6365 2074 6865 2067 656f 6d65 7472  orce the geometr
+0000be50: 7920 7479 7065 2074 6f20 6120 6d75 6c74  y type to a mult
+0000be60: 6974 7970 650a 2020 2020 2020 2020 2020  itype.          
+0000be70: 2020 666f 7220 6669 6c65 2074 7970 6573    for file types
+0000be80: 2074 6861 7420 7265 7175 6972 6520 6f6e   that require on
+0000be90: 6520 6765 6f6d 6574 7279 7479 7065 2070  e geometrytype p
+0000bea0: 6572 206c 6179 6572 2e0a 2020 2020 2020  er layer..      
+0000beb0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+0000bec0: 6f20 4661 6c73 652e 0a20 2020 2020 2020  o False..       
+0000bed0: 2061 7070 656e 6420 2862 6f6f 6c2c 206f   append (bool, o
+0000bee0: 7074 696f 6e61 6c29 3a20 5472 7565 2074  ptional): True t
+0000bef0: 6f20 6170 7065 6e64 2074 6f20 7468 6520  o append to the 
+0000bf00: 6669 6c65 2f6c 6179 6572 2069 6620 6974  file/layer if it
+0000bf10: 2065 7869 7374 7320 616c 7265 6164 792e   exists already.
+0000bf20: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0000bf30: 6974 2064 6f65 736e 2774 2065 7869 7374  it doesn't exist
+0000bf40: 2079 6574 2c20 6974 2069 7320 6372 6561   yet, it is crea
+0000bf50: 7465 642e 2044 6566 6175 6c74 7320 746f  ted. Defaults to
+0000bf60: 2046 616c 7365 2e0a 2020 2020 2020 2020   False..        
+0000bf70: 6170 7065 6e64 5f74 696d 656f 7574 5f73  append_timeout_s
+0000bf80: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
+0000bf90: 3a20 5468 6520 6d61 7869 6d75 6d20 7469  : The maximum ti
+0000bfa0: 6d65 6f75 7420 746f 2077 6169 7420 7768  meout to wait wh
+0000bfb0: 656e 2074 6865 0a20 2020 2020 2020 2020  en the.         
+0000bfc0: 2020 206f 7574 7075 7420 6669 6c65 2069     output file i
+0000bfd0: 7320 616c 7265 6164 7920 6265 696e 6720  s already being 
+0000bfe0: 7772 6974 7465 6e20 746f 2062 7920 616e  written to by an
+0000bff0: 6f74 6865 7220 7072 6f63 6573 732e 0a20  other process.. 
+0000c000: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+0000c010: 6c74 7320 746f 2036 3030 2e0a 2020 2020  lts to 600..    
+0000c020: 2020 2020 696e 6465 7820 2862 6f6f 6c2c      index (bool,
+0000c030: 206f 7074 696f 6e61 6c29 3a20 4966 2054   optional): If T
+0000c040: 7275 652c 2077 7269 7465 2069 6e64 6578  rue, write index
+0000c050: 2069 6e74 6f20 6f6e 6520 6f72 206d 6f72   into one or mor
+0000c060: 6520 636f 6c75 6d6e 7320 2866 6f72 0a20  e columns (for. 
+0000c070: 2020 2020 2020 2020 2020 204d 756c 7469             Multi
+0000c080: 496e 6465 7829 2e20 4e6f 6e65 2077 7269  Index). None wri
+0000c090: 7465 7320 7468 6520 696e 6465 7820 696e  tes the index in
+0000c0a0: 746f 206f 6e65 206f 7220 6d6f 7265 2063  to one or more c
+0000c0b0: 6f6c 756d 6e73 206f 6e6c 7920 6966 2074  olumns only if t
+0000c0c0: 6865 0a20 2020 2020 2020 2020 2020 2069  he.            i
+0000c0d0: 6e64 6578 2069 7320 6e61 6d65 642c 2069  ndex is named, i
+0000c0e0: 7320 6120 4d75 6c74 6949 6e64 6578 2c20  s a MultiIndex, 
+0000c0f0: 6f72 2068 6173 2061 206e 6f6e 2d69 6e74  or has a non-int
+0000c100: 6567 6572 2064 6174 6120 7479 7065 2e0a  eger data type..
+0000c110: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+0000c120: 616c 7365 2c20 6e6f 2069 6e64 6578 2069  alse, no index i
+0000c130: 7320 7772 6974 7465 6e2e 2044 6566 6175  s written. Defau
+0000c140: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+0000c150: 2020 2020 2063 7265 6174 655f 7370 6174       create_spat
+0000c160: 6961 6c5f 696e 6465 7820 2862 6f6f 6c2c  ial_index (bool,
+0000c170: 206f 7074 696f 6e61 6c29 3a20 5472 7565   optional): True
+0000c180: 2074 6f20 666f 7263 6520 6372 6561 7469   to force creati
+0000c190: 6f6e 206f 6620 7370 6174 6961 6c20 696e  on of spatial in
+0000c1a0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+0000c1b0: 2046 616c 7365 2074 6f20 6176 6f69 6420   False to avoid 
+0000c1c0: 6372 6561 7469 6f6e 2e20 4e6f 6e65 206c  creation. None l
+0000c1d0: 6561 6473 2074 6f20 7468 6520 6465 6661  eads to the defa
+0000c1e0: 756c 7420 6265 6861 7669 6f75 7220 6f66  ult behaviour of
+0000c1f0: 2067 6461 6c2e 0a20 2020 2020 2020 2020   gdal..         
+0000c200: 2020 2044 6566 6175 6c74 7320 746f 2054     Defaults to T
+0000c210: 7275 652e 0a0a 2020 2020 5261 6973 6573  rue...    Raises
+0000c220: 3a0a 2020 2020 2020 2020 5661 6c75 6545  :.        ValueE
+0000c230: 7272 6f72 3a20 616e 2069 6e76 616c 6964  rror: an invalid
+0000c240: 2070 6172 616d 6574 6572 2076 616c 7565   parameter value
+0000c250: 2077 6173 2070 6173 7365 642e 0a20 2020   was passed..   
+0000c260: 2020 2020 2052 756e 7469 6d65 4572 726f       RuntimeErro
+0000c270: 723a 2074 696d 656f 7574 2077 6173 2072  r: timeout was r
+0000c280: 6561 6368 6564 2077 6869 6c65 2074 7279  eached while try
+0000c290: 696e 6720 746f 2061 7070 656e 6420 6461  ing to append da
+0000c2a0: 7461 2074 6f20 7061 7468 2e0a 2020 2020  ta to path..    
+0000c2b0: 2222 220a 2020 2020 2320 4368 6563 6b20  """.    # Check 
+0000c2c0: 696e 7075 7420 7061 7261 6d65 7465 7273  input parameters
+0000c2d0: 0a20 2020 2023 202d 2d2d 2d2d 2d2d 2d2d  .    # ---------
+0000c2e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+0000c2f0: 2020 7061 7468 203d 2050 6174 6828 7061    path = Path(pa
+0000c300: 7468 290a 0a20 2020 2023 2049 6620 6e6f  th)..    # If no
+0000c310: 206c 6179 6572 206e 616d 6520 7370 6563   layer name spec
+0000c320: 6966 6965 642c 2064 6574 6572 6d69 6e65  ified, determine
+0000c330: 206f 6e65 0a20 2020 2069 6620 6c61 7965   one.    if laye
+0000c340: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+0000c350: 2020 2069 6620 6170 7065 6e64 2061 6e64     if append and
+0000c360: 2070 6174 682e 6578 6973 7473 2829 3a0a   path.exists():.
+0000c370: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000c380: 7220 3d20 6765 745f 6f6e 6c79 5f6c 6179  r = get_only_lay
+0000c390: 6572 2870 6174 6829 0a20 2020 2020 2020  er(path).       
+0000c3a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000c3b0: 2020 206c 6179 6572 203d 2050 6174 6828     layer = Path(
+0000c3c0: 7061 7468 292e 7374 656d 0a0a 2020 2020  path).stem..    
+0000c3d0: 2320 4966 2066 6f72 6365 5f6f 7574 7075  # If force_outpu
+0000c3e0: 745f 6765 6f6d 6574 7279 7479 7065 2069  t_geometrytype i
+0000c3f0: 7320 6120 7374 7269 6e67 2c20 6368 6563  s a string, chec
+0000c400: 6b20 6966 2069 7420 6973 2061 2022 7374  k if it is a "st
+0000c410: 616e 6461 7264 2220 6765 6f6d 6574 7279  andard" geometry
+0000c420: 0a20 2020 2023 2074 7970 652c 2061 7320  .    # type, as 
+0000c430: 4744 414c 2061 6c73 6f20 7375 7070 6f72  GDAL also suppor
+0000c440: 7473 2073 7065 6369 616c 2067 656f 6d65  ts special geome
+0000c450: 7472 7920 7479 7065 7320 6c69 6b65 2022  try types like "
+0000c460: 5052 4f4d 4f54 455f 544f 5f4d 554c 5449  PROMOTE_TO_MULTI
+0000c470: 220a 2020 2020 6966 2069 7369 6e73 7461  ".    if isinsta
+0000c480: 6e63 6528 666f 7263 655f 6f75 7470 7574  nce(force_output
+0000c490: 5f67 656f 6d65 7472 7974 7970 652c 2073  _geometrytype, s
+0000c4a0: 7472 293a 0a20 2020 2020 2020 2066 6f72  tr):.        for
+0000c4b0: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
+0000c4c0: 7279 7479 7065 203d 2066 6f72 6365 5f6f  rytype = force_o
+0000c4d0: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
+0000c4e0: 7065 2e75 7070 6572 2829 0a20 2020 2020  pe.upper().     
+0000c4f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000c500: 2020 2020 2320 5665 7269 6679 2069 6620      # Verify if 
+0000c510: 6974 2069 7320 6120 2273 7461 6e64 6172  it is a "standar
+0000c520: 6422 2067 656f 6d65 7472 7920 7479 7065  d" geometry type
+0000c530: 2c20 6173 2047 4441 4c20 616c 736f 2073  , as GDAL also s
+0000c540: 7570 706f 7274 730a 2020 2020 2020 2020  upports.        
+0000c550: 2020 2020 2320 7370 6563 6961 6c20 6765      # special ge
+0000c560: 6f6d 6574 7279 2074 7970 6573 206c 696b  ometry types lik
+0000c570: 6520 2250 524f 4d4f 5445 5f54 4f5f 4d55  e "PROMOTE_TO_MU
+0000c580: 4c54 4922 0a20 2020 2020 2020 2020 2020  LTI".           
+0000c590: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
+0000c5a0: 6f6d 6574 7279 7479 7065 203d 2047 656f  ometrytype = Geo
+0000c5b0: 6d65 7472 7954 7970 655b 666f 7263 655f  metryType[force_
+0000c5c0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+0000c5d0: 7970 655d 0a20 2020 2020 2020 2065 7863  ype].        exc
+0000c5e0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0000c5f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c600: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000c610: 2020 2020 2020 2020 2020 2020 2066 2255               f"U
+0000c620: 6e73 7570 706f 7274 6564 2066 6f72 6365  nsupported force
+0000c630: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
+0000c640: 7479 7065 3a20 7b66 6f72 6365 5f6f 7574  type: {force_out
+0000c650: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
+0000c660: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+0000c670: 0a20 2020 2069 6620 666f 7263 655f 6f75  .    if force_ou
+0000c680: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
+0000c690: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+0000c6a0: 6420 666f 7263 655f 6f75 7470 7574 5f67  d force_output_g
+0000c6b0: 656f 6d65 7472 7974 7970 652e 6973 5f6d  eometrytype.is_m
+0000c6c0: 756c 7469 7479 7065 3a0a 2020 2020 2020  ultitype:.      
+0000c6d0: 2020 666f 7263 655f 6d75 6c74 6974 7970    force_multityp
+0000c6e0: 6520 3d20 5472 7565 0a0a 2020 2020 2320  e = True..    # 
+0000c6f0: 4966 2074 6865 7265 2069 7320 6e6f 2067  If there is no g
+0000c700: 656f 6d65 7472 7920 636f 6c75 6d6e 2069  eometry column i
+0000c710: 6e20 7468 6520 696e 7075 742c 2061 6c77  n the input, alw
+0000c720: 6179 7320 7573 6520 6669 6f6e 612c 2061  ays use fiona, a
+0000c730: 7320 7079 6f67 7269 6f20 646f 6573 6e27  s pyogrio doesn'
+0000c740: 740a 2020 2020 2320 7375 7070 6f72 7420  t.    # support 
+0000c750: 7468 6174 2079 6574 2061 7420 7469 6d65  that yet at time
+0000c760: 206f 6620 7772 6974 696e 672e 0a20 2020   of writing..   
+0000c770: 2069 6620 6973 696e 7374 616e 6365 2867   if isinstance(g
+0000c780: 6466 2c20 6770 642e 4765 6f44 6174 6146  df, gpd.GeoDataF
+0000c790: 7261 6d65 2920 6973 2046 616c 7365 206f  rame) is False o
+0000c7a0: 7220 280a 2020 2020 2020 2020 6973 696e  r (.        isin
+0000c7b0: 7374 616e 6365 2867 6466 2c20 6770 642e  stance(gdf, gpd.
+0000c7c0: 4765 6f44 6174 6146 7261 6d65 2920 616e  GeoDataFrame) an
+0000c7d0: 6420 2267 656f 6d65 7472 7922 206e 6f74  d "geometry" not
+0000c7e0: 2069 6e20 6764 662e 636f 6c75 6d6e 730a   in gdf.columns.
+0000c7f0: 2020 2020 293a 0a20 2020 2020 2020 2065      ):.        e
+0000c800: 6e67 696e 6520 3d20 2266 696f 6e61 220a  ngine = "fiona".
+0000c810: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c820: 2020 656e 6769 6e65 203d 205f 6765 745f    engine = _get_
+0000c830: 656e 6769 6e65 2829 0a0a 2020 2020 2320  engine()..    # 
+0000c840: 4e6f 7720 7772 6974 6520 7769 7468 2074  Now write with t
+0000c850: 6865 2063 6f72 7265 6374 2065 6e67 696e  he correct engin
+0000c860: 650a 2020 2020 6966 2065 6e67 696e 6520  e.    if engine 
+0000c870: 3d3d 2022 7079 6f67 7269 6f22 3a0a 2020  == "pyogrio":.  
+0000c880: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+0000c890: 6e73 7461 6e63 6528 6764 662c 2067 7064  nstance(gdf, gpd
+0000c8a0: 2e47 656f 4461 7461 4672 616d 6529 0a20  .GeoDataFrame). 
+0000c8b0: 2020 2020 2020 2072 6574 7572 6e20 5f74         return _t
+0000c8c0: 6f5f 6669 6c65 5f70 796f 6772 696f 280a  o_file_pyogrio(.
+0000c8d0: 2020 2020 2020 2020 2020 2020 6764 663d              gdf=
+0000c8e0: 6764 662c 0a20 2020 2020 2020 2020 2020  gdf,.           
+0000c8f0: 2070 6174 683d 7061 7468 2c0a 2020 2020   path=path,.    
+0000c900: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
+0000c910: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
+0000c920: 2066 6f72 6365 5f6f 7574 7075 745f 6765   force_output_ge
+0000c930: 6f6d 6574 7279 7479 7065 3d66 6f72 6365  ometrytype=force
+0000c940: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
+0000c950: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+0000c960: 2020 666f 7263 655f 6d75 6c74 6974 7970    force_multityp
+0000c970: 653d 666f 7263 655f 6d75 6c74 6974 7970  e=force_multityp
+0000c980: 652c 0a20 2020 2020 2020 2020 2020 2061  e,.            a
+0000c990: 7070 656e 643d 6170 7065 6e64 2c0a 2020  ppend=append,.  
+0000c9a0: 2020 2020 2020 2020 2020 6170 7065 6e64            append
+0000c9b0: 5f74 696d 656f 7574 5f73 3d61 7070 656e  _timeout_s=appen
+0000c9c0: 645f 7469 6d65 6f75 745f 732c 0a20 2020  d_timeout_s,.   
+0000c9d0: 2020 2020 2020 2020 2069 6e64 6578 3d69           index=i
+0000c9e0: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
+0000c9f0: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
+0000ca00: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
+0000ca10: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
+0000ca20: 2020 2020 2029 0a20 2020 2065 6c69 6620       ).    elif 
+0000ca30: 656e 6769 6e65 203d 3d20 2266 696f 6e61  engine == "fiona
+0000ca40: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+0000ca50: 6e20 5f74 6f5f 6669 6c65 5f66 696f 6e61  n _to_file_fiona
+0000ca60: 280a 2020 2020 2020 2020 2020 2020 6764  (.            gd
+0000ca70: 663d 6764 662c 0a20 2020 2020 2020 2020  f=gdf,.         
+0000ca80: 2020 2070 6174 683d 7061 7468 2c0a 2020     path=path,.  
+0000ca90: 2020 2020 2020 2020 2020 6c61 7965 723d            layer=
+0000caa0: 6c61 7965 722c 0a20 2020 2020 2020 2020  layer,.         
+0000cab0: 2020 2066 6f72 6365 5f6f 7574 7075 745f     force_output_
+0000cac0: 6765 6f6d 6574 7279 7479 7065 3d66 6f72  geometrytype=for
+0000cad0: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
+0000cae0: 7279 7479 7065 2c0a 2020 2020 2020 2020  rytype,.        
+0000caf0: 2020 2020 666f 7263 655f 6d75 6c74 6974      force_multit
+0000cb00: 7970 653d 666f 7263 655f 6d75 6c74 6974  ype=force_multit
+0000cb10: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000cb20: 2061 7070 656e 643d 6170 7065 6e64 2c0a   append=append,.
+0000cb30: 2020 2020 2020 2020 2020 2020 6170 7065              appe
+0000cb40: 6e64 5f74 696d 656f 7574 5f73 3d61 7070  nd_timeout_s=app
+0000cb50: 656e 645f 7469 6d65 6f75 745f 732c 0a20  end_timeout_s,. 
+0000cb60: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000cb70: 3d69 6e64 6578 2c0a 2020 2020 2020 2020  =index,.        
+0000cb80: 2020 2020 6372 6561 7465 5f73 7061 7469      create_spati
+0000cb90: 616c 5f69 6e64 6578 3d63 7265 6174 655f  al_index=create_
+0000cba0: 7370 6174 6961 6c5f 696e 6465 782c 0a20  spatial_index,. 
+0000cbb0: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
+0000cbc0: 653a 0a20 2020 2020 2020 2072 6169 7365  e:.        raise
+0000cbd0: 2056 616c 7565 4572 726f 7228 6622 556e   ValueError(f"Un
+0000cbe0: 7375 7070 6f72 7465 6420 656e 6769 6e65  supported engine
+0000cbf0: 3a20 7b65 6e67 696e 657d 2229 0a0a 0a64  : {engine}")...d
+0000cc00: 6566 205f 6765 745f 656e 6769 6e65 2829  ef _get_engine()
+0000cc10: 3a0a 2020 2020 7265 7475 726e 206f 732e  :.    return os.
+0000cc20: 656e 7669 726f 6e2e 6765 7428 2247 464f  environ.get("GFO
+0000cc30: 5f49 4f5f 454e 4749 4e45 222c 2022 7079  _IO_ENGINE", "py
+0000cc40: 6f67 7269 6f22 290a 0a0a 6465 6620 5f74  ogrio")...def _t
+0000cc50: 6f5f 6669 6c65 5f66 696f 6e61 280a 2020  o_file_fiona(.  
+0000cc60: 2020 6764 663a 2055 6e69 6f6e 5b70 642e    gdf: Union[pd.
+0000cc70: 4461 7461 4672 616d 652c 2067 7064 2e47  DataFrame, gpd.G
+0000cc80: 656f 4461 7461 4672 616d 655d 2c0a 2020  eoDataFrame],.  
+0000cc90: 2020 7061 7468 3a20 5061 7468 2c0a 2020    path: Path,.  
+0000cca0: 2020 6c61 7965 723a 2073 7472 2c0a 2020    layer: str,.  
+0000ccb0: 2020 666f 7263 655f 6f75 7470 7574 5f67    force_output_g
+0000ccc0: 656f 6d65 7472 7974 7970 653a 2055 6e69  eometrytype: Uni
+0000ccd0: 6f6e 5b47 656f 6d65 7472 7954 7970 652c  on[GeometryType,
+0000cce0: 2073 7472 2c20 4e6f 6e65 5d20 3d20 4e6f   str, None] = No
+0000ccf0: 6e65 2c0a 2020 2020 666f 7263 655f 6d75  ne,.    force_mu
+0000cd00: 6c74 6974 7970 653a 2062 6f6f 6c20 3d20  ltitype: bool = 
+0000cd10: 4661 6c73 652c 0a20 2020 2061 7070 656e  False,.    appen
+0000cd20: 643a 2062 6f6f 6c20 3d20 4661 6c73 652c  d: bool = False,
+0000cd30: 0a20 2020 2061 7070 656e 645f 7469 6d65  .    append_time
+0000cd40: 6f75 745f 733a 2069 6e74 203d 2036 3030  out_s: int = 600
+0000cd50: 2c0a 2020 2020 696e 6465 783a 204f 7074  ,.    index: Opt
+0000cd60: 696f 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f  ional[bool] = No
+0000cd70: 6e65 2c0a 2020 2020 6372 6561 7465 5f73  ne,.    create_s
+0000cd80: 7061 7469 616c 5f69 6e64 6578 3a20 4f70  patial_index: Op
+0000cd90: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 2054  tional[bool] = T
+0000cda0: 7275 652c 0a29 3a0a 2020 2020 2222 220a  rue,.):.    """.
+0000cdb0: 2020 2020 5772 6974 6573 2061 2070 616e      Writes a pan
+0000cdc0: 6461 7320 6461 7461 6672 616d 6520 746f  das dataframe to
+0000cdd0: 2066 696c 6520 7573 696e 6720 6669 6f6e   file using fion
+0000cde0: 612e 0a20 2020 2022 2222 0a20 2020 2023  a..    """.    #
+0000cdf0: 2053 6861 7065 6669 6c65 2064 6f65 736e   Shapefile doesn
+0000ce00: 2774 2073 7570 706f 7274 2064 6174 6574  't support datet
+0000ce10: 696d 6520 636f 6c75 6d6e 732c 2073 6f20  ime columns, so 
+0000ce20: 6669 7273 7420 6361 7374 2074 6865 6d20  first cast them 
+0000ce30: 746f 2073 7472 696e 670a 2020 2020 6966  to string.    if
+0000ce40: 2047 656f 6669 6c65 5479 7065 2870 6174   GeofileType(pat
+0000ce50: 6829 203d 3d20 4765 6f66 696c 6554 7970  h) == GeofileTyp
+0000ce60: 652e 4553 5249 5368 6170 6566 696c 653a  e.ESRIShapefile:
+0000ce70: 0a20 2020 2020 2020 2067 6466 203d 2067  .        gdf = g
+0000ce80: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+0000ce90: 2020 666f 7220 636f 6c75 6d6e 2069 6e20    for column in 
+0000cea0: 6764 662e 7365 6c65 6374 5f64 7479 7065  gdf.select_dtype
+0000ceb0: 7328 696e 636c 7564 653d 5b22 6461 7465  s(include=["date
+0000cec0: 7469 6d65 3634 225d 293a 0a20 2020 2020  time64"]):.     
+0000ced0: 2020 2020 2020 2067 6466 5b63 6f6c 756d         gdf[colum
+0000cee0: 6e5d 203d 2067 6466 5b63 6f6c 756d 6e5d  n] = gdf[column]
+0000cef0: 2e61 7374 7970 6528 7374 7229 0a0a 2020  .astype(str)..  
+0000cf00: 2020 2320 4861 6e64 6c65 2073 6f6d 6520    # Handle some 
+0000cf10: 7370 6563 6966 6963 2063 6173 6573 2077  specific cases w
+0000cf20: 6865 7265 2074 6865 2066 696c 6520 7363  here the file sc
+0000cf30: 6865 6d61 206e 6565 6473 2074 6f20 6265  hema needs to be
+0000cf40: 206d 616e 6970 756c 6174 6564 2e0a 2020   manipulated..  
+0000cf50: 2020 7363 6865 6d61 203d 204e 6f6e 650a    schema = None.
+0000cf60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000cf70: 6528 6764 662c 2067 7064 2e47 656f 4461  e(gdf, gpd.GeoDa
+0000cf80: 7461 4672 616d 6529 2069 7320 4661 6c73  taFrame) is Fals
+0000cf90: 6520 6f72 2028 0a20 2020 2020 2020 2069  e or (.        i
+0000cfa0: 7369 6e73 7461 6e63 6528 6764 662c 2067  sinstance(gdf, g
+0000cfb0: 7064 2e47 656f 4461 7461 4672 616d 6529  pd.GeoDataFrame)
+0000cfc0: 2061 6e64 2022 6765 6f6d 6574 7279 2220   and "geometry" 
+0000cfd0: 6e6f 7420 696e 2067 6466 2e63 6f6c 756d  not in gdf.colum
+0000cfe0: 6e73 0a20 2020 2029 3a0a 2020 2020 2020  ns.    ):.      
+0000cff0: 2020 2320 4e6f 2067 656f 6d65 7472 792c    # No geometry,
+0000d000: 2073 6f20 7072 6570 6172 6520 746f 2062   so prepare to b
+0000d010: 6520 7772 6974 7465 6e20 6173 2061 7474  e written as att
+0000d020: 7269 6275 7465 2074 6162 6c65 3a20 6164  ribute table: ad
+0000d030: 6420 6765 6f6d 6574 7279 2063 6f6c 756d  d geometry colum
+0000d040: 6e0a 2020 2020 2020 2020 2320 7769 7468  n.        # with
+0000d050: 204e 6f6e 6520 6765 6f6d 6574 7279 2074   None geometry t
+0000d060: 7970 6520 696e 2073 6368 656d 610a 2020  ype in schema.  
+0000d070: 2020 2020 2020 6764 6620 3d20 6770 642e        gdf = gpd.
+0000d080: 4765 6f44 6174 6146 7261 6d65 2867 6466  GeoDataFrame(gdf
+0000d090: 2c20 6765 6f6d 6574 7279 3d5b 4e6f 6e65  , geometry=[None
+0000d0a0: 2066 6f72 2069 2069 6e20 6764 662e 696e   for i in gdf.in
+0000d0b0: 6465 785d 290a 0a20 2020 2020 2020 2073  dex])..        s
+0000d0c0: 6368 656d 6120 3d20 6770 645f 696f 5f66  chema = gpd_io_f
+0000d0d0: 696c 652e 696e 6665 725f 7363 6865 6d61  ile.infer_schema
+0000d0e0: 2867 6466 290a 2020 2020 2020 2020 7363  (gdf).        sc
+0000d0f0: 6865 6d61 5b22 6765 6f6d 6574 7279 225d  hema["geometry"]
+0000d100: 203d 2022 4e6f 6e65 220a 2020 2020 656c   = "None".    el
+0000d110: 6966 2028 0a20 2020 2020 2020 206c 656e  if (.        len
+0000d120: 2867 6466 2920 3d3d 2030 0a20 2020 2020  (gdf) == 0.     
+0000d130: 2020 2061 6e64 2066 6f72 6365 5f6f 7574     and force_out
+0000d140: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
+0000d150: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
+0000d160: 2020 2020 2061 6e64 2069 7369 6e73 7461       and isinsta
+0000d170: 6e63 6528 666f 7263 655f 6f75 7470 7574  nce(force_output
+0000d180: 5f67 656f 6d65 7472 7974 7970 652c 2047  _geometrytype, G
+0000d190: 656f 6d65 7472 7954 7970 6529 0a20 2020  eometryType).   
+0000d1a0: 2029 3a0a 2020 2020 2020 2020 2320 4966   ):.        # If
+0000d1b0: 2074 6865 2067 6466 2069 7320 656d 7074   the gdf is empt
+0000d1c0: 7920 6275 7420 6120 6765 6f6d 6574 7279  y but a geometry
+0000d1d0: 2074 7970 6520 6973 2073 7065 6369 6669   type is specifi
+0000d1e0: 6564 2c20 7573 6520 7468 6520 7370 6563  ed, use the spec
+0000d1f0: 6966 6965 6420 7479 7065 0a20 2020 2020  ified type.     
+0000d200: 2020 2073 6368 656d 6120 3d20 6770 645f     schema = gpd_
+0000d210: 696f 5f66 696c 652e 696e 6665 725f 7363  io_file.infer_sc
+0000d220: 6865 6d61 2867 6466 290a 2020 2020 2020  hema(gdf).      
+0000d230: 2020 2320 4765 6f6d 6574 7279 2074 7970    # Geometry typ
+0000d240: 6520 6d75 7374 2062 6520 696e 2063 616d  e must be in cam
+0000d250: 656c 6361 7365 2066 6f72 2066 696f 6e61  elcase for fiona
+0000d260: 0a20 2020 2020 2020 2073 6368 656d 615b  .        schema[
+0000d270: 2267 656f 6d65 7472 7922 5d20 3d20 666f  "geometry"] = fo
+0000d280: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
+0000d290: 7472 7974 7970 652e 6e61 6d65 5f63 616d  trytype.name_cam
+0000d2a0: 656c 6361 7365 0a20 2020 2061 7373 6572  elcase.    asser
+0000d2b0: 7420 6973 696e 7374 616e 6365 2867 6466  t isinstance(gdf
+0000d2c0: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
+0000d2d0: 6d65 290a 0a20 2020 2023 2043 6f6e 7665  me)..    # Conve
+0000d2e0: 7274 2066 6f72 6365 5f6f 7574 7075 745f  rt force_output_
+0000d2f0: 6765 6f6d 6574 7279 7479 7065 2074 6f20  geometrytype to 
+0000d300: 7374 7269 6e67 2074 6f20 7369 6d70 6c69  string to simpli
+0000d310: 6679 2063 6f64 6520 6166 7465 7277 6172  fy code afterwar
+0000d320: 6473 0a20 2020 2069 6620 6973 696e 7374  ds.    if isinst
+0000d330: 616e 6365 2866 6f72 6365 5f6f 7574 7075  ance(force_outpu
+0000d340: 745f 6765 6f6d 6574 7279 7479 7065 2c20  t_geometrytype, 
+0000d350: 4765 6f6d 6574 7279 5479 7065 293a 0a20  GeometryType):. 
+0000d360: 2020 2020 2020 2066 6f72 6365 5f6f 7574         force_out
+0000d370: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
+0000d380: 203d 2066 6f72 6365 5f6f 7574 7075 745f   = force_output_
+0000d390: 6765 6f6d 6574 7279 7479 7065 2e6e 616d  geometrytype.nam
+0000d3a0: 650a 0a20 2020 2023 204e 6f20 7468 6520  e..    # No the 
+0000d3b0: 6669 6c65 2063 616e 2061 6374 7561 6c6c  file can actuall
+0000d3c0: 7920 6265 2077 7269 7474 656e 0a20 2020  y be written.   
+0000d3d0: 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   # -------------
+0000d3e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000d3f0: 2d2d 2d2d 2d2d 0a20 2020 2023 2046 696f  ------.    # Fio
+0000d400: 6e61 2064 6f65 736e 2774 2073 7570 706f  na doesn't suppo
+0000d410: 7274 2074 6865 206f 7574 7075 7420 6765  rt the output ge
+0000d420: 6f6d 6574 7279 7479 7065 2070 6172 616d  ometrytype param
+0000d430: 6574 6572 2061 7320 7573 6564 2069 6e20  eter as used in 
+0000d440: 6764 616c 2c20 736f 2061 7320 610a 2020  gdal, so as a.  
+0000d450: 2020 2320 6c69 6768 7477 6569 6768 7420    # lightweight 
+0000d460: 696d 706c 656d 656e 7461 7469 6f6e 206a  implementation j
+0000d470: 7573 7420 7365 7420 666f 7263 650a 2020  ust set force.  
+0000d480: 2020 6465 6620 7772 6974 655f 746f 5f66    def write_to_f
+0000d490: 696c 6528 0a20 2020 2020 2020 2067 6466  ile(.        gdf
+0000d4a0: 3a20 6770 642e 4765 6f44 6174 6146 7261  : gpd.GeoDataFra
+0000d4b0: 6d65 2c0a 2020 2020 2020 2020 7061 7468  me,.        path
+0000d4c0: 3a20 5061 7468 2c0a 2020 2020 2020 2020  : Path,.        
+0000d4d0: 6c61 7965 723a 2073 7472 2c0a 2020 2020  layer: str,.    
+0000d4e0: 2020 2020 696e 6465 783a 204f 7074 696f      index: Optio
+0000d4f0: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
+0000d500: 2c0a 2020 2020 2020 2020 666f 7263 655f  ,.        force_
+0000d510: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+0000d520: 7970 653a 204f 7074 696f 6e61 6c5b 7374  ype: Optional[st
+0000d530: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+0000d540: 2020 2066 6f72 6365 5f6d 756c 7469 7479     force_multity
+0000d550: 7065 3a20 626f 6f6c 203d 2046 616c 7365  pe: bool = False
+0000d560: 2c0a 2020 2020 2020 2020 6170 7065 6e64  ,.        append
+0000d570: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000d580: 2020 2020 2020 2020 7363 6865 6d61 3a20          schema: 
+0000d590: 4f70 7469 6f6e 616c 5b64 6963 745d 203d  Optional[dict] =
+0000d5a0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
+0000d5b0: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
+0000d5c0: 6465 783a 204f 7074 696f 6e61 6c5b 626f  dex: Optional[bo
+0000d5d0: 6f6c 5d20 3d20 5472 7565 2c0a 2020 2020  ol] = True,.    
+0000d5e0: 293a 0a20 2020 2020 2020 2023 2050 7265  ):.        # Pre
+0000d5f0: 7061 7265 2061 7267 7320 666f 7220 746f  pare args for to
+0000d600: 5f66 696c 650a 2020 2020 2020 2020 6966  _file.        if
+0000d610: 2061 7070 656e 6420 6973 2054 7275 653a   append is True:
+0000d620: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d630: 7061 7468 2e65 7869 7374 7328 293a 0a20  path.exists():. 
+0000d640: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000d650: 6f64 6520 3d20 2261 220a 2020 2020 2020  ode = "a".      
+0000d660: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d670: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000d680: 203d 2022 7722 0a20 2020 2020 2020 2065   = "w".        e
+0000d690: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000d6a0: 206d 6f64 6520 3d20 2277 220a 0a20 2020   mode = "w"..   
+0000d6b0: 2020 2020 206b 7761 7267 7320 3d20 7b7d       kwargs = {}
+0000d6c0: 0a20 2020 2020 2020 206b 7761 7267 735b  .        kwargs[
+0000d6d0: 2265 6e67 696e 6522 5d20 3d20 2266 696f  "engine"] = "fio
+0000d6e0: 6e61 220a 2020 2020 2020 2020 6b77 6172  na".        kwar
+0000d6f0: 6773 5b22 6d6f 6465 225d 203d 206d 6f64  gs["mode"] = mod
+0000d700: 650a 2020 2020 2020 2020 6765 6f66 696c  e.        geofil
+0000d710: 6574 7970 6520 3d20 4765 6f66 696c 6554  etype = GeofileT
+0000d720: 7970 6528 7061 7468 290a 2020 2020 2020  ype(path).      
+0000d730: 2020 6b77 6172 6773 5b22 6472 6976 6572    kwargs["driver
+0000d740: 225d 203d 2067 656f 6669 6c65 7479 7065  "] = geofiletype
+0000d750: 2e6f 6772 6472 6976 6572 0a20 2020 2020  .ogrdriver.     
+0000d760: 2020 206b 7761 7267 735b 2269 6e64 6578     kwargs["index
+0000d770: 225d 203d 2069 6e64 6578 0a20 2020 2020  "] = index.     
+0000d780: 2020 2069 6620 6372 6561 7465 5f73 7061     if create_spa
+0000d790: 7469 616c 5f69 6e64 6578 2069 7320 6e6f  tial_index is no
+0000d7a0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000d7b0: 2020 2020 6b77 6172 6773 5b22 5350 4154      kwargs["SPAT
+0000d7c0: 4941 4c5f 494e 4445 5822 5d20 3d20 6372  IAL_INDEX"] = cr
+0000d7d0: 6561 7465 5f73 7061 7469 616c 5f69 6e64  eate_spatial_ind
+0000d7e0: 6578 0a20 2020 2020 2020 2069 6620 666f  ex.        if fo
+0000d7f0: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
+0000d800: 7472 7974 7970 6520 6973 206e 6f74 204e  trytype is not N
+0000d810: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000d820: 206b 7761 7267 735b 2267 656f 6d65 7472   kwargs["geometr
+0000d830: 7974 7970 6522 5d20 3d20 666f 7263 655f  ytype"] = force_
+0000d840: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+0000d850: 7970 650a 2020 2020 2020 2020 6966 2073  ype.        if s
+0000d860: 6368 656d 6120 6973 206e 6f74 204e 6f6e  chema is not Non
+0000d870: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
+0000d880: 7761 7267 735b 2273 6368 656d 6122 5d20  wargs["schema"] 
+0000d890: 3d20 7363 6865 6d61 0a0a 2020 2020 2020  = schema..      
+0000d8a0: 2020 2320 4e6f 7720 7765 2063 616e 2077    # Now we can w
+0000d8b0: 7269 7465 0a20 2020 2020 2020 2069 6620  rite.        if 
+0000d8c0: 6765 6f66 696c 6574 7970 6520 3d3d 2047  geofiletype == G
+0000d8d0: 656f 6669 6c65 5479 7065 2e45 5352 4953  eofileType.ESRIS
+0000d8e0: 6861 7065 6669 6c65 3a0a 2020 2020 2020  hapefile:.      
+0000d8f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000d900: 2020 2020 2020 6966 2069 6e64 6578 2069        if index i
+0000d910: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+0000d920: 2020 2020 2020 2020 6764 665f 746f 5f77          gdf_to_w
+0000d930: 7269 7465 203d 2067 6466 2e72 6573 6574  rite = gdf.reset
+0000d940: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+0000d950: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000d960: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d970: 2020 2020 6764 665f 746f 5f77 7269 7465      gdf_to_write
+0000d980: 203d 2067 6466 0a20 2020 2020 2020 2020   = gdf.         
+0000d990: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+0000d9a0: 2020 2067 6466 2e74 6f5f 6669 6c65 2873     gdf.to_file(s
+0000d9b0: 7472 2870 6174 6829 2c20 2a2a 6b77 6172  tr(path), **kwar
+0000d9c0: 6773 290a 2020 2020 2020 2020 656c 6966  gs).        elif
+0000d9d0: 2067 656f 6669 6c65 7479 7065 203d 3d20   geofiletype == 
+0000d9e0: 4765 6f66 696c 6554 7970 652e 4750 4b47  GeofileType.GPKG
+0000d9f0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000da00: 5472 7920 746f 2068 6172 6d6f 6e69 7a65  Try to harmonize
+0000da10: 2074 6865 2067 656f 6d65 7472 7974 7970   the geometrytyp
+0000da20: 6520 746f 206f 6e65 2028 6d75 6c74 6929  e to one (multi)
+0000da30: 7479 7065 2c20 6173 2047 504b 470a 2020  type, as GPKG.  
+0000da40: 2020 2020 2020 2020 2020 2320 646f 6573            # does
+0000da50: 6e27 7420 6c69 6b65 203e 2031 2074 7970  n't like > 1 typ
+0000da60: 6520 696e 2061 206c 6179 6572 0a20 2020  e in a layer.   
+0000da70: 2020 2020 2020 2020 2069 6620 7363 6865           if sche
+0000da80: 6d61 2069 7320 4e6f 6e65 206f 7220 286c  ma is None or (l
+0000da90: 656e 2867 6466 2920 3e20 3020 616e 6420  en(gdf) > 0 and 
+0000daa0: 7363 6865 6d61 5b22 6765 6f6d 6574 7279  schema["geometry
+0000dab0: 225d 2021 3d20 224e 6f6e 6522 293a 0a20  "] != "None"):. 
+0000dac0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000dad0: 6466 203d 2067 6466 2e63 6f70 7928 290a  df = gdf.copy().
+0000dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daf0: 6764 662e 6765 6f6d 6574 7279 203d 2067  gdf.geometry = g
+0000db00: 656f 7365 7269 6573 5f75 7469 6c2e 6861  eoseries_util.ha
+0000db10: 726d 6f6e 697a 655f 6765 6f6d 6574 7279  rmonize_geometry
+0000db20: 7479 7065 7328 0a20 2020 2020 2020 2020  types(.         
+0000db30: 2020 2020 2020 2020 2020 2067 6466 2e67             gdf.g
+0000db40: 656f 6d65 7472 792c 2066 6f72 6365 5f6d  eometry, force_m
+0000db50: 756c 7469 7479 7065 3d66 6f72 6365 5f6d  ultitype=force_m
+0000db60: 756c 7469 7479 7065 0a20 2020 2020 2020  ultitype.       
+0000db70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000db80: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000db90: 7420 6973 696e 7374 616e 6365 2867 6466  t isinstance(gdf
+0000dba0: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
+0000dbb0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000dbc0: 6764 662e 746f 5f66 696c 6528 7374 7228  gdf.to_file(str(
+0000dbd0: 7061 7468 292c 206c 6179 6572 3d6c 6179  path), layer=lay
+0000dbe0: 6572 2c20 2a2a 6b77 6172 6773 290a 2020  er, **kwargs).  
+0000dbf0: 2020 2020 2020 656c 6966 2067 656f 6669        elif geofi
+0000dc00: 6c65 7479 7065 203d 3d20 4765 6f66 696c  letype == Geofil
+0000dc10: 6554 7970 652e 5351 4c69 7465 3a0a 2020  eType.SQLite:.  
+0000dc20: 2020 2020 2020 2020 2020 6764 662e 746f            gdf.to
+0000dc30: 5f66 696c 6528 7374 7228 7061 7468 292c  _file(str(path),
+0000dc40: 206c 6179 6572 3d6c 6179 6572 2c20 2a2a   layer=layer, **
+0000dc50: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0000dc60: 656c 6966 2067 656f 6669 6c65 7479 7065  elif geofiletype
+0000dc70: 203d 3d20 4765 6f66 696c 6554 7970 652e   == GeofileType.
+0000dc80: 4765 6f4a 534f 4e3a 0a20 2020 2020 2020  GeoJSON:.       
+0000dc90: 2020 2020 2067 6466 2e74 6f5f 6669 6c65       gdf.to_file
+0000dca0: 2873 7472 2870 6174 6829 2c20 2a2a 6b77  (str(path), **kw
+0000dcb0: 6172 6773 290a 2020 2020 2020 2020 656c  args).        el
+0000dcc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000dcd0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000dce0: 2866 224e 6f74 2069 6d70 6c65 6d65 6e74  (f"Not implement
+0000dcf0: 6564 2066 6f72 2067 656f 6669 6c65 7479  ed for geofilety
+0000dd00: 7065 207b 6765 6f66 696c 6574 7970 657d  pe {geofiletype}
+0000dd10: 2229 0a0a 2020 2020 2320 4966 206e 6f20  ")..    # If no 
+0000dd20: 6170 7065 6e64 2c20 6a75 7374 2077 7269  append, just wri
+0000dd30: 7465 2074 6f20 6f75 7470 7574 2070 6174  te to output pat
+0000dd40: 680a 2020 2020 6966 206e 6f74 2061 7070  h.    if not app
+0000dd50: 656e 643a 0a20 2020 2020 2020 2077 7269  end:.        wri
+0000dd60: 7465 5f74 6f5f 6669 6c65 280a 2020 2020  te_to_file(.    
+0000dd70: 2020 2020 2020 2020 6764 663d 6764 662c          gdf=gdf,
+0000dd80: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+0000dd90: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
+0000dda0: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
+0000ddb0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0000ddc0: 6578 3d69 6e64 6578 2c0a 2020 2020 2020  ex=index,.      
+0000ddd0: 2020 2020 2020 666f 7263 655f 6f75 7470        force_outp
+0000dde0: 7574 5f67 656f 6d65 7472 7974 7970 653d  ut_geometrytype=
+0000ddf0: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
+0000de00: 6d65 7472 7974 7970 652c 0a20 2020 2020  metrytype,.     
+0000de10: 2020 2020 2020 2066 6f72 6365 5f6d 756c         force_mul
+0000de20: 7469 7479 7065 3d66 6f72 6365 5f6d 756c  titype=force_mul
+0000de30: 7469 7479 7065 2c0a 2020 2020 2020 2020  titype,.        
+0000de40: 2020 2020 6170 7065 6e64 3d61 7070 656e      append=appen
+0000de50: 642c 0a20 2020 2020 2020 2020 2020 2073  d,.            s
+0000de60: 6368 656d 613d 7363 6865 6d61 2c0a 2020  chema=schema,.  
+0000de70: 2020 2020 2020 2020 2020 6372 6561 7465            create
+0000de80: 5f73 7061 7469 616c 5f69 6e64 6578 3d63  _spatial_index=c
+0000de90: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
+0000dea0: 6465 782c 0a20 2020 2020 2020 2029 0a20  dex,.        ). 
+0000deb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000dec0: 2023 2041 7070 656e 6420 6973 2061 736b   # Append is ask
+0000ded0: 6564 2c20 6368 6563 6b20 6966 2074 6865  ed, check if the
+0000dee0: 2066 696f 6e61 2064 7269 7665 7220 7375   fiona driver su
+0000def0: 7070 6f72 7473 2061 7070 656e 6469 6e67  pports appending
+0000df00: 2e20 4966 0a20 2020 2020 2020 2023 206e  . If.        # n
+0000df10: 6f74 2c20 7772 6974 6520 746f 2074 656d  ot, write to tem
+0000df20: 706f 7261 7279 206f 7574 7075 7420 6669  porary output fi
+0000df30: 6c65 0a0a 2020 2020 2020 2020 2320 5265  le..        # Re
+0000df40: 6d61 726b 3a20 6669 6f6e 6120 7072 652d  mark: fiona pre-
+0000df50: 312e 382e 3134 2064 6964 6e27 7420 7375  1.8.14 didn't su
+0000df60: 7070 6f72 7420 6170 7065 6e64 696e 6720  pport appending 
+0000df70: 746f 2067 656f 7061 636b 6167 652e 204f  to geopackage. O
+0000df80: 6e63 650a 2020 2020 2020 2020 2320 6f6c  nce.        # ol
+0000df90: 6465 7220 7665 7273 696f 6e73 2062 6563  der versions bec
+0000dfa0: 6f6d 6573 2072 6172 652c 2064 6570 656e  omes rare, depen
+0000dfb0: 6465 6e63 7920 6361 6e20 6265 2070 7574  dency can be put
+0000dfc0: 2074 6f20 7468 6973 2076 6572 7369 6f6e   to this version
+0000dfd0: 2c20 616e 640a 2020 2020 2020 2020 2320  , and.        # 
+0000dfe0: 7468 6973 2063 6f64 6520 6361 6e20 6265  this code can be
+0000dff0: 2063 6c65 616e 6564 2075 702e 2e2e 0a20   cleaned up.... 
+0000e000: 2020 2020 2020 2067 656f 6669 6c65 7479         geofilety
+0000e010: 7065 203d 2047 656f 6669 6c65 5479 7065  pe = GeofileType
+0000e020: 2870 6174 6829 0a20 2020 2020 2020 2067  (path).        g
+0000e030: 6466 7465 6d70 5f70 6174 6820 3d20 4e6f  dftemp_path = No
+0000e040: 6e65 0a20 2020 2020 2020 2067 6466 7465  ne.        gdfte
+0000e050: 6d70 5f6c 6f63 6b70 6174 6820 3d20 4e6f  mp_lockpath = No
+0000e060: 6e65 0a20 2020 2020 2020 2069 6620 2261  ne.        if "a
+0000e070: 2220 6e6f 7420 696e 2066 696f 6e61 2e73  " not in fiona.s
+0000e080: 7570 706f 7274 6564 5f64 7269 7665 7273  upported_drivers
+0000e090: 5b67 656f 6669 6c65 7479 7065 2e6f 6772  [geofiletype.ogr
+0000e0a0: 6472 6976 6572 5d3a 0a20 2020 2020 2020  driver]:.       
+0000e0b0: 2020 2020 2023 2047 6574 2061 2075 6e69       # Get a uni
+0000e0c0: 7175 6520 7465 6d70 2066 696c 6520 7061  que temp file pa
+0000e0d0: 7468 2e20 5468 6520 6669 6c65 2063 616e  th. The file can
+0000e0e0: 6e6f 7420 6265 2063 7265 6174 6564 2079  not be created y
+0000e0f0: 6574 2c20 736f 0a20 2020 2020 2020 2020  et, so.         
+0000e100: 2020 2023 206f 6e6c 7920 6372 6561 7465     # only create
+0000e110: 2061 206c 6f63 6b20 6669 6c65 2074 6f20   a lock file to 
+0000e120: 6576 6164 6520 6f74 6865 7220 7072 6f63  evade other proc
+0000e130: 6573 7365 7320 7573 696e 6720 7468 6520  esses using the 
+0000e140: 7361 6d65 0a20 2020 2020 2020 2020 2020  same.           
+0000e150: 2023 2074 656d 7020 6669 6c65 206e 616d   # temp file nam
+0000e160: 650a 2020 2020 2020 2020 2020 2020 6764  e.            gd
+0000e170: 6674 656d 705f 7061 7468 2c20 6764 6674  ftemp_path, gdft
+0000e180: 656d 705f 6c6f 636b 7061 7468 203d 205f  emp_lockpath = _
+0000e190: 696f 5f75 7469 6c2e 6765 745f 7465 6d70  io_util.get_temp
+0000e1a0: 6669 6c65 5f6c 6f63 6b65 6428 0a20 2020  file_locked(.   
+0000e1b0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0000e1c0: 655f 6669 6c65 6e61 6d65 3d22 6764 6674  e_filename="gdft
+0000e1d0: 656d 7022 2c20 7375 6666 6978 3d70 6174  emp", suffix=pat
+0000e1e0: 682e 7375 6666 6978 2c20 6469 726e 616d  h.suffix, dirnam
+0000e1f0: 653d 2267 656f 6669 6c65 5f74 6f5f 6669  e="geofile_to_fi
+0000e200: 6c65 220a 2020 2020 2020 2020 2020 2020  le".            
+0000e210: 290a 2020 2020 2020 2020 2020 2020 7772  ).            wr
+0000e220: 6974 655f 746f 5f66 696c 6528 0a20 2020  ite_to_file(.   
+0000e230: 2020 2020 2020 2020 2020 2020 2067 6466               gdf
+0000e240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e250: 2020 7061 7468 3d67 6466 7465 6d70 5f70    path=gdftemp_p
+0000e260: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000e270: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+0000e280: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e290: 2020 696e 6465 783d 696e 6465 782c 0a20    index=index,. 
+0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e2b0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+0000e2c0: 6574 7279 7479 7065 3d66 6f72 6365 5f6f  etrytype=force_o
+0000e2d0: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
+0000e2e0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+0000e2f0: 2020 2020 666f 7263 655f 6d75 6c74 6974      force_multit
+0000e300: 7970 653d 666f 7263 655f 6d75 6c74 6974  ype=force_multit
+0000e310: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000e320: 2020 2020 2073 6368 656d 613d 7363 6865       schema=sche
+0000e330: 6d61 2c0a 2020 2020 2020 2020 2020 2020  ma,.            
+0000e340: 2020 2020 6372 6561 7465 5f73 7061 7469      create_spati
+0000e350: 616c 5f69 6e64 6578 3d63 7265 6174 655f  al_index=create_
+0000e360: 7370 6174 6961 6c5f 696e 6465 782c 0a20  spatial_index,. 
+0000e370: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000e380: 2020 2020 2020 2320 4669 6c65 7320 646f        # Files do
+0000e390: 6e27 7420 7479 7069 6361 6c6c 7920 7375  n't typically su
+0000e3a0: 7070 6f72 7420 6861 7669 6e67 206d 756c  pport having mul
+0000e3b0: 7469 706c 6520 7072 6f63 6573 7365 7320  tiple processes 
+0000e3c0: 7772 6974 696e 670a 2020 2020 2020 2020  writing.        
+0000e3d0: 2320 7369 6d75 6c74 616e 6f75 736c 7920  # simultanously 
+0000e3e0: 746f 2074 6865 6d2c 2073 6f20 7573 6520  to them, so use 
+0000e3f0: 6c6f 636b 2066 696c 6520 746f 2073 796e  lock file to syn
+0000e400: 6368 726f 6e69 7a65 2061 6363 6573 732e  chronize access.
+0000e410: 0a20 2020 2020 2020 206c 6f63 6b66 696c  .        lockfil
+0000e420: 6520 3d20 5061 7468 2866 227b 7374 7228  e = Path(f"{str(
+0000e430: 7061 7468 297d 2e6c 6f63 6b22 290a 2020  path)}.lock").  
+0000e440: 2020 2020 2020 7374 6172 745f 7469 6d65        start_time
+0000e450: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+0000e460: 7469 6d65 2e6e 6f77 2829 0a20 2020 2020  time.now().     
+0000e470: 2020 2072 6561 6479 203d 2046 616c 7365     ready = False
+0000e480: 0a20 2020 2020 2020 2077 6869 6c65 206e  .        while n
+0000e490: 6f74 2072 6561 6479 3a0a 2020 2020 2020  ot ready:.      
+0000e4a0: 2020 2020 2020 6966 205f 696f 5f75 7469        if _io_uti
+0000e4b0: 6c2e 6372 6561 7465 5f66 696c 655f 6174  l.create_file_at
+0000e4c0: 6f6d 6963 286c 6f63 6b66 696c 6529 2069  omic(lockfile) i
+0000e4d0: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+0000e4e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e500: 2023 2049 6620 6764 6620 7761 736e 2774   # If gdf wasn't
+0000e510: 2077 7269 7474 656e 2074 6f20 7465 6d70   written to temp
+0000e520: 2066 696c 652c 2075 7365 2073 7461 6e64   file, use stand
+0000e530: 6172 6420 7772 6974 652d 746f 2d66 696c  ard write-to-fil
+0000e540: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000e550: 2020 2020 2020 6966 2067 6466 7465 6d70        if gdftemp
+0000e560: 5f70 6174 6820 6973 204e 6f6e 653a 0a20  _path is None:. 
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e580: 2020 2020 2020 2077 7269 7465 5f74 6f5f         write_to_
+0000e590: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
 0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5b0: 2020 2020 2020 2020 2020 2020 666f 7263              forc
-0000e5c0: 655f 6d75 6c74 6974 7970 653d 666f 7263  e_multitype=forc
-0000e5d0: 655f 6d75 6c74 6974 7970 652c 0a20 2020  e_multitype,.   
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 2061 7070 656e 643d           append=
-0000e600: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000e5b0: 2020 6764 663d 6764 662c 0a20 2020 2020    gdf=gdf,.     
+0000e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5d0: 2020 2020 2020 2070 6174 683d 7061 7468         path=path
+0000e5e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e5f0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000e600: 7965 723d 6c61 7965 722c 0a20 2020 2020  yer=layer,.     
 0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e620: 2020 7363 6865 6d61 3d73 6368 656d 612c    schema=schema,
-0000e630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e640: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-0000e650: 6174 655f 7370 6174 6961 6c5f 696e 6465  ate_spatial_inde
-0000e660: 783d 6372 6561 7465 5f73 7061 7469 616c  x=create_spatial
-0000e670: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
-0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e6a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6c0: 2020 2020 2320 4966 2067 6466 2077 7269      # If gdf wri
-0000e6d0: 7474 656e 2074 6f20 7465 6d70 2066 696c  tten to temp fil
-0000e6e0: 652c 2075 7365 2061 7070 656e 645f 746f  e, use append_to
-0000e6f0: 5f6e 6f6c 6f63 6b20 2b20 636c 6561 6e75  _nolock + cleanu
-0000e700: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-0000e710: 2020 2020 2020 2020 2020 5f61 7070 656e            _appen
-0000e720: 645f 746f 5f6e 6f6c 6f63 6b28 0a20 2020  d_to_nolock(.   
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 2020 2020 2020 2020 2073 7263 3d67 6466           src=gdf
-0000e750: 7465 6d70 5f70 6174 682c 0a20 2020 2020  temp_path,.     
+0000e620: 2020 2020 2020 2069 6e64 6578 3d69 6e64         index=ind
+0000e630: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
+0000e660: 6d65 7472 7974 7970 653d 666f 7263 655f  metrytype=force_
+0000e670: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+0000e680: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6a0: 2066 6f72 6365 5f6d 756c 7469 7479 7065   force_multitype
+0000e6b0: 3d66 6f72 6365 5f6d 756c 7469 7479 7065  =force_multitype
+0000e6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e6d0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0000e6e0: 7065 6e64 3d54 7275 652c 0a20 2020 2020  pend=True,.     
+0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e700: 2020 2020 2020 2073 6368 656d 613d 7363         schema=sc
+0000e710: 6865 6d61 2c0a 2020 2020 2020 2020 2020  hema,.          
+0000e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e730: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
+0000e740: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
+0000e750: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
 0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e770: 2020 2020 2020 2064 7374 3d70 6174 682c         dst=path,
-0000e780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e790: 2020 2020 2020 2020 2020 2020 2064 7374               dst
-0000e7a0: 5f6c 6179 6572 3d6c 6179 6572 2c0a 2020  _layer=layer,.  
-0000e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7c0: 2020 2020 2020 2020 2020 666f 7263 655f            force_
-0000e7d0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-0000e7e0: 7970 653d 666f 7263 655f 6f75 7470 7574  ype=force_output
-0000e7f0: 5f67 656f 6d65 7472 7974 7970 652c 0a20  _geometrytype,. 
-0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e810: 2020 2020 2020 2020 2020 2063 7265 6174             creat
-0000e820: 655f 7370 6174 6961 6c5f 696e 6465 783d  e_spatial_index=
-0000e830: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
-0000e840: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-0000e850: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e870: 2020 2020 2020 2020 7265 6d6f 7665 2867          remove(g
-0000e880: 6466 7465 6d70 5f70 6174 6829 0a20 2020  dftemp_path).   
-0000e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8a0: 2020 2020 2069 6620 6764 6674 656d 705f       if gdftemp_
-0000e8b0: 6c6f 636b 7061 7468 2069 7320 6e6f 7420  lockpath is not 
-0000e8c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8e0: 2020 6764 6674 656d 705f 6c6f 636b 7061    gdftemp_lockpa
-0000e8f0: 7468 2e75 6e6c 696e 6b28 290a 2020 2020  th.unlink().    
-0000e900: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000e910: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0000e920: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
-0000e930: 2020 2020 2020 2020 2320 4966 2073 716c          # If sql
-0000e940: 6974 6520 6f75 7470 7574 2066 696c 6520  ite output file 
-0000e950: 6c6f 636b 6564 2c20 616c 736f 2072 6574  locked, also ret
-0000e960: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-0000e970: 2020 2020 2020 2069 6620 6765 6f66 696c         if geofil
-0000e980: 6574 7970 652e 6973 5f73 7061 7469 616c  etype.is_spatial
-0000e990: 6974 655f 6261 7365 6420 616e 6420 7374  ite_based and st
-0000e9a0: 7228 6578 2920 6e6f 7420 696e 205b 0a20  r(ex) not in [. 
+0000e770: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000e780: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000e790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e7a0: 2020 2020 2020 2020 2023 2049 6620 6764           # If gd
+0000e7b0: 6620 7772 6974 7465 6e20 746f 2074 656d  f written to tem
+0000e7c0: 7020 6669 6c65 2c20 7573 6520 6170 7065  p file, use appe
+0000e7d0: 6e64 5f74 6f5f 6e6f 6c6f 636b 202b 2063  nd_to_nolock + c
+0000e7e0: 6c65 616e 7570 0a20 2020 2020 2020 2020  leanup.         
+0000e7f0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000e800: 6170 7065 6e64 5f74 6f5f 6e6f 6c6f 636b  append_to_nolock
+0000e810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e820: 2020 2020 2020 2020 2020 2020 2020 7372                sr
+0000e830: 633d 6764 6674 656d 705f 7061 7468 2c0a  c=gdftemp_path,.
+0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e850: 2020 2020 2020 2020 2020 2020 6473 743d              dst=
+0000e860: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e880: 2020 6473 745f 6c61 7965 723d 6c61 7965    dst_layer=laye
+0000e890: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e8b0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+0000e8c0: 6574 7279 7479 7065 3d66 6f72 6365 5f6f  etrytype=force_o
+0000e8d0: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
+0000e8e0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+0000e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e900: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
+0000e910: 6e64 6578 3d63 7265 6174 655f 7370 6174  ndex=create_spat
+0000e920: 6961 6c5f 696e 6465 782c 0a20 2020 2020  ial_index,.     
+0000e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e940: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000e950: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+0000e960: 6f76 6528 6764 6674 656d 705f 7061 7468  ove(gdftemp_path
+0000e970: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e980: 2020 2020 2020 2020 2020 6966 2067 6466            if gdf
+0000e990: 7465 6d70 5f6c 6f63 6b70 6174 6820 6973  temp_lockpath is
+0000e9a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
 0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9c0: 2020 2020 2020 2022 6461 7461 6261 7365         "database
-0000e9d0: 2069 7320 6c6f 636b 6564 222c 0a20 2020   is locked",.   
-0000e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9f0: 2020 2020 2022 6174 7465 6d70 7420 746f       "attempt to
-0000ea00: 2077 7269 7465 2061 2072 6561 646f 6e6c   write a readonl
-0000ea10: 7920 6461 7461 6261 7365 222c 0a20 2020  y database",.   
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
-0000ea40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000ea50: 6520 6578 0a20 2020 2020 2020 2020 2020  e ex.           
-0000ea60: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
-0000ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea80: 2020 7265 6164 7920 3d20 5472 7565 0a20    ready = True. 
-0000ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eaa0: 2020 206c 6f63 6b66 696c 652e 756e 6c69     lockfile.unli
-0000eab0: 6e6b 2829 0a20 2020 2020 2020 2020 2020  nk().           
-0000eac0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000ead0: 2020 2020 2020 2074 696d 655f 7761 6974         time_wait
-0000eae0: 696e 6720 3d20 2864 6174 6574 696d 652e  ing = (datetime.
-0000eaf0: 6461 7465 7469 6d65 2e6e 6f77 2829 202d  datetime.now() -
-0000eb00: 2073 7461 7274 5f74 696d 6529 2e74 6f74   start_time).tot
-0000eb10: 616c 5f73 6563 6f6e 6473 2829 0a20 2020  al_seconds().   
-0000eb20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000eb30: 7469 6d65 5f77 6169 7469 6e67 203e 2061  time_waiting > a
-0000eb40: 7070 656e 645f 7469 6d65 6f75 745f 733a  ppend_timeout_s:
-0000eb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb60: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000eb70: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-0000eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb90: 2066 2274 6f5f 6669 6c65 2074 696d 656f   f"to_file timeo
-0000eba0: 7574 206f 6620 7b61 7070 656e 645f 7469  ut of {append_ti
-0000ebb0: 6d65 6f75 745f 737d 2072 6561 6368 6564  meout_s} reached
-0000ebc0: 2c20 7374 6f70 2061 7070 656e 6420 220a  , stop append ".
-0000ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebe0: 2020 2020 2020 2020 6622 746f 207b 7061          f"to {pa
-0000ebf0: 7468 7d21 220a 2020 2020 2020 2020 2020  th}!".          
-0000ec00: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000ec10: 2020 2020 2020 2020 2023 2053 6c65 6570           # Sleep
-0000ec20: 2066 6f72 2061 2073 6563 6f6e 6420 6265   for a second be
-0000ec30: 666f 7265 2074 7279 696e 6720 6167 6169  fore trying agai
-0000ec40: 6e0a 2020 2020 2020 2020 2020 2020 7469  n.            ti
-0000ec50: 6d65 2e73 6c65 6570 2831 290a 0a0a 6465  me.sleep(1)...de
-0000ec60: 6620 5f74 6f5f 6669 6c65 5f70 796f 6772  f _to_file_pyogr
-0000ec70: 696f 280a 2020 2020 6764 663a 2067 7064  io(.    gdf: gpd
-0000ec80: 2e47 656f 4461 7461 4672 616d 652c 0a20  .GeoDataFrame,. 
-0000ec90: 2020 2070 6174 683a 2050 6174 682c 0a20     path: Path,. 
-0000eca0: 2020 206c 6179 6572 3a20 7374 722c 0a20     layer: str,. 
-0000ecb0: 2020 2066 6f72 6365 5f6f 7574 7075 745f     force_output_
-0000ecc0: 6765 6f6d 6574 7279 7479 7065 3a20 556e  geometrytype: Un
-0000ecd0: 696f 6e5b 4765 6f6d 6574 7279 5479 7065  ion[GeometryType
-0000ece0: 2c20 7374 722c 204e 6f6e 655d 203d 204e  , str, None] = N
-0000ecf0: 6f6e 652c 0a20 2020 2066 6f72 6365 5f6d  one,.    force_m
-0000ed00: 756c 7469 7479 7065 3a20 626f 6f6c 203d  ultitype: bool =
-0000ed10: 2046 616c 7365 2c0a 2020 2020 6170 7065   False,.    appe
-0000ed20: 6e64 3a20 626f 6f6c 203d 2046 616c 7365  nd: bool = False
-0000ed30: 2c0a 2020 2020 6170 7065 6e64 5f74 696d  ,.    append_tim
-0000ed40: 656f 7574 5f73 3a20 696e 7420 3d20 3630  eout_s: int = 60
-0000ed50: 302c 0a20 2020 2069 6e64 6578 3a20 4f70  0,.    index: Op
-0000ed60: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-0000ed70: 6f6e 652c 0a20 2020 2063 7265 6174 655f  one,.    create_
-0000ed80: 7370 6174 6961 6c5f 696e 6465 783a 204f  spatial_index: O
-0000ed90: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
-0000eda0: 5472 7565 2c0a 293a 0a20 2020 2022 2222  True,.):.    """
-0000edb0: 0a20 2020 2057 7269 7465 7320 6120 7061  .    Writes a pa
-0000edc0: 6e64 6173 2064 6174 6166 7261 6d65 2074  ndas dataframe t
-0000edd0: 6f20 6669 6c65 2075 7369 6e67 2070 796f  o file using pyo
-0000ede0: 6772 696f 2e0a 0a20 2020 2052 656d 6172  grio...    Remar
-0000edf0: 6b3a 2074 6869 7320 6675 6e63 7469 6f6e  k: this function
-0000ee00: 206f 6e6c 7920 7375 7070 6f72 7473 2077   only supports w
-0000ee10: 7269 7469 6e67 2047 656f 4461 7461 4672  riting GeoDataFr
-0000ee20: 616d 6573 2061 7420 7468 6520 6d6f 6d65  ames at the mome
-0000ee30: 6e74 2e0a 2020 2020 2222 220a 2020 2020  nt..    """.    
-0000ee40: 2320 5072 6570 6172 6520 6172 6773 2066  # Prepare args f
-0000ee50: 6f72 2077 7269 7465 5f64 6174 6166 7261  or write_datafra
-0000ee60: 6d65 0a20 2020 206b 7761 7267 7320 3d20  me.    kwargs = 
-0000ee70: 7b7d 0a20 2020 206b 7761 7267 735b 2265  {}.    kwargs["e
-0000ee80: 6e67 696e 6522 5d20 3d20 2270 796f 6772  ngine"] = "pyogr
-0000ee90: 696f 220a 0a20 2020 2023 2043 6865 636b  io"..    # Check
-0000eea0: 2075 7066 726f 6e74 2069 6620 6170 7065   upfront if appe
-0000eeb0: 6e64 2069 7320 676f 696e 6720 746f 2077  nd is going to w
-0000eec0: 6f72 6b20 746f 2067 6976 6520 6e69 6365  ork to give nice
-0000eed0: 2065 7272 6f72 0a20 2020 2069 6620 6170   error.    if ap
-0000eee0: 7065 6e64 2069 7320 5472 7565 2061 6e64  pend is True and
-0000eef0: 2070 6174 682e 6578 6973 7473 2829 3a0a   path.exists():.
-0000ef00: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-0000ef10: 6170 7065 6e64 225d 203d 2054 7275 650a  append"] = True.
-0000ef20: 2020 2020 2020 2020 6c61 7965 7269 6e66          layerinf
-0000ef30: 6f20 3d20 6765 745f 6c61 7965 7269 6e66  o = get_layerinf
-0000ef40: 6f28 7061 7468 2c20 6c61 7965 7229 0a20  o(path, layer). 
-0000ef50: 2020 2020 2020 2066 696c 655f 636f 6c73         file_cols
-0000ef60: 203d 205b 636f 6c2e 7570 7065 7228 2920   = [col.upper() 
-0000ef70: 666f 7220 636f 6c20 696e 206c 6179 6572  for col in layer
-0000ef80: 696e 666f 2e63 6f6c 756d 6e73 5d0a 2020  info.columns].  
-0000ef90: 2020 2020 2020 6764 665f 636f 6c73 203d        gdf_cols =
-0000efa0: 205b 636f 6c2e 7570 7065 7228 2920 666f   [col.upper() fo
-0000efb0: 7220 636f 6c20 696e 2067 6466 2e63 6f6c  r col in gdf.col
-0000efc0: 756d 6e73 2069 6620 636f 6c20 213d 2067  umns if col != g
-0000efd0: 6466 2e67 656f 6d65 7472 792e 6e61 6d65  df.geometry.name
-0000efe0: 5d0a 2020 2020 2020 2020 6966 2067 6466  ].        if gdf
-0000eff0: 5f63 6f6c 7320 213d 2066 696c 655f 636f  _cols != file_co
-0000f000: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
-0000f010: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000f020: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000f030: 2020 2264 6573 7469 6e61 7469 6f6e 206c    "destination l
-0000f040: 6179 6572 2064 6f65 736e 2774 2068 6176  ayer doesn't hav
-0000f050: 6520 7468 6520 7361 6d65 2063 6f6c 756d  e the same colum
-0000f060: 6e73 2061 7320 6764 663a 2022 0a20 2020  ns as gdf: ".   
-0000f070: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-0000f080: 6669 6c65 5f63 6f6c 737d 2076 7320 7b67  file_cols} vs {g
-0000f090: 6466 5f63 6f6c 737d 220a 2020 2020 2020  df_cols}".      
-0000f0a0: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-0000f0b0: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
-0000f0c0: 6e64 6578 2069 7320 6e6f 7420 4e6f 6e65  ndex is not None
-0000f0d0: 3a0a 2020 2020 2020 2020 6b77 6172 6773  :.        kwargs
-0000f0e0: 5b22 5350 4154 4941 4c5f 494e 4445 5822  ["SPATIAL_INDEX"
-0000f0f0: 5d20 3d20 6372 6561 7465 5f73 7061 7469  ] = create_spati
-0000f100: 616c 5f69 6e64 6578 0a20 2020 2067 656f  al_index.    geo
-0000f110: 6669 6c65 7479 7065 203d 2047 656f 6669  filetype = Geofi
-0000f120: 6c65 5479 7065 2870 6174 6829 0a20 2020  leType(path).   
-0000f130: 206b 7761 7267 735b 2264 7269 7665 7222   kwargs["driver"
-0000f140: 5d20 3d20 6765 6f66 696c 6574 7970 652e  ] = geofiletype.
-0000f150: 6f67 7264 7269 7665 720a 2020 2020 6b77  ogrdriver.    kw
-0000f160: 6172 6773 5b22 696e 6465 7822 5d20 3d20  args["index"] = 
-0000f170: 696e 6465 780a 2020 2020 6966 2063 7265  index.    if cre
-0000f180: 6174 655f 7370 6174 6961 6c5f 696e 6465  ate_spatial_inde
-0000f190: 7820 6973 206e 6f74 204e 6f6e 653a 0a20  x is not None:. 
-0000f1a0: 2020 2020 2020 206b 7761 7267 735b 2253         kwargs["S
-0000f1b0: 5041 5449 414c 5f49 4e44 4558 225d 203d  PATIAL_INDEX"] =
-0000f1c0: 2063 7265 6174 655f 7370 6174 6961 6c5f   create_spatial_
-0000f1d0: 696e 6465 780a 2020 2020 6966 2066 6f72  index.    if for
-0000f1e0: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
-0000f1f0: 7279 7479 7065 2069 7320 6e6f 7420 4e6f  rytype is not No
-0000f200: 6e65 3a0a 2020 2020 2020 2020 6966 2069  ne:.        if i
-0000f210: 7369 6e73 7461 6e63 6528 666f 7263 655f  sinstance(force_
-0000f220: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-0000f230: 7970 652c 2047 656f 6d65 7472 7954 7970  ype, GeometryTyp
-0000f240: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000f250: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
-0000f260: 6d65 7472 7974 7970 6520 3d20 666f 7263  metrytype = forc
-0000f270: 655f 6f75 7470 7574 5f67 656f 6d65 7472  e_output_geometr
-0000f280: 7974 7970 652e 6e61 6d65 5f63 616d 656c  ytype.name_camel
-0000f290: 6361 7365 0a20 2020 2020 2020 206b 7761  case.        kwa
-0000f2a0: 7267 735b 2267 656f 6d65 7472 795f 7479  rgs["geometry_ty
-0000f2b0: 7065 225d 203d 2066 6f72 6365 5f6f 7574  pe"] = force_out
-0000f2c0: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
-0000f2d0: 0a20 2020 2069 6620 666f 7263 655f 6d75  .    if force_mu
-0000f2e0: 6c74 6974 7970 653a 0a20 2020 2020 2020  ltitype:.       
-0000f2f0: 206b 7761 7267 735b 2270 726f 6d6f 7465   kwargs["promote
-0000f300: 5f74 6f5f 6d75 6c74 6922 5d20 3d20 5472  _to_multi"] = Tr
-0000f310: 7565 0a0a 2020 2020 2320 4e6f 7720 7765  ue..    # Now we
-0000f320: 2063 616e 2077 7269 7465 0a20 2020 2069   can write.    i
-0000f330: 6620 6765 6f66 696c 6574 7970 652e 6973  f geofiletype.is
-0000f340: 5f73 696e 676c 656c 6179 6572 3a0a 2020  _singlelayer:.  
-0000f350: 2020 2020 2020 6764 662e 746f 5f66 696c        gdf.to_fil
-0000f360: 6528 7374 7228 7061 7468 292c 202a 2a6b  e(str(path), **k
-0000f370: 7761 7267 7329 0a20 2020 2065 6c73 653a  wargs).    else:
-0000f380: 0a20 2020 2020 2020 2067 6466 2e74 6f5f  .        gdf.to_
-0000f390: 6669 6c65 2873 7472 2870 6174 6829 2c20  file(str(path), 
-0000f3a0: 6c61 7965 723d 6c61 7965 722c 202a 2a6b  layer=layer, **k
-0000f3b0: 7761 7267 7329 0a0a 0a64 6566 2067 6574  wargs)...def get
-0000f3c0: 5f63 7273 2870 6174 683a 2055 6e69 6f6e  _crs(path: Union
-0000f3d0: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
-0000f3e0: 6b65 5b41 6e79 5d22 5d29 202d 3e20 7079  ke[Any]"]) -> py
-0000f3f0: 7072 6f6a 2e43 5253 3a0a 2020 2020 2222  proj.CRS:.    ""
-0000f400: 220a 2020 2020 4765 7420 7468 6520 4352  ".    Get the CR
-0000f410: 5320 2870 726f 6a65 6374 696f 6e29 206f  S (projection) o
-0000f420: 6620 7468 6520 6669 6c65 0a0a 2020 2020  f the file..    
-0000f430: 4172 6773 3a0a 2020 2020 2020 2020 7061  Args:.        pa
-0000f440: 7468 2028 5061 7468 4c69 6b65 293a 2050  th (PathLike): P
-0000f450: 6174 6820 746f 2074 6865 2066 696c 652e  ath to the file.
-0000f460: 0a0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
-0000f470: 2020 2020 2020 2070 7970 726f 6a2e 4352         pyproj.CR
-0000f480: 533a 2054 6865 2070 726f 6a65 6374 696f  S: The projectio
-0000f490: 6e20 6f66 2074 6865 2066 696c 650a 2020  n of the file.  
-0000f4a0: 2020 2222 220a 2020 2020 2320 544f 444f    """.    # TODO
-0000f4b0: 3a20 7365 656d 7320 6c69 6b65 2073 7570  : seems like sup
-0000f4c0: 706f 7274 2066 6f72 206d 756c 7469 706c  port for multipl
-0000f4d0: 6520 6c61 7965 7273 2069 6e20 7468 6520  e layers in the 
-0000f4e0: 6669 6c65 2069 736e 2774 2068 6572 6520  file isn't here 
-0000f4f0: 7965 743f 3f3f 0a20 2020 2077 6974 6820  yet???.    with 
-0000f500: 6669 6f6e 612e 6f70 656e 2873 7472 2870  fiona.open(str(p
-0000f510: 6174 6829 2c20 2272 2229 2061 7320 6765  ath), "r") as ge
-0000f520: 6f66 696c 653a 0a20 2020 2020 2020 2061  ofile:.        a
-0000f530: 7373 6572 7420 6765 6f66 696c 6520 6973  ssert geofile is
-0000f540: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
-0000f550: 2020 7265 7475 726e 2070 7970 726f 6a2e    return pyproj.
-0000f560: 4352 5328 6765 6f66 696c 652e 6372 7329  CRS(geofile.crs)
-0000f570: 0a0a 0a64 6566 2069 735f 6765 6f66 696c  ...def is_geofil
-0000f580: 6528 7061 7468 3a20 556e 696f 6e5b 7374  e(path: Union[st
-0000f590: 722c 2022 6f73 2e50 6174 684c 696b 655b  r, "os.PathLike[
-0000f5a0: 416e 795d 225d 2920 2d3e 2062 6f6f 6c3a  Any]"]) -> bool:
-0000f5b0: 0a20 2020 2022 2222 0a20 2020 2044 6574  .    """.    Det
-0000f5c0: 6572 6d69 6e65 7320 6261 7365 6420 6f6e  ermines based on
-0000f5d0: 2074 6865 2066 696c 6570 6174 6820 6966   the filepath if
-0000f5e0: 2074 6869 7320 6973 2061 2067 656f 6669   this is a geofi
-0000f5f0: 6c65 2e0a 0a20 2020 2041 7267 733a 0a20  le...    Args:. 
-0000f600: 2020 2020 2020 2070 6174 6820 2850 6174         path (Pat
-0000f610: 684c 696b 6529 3a20 5468 6520 6669 6c65  hLike): The file
-0000f620: 2070 6174 682e 0a0a 2020 2020 5265 7475   path...    Retu
-0000f630: 726e 733a 0a20 2020 2020 2020 2062 6f6f  rns:.        boo
-0000f640: 6c3a 2054 7275 6520 6966 2069 7420 6973  l: True if it is
-0000f650: 2061 2067 656f 2066 696c 652e 0a20 2020   a geo file..   
-0000f660: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-0000f670: 6973 5f67 656f 6669 6c65 5f65 7874 2850  is_geofile_ext(P
-0000f680: 6174 6828 7061 7468 292e 7375 6666 6978  ath(path).suffix
-0000f690: 290a 0a0a 6465 6620 6973 5f67 656f 6669  )...def is_geofi
-0000f6a0: 6c65 5f65 7874 2866 696c 655f 6578 743a  le_ext(file_ext:
-0000f6b0: 2073 7472 2920 2d3e 2062 6f6f 6c3a 0a20   str) -> bool:. 
-0000f6c0: 2020 2022 2222 0a20 2020 2044 6574 6572     """.    Deter
-0000f6d0: 6d69 6e65 7320 6261 7365 6420 6f6e 2074  mines based on t
-0000f6e0: 6865 2066 696c 6520 6578 7465 6e73 696f  he file extensio
-0000f6f0: 6e20 6966 2074 6869 7320 6973 2061 2067  n if this is a g
-0000f700: 656f 6669 6c65 2e0a 0a20 2020 2041 7267  eofile...    Arg
-0000f710: 733a 0a20 2020 2020 2020 2066 696c 655f  s:.        file_
-0000f720: 6578 7420 2873 7472 293a 2074 6865 2065  ext (str): the e
-0000f730: 7874 656e 7369 6f6e 2e0a 0a20 2020 2052  xtension...    R
-0000f740: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-0000f750: 626f 6f6c 3a20 5472 7565 2069 6620 6974  bool: True if it
-0000f760: 2069 7320 6120 6765 6f66 696c 652e 0a20   is a geofile.. 
-0000f770: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
-0000f780: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-0000f790: 2064 7269 7665 7220 6361 6e20 6265 2064   driver can be d
-0000f7a0: 6574 6572 6d69 6e65 642c 2069 7420 6973  etermined, it is
-0000f7b0: 2061 2028 7375 7070 6f72 7465 6429 2067   a (supported) g
-0000f7c0: 656f 2066 696c 652e 0a20 2020 2020 2020  eo file..       
-0000f7d0: 205f 203d 2047 656f 6669 6c65 5479 7065   _ = GeofileType
-0000f7e0: 2866 696c 655f 6578 7429 0a20 2020 2020  (file_ext).     
-0000f7f0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-0000f800: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000f810: 696f 6e3a 0a20 2020 2020 2020 2072 6574  ion:.        ret
-0000f820: 7572 6e20 4661 6c73 650a 0a0a 6465 6620  urn False...def 
-0000f830: 636d 7028 0a20 2020 2070 6174 6831 3a20  cmp(.    path1: 
-0000f840: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
-0000f850: 6174 684c 696b 655b 416e 795d 225d 2c20  athLike[Any]"], 
-0000f860: 7061 7468 323a 2055 6e69 6f6e 5b73 7472  path2: Union[str
-0000f870: 2c20 226f 732e 5061 7468 4c69 6b65 5b41  , "os.PathLike[A
-0000f880: 6e79 5d22 5d0a 2920 2d3e 2062 6f6f 6c3a  ny]"].) -> bool:
-0000f890: 0a20 2020 2022 2222 0a20 2020 2043 6f6d  .    """.    Com
-0000f8a0: 7061 7265 2069 6620 7477 6f20 6765 6f66  pare if two geof
-0000f8b0: 696c 6573 2061 7265 2069 6465 6e74 6963  iles are identic
-0000f8c0: 616c 2e0a 0a20 2020 2046 6f72 2067 656f  al...    For geo
-0000f8d0: 6669 6c65 7320 7468 6174 2075 7365 206d  files that use m
-0000f8e0: 756c 7469 706c 6520 6669 6c65 732c 2061  ultiple files, a
-0000f8f0: 6c6c 2072 656c 6576 616e 7420 6669 6c65  ll relevant file
-0000f900: 7320 6d75 7374 2062 6520 6964 656e 7469  s must be identi
-0000f910: 6361 6c2e 0a20 2020 2045 672e 2066 6f72  cal..    Eg. for
-0000f920: 2073 6861 7065 6669 6c65 732c 2074 6865   shapefiles, the
-0000f930: 202e 7368 702c 202e 7368 7820 616e 6420   .shp, .shx and 
-0000f940: 2e64 6266 2066 696c 6520 6d75 7374 2062  .dbf file must b
-0000f950: 6520 6964 656e 7469 6361 6c2e 0a0a 2020  e identical...  
-0000f960: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000f970: 7061 7468 3120 2850 6174 684c 696b 6529  path1 (PathLike)
-0000f980: 3a20 7061 7468 2074 6f20 7468 6520 6669  : path to the fi
-0000f990: 7273 7420 6669 6c65 2e0a 2020 2020 2020  rst file..      
-0000f9a0: 2020 7061 7468 3220 2850 6174 684c 696b    path2 (PathLik
-0000f9b0: 6529 3a20 7061 7468 2074 6f20 7468 6520  e): path to the 
-0000f9c0: 7365 636f 6e64 2066 696c 652e 0a0a 2020  second file...  
-0000f9d0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-0000f9e0: 2020 2062 6f6f 6c3a 2054 7275 6520 6966     bool: True if
-0000f9f0: 2074 6865 2066 696c 6573 2061 7265 2069   the files are i
-0000fa00: 6465 6e74 6963 616c 0a20 2020 2022 2222  dentical.    """
-0000fa10: 0a20 2020 2023 2043 6865 636b 2069 6e70  .    # Check inp
-0000fa20: 7574 2070 6172 616d 6574 6572 730a 2020  ut parameters.  
-0000fa30: 2020 7061 7468 315f 7020 3d20 5061 7468    path1_p = Path
-0000fa40: 2870 6174 6831 290a 2020 2020 7061 7468  (path1).    path
-0000fa50: 325f 7020 3d20 5061 7468 2870 6174 6832  2_p = Path(path2
-0000fa60: 290a 0a20 2020 2023 2046 6f72 2061 2073  )..    # For a s
-0000fa70: 6861 7065 6669 6c65 2c20 6d75 6c74 6970  hapefile, multip
-0000fa80: 6c65 2066 696c 6573 206e 6565 6420 746f  le files need to
-0000fa90: 2062 6520 636f 6d70 6172 6564 0a20 2020   be compared.   
-0000faa0: 2069 6620 7061 7468 315f 702e 7375 6666   if path1_p.suff
-0000fab0: 6978 2e6c 6f77 6572 2829 203d 3d20 222e  ix.lower() == ".
-0000fac0: 7368 7022 3a0a 2020 2020 2020 2020 7061  shp":.        pa
-0000fad0: 7468 325f 6e6f 6578 742c 205f 203d 206f  th2_noext, _ = o
-0000fae0: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-0000faf0: 7061 7468 325f 7029 0a20 2020 2020 2020  path2_p).       
-0000fb00: 2073 6861 7065 6669 6c65 5f62 6173 655f   shapefile_base_
-0000fb10: 7375 6666 6978 6573 203d 205b 222e 7368  suffixes = [".sh
-0000fb20: 7022 2c20 222e 6462 6622 2c20 222e 7368  p", ".dbf", ".sh
-0000fb30: 7822 5d0a 2020 2020 2020 2020 7061 7468  x"].        path
-0000fb40: 315f 6e6f 6578 7420 3d20 7061 7468 315f  1_noext = path1_
-0000fb50: 702e 7061 7265 6e74 202f 2070 6174 6831  p.parent / path1
-0000fb60: 5f70 2e73 7465 6d0a 2020 2020 2020 2020  _p.stem.        
-0000fb70: 7061 7468 325f 6e6f 6578 7420 3d20 7061  path2_noext = pa
-0000fb80: 7468 325f 702e 7061 7265 6e74 202f 2070  th2_p.parent / p
-0000fb90: 6174 6832 5f70 2e73 7465 6d0a 2020 2020  ath2_p.stem.    
-0000fba0: 2020 2020 666f 7220 6578 7420 696e 2073      for ext in s
-0000fbb0: 6861 7065 6669 6c65 5f62 6173 655f 7375  hapefile_base_su
-0000fbc0: 6666 6978 6573 3a0a 2020 2020 2020 2020  ffixes:.        
-0000fbd0: 2020 2020 6966 206e 6f74 2066 696c 6563      if not filec
-0000fbe0: 6d70 2e63 6d70 2866 227b 7374 7228 7061  mp.cmp(f"{str(pa
-0000fbf0: 7468 315f 6e6f 6578 7429 7d7b 6578 747d  th1_noext)}{ext}
-0000fc00: 222c 2066 227b 7374 7228 7061 7468 325f  ", f"{str(path2_
-0000fc10: 6e6f 6578 7429 7d7b 6578 747d 2229 3a0a  noext)}{ext}"):.
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
-0000fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc50: 2066 2246 696c 6520 7b70 6174 6831 5f6e   f"File {path1_n
-0000fc60: 6f65 7874 7d7b 6578 747d 2069 7320 6469  oext}{ext} is di
-0000fc70: 6666 6572 656e 7420 6672 6f6d 207b 7061  fferent from {pa
-0000fc80: 7468 325f 6e6f 6578 747d 7b65 7874 7d22  th2_noext}{ext}"
-0000fc90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fca0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000fcb0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000fcc0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0000fcd0: 7275 650a 2020 2020 656c 7365 3a0a 2020  rue.    else:.  
-0000fce0: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
-0000fcf0: 6563 6d70 2e63 6d70 2873 7472 2870 6174  ecmp.cmp(str(pat
-0000fd00: 6831 5f70 292c 2073 7472 2870 6174 6832  h1_p), str(path2
-0000fd10: 5f70 2929 0a0a 0a64 6566 2063 6f70 7928  _p))...def copy(
-0000fd20: 7372 633a 2055 6e69 6f6e 5b73 7472 2c20  src: Union[str, 
-0000fd30: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
-0000fd40: 5d22 5d2c 2064 7374 3a20 556e 696f 6e5b  ]"], dst: Union[
-0000fd50: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
-0000fd60: 655b 416e 795d 225d 293a 0a20 2020 2022  e[Any]"]):.    "
-0000fd70: 2222 0a20 2020 2043 6f70 6965 7320 7468  "".    Copies th
-0000fd80: 6520 6765 6f66 696c 6520 6672 6f6d 2073  e geofile from s
-0000fd90: 7263 2074 6f20 6473 742e 2049 7320 7468  rc to dst. Is th
-0000fda0: 6520 736f 7572 6365 2066 696c 6520 6973  e source file is
-0000fdb0: 2061 2067 656f 6669 6c65 2063 6f6e 7461   a geofile conta
-0000fdc0: 696e 696e 670a 2020 2020 6f66 206d 756c  ining.    of mul
-0000fdd0: 7469 706c 6520 6669 6c65 7320 2865 672e  tiple files (eg.
-0000fde0: 202e 7368 7029 2061 6c6c 2066 696c 6573   .shp) all files
-0000fdf0: 2061 7265 2063 6f70 6965 642e 0a0a 2020   are copied...  
-0000fe00: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000fe10: 7372 6320 2850 6174 684c 696b 6529 3a20  src (PathLike): 
-0000fe20: 7468 6520 6669 6c65 2074 6f20 636f 7079  the file to copy
-0000fe30: 2e0a 2020 2020 2020 2020 6473 7420 2850  ..        dst (P
-0000fe40: 6174 684c 696b 6529 3a20 7468 6520 6c6f  athLike): the lo
-0000fe50: 6361 7469 6f6e 2074 6f20 636f 7079 2074  cation to copy t
-0000fe60: 6865 2066 696c 6528 7329 2074 6f2e 0a20  he file(s) to.. 
-0000fe70: 2020 2022 2222 0a20 2020 2023 2043 6865     """.    # Che
-0000fe80: 636b 2069 6e70 7574 2070 6172 616d 6574  ck input paramet
-0000fe90: 6572 730a 2020 2020 7372 6320 3d20 5061  ers.    src = Pa
-0000fea0: 7468 2873 7263 290a 2020 2020 6473 7420  th(src).    dst 
-0000feb0: 3d20 5061 7468 2864 7374 290a 2020 2020  = Path(dst).    
-0000fec0: 6765 6f66 696c 6574 7970 6520 3d20 4765  geofiletype = Ge
-0000fed0: 6f66 696c 6554 7970 6528 7372 6329 0a0a  ofileType(src)..
-0000fee0: 2020 2020 2320 436f 7079 2074 6865 206d      # Copy the m
-0000fef0: 6169 6e20 6669 6c65 0a20 2020 2073 6875  ain file.    shu
-0000ff00: 7469 6c2e 636f 7079 2873 7472 2873 7263  til.copy(str(src
-0000ff10: 292c 2064 7374 290a 0a20 2020 2023 2046  ), dst)..    # F
-0000ff20: 6f72 2073 6f6d 6520 6669 6c65 2074 7970  or some file typ
-0000ff30: 6573 2c20 6578 7472 6120 6669 6c65 7320  es, extra files 
-0000ff40: 6e65 6564 2074 6f20 6265 2063 6f70 6965  need to be copie
-0000ff50: 640a 2020 2020 2320 4966 2064 6573 7420  d.    # If dest 
-0000ff60: 6973 2061 2064 6972 2c20 6a75 7374 2075  is a dir, just u
-0000ff70: 7365 206d 6f76 652e 204f 7468 6572 7769  se move. Otherwi
-0000ff80: 7365 2063 6f6e 6361 7420 6465 7374 2066  se concat dest f
-0000ff90: 696c 6570 6174 6873 0a20 2020 2069 6620  ilepaths.    if 
-0000ffa0: 6765 6f66 696c 6574 7970 652e 7375 6666  geofiletype.suff
-0000ffb0: 6978 6573 5f65 7874 7261 6669 6c65 7320  ixes_extrafiles 
-0000ffc0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000ffd0: 2020 2020 2069 6620 6473 742e 6973 5f64       if dst.is_d
-0000ffe0: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
-0000fff0: 2020 666f 7220 7375 6666 6978 2069 6e20    for suffix in 
-00010000: 6765 6f66 696c 6574 7970 652e 7375 6666  geofiletype.suff
-00010010: 6978 6573 5f65 7874 7261 6669 6c65 733a  ixes_extrafiles:
-00010020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010030: 2073 7263 6669 6c65 203d 2073 7263 2e70   srcfile = src.p
-00010040: 6172 656e 7420 2f20 6622 7b73 7263 2e73  arent / f"{src.s
-00010050: 7465 6d7d 7b73 7566 6669 787d 220a 2020  tem}{suffix}".  
-00010060: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010070: 2073 7263 6669 6c65 2e65 7869 7374 7328   srcfile.exists(
-00010080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010090: 2020 2020 2020 2073 6875 7469 6c2e 636f         shutil.co
-000100a0: 7079 2873 7472 2873 7263 6669 6c65 292c  py(str(srcfile),
-000100b0: 2064 7374 290a 2020 2020 2020 2020 656c   dst).        el
-000100c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000100d0: 666f 7220 7375 6666 6978 2069 6e20 6765  for suffix in ge
-000100e0: 6f66 696c 6574 7970 652e 7375 6666 6978  ofiletype.suffix
-000100f0: 6573 5f65 7874 7261 6669 6c65 733a 0a20  es_extrafiles:. 
-00010100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00010110: 7263 6669 6c65 203d 2073 7263 2e70 6172  rcfile = src.par
-00010120: 656e 7420 2f20 6622 7b73 7263 2e73 7465  ent / f"{src.ste
-00010130: 6d7d 7b73 7566 6669 787d 220a 2020 2020  m}{suffix}".    
-00010140: 2020 2020 2020 2020 2020 2020 6473 7466              dstf
-00010150: 696c 6520 3d20 6473 742e 7061 7265 6e74  ile = dst.parent
-00010160: 202f 2066 227b 6473 742e 7374 656d 7d7b   / f"{dst.stem}{
-00010170: 7375 6666 6978 7d22 0a20 2020 2020 2020  suffix}".       
-00010180: 2020 2020 2020 2020 2069 6620 7372 6366           if srcf
-00010190: 696c 652e 6578 6973 7473 2829 3a0a 2020  ile.exists():.  
-000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101b0: 2020 7368 7574 696c 2e63 6f70 7928 7374    shutil.copy(st
-000101c0: 7228 7372 6366 696c 6529 2c20 6473 7466  r(srcfile), dstf
-000101d0: 696c 6529 0a0a 0a64 6566 206d 6f76 6528  ile)...def move(
-000101e0: 7372 633a 2055 6e69 6f6e 5b73 7472 2c20  src: Union[str, 
-000101f0: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
-00010200: 5d22 5d2c 2064 7374 3a20 556e 696f 6e5b  ]"], dst: Union[
-00010210: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
-00010220: 655b 416e 795d 225d 293a 0a20 2020 2022  e[Any]"]):.    "
-00010230: 2222 0a20 2020 204d 6f76 6573 2074 6865  "".    Moves the
-00010240: 2067 656f 6669 6c65 2066 726f 6d20 7372   geofile from sr
-00010250: 6320 746f 2064 7374 2e20 4966 2074 6865  c to dst. If the
-00010260: 2073 6f75 7263 6520 6669 6c65 2069 7320   source file is 
-00010270: 6120 6765 6f66 696c 6520 636f 6e74 6169  a geofile contai
-00010280: 6e69 6e67 0a20 2020 206f 6620 6d75 6c74  ning.    of mult
-00010290: 6970 6c65 2066 696c 6573 2028 6567 2e20  iple files (eg. 
-000102a0: 2e73 6870 2920 616c 6c20 6669 6c65 7320  .shp) all files 
-000102b0: 6172 6520 6d6f 7665 642e 0a0a 2020 2020  are moved...    
-000102c0: 4172 6773 3a0a 2020 2020 2020 2020 7372  Args:.        sr
-000102d0: 6320 2850 6174 684c 696b 6529 3a20 7468  c (PathLike): th
-000102e0: 6520 6669 6c65 2074 6f20 6d6f 7665 0a20  e file to move. 
-000102f0: 2020 2020 2020 2064 7374 2028 5061 7468         dst (Path
-00010300: 4c69 6b65 293a 2074 6865 206c 6f63 6174  Like): the locat
-00010310: 696f 6e20 746f 206d 6f76 6520 7468 6520  ion to move the 
-00010320: 6669 6c65 2873 2920 746f 0a20 2020 2022  file(s) to.    "
-00010330: 2222 0a20 2020 2023 2043 6865 636b 2069  "".    # Check i
-00010340: 6e70 7574 2070 6172 616d 6574 6572 730a  nput parameters.
-00010350: 2020 2020 7372 6320 3d20 5061 7468 2873      src = Path(s
-00010360: 7263 290a 2020 2020 6473 7420 3d20 5061  rc).    dst = Pa
-00010370: 7468 2864 7374 290a 2020 2020 6765 6f66  th(dst).    geof
-00010380: 696c 6574 7970 6520 3d20 4765 6f66 696c  iletype = Geofil
-00010390: 6554 7970 6528 7372 6329 0a0a 2020 2020  eType(src)..    
-000103a0: 2320 4d6f 7665 2074 6865 206d 6169 6e20  # Move the main 
-000103b0: 6669 6c65 0a20 2020 2073 6875 7469 6c2e  file.    shutil.
-000103c0: 6d6f 7665 2873 7472 2873 7263 292c 2064  move(str(src), d
-000103d0: 7374 290a 0a20 2020 2023 2046 6f72 2073  st)..    # For s
-000103e0: 6f6d 6520 6669 6c65 2074 7970 6573 2c20  ome file types, 
-000103f0: 6578 7472 6120 6669 6c65 7320 6e65 6564  extra files need
-00010400: 2074 6f20 6265 206d 6f76 6564 0a20 2020   to be moved.   
-00010410: 2023 2049 6620 6465 7374 2069 7320 6120   # If dest is a 
-00010420: 6469 722c 206a 7573 7420 7573 6520 6d6f  dir, just use mo
-00010430: 7665 2e20 4f74 6865 7277 6973 6520 636f  ve. Otherwise co
-00010440: 6e63 6174 2064 6573 7420 6669 6c65 7061  ncat dest filepa
-00010450: 7468 730a 2020 2020 6966 2067 656f 6669  ths.    if geofi
-00010460: 6c65 7479 7065 2e73 7566 6669 7865 735f  letype.suffixes_
-00010470: 6578 7472 6166 696c 6573 2069 7320 6e6f  extrafiles is no
-00010480: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00010490: 6966 2064 7374 2e69 735f 6469 7228 293a  if dst.is_dir():
-000104a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000104b0: 2073 7566 6669 7820 696e 2067 656f 6669   suffix in geofi
-000104c0: 6c65 7479 7065 2e73 7566 6669 7865 735f  letype.suffixes_
-000104d0: 6578 7472 6166 696c 6573 3a0a 2020 2020  extrafiles:.    
-000104e0: 2020 2020 2020 2020 2020 2020 7372 6366              srcf
-000104f0: 696c 6520 3d20 7372 632e 7061 7265 6e74  ile = src.parent
-00010500: 202f 2066 227b 7372 632e 7374 656d 7d7b   / f"{src.stem}{
-00010510: 7375 6666 6978 7d22 0a20 2020 2020 2020  suffix}".       
-00010520: 2020 2020 2020 2020 2069 6620 7372 6366           if srcf
-00010530: 696c 652e 6578 6973 7473 2829 3a0a 2020  ile.exists():.  
-00010540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010550: 2020 7368 7574 696c 2e6d 6f76 6528 7374    shutil.move(st
-00010560: 7228 7372 6366 696c 6529 2c20 6473 7429  r(srcfile), dst)
-00010570: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00010580: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00010590: 7566 6669 7820 696e 2067 656f 6669 6c65  uffix in geofile
-000105a0: 7479 7065 2e73 7566 6669 7865 735f 6578  type.suffixes_ex
-000105b0: 7472 6166 696c 6573 3a0a 2020 2020 2020  trafiles:.      
-000105c0: 2020 2020 2020 2020 2020 7372 6366 696c            srcfil
-000105d0: 6520 3d20 7372 632e 7061 7265 6e74 202f  e = src.parent /
-000105e0: 2066 227b 7372 632e 7374 656d 7d7b 7375   f"{src.stem}{su
-000105f0: 6666 6978 7d22 0a20 2020 2020 2020 2020  ffix}".         
-00010600: 2020 2020 2020 2064 7374 6669 6c65 203d         dstfile =
-00010610: 2064 7374 2e70 6172 656e 7420 2f20 6622   dst.parent / f"
-00010620: 7b64 7374 2e73 7465 6d7d 7b73 7566 6669  {dst.stem}{suffi
-00010630: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
-00010640: 2020 2020 6966 2073 7263 6669 6c65 2e65      if srcfile.e
-00010650: 7869 7374 7328 293a 0a20 2020 2020 2020  xists():.       
-00010660: 2020 2020 2020 2020 2020 2020 2073 6875               shu
-00010670: 7469 6c2e 6d6f 7665 2873 7472 2873 7263  til.move(str(src
-00010680: 6669 6c65 292c 2064 7374 6669 6c65 290a  file), dstfile).
-00010690: 0a0a 6465 6620 7265 6d6f 7665 2870 6174  ..def remove(pat
-000106a0: 683a 2055 6e69 6f6e 5b73 7472 2c20 226f  h: Union[str, "o
-000106b0: 732e 5061 7468 4c69 6b65 5b41 6e79 5d22  s.PathLike[Any]"
-000106c0: 5d2c 206d 6973 7369 6e67 5f6f 6b3a 2062  ], missing_ok: b
-000106d0: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
-000106e0: 2020 2222 220a 2020 2020 5265 6d6f 7665    """.    Remove
-000106f0: 7320 7468 6520 6765 6f66 696c 652e 2049  s the geofile. I
-00010700: 7320 6974 2069 7320 6120 6765 6f66 696c  s it is a geofil
-00010710: 6520 636f 6d70 6f73 6564 206f 6620 6d75  e composed of mu
-00010720: 6c74 6970 6c65 2066 696c 6573 0a20 2020  ltiple files.   
-00010730: 2028 6567 2e20 2e73 6870 2920 616c 6c20   (eg. .shp) all 
-00010740: 6669 6c65 7320 6172 6520 7265 6d6f 7665  files are remove
-00010750: 642e 0a20 2020 2049 6620 2e6c 6f63 6b20  d..    If .lock 
-00010760: 6669 6c65 7320 6172 6520 7072 6573 656e  files are presen
-00010770: 742c 2074 6865 7920 6172 6520 7265 6d6f  t, they are remo
-00010780: 7665 6420 6173 2077 656c 6c2e 0a0a 2020  ved as well...  
-00010790: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-000107a0: 7061 7468 2028 5061 7468 4c69 6b65 293a  path (PathLike):
-000107b0: 2074 6865 2066 696c 6520 746f 2072 656d   the file to rem
-000107c0: 6f76 650a 2020 2020 2222 220a 2020 2020  ove.    """.    
-000107d0: 2320 4368 6563 6b20 696e 7075 7420 7061  # Check input pa
-000107e0: 7261 6d65 7465 7273 0a20 2020 2070 6174  rameters.    pat
-000107f0: 6820 3d20 5061 7468 2870 6174 6829 0a20  h = Path(path). 
-00010800: 2020 2067 656f 6669 6c65 7479 7065 203d     geofiletype =
-00010810: 2047 656f 6669 6c65 5479 7065 2870 6174   GeofileType(pat
-00010820: 6829 0a0a 2020 2020 2320 4966 2074 6865  h)..    # If the
-00010830: 7265 2069 7320 6120 6c6f 636b 2066 696c  re is a lock fil
-00010840: 652c 2072 656d 6f76 6520 6974 0a20 2020  e, remove it.   
-00010850: 206c 6f63 6b66 696c 655f 7061 7468 203d   lockfile_path =
-00010860: 2070 6174 682e 7061 7265 6e74 202f 2066   path.parent / f
-00010870: 227b 7061 7468 2e6e 616d 657d 2e6c 6f63  "{path.name}.loc
-00010880: 6b22 0a20 2020 206c 6f63 6b66 696c 655f  k".    lockfile_
-00010890: 7061 7468 2e75 6e6c 696e 6b28 6d69 7373  path.unlink(miss
-000108a0: 696e 675f 6f6b 3d54 7275 6529 0a0a 2020  ing_ok=True)..  
-000108b0: 2020 2320 5265 6d6f 7665 2074 6865 206d    # Remove the m
-000108c0: 6169 6e20 6669 6c65 0a20 2020 2069 6620  ain file.    if 
-000108d0: 7061 7468 2e65 7869 7374 7328 293a 0a20  path.exists():. 
-000108e0: 2020 2020 2020 2070 6174 682e 756e 6c69         path.unli
-000108f0: 6e6b 286d 6973 7369 6e67 5f6f 6b3d 6d69  nk(missing_ok=mi
-00010900: 7373 696e 675f 6f6b 290a 0a20 2020 2023  ssing_ok)..    #
-00010910: 2046 6f72 2073 6f6d 6520 6669 6c65 2074   For some file t
-00010920: 7970 6573 2c20 6578 7472 6120 6669 6c65  ypes, extra file
-00010930: 7320 6e65 6564 2074 6f20 6265 2072 656d  s need to be rem
-00010940: 6f76 6564 0a20 2020 2069 6620 6765 6f66  oved.    if geof
-00010950: 696c 6574 7970 652e 7375 6666 6978 6573  iletype.suffixes
-00010960: 5f65 7874 7261 6669 6c65 7320 6973 206e  _extrafiles is n
-00010970: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00010980: 2066 6f72 2073 7566 6669 7820 696e 2067   for suffix in g
-00010990: 656f 6669 6c65 7479 7065 2e73 7566 6669  eofiletype.suffi
-000109a0: 7865 735f 6578 7472 6166 696c 6573 3a0a  xes_extrafiles:.
-000109b0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-000109c0: 5f70 6174 6820 3d20 7061 7468 2e70 6172  _path = path.par
-000109d0: 656e 7420 2f20 6622 7b70 6174 682e 7374  ent / f"{path.st
-000109e0: 656d 7d7b 7375 6666 6978 7d22 0a20 2020  em}{suffix}".   
-000109f0: 2020 2020 2020 2020 2063 7572 725f 7061           curr_pa
-00010a00: 7468 2e75 6e6c 696e 6b28 6d69 7373 696e  th.unlink(missin
-00010a10: 675f 6f6b 3d54 7275 6529 0a0a 0a64 6566  g_ok=True)...def
-00010a20: 2061 7070 656e 645f 746f 280a 2020 2020   append_to(.    
-00010a30: 7372 633a 2055 6e69 6f6e 5b73 7472 2c20  src: Union[str, 
-00010a40: 226f 732e 5061 7468 4c69 6b65 5b41 6e79  "os.PathLike[Any
-00010a50: 5d22 5d2c 0a20 2020 2064 7374 3a20 556e  ]"],.    dst: Un
-00010a60: 696f 6e5b 7374 722c 2022 6f73 2e50 6174  ion[str, "os.Pat
-00010a70: 684c 696b 655b 416e 795d 225d 2c0a 2020  hLike[Any]"],.  
-00010a80: 2020 7372 635f 6c61 7965 723a 204f 7074    src_layer: Opt
-00010a90: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00010aa0: 652c 0a20 2020 2064 7374 5f6c 6179 6572  e,.    dst_layer
-00010ab0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00010ac0: 3d20 4e6f 6e65 2c0a 2020 2020 7372 635f  = None,.    src_
-00010ad0: 6372 733a 2055 6e69 6f6e 5b69 6e74 2c20  crs: Union[int, 
-00010ae0: 7374 722c 204e 6f6e 655d 203d 204e 6f6e  str, None] = Non
-00010af0: 652c 0a20 2020 2064 7374 5f63 7273 3a20  e,.    dst_crs: 
-00010b00: 556e 696f 6e5b 696e 742c 2073 7472 2c20  Union[int, str, 
-00010b10: 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a 2020  None] = None,.  
-00010b20: 2020 7768 6572 653a 204f 7074 696f 6e61    where: Optiona
-00010b30: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-00010b40: 2020 2072 6570 726f 6a65 6374 3a20 626f     reproject: bo
-00010b50: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00010b60: 6578 706c 6f64 6563 6f6c 6c65 6374 696f  explodecollectio
-00010b70: 6e73 3a20 626f 6f6c 203d 2046 616c 7365  ns: bool = False
-00010b80: 2c0a 2020 2020 666f 7263 655f 6f75 7470  ,.    force_outp
-00010b90: 7574 5f67 656f 6d65 7472 7974 7970 653a  ut_geometrytype:
-00010ba0: 2055 6e69 6f6e 5b47 656f 6d65 7472 7954   Union[GeometryT
-00010bb0: 7970 652c 2073 7472 2c20 4e6f 6e65 5d20  ype, str, None] 
-00010bc0: 3d20 4e6f 6e65 2c0a 2020 2020 6372 6561  = None,.    crea
-00010bd0: 7465 5f73 7061 7469 616c 5f69 6e64 6578  te_spatial_index
-00010be0: 3a20 4f70 7469 6f6e 616c 5b62 6f6f 6c5d  : Optional[bool]
-00010bf0: 203d 2054 7275 652c 0a20 2020 2061 7070   = True,.    app
-00010c00: 656e 645f 7469 6d65 6f75 745f 733a 2069  end_timeout_s: i
-00010c10: 6e74 203d 2036 3030 2c0a 2020 2020 7472  nt = 600,.    tr
-00010c20: 616e 7361 6374 696f 6e5f 7369 7a65 3a20  ansaction_size: 
-00010c30: 696e 7420 3d20 3530 3030 302c 0a20 2020  int = 50000,.   
-00010c40: 2070 7265 7365 7276 655f 6669 643a 204f   preserve_fid: O
-00010c50: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
-00010c60: 4e6f 6e65 2c0a 2020 2020 6f70 7469 6f6e  None,.    option
-00010c70: 733a 2064 6963 7420 3d20 7b7d 2c0a 293a  s: dict = {},.):
-00010c80: 0a20 2020 2022 2222 0a20 2020 2041 7070  .    """.    App
-00010c90: 656e 6420 7372 6320 6669 6c65 2074 6f20  end src file to 
-00010ca0: 7468 6520 6473 7420 6669 6c65 2e0a 0a20  the dst file... 
-00010cb0: 2020 2052 656d 6172 6b3a 2061 7070 656e     Remark: appen
-00010cc0: 6420 6973 206e 6f74 2073 7570 706f 7274  d is not support
-00010cd0: 6564 2066 6f72 2061 6c6c 2066 696c 6574  ed for all filet
-00010ce0: 7970 6573 2069 6e20 6669 6f6e 612f 6765  ypes in fiona/ge
-00010cf0: 6f70 616e 6461 7320 2830 2e38 290a 2020  opandas (0.8).  
-00010d00: 2020 736f 2077 6f72 6b61 726f 756e 6420    so workaround 
-00010d10: 7669 6120 6764 616c 206e 6565 6465 642e  via gdal needed.
-00010d20: 0a0a 2020 2020 5468 6520 6f70 7469 6f6e  ..    The option
-00010d30: 7320 7061 7261 6d65 7465 7220 6361 6e20  s parameter can 
-00010d40: 6265 2075 7365 6420 746f 2070 6173 7320  be used to pass 
-00010d50: 616e 7920 7479 7065 206f 6620 6f70 7469  any type of opti
-00010d60: 6f6e 7320 746f 2047 4441 4c20 696e 0a20  ons to GDAL in. 
-00010d70: 2020 2074 6865 2066 6f6c 6c6f 7769 6e67     the following
-00010d80: 2066 6f72 6d3a 0a20 2020 2020 2020 207b   form:.        {
-00010d90: 2022 3c6f 7074 696f 6e5f 7479 7065 3e2e   "<option_type>.
-00010da0: 3c6f 7074 696f 6e5f 6e61 6d65 3e22 3a20  <option_name>": 
-00010db0: 3c6f 7074 696f 6e5f 7661 6c75 653e 207d  <option_value> }
-00010dc0: 0a0a 2020 2020 5468 6520 6f70 7469 6f6e  ..    The option
-00010dd0: 2074 7970 6573 2063 616e 2062 6520 616e   types can be an
-00010de0: 7920 6f66 2074 6865 2066 6f6c 6c6f 7769  y of the followi
-00010df0: 6e67 3a0a 2020 2020 2020 2020 2d20 4c41  ng:.        - LA
-00010e00: 5945 525f 4352 4541 5449 4f4e 3a20 6c61  YER_CREATION: la
-00010e10: 7965 7220 6372 6561 7469 6f6e 206f 7074  yer creation opt
-00010e20: 696f 6e20 286c 636f 290a 2020 2020 2020  ion (lco).      
-00010e30: 2020 2d20 4441 5441 5345 545f 4352 4541    - DATASET_CREA
-00010e40: 5449 4f4e 3a20 6461 7461 7365 7420 6372  TION: dataset cr
-00010e50: 6561 7469 6f6e 206f 7074 696f 6e20 2864  eation option (d
-00010e60: 7363 6f29 0a20 2020 2020 2020 202d 2049  sco).        - I
-00010e70: 4e50 5554 5f4f 5045 4e3a 2069 6e70 7574  NPUT_OPEN: input
-00010e80: 2064 6174 6173 6574 206f 7065 6e20 6f70   dataset open op
-00010e90: 7469 6f6e 2028 6f6f 290a 2020 2020 2020  tion (oo).      
-00010ea0: 2020 2d20 4445 5354 494e 4154 494f 4e5f    - DESTINATION_
-00010eb0: 4f50 454e 3a20 6465 7374 696e 6174 696f  OPEN: destinatio
-00010ec0: 6e20 6461 7461 7365 7420 6f70 656e 206f  n dataset open o
-00010ed0: 7074 696f 6e20 2864 6f6f 290a 2020 2020  ption (doo).    
-00010ee0: 2020 2020 2d20 434f 4e46 4947 3a20 636f      - CONFIG: co
-00010ef0: 6e66 6967 206f 7074 696f 6e20 2863 6f6e  nfig option (con
-00010f00: 6669 6729 0a0a 2020 2020 5468 6520 6f70  fig)..    The op
-00010f10: 7469 6f6e 7320 6361 6e20 6265 2066 6f75  tions can be fou
-00010f20: 6e64 2069 6e20 7468 6520 5b47 4441 4c20  nd in the [GDAL 
-00010f30: 7665 6374 6f72 2064 7269 7665 7220 646f  vector driver do
-00010f40: 6375 6d65 6e74 6174 696f 6e5d 0a20 2020  cumentation].   
-00010f50: 2028 6874 7470 733a 2f2f 6764 616c 2e6f   (https://gdal.o
-00010f60: 7267 2f64 7269 7665 7273 2f76 6563 746f  rg/drivers/vecto
-00010f70: 722f 696e 6465 782e 6874 6d6c 292e 0a0a  r/index.html)...
-00010f80: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00010f90: 2020 7372 6320 2855 6e69 6f6e 5b73 7472    src (Union[str
-00010fa0: 2c29 3a20 736f 7572 6365 2066 696c 6520  ,): source file 
-00010fb0: 7061 7468 2e0a 2020 2020 2020 2020 6473  path..        ds
-00010fc0: 7420 2855 6e69 6f6e 5b73 7472 2c29 3a20  t (Union[str,): 
-00010fd0: 6465 7374 696e 6174 696f 6e20 6669 6c65  destination file
-00010fe0: 2070 6174 682e 0a20 2020 2020 2020 2073   path..        s
-00010ff0: 7263 5f6c 6179 6572 2028 7374 722c 206f  rc_layer (str, o
-00011000: 7074 696f 6e61 6c29 3a20 736f 7572 6365  ptional): source
-00011010: 206c 6179 6572 2e20 4465 6661 756c 7473   layer. Defaults
-00011020: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
-00011030: 2020 6473 745f 6c61 7965 7220 2873 7472    dst_layer (str
-00011040: 2c20 6f70 7469 6f6e 616c 293a 2064 6573  , optional): des
-00011050: 7469 6e61 7469 6f6e 206c 6179 6572 2e20  tination layer. 
-00011060: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-00011070: 2e0a 2020 2020 2020 2020 7372 635f 6372  ..        src_cr
-00011080: 7320 2873 7472 2c20 6f70 7469 6f6e 616c  s (str, optional
-00011090: 293a 2061 6e20 6570 7367 2069 6e74 206f  ): an epsg int o
-000110a0: 7220 616e 7974 6869 6e67 2073 7570 706f  r anything suppo
-000110b0: 7274 6564 0a20 2020 2020 2020 2020 2020  rted.           
-000110c0: 2062 7920 7468 6520 4f47 5253 7061 7469   by the OGRSpati
-000110d0: 616c 5265 6665 7265 6e63 652e 5365 7446  alReference.SetF
-000110e0: 726f 6d55 7365 7249 6e70 7574 2829 2063  romUserInput() c
-000110f0: 616c 6c2c 2077 6869 6368 2069 6e63 6c75  all, which inclu
-00011100: 6465 730a 2020 2020 2020 2020 2020 2020  des.            
-00011110: 616e 2045 5053 4720 7374 7269 6e67 2028  an EPSG string (
-00011120: 6567 2e20 2245 5053 473a 3433 3236 2229  eg. "EPSG:4326")
-00011130: 2c20 6120 7765 6c6c 206b 6e6f 776e 2074  , a well known t
-00011140: 6578 7420 2857 4b54 2920 4352 530a 2020  ext (WKT) CRS.  
-00011150: 2020 2020 2020 2020 2020 6465 6669 6e69            defini
-00011160: 7469 6f6e 2c2e 2e2e 2044 6566 6175 6c74  tion,... Default
-00011170: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00011180: 2020 2064 7374 5f63 7273 2028 7374 722c     dst_crs (str,
-00011190: 206f 7074 696f 6e61 6c29 3a20 616e 2065   optional): an e
-000111a0: 7073 6720 696e 7420 6f72 2061 6e79 7468  psg int or anyth
-000111b0: 696e 6720 7375 7070 6f72 7465 640a 2020  ing supported.  
-000111c0: 2020 2020 2020 2020 2020 6279 2074 6865            by the
-000111d0: 204f 4752 5370 6174 6961 6c52 6566 6572   OGRSpatialRefer
-000111e0: 656e 6365 2e53 6574 4672 6f6d 5573 6572  ence.SetFromUser
-000111f0: 496e 7075 7428 2920 6361 6c6c 2c20 7768  Input() call, wh
-00011200: 6963 6820 696e 636c 7564 6573 0a20 2020  ich includes.   
-00011210: 2020 2020 2020 2020 2061 6e20 4550 5347           an EPSG
-00011220: 2073 7472 696e 6720 2865 672e 2022 4550   string (eg. "EP
-00011230: 5347 3a34 3332 3622 292c 2061 2077 656c  SG:4326"), a wel
-00011240: 6c20 6b6e 6f77 6e20 7465 7874 2028 574b  l known text (WK
-00011250: 5429 2043 5253 0a20 2020 2020 2020 2020  T) CRS.         
-00011260: 2020 2064 6566 696e 6974 696f 6e2c 2e2e     definition,..
-00011270: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-00011280: 6e65 2e0a 2020 2020 2020 2020 7768 6572  ne..        wher
-00011290: 6520 2873 7472 2c20 6f70 7469 6f6e 616c  e (str, optional
-000112a0: 293a 206f 6e6c 7920 6170 7065 6e64 2074  ): only append t
-000112b0: 6865 2072 6f77 7320 6672 6f6d 2073 7263  he rows from src
-000112c0: 2074 6861 7420 636f 6d70 6c79 2074 6f20   that comply to 
-000112d0: 7468 6520 6669 6c74 6572 0a20 2020 2020  the filter.     
-000112e0: 2020 2020 2020 2073 7065 6369 6669 6564         specified
-000112f0: 2e20 4170 706c 6965 6420 6265 666f 7265  . Applied before
-00011300: 2065 7870 6c6f 6465 636f 6c6c 6563 7469   explodecollecti
-00011310: 6f6e 732e 2046 696c 7465 7220 7368 6f75  ons. Filter shou
-00011320: 6c64 2062 6520 696e 2073 716c 6974 650a  ld be in sqlite.
-00011330: 2020 2020 2020 2020 2020 2020 5351 4c20              SQL 
-00011340: 5748 4552 4520 7379 6e74 6178 2061 6e64  WHERE syntax and
-00011350: 207c 7370 6174 6961 6c69 7465 5f72 6566   |spatialite_ref
-00011360: 6572 656e 6365 5f6c 696e 6b7c 2066 756e  erence_link| fun
-00011370: 6374 696f 6e73 2063 616e 2062 6520 7573  ctions can be us
-00011380: 6564 2e20 4966 0a20 2020 2020 2020 2020  ed. If.         
-00011390: 2020 2077 6865 7265 2063 6f6e 7461 696e     where contain
-000113a0: 7320 7468 6520 7b67 656f 6d65 7472 7963  s the {geometryc
-000113b0: 6f6c 756d 6e7d 2070 6c61 6365 686f 6c64  olumn} placehold
-000113c0: 6572 2c20 6974 2069 7320 6669 6c6c 6564  er, it is filled
-000113d0: 206f 7574 2077 6974 6820 7468 650a 2020   out with the.  
-000113e0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
-000113f0: 7279 2063 6f6c 756d 6e20 6e61 6d65 206f  ry column name o
-00011400: 6620 7468 6520 7372 6320 6669 6c65 2e20  f the src file. 
-00011410: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-00011420: 2e0a 2020 2020 2020 2020 7265 7072 6f6a  ..        reproj
-00011430: 6563 7420 2862 6f6f 6c2c 206f 7074 696f  ect (bool, optio
-00011440: 6e61 6c29 3a20 5472 7565 2074 6f20 7265  nal): True to re
-00011450: 7072 6f6a 6563 7420 7768 696c 6520 636f  project while co
-00011460: 6e76 6572 7469 6e67 2074 6865 0a20 2020  nverting the.   
-00011470: 2020 2020 2020 2020 2066 696c 652e 2044           file. D
-00011480: 6566 6175 6c74 7320 746f 2046 616c 7365  efaults to False
-00011490: 2e0a 2020 2020 2020 2020 6578 706c 6f64  ..        explod
-000114a0: 6563 6f6c 6c65 6374 696f 6e73 2028 626f  ecollections (bo
-000114b0: 6f6c 292c 206f 7074 696f 6e61 6c29 3a20  ol), optional): 
-000114c0: 5472 7565 2074 6f20 6f75 7470 7574 206f  True to output o
-000114d0: 6e6c 7920 7369 6d70 6c65 2067 656f 6d65  nly simple geome
-000114e0: 7472 6965 732e 0a20 2020 2020 2020 2020  tries..         
-000114f0: 2020 2044 6566 6175 6c74 7320 746f 2046     Defaults to F
-00011500: 616c 7365 2e0a 2020 2020 2020 2020 666f  alse..        fo
-00011510: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
-00011520: 7472 7974 7970 6520 2855 6e69 6f6e 5b47  trytype (Union[G
-00011530: 656f 6d65 7472 7954 7970 652c 2073 7472  eometryType, str
-00011540: 5d2c 206f 7074 696f 6e61 6c29 3a20 4765  ], optional): Ge
-00011550: 6f6d 6574 7279 2074 7970 652e 0a20 2020  ometry type..   
-00011560: 2020 2020 2020 2020 2074 6f20 2874 7279           to (try
-00011570: 2074 6f29 2066 6f72 6365 2074 6865 206f   to) force the o
-00011580: 7574 7075 7420 746f 2e20 4465 6661 756c  utput to. Defaul
-00011590: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
-000115a0: 2020 2020 6372 6561 7465 5f73 7061 7469      create_spati
-000115b0: 616c 5f69 6e64 6578 2028 626f 6f6c 2c20  al_index (bool, 
-000115c0: 6f70 7469 6f6e 616c 293a 2054 7275 6520  optional): True 
-000115d0: 746f 2063 7265 6174 6520 6120 7370 6174  to create a spat
-000115e0: 6961 6c20 696e 6465 780a 2020 2020 2020  ial index.      
-000115f0: 2020 2020 2020 6f6e 2074 6865 2064 6573        on the des
-00011600: 7469 6e61 7469 6f6e 2066 696c 652f 6c61  tination file/la
-00011610: 7965 722e 2049 6620 4e6f 6e65 2c20 7468  yer. If None, th
-00011620: 6520 6465 6661 756c 7420 6265 6861 7669  e default behavi
-00011630: 6f75 7220 6279 2067 6461 6c20 666f 720a  our by gdal for.
-00011640: 2020 2020 2020 2020 2020 2020 7468 6174              that
-00011650: 2066 696c 6520 7479 7065 2069 7320 7265   file type is re
-00011660: 7370 6563 7465 642e 2049 6620 7468 6520  spected. If the 
-00011670: 4c41 5945 525f 4352 4541 5449 4f4e 2e53  LAYER_CREATION.S
-00011680: 5041 5449 414c 5f49 4e44 4558 0a20 2020  PATIAL_INDEX.   
-00011690: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
-000116a0: 6572 2069 7320 7370 6563 6966 6965 6420  er is specified 
-000116b0: 696e 206f 7074 696f 6e73 2c20 6372 6561  in options, crea
-000116c0: 7465 5f73 7061 7469 616c 5f69 6e64 6578  te_spatial_index
-000116d0: 2069 7320 6967 6e6f 7265 642e 0a20 2020   is ignored..   
-000116e0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-000116f0: 7320 746f 2054 7275 652e 0a20 2020 2020  s to True..     
-00011700: 2020 2061 7070 656e 645f 7469 6d65 6f75     append_timeou
-00011710: 745f 7320 2869 6e74 2c20 6f70 7469 6f6e  t_s (int, option
-00011720: 616c 293a 2074 696d 656f 7574 2074 6f20  al): timeout to 
-00011730: 7573 6520 6966 2074 6865 206f 7574 7075  use if the outpu
-00011740: 7420 6669 6c65 2069 730a 2020 2020 2020  t file is.      
-00011750: 2020 2020 2020 6265 696e 6720 7772 6974        being writ
-00011760: 7465 6e20 746f 2062 7920 616e 6f74 6865  ten to by anothe
-00011770: 7220 7072 6f63 6573 7320 616c 7265 6164  r process alread
-00011780: 792e 2044 6566 6175 6c74 7320 746f 2036  y. Defaults to 6
-00011790: 3030 2e0a 2020 2020 2020 2020 7472 616e  00..        tran
-000117a0: 7361 6374 696f 6e5f 7369 7a65 2028 696e  saction_size (in
-000117b0: 742c 206f 7074 696f 6e61 6c29 3a20 5472  t, optional): Tr
-000117c0: 616e 7361 6374 696f 6e20 7369 7a65 2e20  ansaction size. 
-000117d0: 4465 6661 756c 7473 2074 6f20 3530 3030  Defaults to 5000
-000117e0: 302e 0a20 2020 2020 2020 2070 7265 7365  0..        prese
-000117f0: 7276 655f 6669 6420 2862 6f6f 6c2c 206f  rve_fid (bool, o
-00011800: 7074 696f 6e61 6c29 3a20 5472 7565 2074  ptional): True t
-00011810: 6f20 6d61 6b65 2061 6e20 6578 7472 6120  o make an extra 
-00011820: 6566 666f 7274 2074 6f20 7072 6573 6572  effort to preser
-00011830: 7665 2066 6964 2773 206f 660a 2020 2020  ve fid's of.    
-00011840: 2020 2020 2020 2020 7468 6520 736f 7572          the sour
-00011850: 6365 206c 6179 6572 2074 6f20 7468 6520  ce layer to the 
-00011860: 6465 7374 696e 6174 696f 6e20 6c61 7965  destination laye
-00011870: 722e 2046 616c 7365 206e 6f74 2074 6f20  r. False not to 
-00011880: 646f 2061 6e79 2065 6666 6f72 742e 204e  do any effort. N
-00011890: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000118a0: 746f 2075 7365 2074 6865 2064 6566 6175  to use the defau
-000118b0: 6c74 2062 6568 6176 696f 7572 206f 6620  lt behaviour of 
-000118c0: 6764 616c 2c20 7468 6174 2061 6c72 6561  gdal, that alrea
-000118d0: 6479 2070 7265 7365 7276 6573 2069 6e20  dy preserves in 
-000118e0: 736f 6d65 2063 6173 6573 2e0a 2020 2020  some cases..    
-000118f0: 2020 2020 2020 2020 536f 6d65 2066 696c          Some fil
-00011900: 6520 666f 726d 6174 7320 646f 6e27 7420  e formats don't 
-00011910: 6578 706c 6963 6974 6c79 2073 746f 7265  explicitly store
-00011920: 2074 6865 2066 6964 2028 652e 672e 2073   the fid (e.g. s
-00011930: 6861 7065 6669 6c65 292c 2073 6f20 7468  hapefile), so th
-00011940: 6579 0a20 2020 2020 2020 2020 2020 2077  ey.            w
-00011950: 696c 6c20 6e65 7665 7220 6265 2061 626c  ill never be abl
-00011960: 6520 746f 2070 7265 7365 7276 6520 6669  e to preserve fi
-00011970: 6473 2e20 4465 6661 756c 7473 2074 6f20  ds. Defaults to 
-00011980: 4e6f 6e65 2e0a 2020 2020 2020 2020 6f70  None..        op
-00011990: 7469 6f6e 7320 2864 6963 742c 206f 7074  tions (dict, opt
-000119a0: 696f 6e61 6c29 3a20 6f70 7469 6f6e 7320  ional): options 
-000119b0: 746f 2070 6173 7320 746f 2067 6461 6c2e  to pass to gdal.
-000119c0: 0a0a 2020 2020 5261 6973 6573 3a0a 2020  ..    Raises:.  
-000119d0: 2020 2020 2020 5661 6c75 6545 7272 6f72        ValueError
-000119e0: 3a20 616e 2069 6e76 616c 6964 2070 6172  : an invalid par
-000119f0: 616d 6574 6572 2076 616c 7565 2077 6173  ameter value was
-00011a00: 2070 6173 7365 642e 0a20 2020 2020 2020   passed..       
-00011a10: 2052 756e 7469 6d65 4572 726f 723a 2074   RuntimeError: t
-00011a20: 696d 656f 7574 2077 6173 2072 6561 6368  imeout was reach
-00011a30: 6564 2077 6869 6c65 2074 7279 696e 6720  ed while trying 
-00011a40: 746f 2061 7070 656e 6420 6461 7461 2074  to append data t
-00011a50: 6f20 7061 7468 2e0a 0a20 2020 202e 2e20  o path...    .. 
-00011a60: 7c73 7061 7469 616c 6974 655f 7265 6665  |spatialite_refe
-00011a70: 7265 6e63 655f 6c69 6e6b 7c20 7261 773a  rence_link| raw:
-00011a80: 3a20 6874 6d6c 0a0a 2020 2020 2020 2020  : html..        
-00011a90: 3c61 2068 7265 663d 2268 7474 7073 3a2f  <a href="https:/
-00011aa0: 2f77 7777 2e67 6169 612d 6769 732e 6974  /www.gaia-gis.it
-00011ab0: 2f67 6169 612d 7369 6e73 2f73 7061 7469  /gaia-sins/spati
-00011ac0: 616c 6974 652d 7371 6c2d 6c61 7465 7374  alite-sql-latest
-00011ad0: 2e68 746d 6c22 2074 6172 6765 743d 225f  .html" target="_
-00011ae0: 626c 616e 6b22 3e73 7061 7469 616c 6974  blank">spatialit
-00011af0: 6520 7265 6665 7265 6e63 653c 2f61 3e0a  e reference</a>.
-00011b00: 0a20 2020 2022 2222 2020 2320 6e6f 7161  .    """  # noqa
-00011b10: 3a20 4535 3031 0a20 2020 2023 2043 6865  : E501.    # Che
-00011b20: 636b 2f63 6c65 616e 2069 6e70 7574 2070  ck/clean input p
-00011b30: 6172 616d 730a 2020 2020 7372 6320 3d20  arams.    src = 
-00011b40: 5061 7468 2873 7263 290a 2020 2020 6473  Path(src).    ds
-00011b50: 7420 3d20 5061 7468 2864 7374 290a 2020  t = Path(dst).  
-00011b60: 2020 6966 2066 6f72 6365 5f6f 7574 7075    if force_outpu
-00011b70: 745f 6765 6f6d 6574 7279 7479 7065 2069  t_geometrytype i
-00011b80: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00011b90: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
-00011ba0: 5f67 656f 6d65 7472 7974 7970 6520 3d20  _geometrytype = 
-00011bb0: 4765 6f6d 6574 7279 5479 7065 2866 6f72  GeometryType(for
-00011bc0: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
-00011bd0: 7279 7479 7065 290a 0a20 2020 2023 2046  rytype)..    # F
-00011be0: 696c 6573 2064 6f6e 2774 2074 7970 6963  iles don't typic
-00011bf0: 616c 6c79 2073 7570 706f 7274 2068 6176  ally support hav
-00011c00: 696e 6720 6d75 6c74 6970 6c65 2070 726f  ing multiple pro
-00011c10: 6365 7373 6573 2077 7269 7469 6e67 0a20  cesses writing. 
-00011c20: 2020 2023 2073 696d 756c 7461 6e6f 7573     # simultanous
-00011c30: 6c79 2074 6f20 7468 656d 2c20 736f 2075  ly to them, so u
-00011c40: 7365 206c 6f63 6b20 6669 6c65 2074 6f20  se lock file to 
-00011c50: 7379 6e63 6872 6f6e 697a 6520 6163 6365  synchronize acce
-00011c60: 7373 2e0a 2020 2020 6c6f 636b 6669 6c65  ss..    lockfile
-00011c70: 203d 2050 6174 6828 6622 7b73 7472 2864   = Path(f"{str(d
-00011c80: 7374 297d 2e6c 6f63 6b22 290a 0a20 2020  st)}.lock")..   
-00011c90: 2023 2049 6620 7468 6520 6465 7374 696e   # If the destin
-00011ca0: 6174 696f 6e20 6669 6c65 2064 6f65 736e  ation file doesn
-00011cb0: 2774 2065 7869 7374 2079 6574 2c20 6275  't exist yet, bu
-00011cc0: 7420 7468 6520 6c6f 636b 6669 6c65 2064  t the lockfile d
-00011cd0: 6f65 732c 0a20 2020 2023 2074 7279 2072  oes,.    # try r
-00011ce0: 656d 6f76 696e 6720 7468 6520 6c6f 636b  emoving the lock
-00011cf0: 6669 6c65 2061 7320 6974 206d 6967 6874  file as it might
-00011d00: 2062 6520 6120 6768 6f73 7420 6c6f 636b   be a ghost lock
-00011d10: 6669 6c65 2e0a 2020 2020 6966 206e 6f74  file..    if not
-00011d20: 2064 7374 2e65 7869 7374 7328 2920 616e   dst.exists() an
-00011d30: 6420 6c6f 636b 6669 6c65 2e65 7869 7374  d lockfile.exist
-00011d40: 7328 293a 0a20 2020 2020 2020 2074 7279  s():.        try
-00011d50: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00011d60: 636b 6669 6c65 2e75 6e6c 696e 6b28 290a  ckfile.unlink().
-00011d70: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00011d80: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00011d90: 2020 2020 2020 5f20 3d20 4e6f 6e65 0a0a        _ = None..
-00011da0: 2020 2020 2320 4372 6561 7469 6e67 206c      # Creating l
-00011db0: 6f63 6b66 696c 6520 616e 6420 6170 7065  ockfile and appe
-00011dc0: 6e64 0a20 2020 2073 7461 7274 5f74 696d  nd.    start_tim
-00011dd0: 6520 3d20 6461 7465 7469 6d65 2e64 6174  e = datetime.dat
-00011de0: 6574 696d 652e 6e6f 7728 290a 2020 2020  etime.now().    
-00011df0: 7265 6164 7920 3d20 4661 6c73 650a 2020  ready = False.  
-00011e00: 2020 7768 696c 6520 6e6f 7420 7265 6164    while not read
-00011e10: 793a 0a20 2020 2020 2020 2069 6620 5f69  y:.        if _i
-00011e20: 6f5f 7574 696c 2e63 7265 6174 655f 6669  o_util.create_fi
-00011e30: 6c65 5f61 746f 6d69 6328 6c6f 636b 6669  le_atomic(lockfi
-00011e40: 6c65 2920 6973 2054 7275 653a 0a20 2020  le) is True:.   
-00011e50: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011e70: 6170 7065 6e64 0a20 2020 2020 2020 2020  append.         
-00011e80: 2020 2020 2020 205f 6170 7065 6e64 5f74         _append_t
-00011e90: 6f5f 6e6f 6c6f 636b 280a 2020 2020 2020  o_nolock(.      
-00011ea0: 2020 2020 2020 2020 2020 2020 2020 7372                sr
-00011eb0: 633d 7372 632c 0a20 2020 2020 2020 2020  c=src,.         
-00011ec0: 2020 2020 2020 2020 2020 2064 7374 3d64             dst=d
-00011ed0: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
-00011ee0: 2020 2020 2020 2020 7372 635f 6c61 7965          src_laye
-00011ef0: 723d 7372 635f 6c61 7965 722c 0a20 2020  r=src_layer,.   
-00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f10: 2064 7374 5f6c 6179 6572 3d64 7374 5f6c   dst_layer=dst_l
-00011f20: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-00011f30: 2020 2020 2020 2020 2020 7372 635f 6372            src_cr
-00011f40: 733d 7372 635f 6372 732c 0a20 2020 2020  s=src_crs,.     
-00011f50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00011f60: 7374 5f63 7273 3d64 7374 5f63 7273 2c0a  st_crs=dst_crs,.
-00011f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f80: 2020 2020 7768 6572 653d 7768 6572 652c      where=where,
-00011f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011fa0: 2020 2020 2072 6570 726f 6a65 6374 3d72       reproject=r
-00011fb0: 6570 726f 6a65 6374 2c0a 2020 2020 2020  eproject,.      
-00011fc0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011fd0: 706c 6f64 6563 6f6c 6c65 6374 696f 6e73  plodecollections
-00011fe0: 3d65 7870 6c6f 6465 636f 6c6c 6563 7469  =explodecollecti
-00011ff0: 6f6e 732c 0a20 2020 2020 2020 2020 2020  ons,.           
-00012000: 2020 2020 2020 2020 2066 6f72 6365 5f6f           force_o
-00012010: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
-00012020: 7065 3d66 6f72 6365 5f6f 7574 7075 745f  pe=force_output_
-00012030: 6765 6f6d 6574 7279 7479 7065 2c0a 2020  geometrytype,.  
+0000e9c0: 2020 2020 2020 2067 6466 7465 6d70 5f6c         gdftemp_l
+0000e9d0: 6f63 6b70 6174 682e 756e 6c69 6e6b 2829  ockpath.unlink()
+0000e9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e9f0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000ea00: 6e20 6173 2065 783a 0a20 2020 2020 2020  n as ex:.       
+0000ea10: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+0000ea20: 6620 7371 6c69 7465 206f 7574 7075 7420  f sqlite output 
+0000ea30: 6669 6c65 206c 6f63 6b65 642c 2061 6c73  file locked, als
+0000ea40: 6f20 7265 7472 790a 2020 2020 2020 2020  o retry.        
+0000ea50: 2020 2020 2020 2020 2020 2020 6966 2067              if g
+0000ea60: 656f 6669 6c65 7479 7065 2e69 735f 7370  eofiletype.is_sp
+0000ea70: 6174 6961 6c69 7465 5f62 6173 6564 2061  atialite_based a
+0000ea80: 6e64 2073 7472 2865 7829 206e 6f74 2069  nd str(ex) not i
+0000ea90: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
+0000eaa0: 2020 2020 2020 2020 2020 2020 2264 6174              "dat
+0000eab0: 6162 6173 6520 6973 206c 6f63 6b65 6422  abase is locked"
+0000eac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ead0: 2020 2020 2020 2020 2020 2261 7474 656d            "attem
+0000eae0: 7074 2074 6f20 7772 6974 6520 6120 7265  pt to write a re
+0000eaf0: 6164 6f6e 6c79 2064 6174 6162 6173 6522  adonly database"
+0000eb00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000eb10: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb30: 2072 6169 7365 2065 780a 2020 2020 2020   raise ex.      
+0000eb40: 2020 2020 2020 2020 2020 6669 6e61 6c6c            finall
+0000eb50: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000eb60: 2020 2020 2020 2072 6561 6479 203d 2054         ready = T
+0000eb70: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0000eb80: 2020 2020 2020 2020 6c6f 636b 6669 6c65          lockfile
+0000eb90: 2e75 6e6c 696e 6b28 290a 2020 2020 2020  .unlink().      
+0000eba0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000ebb0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+0000ebc0: 5f77 6169 7469 6e67 203d 2028 6461 7465  _waiting = (date
+0000ebd0: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+0000ebe0: 7728 2920 2d20 7374 6172 745f 7469 6d65  w() - start_time
+0000ebf0: 292e 746f 7461 6c5f 7365 636f 6e64 7328  ).total_seconds(
+0000ec00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ec10: 2020 6966 2074 696d 655f 7761 6974 696e    if time_waitin
+0000ec20: 6720 3e20 6170 7065 6e64 5f74 696d 656f  g > append_timeo
+0000ec30: 7574 5f73 3a0a 2020 2020 2020 2020 2020  ut_s:.          
+0000ec40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000ec50: 5275 6e74 696d 6545 7272 6f72 280a 2020  RuntimeError(.  
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2020 2020 2020 6622 746f 5f66 696c 6520        f"to_file 
+0000ec80: 7469 6d65 6f75 7420 6f66 207b 6170 7065  timeout of {appe
+0000ec90: 6e64 5f74 696d 656f 7574 5f73 7d20 7265  nd_timeout_s} re
+0000eca0: 6163 6865 642c 2073 746f 7020 6170 7065  ached, stop appe
+0000ecb0: 6e64 2022 0a20 2020 2020 2020 2020 2020  nd ".           
+0000ecc0: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+0000ecd0: 6f20 7b70 6174 687d 2122 0a20 2020 2020  o {path}!".     
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ecf0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000ed00: 536c 6565 7020 666f 7220 6120 7365 636f  Sleep for a seco
+0000ed10: 6e64 2062 6566 6f72 6520 7472 7969 6e67  nd before trying
+0000ed20: 2061 6761 696e 0a20 2020 2020 2020 2020   again.         
+0000ed30: 2020 2074 696d 652e 736c 6565 7028 3129     time.sleep(1)
+0000ed40: 0a0a 0a64 6566 205f 746f 5f66 696c 655f  ...def _to_file_
+0000ed50: 7079 6f67 7269 6f28 0a20 2020 2067 6466  pyogrio(.    gdf
+0000ed60: 3a20 6770 642e 4765 6f44 6174 6146 7261  : gpd.GeoDataFra
+0000ed70: 6d65 2c0a 2020 2020 7061 7468 3a20 5061  me,.    path: Pa
+0000ed80: 7468 2c0a 2020 2020 6c61 7965 723a 2073  th,.    layer: s
+0000ed90: 7472 2c0a 2020 2020 666f 7263 655f 6f75  tr,.    force_ou
+0000eda0: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
+0000edb0: 653a 2055 6e69 6f6e 5b47 656f 6d65 7472  e: Union[Geometr
+0000edc0: 7954 7970 652c 2073 7472 2c20 4e6f 6e65  yType, str, None
+0000edd0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 666f  ] = None,.    fo
+0000ede0: 7263 655f 6d75 6c74 6974 7970 653a 2062  rce_multitype: b
+0000edf0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000ee00: 2061 7070 656e 643a 2062 6f6f 6c20 3d20   append: bool = 
+0000ee10: 4661 6c73 652c 0a20 2020 2061 7070 656e  False,.    appen
+0000ee20: 645f 7469 6d65 6f75 745f 733a 2069 6e74  d_timeout_s: int
+0000ee30: 203d 2036 3030 2c0a 2020 2020 696e 6465   = 600,.    inde
+0000ee40: 783a 204f 7074 696f 6e61 6c5b 626f 6f6c  x: Optional[bool
+0000ee50: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 6372  ] = None,.    cr
+0000ee60: 6561 7465 5f73 7061 7469 616c 5f69 6e64  eate_spatial_ind
+0000ee70: 6578 3a20 4f70 7469 6f6e 616c 5b62 6f6f  ex: Optional[boo
+0000ee80: 6c5d 203d 2054 7275 652c 0a29 3a0a 2020  l] = True,.):.  
+0000ee90: 2020 2222 220a 2020 2020 5772 6974 6573    """.    Writes
+0000eea0: 2061 2070 616e 6461 7320 6461 7461 6672   a pandas datafr
+0000eeb0: 616d 6520 746f 2066 696c 6520 7573 696e  ame to file usin
+0000eec0: 6720 7079 6f67 7269 6f2e 0a0a 2020 2020  g pyogrio...    
+0000eed0: 5265 6d61 726b 3a20 7468 6973 2066 756e  Remark: this fun
+0000eee0: 6374 696f 6e20 6f6e 6c79 2073 7570 706f  ction only suppo
+0000eef0: 7274 7320 7772 6974 696e 6720 4765 6f44  rts writing GeoD
+0000ef00: 6174 6146 7261 6d65 7320 6174 2074 6865  ataFrames at the
+0000ef10: 206d 6f6d 656e 742e 0a20 2020 2022 2222   moment..    """
+0000ef20: 0a20 2020 2023 2050 7265 7061 7265 2061  .    # Prepare a
+0000ef30: 7267 7320 666f 7220 7772 6974 655f 6461  rgs for write_da
+0000ef40: 7461 6672 616d 650a 2020 2020 6b77 6172  taframe.    kwar
+0000ef50: 6773 203d 207b 7d0a 2020 2020 6b77 6172  gs = {}.    kwar
+0000ef60: 6773 5b22 656e 6769 6e65 225d 203d 2022  gs["engine"] = "
+0000ef70: 7079 6f67 7269 6f22 0a0a 2020 2020 2320  pyogrio"..    # 
+0000ef80: 4368 6563 6b20 7570 6672 6f6e 7420 6966  Check upfront if
+0000ef90: 2061 7070 656e 6420 6973 2067 6f69 6e67   append is going
+0000efa0: 2074 6f20 776f 726b 2074 6f20 6769 7665   to work to give
+0000efb0: 206e 6963 6520 6572 726f 720a 2020 2020   nice error.    
+0000efc0: 6966 2061 7070 656e 6420 6973 2054 7275  if append is Tru
+0000efd0: 6520 616e 6420 7061 7468 2e65 7869 7374  e and path.exist
+0000efe0: 7328 293a 0a20 2020 2020 2020 206b 7761  s():.        kwa
+0000eff0: 7267 735b 2261 7070 656e 6422 5d20 3d20  rgs["append"] = 
+0000f000: 5472 7565 0a20 2020 2020 2020 206c 6179  True.        lay
+0000f010: 6572 696e 666f 203d 2067 6574 5f6c 6179  erinfo = get_lay
+0000f020: 6572 696e 666f 2870 6174 682c 206c 6179  erinfo(path, lay
+0000f030: 6572 290a 2020 2020 2020 2020 6669 6c65  er).        file
+0000f040: 5f63 6f6c 7320 3d20 5b63 6f6c 2e75 7070  _cols = [col.upp
+0000f050: 6572 2829 2066 6f72 2063 6f6c 2069 6e20  er() for col in 
+0000f060: 6c61 7965 7269 6e66 6f2e 636f 6c75 6d6e  layerinfo.column
+0000f070: 735d 0a20 2020 2020 2020 2067 6466 5f63  s].        gdf_c
+0000f080: 6f6c 7320 3d20 5b63 6f6c 2e75 7070 6572  ols = [col.upper
+0000f090: 2829 2066 6f72 2063 6f6c 2069 6e20 6764  () for col in gd
+0000f0a0: 662e 636f 6c75 6d6e 7320 6966 2063 6f6c  f.columns if col
+0000f0b0: 2021 3d20 6764 662e 6765 6f6d 6574 7279   != gdf.geometry
+0000f0c0: 2e6e 616d 655d 0a20 2020 2020 2020 2069  .name].        i
+0000f0d0: 6620 6764 665f 636f 6c73 2021 3d20 6669  f gdf_cols != fi
+0000f0e0: 6c65 5f63 6f6c 733a 0a20 2020 2020 2020  le_cols:.       
+0000f0f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000f100: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000f110: 2020 2020 2020 2022 6465 7374 696e 6174         "destinat
+0000f120: 696f 6e20 6c61 7965 7220 646f 6573 6e27  ion layer doesn'
+0000f130: 7420 6861 7665 2074 6865 2073 616d 6520  t have the same 
+0000f140: 636f 6c75 6d6e 7320 6173 2067 6466 3a20  columns as gdf: 
+0000f150: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000f160: 2020 6622 7b66 696c 655f 636f 6c73 7d20    f"{file_cols} 
+0000f170: 7673 207b 6764 665f 636f 6c73 7d22 0a20  vs {gdf_cols}". 
+0000f180: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000f190: 2020 2320 5072 6570 6172 6520 6b77 6172    # Prepare kwar
+0000f1a0: 6773 2074 6f20 7573 6520 696e 2067 656f  gs to use in geo
+0000f1b0: 7061 6e64 6173 2e74 6f5f 6669 6c65 0a20  pandas.to_file. 
+0000f1c0: 2020 2069 6620 6372 6561 7465 5f73 7061     if create_spa
+0000f1d0: 7469 616c 5f69 6e64 6578 2069 7320 6e6f  tial_index is no
+0000f1e0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000f1f0: 6b77 6172 6773 5b22 5350 4154 4941 4c5f  kwargs["SPATIAL_
+0000f200: 494e 4445 5822 5d20 3d20 6372 6561 7465  INDEX"] = create
+0000f210: 5f73 7061 7469 616c 5f69 6e64 6578 0a20  _spatial_index. 
+0000f220: 2020 2067 656f 6669 6c65 7479 7065 203d     geofiletype =
+0000f230: 2047 656f 6669 6c65 5479 7065 2870 6174   GeofileType(pat
+0000f240: 6829 0a20 2020 206b 7761 7267 735b 2264  h).    kwargs["d
+0000f250: 7269 7665 7222 5d20 3d20 6765 6f66 696c  river"] = geofil
+0000f260: 6574 7970 652e 6f67 7264 7269 7665 720a  etype.ogrdriver.
+0000f270: 2020 2020 6b77 6172 6773 5b22 696e 6465      kwargs["inde
+0000f280: 7822 5d20 3d20 696e 6465 780a 2020 2020  x"] = index.    
+0000f290: 6966 2063 7265 6174 655f 7370 6174 6961  if create_spatia
+0000f2a0: 6c5f 696e 6465 7820 6973 206e 6f74 204e  l_index is not N
+0000f2b0: 6f6e 653a 0a20 2020 2020 2020 206b 7761  one:.        kwa
+0000f2c0: 7267 735b 2253 5041 5449 414c 5f49 4e44  rgs["SPATIAL_IND
+0000f2d0: 4558 225d 203d 2063 7265 6174 655f 7370  EX"] = create_sp
+0000f2e0: 6174 6961 6c5f 696e 6465 780a 2020 2020  atial_index.    
+0000f2f0: 6966 2066 6f72 6365 5f6f 7574 7075 745f  if force_output_
+0000f300: 6765 6f6d 6574 7279 7479 7065 2069 7320  geometrytype is 
+0000f310: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000f320: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000f330: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
+0000f340: 6d65 7472 7974 7970 652c 2047 656f 6d65  metrytype, Geome
+0000f350: 7472 7954 7970 6529 3a0a 2020 2020 2020  tryType):.      
+0000f360: 2020 2020 2020 666f 7263 655f 6f75 7470        force_outp
+0000f370: 7574 5f67 656f 6d65 7472 7974 7970 6520  ut_geometrytype 
+0000f380: 3d20 666f 7263 655f 6f75 7470 7574 5f67  = force_output_g
+0000f390: 656f 6d65 7472 7974 7970 652e 6e61 6d65  eometrytype.name
+0000f3a0: 5f63 616d 656c 6361 7365 0a20 2020 2020  _camelcase.     
+0000f3b0: 2020 206b 7761 7267 735b 2267 656f 6d65     kwargs["geome
+0000f3c0: 7472 795f 7479 7065 225d 203d 2066 6f72  try_type"] = for
+0000f3d0: 6365 5f6f 7574 7075 745f 6765 6f6d 6574  ce_output_geomet
+0000f3e0: 7279 7479 7065 0a20 2020 2069 6620 666f  rytype.    if fo
+0000f3f0: 7263 655f 6d75 6c74 6974 7970 653a 0a20  rce_multitype:. 
+0000f400: 2020 2020 2020 206b 7761 7267 735b 2270         kwargs["p
+0000f410: 726f 6d6f 7465 5f74 6f5f 6d75 6c74 6922  romote_to_multi"
+0000f420: 5d20 3d20 5472 7565 0a0a 2020 2020 2320  ] = True..    # 
+0000f430: 4e6f 7720 7765 2063 616e 2077 7269 7465  Now we can write
+0000f440: 0a20 2020 2069 6620 6765 6f66 696c 6574  .    if geofilet
+0000f450: 7970 652e 6973 5f73 696e 676c 656c 6179  ype.is_singlelay
+0000f460: 6572 3a0a 2020 2020 2020 2020 6764 662e  er:.        gdf.
+0000f470: 746f 5f66 696c 6528 7374 7228 7061 7468  to_file(str(path
+0000f480: 292c 202a 2a6b 7761 7267 7329 0a20 2020  ), **kwargs).   
+0000f490: 2065 6c73 653a 0a20 2020 2020 2020 2067   else:.        g
+0000f4a0: 6466 2e74 6f5f 6669 6c65 2873 7472 2870  df.to_file(str(p
+0000f4b0: 6174 6829 2c20 6c61 7965 723d 6c61 7965  ath), layer=laye
+0000f4c0: 722c 202a 2a6b 7761 7267 7329 0a0a 0a64  r, **kwargs)...d
+0000f4d0: 6566 2067 6574 5f63 7273 2870 6174 683a  ef get_crs(path:
+0000f4e0: 2055 6e69 6f6e 5b73 7472 2c20 226f 732e   Union[str, "os.
+0000f4f0: 5061 7468 4c69 6b65 5b41 6e79 5d22 5d29  PathLike[Any]"])
+0000f500: 202d 3e20 7079 7072 6f6a 2e43 5253 3a0a   -> pyproj.CRS:.
+0000f510: 2020 2020 2222 220a 2020 2020 4765 7420      """.    Get 
+0000f520: 7468 6520 4352 5320 2870 726f 6a65 6374  the CRS (project
+0000f530: 696f 6e29 206f 6620 7468 6520 6669 6c65  ion) of the file
+0000f540: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+0000f550: 2020 2020 7061 7468 2028 5061 7468 4c69      path (PathLi
+0000f560: 6b65 293a 2050 6174 6820 746f 2074 6865  ke): Path to the
+0000f570: 2066 696c 652e 0a0a 2020 2020 5265 7475   file...    Retu
+0000f580: 726e 733a 0a20 2020 2020 2020 2070 7970  rns:.        pyp
+0000f590: 726f 6a2e 4352 533a 2054 6865 2070 726f  roj.CRS: The pro
+0000f5a0: 6a65 6374 696f 6e20 6f66 2074 6865 2066  jection of the f
+0000f5b0: 696c 650a 2020 2020 2222 220a 2020 2020  ile.    """.    
+0000f5c0: 2320 544f 444f 3a20 7365 656d 7320 6c69  # TODO: seems li
+0000f5d0: 6b65 2073 7570 706f 7274 2066 6f72 206d  ke support for m
+0000f5e0: 756c 7469 706c 6520 6c61 7965 7273 2069  ultiple layers i
+0000f5f0: 6e20 7468 6520 6669 6c65 2069 736e 2774  n the file isn't
+0000f600: 2068 6572 6520 7965 743f 3f3f 0a20 2020   here yet???.   
+0000f610: 2077 6974 6820 6669 6f6e 612e 6f70 656e   with fiona.open
+0000f620: 2873 7472 2870 6174 6829 2c20 2272 2229  (str(path), "r")
+0000f630: 2061 7320 6765 6f66 696c 653a 0a20 2020   as geofile:.   
+0000f640: 2020 2020 2061 7373 6572 7420 6765 6f66       assert geof
+0000f650: 696c 6520 6973 206e 6f74 204e 6f6e 650a  ile is not None.
+0000f660: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0000f670: 7970 726f 6a2e 4352 5328 6765 6f66 696c  yproj.CRS(geofil
+0000f680: 652e 6372 7329 0a0a 0a64 6566 2069 735f  e.crs)...def is_
+0000f690: 6765 6f66 696c 6528 7061 7468 3a20 556e  geofile(path: Un
+0000f6a0: 696f 6e5b 7374 722c 2022 6f73 2e50 6174  ion[str, "os.Pat
+0000f6b0: 684c 696b 655b 416e 795d 225d 2920 2d3e  hLike[Any]"]) ->
+0000f6c0: 2062 6f6f 6c3a 0a20 2020 2022 2222 0a20   bool:.    """. 
+0000f6d0: 2020 2044 6574 6572 6d69 6e65 7320 6261     Determines ba
+0000f6e0: 7365 6420 6f6e 2074 6865 2066 696c 6570  sed on the filep
+0000f6f0: 6174 6820 6966 2074 6869 7320 6973 2061  ath if this is a
+0000f700: 2067 656f 6669 6c65 2e0a 0a20 2020 2041   geofile...    A
+0000f710: 7267 733a 0a20 2020 2020 2020 2070 6174  rgs:.        pat
+0000f720: 6820 2850 6174 684c 696b 6529 3a20 5468  h (PathLike): Th
+0000f730: 6520 6669 6c65 2070 6174 682e 0a0a 2020  e file path...  
+0000f740: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+0000f750: 2020 2062 6f6f 6c3a 2054 7275 6520 6966     bool: True if
+0000f760: 2069 7420 6973 2061 2067 656f 2066 696c   it is a geo fil
+0000f770: 652e 0a20 2020 2022 2222 0a20 2020 2072  e..    """.    r
+0000f780: 6574 7572 6e20 6973 5f67 656f 6669 6c65  eturn is_geofile
+0000f790: 5f65 7874 2850 6174 6828 7061 7468 292e  _ext(Path(path).
+0000f7a0: 7375 6666 6978 290a 0a0a 6465 6620 6973  suffix)...def is
+0000f7b0: 5f67 656f 6669 6c65 5f65 7874 2866 696c  _geofile_ext(fil
+0000f7c0: 655f 6578 743a 2073 7472 2920 2d3e 2062  e_ext: str) -> b
+0000f7d0: 6f6f 6c3a 0a20 2020 2022 2222 0a20 2020  ool:.    """.   
+0000f7e0: 2044 6574 6572 6d69 6e65 7320 6261 7365   Determines base
+0000f7f0: 6420 6f6e 2074 6865 2066 696c 6520 6578  d on the file ex
+0000f800: 7465 6e73 696f 6e20 6966 2074 6869 7320  tension if this 
+0000f810: 6973 2061 2067 656f 6669 6c65 2e0a 0a20  is a geofile... 
+0000f820: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000f830: 2066 696c 655f 6578 7420 2873 7472 293a   file_ext (str):
+0000f840: 2074 6865 2065 7874 656e 7369 6f6e 2e0a   the extension..
+0000f850: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
+0000f860: 2020 2020 2020 626f 6f6c 3a20 5472 7565        bool: True
+0000f870: 2069 6620 6974 2069 7320 6120 6765 6f66   if it is a geof
+0000f880: 696c 652e 0a20 2020 2022 2222 0a20 2020  ile..    """.   
+0000f890: 2074 7279 3a0a 2020 2020 2020 2020 2320   try:.        # 
+0000f8a0: 4966 2074 6865 2064 7269 7665 7220 6361  If the driver ca
+0000f8b0: 6e20 6265 2064 6574 6572 6d69 6e65 642c  n be determined,
+0000f8c0: 2069 7420 6973 2061 2028 7375 7070 6f72   it is a (suppor
+0000f8d0: 7465 6429 2067 656f 2066 696c 652e 0a20  ted) geo file.. 
+0000f8e0: 2020 2020 2020 205f 203d 2047 656f 6669         _ = Geofi
+0000f8f0: 6c65 5479 7065 2866 696c 655f 6578 7429  leType(file_ext)
+0000f900: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f910: 5472 7565 0a20 2020 2065 7863 6570 7420  True.    except 
+0000f920: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000f930: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000f940: 0a0a 6465 6620 636d 7028 0a20 2020 2070  ..def cmp(.    p
+0000f950: 6174 6831 3a20 556e 696f 6e5b 7374 722c  ath1: Union[str,
+0000f960: 2022 6f73 2e50 6174 684c 696b 655b 416e   "os.PathLike[An
+0000f970: 795d 225d 2c20 7061 7468 323a 2055 6e69  y]"], path2: Uni
+0000f980: 6f6e 5b73 7472 2c20 226f 732e 5061 7468  on[str, "os.Path
+0000f990: 4c69 6b65 5b41 6e79 5d22 5d0a 2920 2d3e  Like[Any]"].) ->
+0000f9a0: 2062 6f6f 6c3a 0a20 2020 2022 2222 0a20   bool:.    """. 
+0000f9b0: 2020 2043 6f6d 7061 7265 2069 6620 7477     Compare if tw
+0000f9c0: 6f20 6765 6f66 696c 6573 2061 7265 2069  o geofiles are i
+0000f9d0: 6465 6e74 6963 616c 2e0a 0a20 2020 2046  dentical...    F
+0000f9e0: 6f72 2067 656f 6669 6c65 7320 7468 6174  or geofiles that
+0000f9f0: 2075 7365 206d 756c 7469 706c 6520 6669   use multiple fi
+0000fa00: 6c65 732c 2061 6c6c 2072 656c 6576 616e  les, all relevan
+0000fa10: 7420 6669 6c65 7320 6d75 7374 2062 6520  t files must be 
+0000fa20: 6964 656e 7469 6361 6c2e 0a20 2020 2045  identical..    E
+0000fa30: 672e 2066 6f72 2073 6861 7065 6669 6c65  g. for shapefile
+0000fa40: 732c 2074 6865 202e 7368 702c 202e 7368  s, the .shp, .sh
+0000fa50: 7820 616e 6420 2e64 6266 2066 696c 6520  x and .dbf file 
+0000fa60: 6d75 7374 2062 6520 6964 656e 7469 6361  must be identica
+0000fa70: 6c2e 0a0a 2020 2020 4172 6773 3a0a 2020  l...    Args:.  
+0000fa80: 2020 2020 2020 7061 7468 3120 2850 6174        path1 (Pat
+0000fa90: 684c 696b 6529 3a20 7061 7468 2074 6f20  hLike): path to 
+0000faa0: 7468 6520 6669 7273 7420 6669 6c65 2e0a  the first file..
+0000fab0: 2020 2020 2020 2020 7061 7468 3220 2850          path2 (P
+0000fac0: 6174 684c 696b 6529 3a20 7061 7468 2074  athLike): path t
+0000fad0: 6f20 7468 6520 7365 636f 6e64 2066 696c  o the second fil
+0000fae0: 652e 0a0a 2020 2020 5265 7475 726e 733a  e...    Returns:
+0000faf0: 0a20 2020 2020 2020 2062 6f6f 6c3a 2054  .        bool: T
+0000fb00: 7275 6520 6966 2074 6865 2066 696c 6573  rue if the files
+0000fb10: 2061 7265 2069 6465 6e74 6963 616c 0a20   are identical. 
+0000fb20: 2020 2022 2222 0a20 2020 2023 2043 6865     """.    # Che
+0000fb30: 636b 2069 6e70 7574 2070 6172 616d 6574  ck input paramet
+0000fb40: 6572 730a 2020 2020 7061 7468 315f 7020  ers.    path1_p 
+0000fb50: 3d20 5061 7468 2870 6174 6831 290a 2020  = Path(path1).  
+0000fb60: 2020 7061 7468 325f 7020 3d20 5061 7468    path2_p = Path
+0000fb70: 2870 6174 6832 290a 0a20 2020 2023 2046  (path2)..    # F
+0000fb80: 6f72 2061 2073 6861 7065 6669 6c65 2c20  or a shapefile, 
+0000fb90: 6d75 6c74 6970 6c65 2066 696c 6573 206e  multiple files n
+0000fba0: 6565 6420 746f 2062 6520 636f 6d70 6172  eed to be compar
+0000fbb0: 6564 0a20 2020 2069 6620 7061 7468 315f  ed.    if path1_
+0000fbc0: 702e 7375 6666 6978 2e6c 6f77 6572 2829  p.suffix.lower()
+0000fbd0: 203d 3d20 222e 7368 7022 3a0a 2020 2020   == ".shp":.    
+0000fbe0: 2020 2020 7061 7468 325f 6e6f 6578 742c      path2_noext,
+0000fbf0: 205f 203d 206f 732e 7061 7468 2e73 706c   _ = os.path.spl
+0000fc00: 6974 6578 7428 7061 7468 325f 7029 0a20  itext(path2_p). 
+0000fc10: 2020 2020 2020 2073 6861 7065 6669 6c65         shapefile
+0000fc20: 5f62 6173 655f 7375 6666 6978 6573 203d  _base_suffixes =
+0000fc30: 205b 222e 7368 7022 2c20 222e 6462 6622   [".shp", ".dbf"
+0000fc40: 2c20 222e 7368 7822 5d0a 2020 2020 2020  , ".shx"].      
+0000fc50: 2020 7061 7468 315f 6e6f 6578 7420 3d20    path1_noext = 
+0000fc60: 7061 7468 315f 702e 7061 7265 6e74 202f  path1_p.parent /
+0000fc70: 2070 6174 6831 5f70 2e73 7465 6d0a 2020   path1_p.stem.  
+0000fc80: 2020 2020 2020 7061 7468 325f 6e6f 6578        path2_noex
+0000fc90: 7420 3d20 7061 7468 325f 702e 7061 7265  t = path2_p.pare
+0000fca0: 6e74 202f 2070 6174 6832 5f70 2e73 7465  nt / path2_p.ste
+0000fcb0: 6d0a 2020 2020 2020 2020 666f 7220 6578  m.        for ex
+0000fcc0: 7420 696e 2073 6861 7065 6669 6c65 5f62  t in shapefile_b
+0000fcd0: 6173 655f 7375 6666 6978 6573 3a0a 2020  ase_suffixes:.  
+0000fce0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000fcf0: 2066 696c 6563 6d70 2e63 6d70 2866 227b   filecmp.cmp(f"{
+0000fd00: 7374 7228 7061 7468 315f 6e6f 6578 7429  str(path1_noext)
+0000fd10: 7d7b 6578 747d 222c 2066 227b 7374 7228  }{ext}", f"{str(
+0000fd20: 7061 7468 325f 6e6f 6578 7429 7d7b 6578  path2_noext)}{ex
+0000fd30: 747d 2229 3a0a 2020 2020 2020 2020 2020  t}"):.          
+0000fd40: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0000fd50: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+0000fd60: 2020 2020 2020 2066 2246 696c 6520 7b70         f"File {p
+0000fd70: 6174 6831 5f6e 6f65 7874 7d7b 6578 747d  ath1_noext}{ext}
+0000fd80: 2069 7320 6469 6666 6572 656e 7420 6672   is different fr
+0000fd90: 6f6d 207b 7061 7468 325f 6e6f 6578 747d  om {path2_noext}
+0000fda0: 7b65 7874 7d22 0a20 2020 2020 2020 2020  {ext}".         
+0000fdb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000fdc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fdd0: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+0000fde0: 7475 726e 2054 7275 650a 2020 2020 656c  turn True.    el
+0000fdf0: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
+0000fe00: 726e 2066 696c 6563 6d70 2e63 6d70 2873  rn filecmp.cmp(s
+0000fe10: 7472 2870 6174 6831 5f70 292c 2073 7472  tr(path1_p), str
+0000fe20: 2870 6174 6832 5f70 2929 0a0a 0a64 6566  (path2_p))...def
+0000fe30: 2063 6f70 7928 7372 633a 2055 6e69 6f6e   copy(src: Union
+0000fe40: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
+0000fe50: 6b65 5b41 6e79 5d22 5d2c 2064 7374 3a20  ke[Any]"], dst: 
+0000fe60: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
+0000fe70: 6174 684c 696b 655b 416e 795d 225d 293a  athLike[Any]"]):
+0000fe80: 0a20 2020 2022 2222 0a20 2020 2043 6f70  .    """.    Cop
+0000fe90: 6965 7320 7468 6520 6765 6f66 696c 6520  ies the geofile 
+0000fea0: 6672 6f6d 2073 7263 2074 6f20 6473 742e  from src to dst.
+0000feb0: 2049 7320 7468 6520 736f 7572 6365 2066   Is the source f
+0000fec0: 696c 6520 6973 2061 2067 656f 6669 6c65  ile is a geofile
+0000fed0: 2063 6f6e 7461 696e 696e 670a 2020 2020   containing.    
+0000fee0: 6f66 206d 756c 7469 706c 6520 6669 6c65  of multiple file
+0000fef0: 7320 2865 672e 202e 7368 7029 2061 6c6c  s (eg. .shp) all
+0000ff00: 2066 696c 6573 2061 7265 2063 6f70 6965   files are copie
+0000ff10: 642e 0a0a 2020 2020 4172 6773 3a0a 2020  d...    Args:.  
+0000ff20: 2020 2020 2020 7372 6320 2850 6174 684c        src (PathL
+0000ff30: 696b 6529 3a20 7468 6520 6669 6c65 2074  ike): the file t
+0000ff40: 6f20 636f 7079 2e0a 2020 2020 2020 2020  o copy..        
+0000ff50: 6473 7420 2850 6174 684c 696b 6529 3a20  dst (PathLike): 
+0000ff60: 7468 6520 6c6f 6361 7469 6f6e 2074 6f20  the location to 
+0000ff70: 636f 7079 2074 6865 2066 696c 6528 7329  copy the file(s)
+0000ff80: 2074 6f2e 0a20 2020 2022 2222 0a20 2020   to..    """.   
+0000ff90: 2023 2043 6865 636b 2069 6e70 7574 2070   # Check input p
+0000ffa0: 6172 616d 6574 6572 730a 2020 2020 7372  arameters.    sr
+0000ffb0: 6320 3d20 5061 7468 2873 7263 290a 2020  c = Path(src).  
+0000ffc0: 2020 6473 7420 3d20 5061 7468 2864 7374    dst = Path(dst
+0000ffd0: 290a 2020 2020 6765 6f66 696c 6574 7970  ).    geofiletyp
+0000ffe0: 6520 3d20 4765 6f66 696c 6554 7970 6528  e = GeofileType(
+0000fff0: 7372 6329 0a0a 2020 2020 2320 436f 7079  src)..    # Copy
+00010000: 2074 6865 206d 6169 6e20 6669 6c65 0a20   the main file. 
+00010010: 2020 2073 6875 7469 6c2e 636f 7079 2873     shutil.copy(s
+00010020: 7472 2873 7263 292c 2064 7374 290a 0a20  tr(src), dst).. 
+00010030: 2020 2023 2046 6f72 2073 6f6d 6520 6669     # For some fi
+00010040: 6c65 2074 7970 6573 2c20 6578 7472 6120  le types, extra 
+00010050: 6669 6c65 7320 6e65 6564 2074 6f20 6265  files need to be
+00010060: 2063 6f70 6965 640a 2020 2020 2320 4966   copied.    # If
+00010070: 2064 6573 7420 6973 2061 2064 6972 2c20   dest is a dir, 
+00010080: 6a75 7374 2075 7365 206d 6f76 652e 204f  just use move. O
+00010090: 7468 6572 7769 7365 2063 6f6e 6361 7420  therwise concat 
+000100a0: 6465 7374 2066 696c 6570 6174 6873 0a20  dest filepaths. 
+000100b0: 2020 2069 6620 6765 6f66 696c 6574 7970     if geofiletyp
+000100c0: 652e 7375 6666 6978 6573 5f65 7874 7261  e.suffixes_extra
+000100d0: 6669 6c65 7320 6973 206e 6f74 204e 6f6e  files is not Non
+000100e0: 653a 0a20 2020 2020 2020 2069 6620 6473  e:.        if ds
+000100f0: 742e 6973 5f64 6972 2829 3a0a 2020 2020  t.is_dir():.    
+00010100: 2020 2020 2020 2020 666f 7220 7375 6666          for suff
+00010110: 6978 2069 6e20 6765 6f66 696c 6574 7970  ix in geofiletyp
+00010120: 652e 7375 6666 6978 6573 5f65 7874 7261  e.suffixes_extra
+00010130: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+00010140: 2020 2020 2020 2073 7263 6669 6c65 203d         srcfile =
+00010150: 2073 7263 2e70 6172 656e 7420 2f20 6622   src.parent / f"
+00010160: 7b73 7263 2e73 7465 6d7d 7b73 7566 6669  {src.stem}{suffi
+00010170: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
+00010180: 2020 2020 6966 2073 7263 6669 6c65 2e65      if srcfile.e
+00010190: 7869 7374 7328 293a 0a20 2020 2020 2020  xists():.       
+000101a0: 2020 2020 2020 2020 2020 2020 2073 6875               shu
+000101b0: 7469 6c2e 636f 7079 2873 7472 2873 7263  til.copy(str(src
+000101c0: 6669 6c65 292c 2064 7374 290a 2020 2020  file), dst).    
+000101d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000101e0: 2020 2020 2020 666f 7220 7375 6666 6978        for suffix
+000101f0: 2069 6e20 6765 6f66 696c 6574 7970 652e   in geofiletype.
+00010200: 7375 6666 6978 6573 5f65 7874 7261 6669  suffixes_extrafi
+00010210: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00010220: 2020 2020 2073 7263 6669 6c65 203d 2073       srcfile = s
+00010230: 7263 2e70 6172 656e 7420 2f20 6622 7b73  rc.parent / f"{s
+00010240: 7263 2e73 7465 6d7d 7b73 7566 6669 787d  rc.stem}{suffix}
+00010250: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00010260: 2020 6473 7466 696c 6520 3d20 6473 742e    dstfile = dst.
+00010270: 7061 7265 6e74 202f 2066 227b 6473 742e  parent / f"{dst.
+00010280: 7374 656d 7d7b 7375 6666 6978 7d22 0a20  stem}{suffix}". 
+00010290: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000102a0: 6620 7372 6366 696c 652e 6578 6973 7473  f srcfile.exists
+000102b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000102c0: 2020 2020 2020 2020 7368 7574 696c 2e63          shutil.c
+000102d0: 6f70 7928 7374 7228 7372 6366 696c 6529  opy(str(srcfile)
+000102e0: 2c20 6473 7466 696c 6529 0a0a 0a64 6566  , dstfile)...def
+000102f0: 206d 6f76 6528 7372 633a 2055 6e69 6f6e   move(src: Union
+00010300: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
+00010310: 6b65 5b41 6e79 5d22 5d2c 2064 7374 3a20  ke[Any]"], dst: 
+00010320: 556e 696f 6e5b 7374 722c 2022 6f73 2e50  Union[str, "os.P
+00010330: 6174 684c 696b 655b 416e 795d 225d 293a  athLike[Any]"]):
+00010340: 0a20 2020 2022 2222 0a20 2020 204d 6f76  .    """.    Mov
+00010350: 6573 2074 6865 2067 656f 6669 6c65 2066  es the geofile f
+00010360: 726f 6d20 7372 6320 746f 2064 7374 2e20  rom src to dst. 
+00010370: 4966 2074 6865 2073 6f75 7263 6520 6669  If the source fi
+00010380: 6c65 2069 7320 6120 6765 6f66 696c 6520  le is a geofile 
+00010390: 636f 6e74 6169 6e69 6e67 0a20 2020 206f  containing.    o
+000103a0: 6620 6d75 6c74 6970 6c65 2066 696c 6573  f multiple files
+000103b0: 2028 6567 2e20 2e73 6870 2920 616c 6c20   (eg. .shp) all 
+000103c0: 6669 6c65 7320 6172 6520 6d6f 7665 642e  files are moved.
+000103d0: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+000103e0: 2020 2020 7372 6320 2850 6174 684c 696b      src (PathLik
+000103f0: 6529 3a20 7468 6520 6669 6c65 2074 6f20  e): the file to 
+00010400: 6d6f 7665 0a20 2020 2020 2020 2064 7374  move.        dst
+00010410: 2028 5061 7468 4c69 6b65 293a 2074 6865   (PathLike): the
+00010420: 206c 6f63 6174 696f 6e20 746f 206d 6f76   location to mov
+00010430: 6520 7468 6520 6669 6c65 2873 2920 746f  e the file(s) to
+00010440: 0a20 2020 2022 2222 0a20 2020 2023 2043  .    """.    # C
+00010450: 6865 636b 2069 6e70 7574 2070 6172 616d  heck input param
+00010460: 6574 6572 730a 2020 2020 7372 6320 3d20  eters.    src = 
+00010470: 5061 7468 2873 7263 290a 2020 2020 6473  Path(src).    ds
+00010480: 7420 3d20 5061 7468 2864 7374 290a 2020  t = Path(dst).  
+00010490: 2020 6765 6f66 696c 6574 7970 6520 3d20    geofiletype = 
+000104a0: 4765 6f66 696c 6554 7970 6528 7372 6329  GeofileType(src)
+000104b0: 0a0a 2020 2020 2320 4d6f 7665 2074 6865  ..    # Move the
+000104c0: 206d 6169 6e20 6669 6c65 0a20 2020 2073   main file.    s
+000104d0: 6875 7469 6c2e 6d6f 7665 2873 7472 2873  hutil.move(str(s
+000104e0: 7263 292c 2064 7374 290a 0a20 2020 2023  rc), dst)..    #
+000104f0: 2046 6f72 2073 6f6d 6520 6669 6c65 2074   For some file t
+00010500: 7970 6573 2c20 6578 7472 6120 6669 6c65  ypes, extra file
+00010510: 7320 6e65 6564 2074 6f20 6265 206d 6f76  s need to be mov
+00010520: 6564 0a20 2020 2023 2049 6620 6465 7374  ed.    # If dest
+00010530: 2069 7320 6120 6469 722c 206a 7573 7420   is a dir, just 
+00010540: 7573 6520 6d6f 7665 2e20 4f74 6865 7277  use move. Otherw
+00010550: 6973 6520 636f 6e63 6174 2064 6573 7420  ise concat dest 
+00010560: 6669 6c65 7061 7468 730a 2020 2020 6966  filepaths.    if
+00010570: 2067 656f 6669 6c65 7479 7065 2e73 7566   geofiletype.suf
+00010580: 6669 7865 735f 6578 7472 6166 696c 6573  fixes_extrafiles
+00010590: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000105a0: 2020 2020 2020 6966 2064 7374 2e69 735f        if dst.is_
+000105b0: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+000105c0: 2020 2066 6f72 2073 7566 6669 7820 696e     for suffix in
+000105d0: 2067 656f 6669 6c65 7479 7065 2e73 7566   geofiletype.suf
+000105e0: 6669 7865 735f 6578 7472 6166 696c 6573  fixes_extrafiles
+000105f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010600: 2020 7372 6366 696c 6520 3d20 7372 632e    srcfile = src.
+00010610: 7061 7265 6e74 202f 2066 227b 7372 632e  parent / f"{src.
+00010620: 7374 656d 7d7b 7375 6666 6978 7d22 0a20  stem}{suffix}". 
+00010630: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010640: 6620 7372 6366 696c 652e 6578 6973 7473  f srcfile.exists
+00010650: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00010660: 2020 2020 2020 2020 7368 7574 696c 2e6d          shutil.m
+00010670: 6f76 6528 7374 7228 7372 6366 696c 6529  ove(str(srcfile)
+00010680: 2c20 6473 7429 0a20 2020 2020 2020 2065  , dst).        e
+00010690: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000106a0: 2066 6f72 2073 7566 6669 7820 696e 2067   for suffix in g
+000106b0: 656f 6669 6c65 7479 7065 2e73 7566 6669  eofiletype.suffi
+000106c0: 7865 735f 6578 7472 6166 696c 6573 3a0a  xes_extrafiles:.
+000106d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106e0: 7372 6366 696c 6520 3d20 7372 632e 7061  srcfile = src.pa
+000106f0: 7265 6e74 202f 2066 227b 7372 632e 7374  rent / f"{src.st
+00010700: 656d 7d7b 7375 6666 6978 7d22 0a20 2020  em}{suffix}".   
+00010710: 2020 2020 2020 2020 2020 2020 2064 7374               dst
+00010720: 6669 6c65 203d 2064 7374 2e70 6172 656e  file = dst.paren
+00010730: 7420 2f20 6622 7b64 7374 2e73 7465 6d7d  t / f"{dst.stem}
+00010740: 7b73 7566 6669 787d 220a 2020 2020 2020  {suffix}".      
+00010750: 2020 2020 2020 2020 2020 6966 2073 7263            if src
+00010760: 6669 6c65 2e65 7869 7374 7328 293a 0a20  file.exists():. 
+00010770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010780: 2020 2073 6875 7469 6c2e 6d6f 7665 2873     shutil.move(s
+00010790: 7472 2873 7263 6669 6c65 292c 2064 7374  tr(srcfile), dst
+000107a0: 6669 6c65 290a 0a0a 6465 6620 7265 6d6f  file)...def remo
+000107b0: 7665 2870 6174 683a 2055 6e69 6f6e 5b73  ve(path: Union[s
+000107c0: 7472 2c20 226f 732e 5061 7468 4c69 6b65  tr, "os.PathLike
+000107d0: 5b41 6e79 5d22 5d2c 206d 6973 7369 6e67  [Any]"], missing
+000107e0: 5f6f 6b3a 2062 6f6f 6c20 3d20 4661 6c73  _ok: bool = Fals
+000107f0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+00010800: 5265 6d6f 7665 7320 7468 6520 6765 6f66  Removes the geof
+00010810: 696c 652e 2049 7320 6974 2069 7320 6120  ile. Is it is a 
+00010820: 6765 6f66 696c 6520 636f 6d70 6f73 6564  geofile composed
+00010830: 206f 6620 6d75 6c74 6970 6c65 2066 696c   of multiple fil
+00010840: 6573 0a20 2020 2028 6567 2e20 2e73 6870  es.    (eg. .shp
+00010850: 2920 616c 6c20 6669 6c65 7320 6172 6520  ) all files are 
+00010860: 7265 6d6f 7665 642e 0a20 2020 2049 6620  removed..    If 
+00010870: 2e6c 6f63 6b20 6669 6c65 7320 6172 6520  .lock files are 
+00010880: 7072 6573 656e 742c 2074 6865 7920 6172  present, they ar
+00010890: 6520 7265 6d6f 7665 6420 6173 2077 656c  e removed as wel
+000108a0: 6c2e 0a0a 2020 2020 4172 6773 3a0a 2020  l...    Args:.  
+000108b0: 2020 2020 2020 7061 7468 2028 5061 7468        path (Path
+000108c0: 4c69 6b65 293a 2074 6865 2066 696c 6520  Like): the file 
+000108d0: 746f 2072 656d 6f76 650a 2020 2020 2222  to remove.    ""
+000108e0: 220a 2020 2020 2320 4368 6563 6b20 696e  ".    # Check in
+000108f0: 7075 7420 7061 7261 6d65 7465 7273 0a20  put parameters. 
+00010900: 2020 2070 6174 6820 3d20 5061 7468 2870     path = Path(p
+00010910: 6174 6829 0a20 2020 2067 656f 6669 6c65  ath).    geofile
+00010920: 7479 7065 203d 2047 656f 6669 6c65 5479  type = GeofileTy
+00010930: 7065 2870 6174 6829 0a0a 2020 2020 2320  pe(path)..    # 
+00010940: 4966 2074 6865 7265 2069 7320 6120 6c6f  If there is a lo
+00010950: 636b 2066 696c 652c 2072 656d 6f76 6520  ck file, remove 
+00010960: 6974 0a20 2020 206c 6f63 6b66 696c 655f  it.    lockfile_
+00010970: 7061 7468 203d 2070 6174 682e 7061 7265  path = path.pare
+00010980: 6e74 202f 2066 227b 7061 7468 2e6e 616d  nt / f"{path.nam
+00010990: 657d 2e6c 6f63 6b22 0a20 2020 206c 6f63  e}.lock".    loc
+000109a0: 6b66 696c 655f 7061 7468 2e75 6e6c 696e  kfile_path.unlin
+000109b0: 6b28 6d69 7373 696e 675f 6f6b 3d54 7275  k(missing_ok=Tru
+000109c0: 6529 0a0a 2020 2020 2320 5265 6d6f 7665  e)..    # Remove
+000109d0: 2074 6865 206d 6169 6e20 6669 6c65 0a20   the main file. 
+000109e0: 2020 2069 6620 7061 7468 2e65 7869 7374     if path.exist
+000109f0: 7328 293a 0a20 2020 2020 2020 2070 6174  s():.        pat
+00010a00: 682e 756e 6c69 6e6b 286d 6973 7369 6e67  h.unlink(missing
+00010a10: 5f6f 6b3d 6d69 7373 696e 675f 6f6b 290a  _ok=missing_ok).
+00010a20: 0a20 2020 2023 2046 6f72 2073 6f6d 6520  .    # For some 
+00010a30: 6669 6c65 2074 7970 6573 2c20 6578 7472  file types, extr
+00010a40: 6120 6669 6c65 7320 6e65 6564 2074 6f20  a files need to 
+00010a50: 6265 2072 656d 6f76 6564 0a20 2020 2069  be removed.    i
+00010a60: 6620 6765 6f66 696c 6574 7970 652e 7375  f geofiletype.su
+00010a70: 6666 6978 6573 5f65 7874 7261 6669 6c65  ffixes_extrafile
+00010a80: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00010a90: 2020 2020 2020 2066 6f72 2073 7566 6669         for suffi
+00010aa0: 7820 696e 2067 656f 6669 6c65 7479 7065  x in geofiletype
+00010ab0: 2e73 7566 6669 7865 735f 6578 7472 6166  .suffixes_extraf
+00010ac0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+00010ad0: 2020 6375 7272 5f70 6174 6820 3d20 7061    curr_path = pa
+00010ae0: 7468 2e70 6172 656e 7420 2f20 6622 7b70  th.parent / f"{p
+00010af0: 6174 682e 7374 656d 7d7b 7375 6666 6978  ath.stem}{suffix
+00010b00: 7d22 0a20 2020 2020 2020 2020 2020 2063  }".            c
+00010b10: 7572 725f 7061 7468 2e75 6e6c 696e 6b28  urr_path.unlink(
+00010b20: 6d69 7373 696e 675f 6f6b 3d54 7275 6529  missing_ok=True)
+00010b30: 0a0a 0a64 6566 2061 7070 656e 645f 746f  ...def append_to
+00010b40: 280a 2020 2020 7372 633a 2055 6e69 6f6e  (.    src: Union
+00010b50: 5b73 7472 2c20 226f 732e 5061 7468 4c69  [str, "os.PathLi
+00010b60: 6b65 5b41 6e79 5d22 5d2c 0a20 2020 2064  ke[Any]"],.    d
+00010b70: 7374 3a20 556e 696f 6e5b 7374 722c 2022  st: Union[str, "
+00010b80: 6f73 2e50 6174 684c 696b 655b 416e 795d  os.PathLike[Any]
+00010b90: 225d 2c0a 2020 2020 7372 635f 6c61 7965  "],.    src_laye
+00010ba0: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
+00010bb0: 203d 204e 6f6e 652c 0a20 2020 2064 7374   = None,.    dst
+00010bc0: 5f6c 6179 6572 3a20 4f70 7469 6f6e 616c  _layer: Optional
+00010bd0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00010be0: 2020 7372 635f 6372 733a 2055 6e69 6f6e    src_crs: Union
+00010bf0: 5b69 6e74 2c20 7374 722c 204e 6f6e 655d  [int, str, None]
+00010c00: 203d 204e 6f6e 652c 0a20 2020 2064 7374   = None,.    dst
+00010c10: 5f63 7273 3a20 556e 696f 6e5b 696e 742c  _crs: Union[int,
+00010c20: 2073 7472 2c20 4e6f 6e65 5d20 3d20 4e6f   str, None] = No
+00010c30: 6e65 2c0a 2020 2020 7768 6572 653a 204f  ne,.    where: O
+00010c40: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00010c50: 6f6e 652c 0a20 2020 2072 6570 726f 6a65  one,.    reproje
+00010c60: 6374 3a20 626f 6f6c 203d 2046 616c 7365  ct: bool = False
+00010c70: 2c0a 2020 2020 6578 706c 6f64 6563 6f6c  ,.    explodecol
+00010c80: 6c65 6374 696f 6e73 3a20 626f 6f6c 203d  lections: bool =
+00010c90: 2046 616c 7365 2c0a 2020 2020 666f 7263   False,.    forc
+00010ca0: 655f 6f75 7470 7574 5f67 656f 6d65 7472  e_output_geometr
+00010cb0: 7974 7970 653a 2055 6e69 6f6e 5b47 656f  ytype: Union[Geo
+00010cc0: 6d65 7472 7954 7970 652c 2073 7472 2c20  metryType, str, 
+00010cd0: 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a 2020  None] = None,.  
+00010ce0: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
+00010cf0: 5f69 6e64 6578 3a20 4f70 7469 6f6e 616c  _index: Optional
+00010d00: 5b62 6f6f 6c5d 203d 2054 7275 652c 0a20  [bool] = True,. 
+00010d10: 2020 2061 7070 656e 645f 7469 6d65 6f75     append_timeou
+00010d20: 745f 733a 2069 6e74 203d 2036 3030 2c0a  t_s: int = 600,.
+00010d30: 2020 2020 7472 616e 7361 6374 696f 6e5f      transaction_
+00010d40: 7369 7a65 3a20 696e 7420 3d20 3530 3030  size: int = 5000
+00010d50: 302c 0a20 2020 2070 7265 7365 7276 655f  0,.    preserve_
+00010d60: 6669 643a 204f 7074 696f 6e61 6c5b 626f  fid: Optional[bo
+00010d70: 6f6c 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ol] = None,.    
+00010d80: 6f70 7469 6f6e 733a 2064 6963 7420 3d20  options: dict = 
+00010d90: 7b7d 2c0a 293a 0a20 2020 2022 2222 0a20  {},.):.    """. 
+00010da0: 2020 2041 7070 656e 6420 7372 6320 6669     Append src fi
+00010db0: 6c65 2074 6f20 7468 6520 6473 7420 6669  le to the dst fi
+00010dc0: 6c65 2e0a 0a20 2020 2052 656d 6172 6b3a  le...    Remark:
+00010dd0: 2061 7070 656e 6420 6973 206e 6f74 2073   append is not s
+00010de0: 7570 706f 7274 6564 2066 6f72 2061 6c6c  upported for all
+00010df0: 2066 696c 6574 7970 6573 2069 6e20 6669   filetypes in fi
+00010e00: 6f6e 612f 6765 6f70 616e 6461 7320 2830  ona/geopandas (0
+00010e10: 2e38 290a 2020 2020 736f 2077 6f72 6b61  .8).    so worka
+00010e20: 726f 756e 6420 7669 6120 6764 616c 206e  round via gdal n
+00010e30: 6565 6465 642e 0a0a 2020 2020 5468 6520  eeded...    The 
+00010e40: 6f70 7469 6f6e 7320 7061 7261 6d65 7465  options paramete
+00010e50: 7220 6361 6e20 6265 2075 7365 6420 746f  r can be used to
+00010e60: 2070 6173 7320 616e 7920 7479 7065 206f   pass any type o
+00010e70: 6620 6f70 7469 6f6e 7320 746f 2047 4441  f options to GDA
+00010e80: 4c20 696e 0a20 2020 2074 6865 2066 6f6c  L in.    the fol
+00010e90: 6c6f 7769 6e67 2066 6f72 6d3a 0a20 2020  lowing form:.   
+00010ea0: 2020 2020 207b 2022 3c6f 7074 696f 6e5f       { "<option_
+00010eb0: 7479 7065 3e2e 3c6f 7074 696f 6e5f 6e61  type>.<option_na
+00010ec0: 6d65 3e22 3a20 3c6f 7074 696f 6e5f 7661  me>": <option_va
+00010ed0: 6c75 653e 207d 0a0a 2020 2020 5468 6520  lue> }..    The 
+00010ee0: 6f70 7469 6f6e 2074 7970 6573 2063 616e  option types can
+00010ef0: 2062 6520 616e 7920 6f66 2074 6865 2066   be any of the f
+00010f00: 6f6c 6c6f 7769 6e67 3a0a 2020 2020 2020  ollowing:.      
+00010f10: 2020 2d20 4c41 5945 525f 4352 4541 5449    - LAYER_CREATI
+00010f20: 4f4e 3a20 6c61 7965 7220 6372 6561 7469  ON: layer creati
+00010f30: 6f6e 206f 7074 696f 6e20 286c 636f 290a  on option (lco).
+00010f40: 2020 2020 2020 2020 2d20 4441 5441 5345          - DATASE
+00010f50: 545f 4352 4541 5449 4f4e 3a20 6461 7461  T_CREATION: data
+00010f60: 7365 7420 6372 6561 7469 6f6e 206f 7074  set creation opt
+00010f70: 696f 6e20 2864 7363 6f29 0a20 2020 2020  ion (dsco).     
+00010f80: 2020 202d 2049 4e50 5554 5f4f 5045 4e3a     - INPUT_OPEN:
+00010f90: 2069 6e70 7574 2064 6174 6173 6574 206f   input dataset o
+00010fa0: 7065 6e20 6f70 7469 6f6e 2028 6f6f 290a  pen option (oo).
+00010fb0: 2020 2020 2020 2020 2d20 4445 5354 494e          - DESTIN
+00010fc0: 4154 494f 4e5f 4f50 454e 3a20 6465 7374  ATION_OPEN: dest
+00010fd0: 696e 6174 696f 6e20 6461 7461 7365 7420  ination dataset 
+00010fe0: 6f70 656e 206f 7074 696f 6e20 2864 6f6f  open option (doo
+00010ff0: 290a 2020 2020 2020 2020 2d20 434f 4e46  ).        - CONF
+00011000: 4947 3a20 636f 6e66 6967 206f 7074 696f  IG: config optio
+00011010: 6e20 2863 6f6e 6669 6729 0a0a 2020 2020  n (config)..    
+00011020: 5468 6520 6f70 7469 6f6e 7320 6361 6e20  The options can 
+00011030: 6265 2066 6f75 6e64 2069 6e20 7468 6520  be found in the 
+00011040: 5b47 4441 4c20 7665 6374 6f72 2064 7269  [GDAL vector dri
+00011050: 7665 7220 646f 6375 6d65 6e74 6174 696f  ver documentatio
+00011060: 6e5d 0a20 2020 2028 6874 7470 733a 2f2f  n].    (https://
+00011070: 6764 616c 2e6f 7267 2f64 7269 7665 7273  gdal.org/drivers
+00011080: 2f76 6563 746f 722f 696e 6465 782e 6874  /vector/index.ht
+00011090: 6d6c 292e 0a0a 2020 2020 4172 6773 3a0a  ml)...    Args:.
+000110a0: 2020 2020 2020 2020 7372 6320 2855 6e69          src (Uni
+000110b0: 6f6e 5b73 7472 2c29 3a20 736f 7572 6365  on[str,): source
+000110c0: 2066 696c 6520 7061 7468 2e0a 2020 2020   file path..    
+000110d0: 2020 2020 6473 7420 2855 6e69 6f6e 5b73      dst (Union[s
+000110e0: 7472 2c29 3a20 6465 7374 696e 6174 696f  tr,): destinatio
+000110f0: 6e20 6669 6c65 2070 6174 682e 0a20 2020  n file path..   
+00011100: 2020 2020 2073 7263 5f6c 6179 6572 2028       src_layer (
+00011110: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
+00011120: 736f 7572 6365 206c 6179 6572 2e20 4465  source layer. De
+00011130: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00011140: 2020 2020 2020 2020 6473 745f 6c61 7965          dst_laye
+00011150: 7220 2873 7472 2c20 6f70 7469 6f6e 616c  r (str, optional
+00011160: 293a 2064 6573 7469 6e61 7469 6f6e 206c  ): destination l
+00011170: 6179 6572 2e20 4465 6661 756c 7473 2074  ayer. Defaults t
+00011180: 6f20 4e6f 6e65 2e0a 2020 2020 2020 2020  o None..        
+00011190: 7372 635f 6372 7320 2873 7472 2c20 6f70  src_crs (str, op
+000111a0: 7469 6f6e 616c 293a 2061 6e20 6570 7367  tional): an epsg
+000111b0: 2069 6e74 206f 7220 616e 7974 6869 6e67   int or anything
+000111c0: 2073 7570 706f 7274 6564 0a20 2020 2020   supported.     
+000111d0: 2020 2020 2020 2062 7920 7468 6520 4f47         by the OG
+000111e0: 5253 7061 7469 616c 5265 6665 7265 6e63  RSpatialReferenc
+000111f0: 652e 5365 7446 726f 6d55 7365 7249 6e70  e.SetFromUserInp
+00011200: 7574 2829 2063 616c 6c2c 2077 6869 6368  ut() call, which
+00011210: 2069 6e63 6c75 6465 730a 2020 2020 2020   includes.      
+00011220: 2020 2020 2020 616e 2045 5053 4720 7374        an EPSG st
+00011230: 7269 6e67 2028 6567 2e20 2245 5053 473a  ring (eg. "EPSG:
+00011240: 3433 3236 2229 2c20 6120 7765 6c6c 206b  4326"), a well k
+00011250: 6e6f 776e 2074 6578 7420 2857 4b54 2920  nown text (WKT) 
+00011260: 4352 530a 2020 2020 2020 2020 2020 2020  CRS.            
+00011270: 6465 6669 6e69 7469 6f6e 2c2e 2e2e 2044  definition,... D
+00011280: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
+00011290: 0a20 2020 2020 2020 2064 7374 5f63 7273  .        dst_crs
+000112a0: 2028 7374 722c 206f 7074 696f 6e61 6c29   (str, optional)
+000112b0: 3a20 616e 2065 7073 6720 696e 7420 6f72  : an epsg int or
+000112c0: 2061 6e79 7468 696e 6720 7375 7070 6f72   anything suppor
+000112d0: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+000112e0: 6279 2074 6865 204f 4752 5370 6174 6961  by the OGRSpatia
+000112f0: 6c52 6566 6572 656e 6365 2e53 6574 4672  lReference.SetFr
+00011300: 6f6d 5573 6572 496e 7075 7428 2920 6361  omUserInput() ca
+00011310: 6c6c 2c20 7768 6963 6820 696e 636c 7564  ll, which includ
+00011320: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
+00011330: 6e20 4550 5347 2073 7472 696e 6720 2865  n EPSG string (e
+00011340: 672e 2022 4550 5347 3a34 3332 3622 292c  g. "EPSG:4326"),
+00011350: 2061 2077 656c 6c20 6b6e 6f77 6e20 7465   a well known te
+00011360: 7874 2028 574b 5429 2043 5253 0a20 2020  xt (WKT) CRS.   
+00011370: 2020 2020 2020 2020 2064 6566 696e 6974           definit
+00011380: 696f 6e2c 2e2e 2e20 4465 6661 756c 7473  ion,... Defaults
+00011390: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+000113a0: 2020 7768 6572 6520 2873 7472 2c20 6f70    where (str, op
+000113b0: 7469 6f6e 616c 293a 206f 6e6c 7920 6170  tional): only ap
+000113c0: 7065 6e64 2074 6865 2072 6f77 7320 6672  pend the rows fr
+000113d0: 6f6d 2073 7263 2074 6861 7420 636f 6d70  om src that comp
+000113e0: 6c79 2074 6f20 7468 6520 6669 6c74 6572  ly to the filter
+000113f0: 0a20 2020 2020 2020 2020 2020 2073 7065  .            spe
+00011400: 6369 6669 6564 2e20 4170 706c 6965 6420  cified. Applied 
+00011410: 6265 666f 7265 2065 7870 6c6f 6465 636f  before explodeco
+00011420: 6c6c 6563 7469 6f6e 732e 2046 696c 7465  llections. Filte
+00011430: 7220 7368 6f75 6c64 2062 6520 696e 2073  r should be in s
+00011440: 716c 6974 650a 2020 2020 2020 2020 2020  qlite.          
+00011450: 2020 5351 4c20 5748 4552 4520 7379 6e74    SQL WHERE synt
+00011460: 6178 2061 6e64 207c 7370 6174 6961 6c69  ax and |spatiali
+00011470: 7465 5f72 6566 6572 656e 6365 5f6c 696e  te_reference_lin
+00011480: 6b7c 2066 756e 6374 696f 6e73 2063 616e  k| functions can
+00011490: 2062 6520 7573 6564 2e20 4966 0a20 2020   be used. If.   
+000114a0: 2020 2020 2020 2020 2077 6865 7265 2063           where c
+000114b0: 6f6e 7461 696e 7320 7468 6520 7b67 656f  ontains the {geo
+000114c0: 6d65 7472 7963 6f6c 756d 6e7d 2070 6c61  metrycolumn} pla
+000114d0: 6365 686f 6c64 6572 2c20 6974 2069 7320  ceholder, it is 
+000114e0: 6669 6c6c 6564 206f 7574 2077 6974 6820  filled out with 
+000114f0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00011500: 6765 6f6d 6574 7279 2063 6f6c 756d 6e20  geometry column 
+00011510: 6e61 6d65 206f 6620 7468 6520 7372 6320  name of the src 
+00011520: 6669 6c65 2e20 4465 6661 756c 7473 2074  file. Defaults t
+00011530: 6f20 4e6f 6e65 2e0a 2020 2020 2020 2020  o None..        
+00011540: 7265 7072 6f6a 6563 7420 2862 6f6f 6c2c  reproject (bool,
+00011550: 206f 7074 696f 6e61 6c29 3a20 5472 7565   optional): True
+00011560: 2074 6f20 7265 7072 6f6a 6563 7420 7768   to reproject wh
+00011570: 696c 6520 636f 6e76 6572 7469 6e67 2074  ile converting t
+00011580: 6865 0a20 2020 2020 2020 2020 2020 2066  he.            f
+00011590: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
+000115a0: 2046 616c 7365 2e0a 2020 2020 2020 2020   False..        
+000115b0: 6578 706c 6f64 6563 6f6c 6c65 6374 696f  explodecollectio
+000115c0: 6e73 2028 626f 6f6c 292c 206f 7074 696f  ns (bool), optio
+000115d0: 6e61 6c29 3a20 5472 7565 2074 6f20 6f75  nal): True to ou
+000115e0: 7470 7574 206f 6e6c 7920 7369 6d70 6c65  tput only simple
+000115f0: 2067 656f 6d65 7472 6965 732e 0a20 2020   geometries..   
+00011600: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00011610: 7320 746f 2046 616c 7365 2e0a 2020 2020  s to False..    
+00011620: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
+00011630: 5f67 656f 6d65 7472 7974 7970 6520 2855  _geometrytype (U
+00011640: 6e69 6f6e 5b47 656f 6d65 7472 7954 7970  nion[GeometryTyp
+00011650: 652c 2073 7472 5d2c 206f 7074 696f 6e61  e, str], optiona
+00011660: 6c29 3a20 4765 6f6d 6574 7279 2074 7970  l): Geometry typ
+00011670: 652e 0a20 2020 2020 2020 2020 2020 2074  e..            t
+00011680: 6f20 2874 7279 2074 6f29 2066 6f72 6365  o (try to) force
+00011690: 2074 6865 206f 7574 7075 7420 746f 2e20   the output to. 
+000116a0: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+000116b0: 2e0a 2020 2020 2020 2020 6372 6561 7465  ..        create
+000116c0: 5f73 7061 7469 616c 5f69 6e64 6578 2028  _spatial_index (
+000116d0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+000116e0: 2054 7275 6520 746f 2063 7265 6174 6520   True to create 
+000116f0: 6120 7370 6174 6961 6c20 696e 6465 780a  a spatial index.
+00011700: 2020 2020 2020 2020 2020 2020 6f6e 2074              on t
+00011710: 6865 2064 6573 7469 6e61 7469 6f6e 2066  he destination f
+00011720: 696c 652f 6c61 7965 722e 2049 6620 4e6f  ile/layer. If No
+00011730: 6e65 2c20 7468 6520 6465 6661 756c 7420  ne, the default 
+00011740: 6265 6861 7669 6f75 7220 6279 2067 6461  behaviour by gda
+00011750: 6c20 666f 720a 2020 2020 2020 2020 2020  l for.          
+00011760: 2020 7468 6174 2066 696c 6520 7479 7065    that file type
+00011770: 2069 7320 7265 7370 6563 7465 642e 2049   is respected. I
+00011780: 6620 7468 6520 4c41 5945 525f 4352 4541  f the LAYER_CREA
+00011790: 5449 4f4e 2e53 5041 5449 414c 5f49 4e44  TION.SPATIAL_IND
+000117a0: 4558 0a20 2020 2020 2020 2020 2020 2070  EX.            p
+000117b0: 6172 616d 6574 6572 2069 7320 7370 6563  arameter is spec
+000117c0: 6966 6965 6420 696e 206f 7074 696f 6e73  ified in options
+000117d0: 2c20 6372 6561 7465 5f73 7061 7469 616c  , create_spatial
+000117e0: 5f69 6e64 6578 2069 7320 6967 6e6f 7265  _index is ignore
+000117f0: 642e 0a20 2020 2020 2020 2020 2020 2044  d..            D
+00011800: 6566 6175 6c74 7320 746f 2054 7275 652e  efaults to True.
+00011810: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+00011820: 7469 6d65 6f75 745f 7320 2869 6e74 2c20  timeout_s (int, 
+00011830: 6f70 7469 6f6e 616c 293a 2074 696d 656f  optional): timeo
+00011840: 7574 2074 6f20 7573 6520 6966 2074 6865  ut to use if the
+00011850: 206f 7574 7075 7420 6669 6c65 2069 730a   output file is.
+00011860: 2020 2020 2020 2020 2020 2020 6265 696e              bein
+00011870: 6720 7772 6974 7465 6e20 746f 2062 7920  g written to by 
+00011880: 616e 6f74 6865 7220 7072 6f63 6573 7320  another process 
+00011890: 616c 7265 6164 792e 2044 6566 6175 6c74  already. Default
+000118a0: 7320 746f 2036 3030 2e0a 2020 2020 2020  s to 600..      
+000118b0: 2020 7472 616e 7361 6374 696f 6e5f 7369    transaction_si
+000118c0: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
+000118d0: 6c29 3a20 5472 616e 7361 6374 696f 6e20  l): Transaction 
+000118e0: 7369 7a65 2e20 4465 6661 756c 7473 2074  size. Defaults t
+000118f0: 6f20 3530 3030 302e 0a20 2020 2020 2020  o 50000..       
+00011900: 2070 7265 7365 7276 655f 6669 6420 2862   preserve_fid (b
+00011910: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
+00011920: 5472 7565 2074 6f20 6d61 6b65 2061 6e20  True to make an 
+00011930: 6578 7472 6120 6566 666f 7274 2074 6f20  extra effort to 
+00011940: 7072 6573 6572 7665 2066 6964 2773 206f  preserve fid's o
+00011950: 660a 2020 2020 2020 2020 2020 2020 7468  f.            th
+00011960: 6520 736f 7572 6365 206c 6179 6572 2074  e source layer t
+00011970: 6f20 7468 6520 6465 7374 696e 6174 696f  o the destinatio
+00011980: 6e20 6c61 7965 722e 2046 616c 7365 206e  n layer. False n
+00011990: 6f74 2074 6f20 646f 2061 6e79 2065 6666  ot to do any eff
+000119a0: 6f72 742e 204e 6f6e 650a 2020 2020 2020  ort. None.      
+000119b0: 2020 2020 2020 746f 2075 7365 2074 6865        to use the
+000119c0: 2064 6566 6175 6c74 2062 6568 6176 696f   default behavio
+000119d0: 7572 206f 6620 6764 616c 2c20 7468 6174  ur of gdal, that
+000119e0: 2061 6c72 6561 6479 2070 7265 7365 7276   already preserv
+000119f0: 6573 2069 6e20 736f 6d65 2063 6173 6573  es in some cases
+00011a00: 2e0a 2020 2020 2020 2020 2020 2020 536f  ..            So
+00011a10: 6d65 2066 696c 6520 666f 726d 6174 7320  me file formats 
+00011a20: 646f 6e27 7420 6578 706c 6963 6974 6c79  don't explicitly
+00011a30: 2073 746f 7265 2074 6865 2066 6964 2028   store the fid (
+00011a40: 652e 672e 2073 6861 7065 6669 6c65 292c  e.g. shapefile),
+00011a50: 2073 6f20 7468 6579 0a20 2020 2020 2020   so they.       
+00011a60: 2020 2020 2077 696c 6c20 6e65 7665 7220       will never 
+00011a70: 6265 2061 626c 6520 746f 2070 7265 7365  be able to prese
+00011a80: 7276 6520 6669 6473 2e20 4465 6661 756c  rve fids. Defaul
+00011a90: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
+00011aa0: 2020 2020 6f70 7469 6f6e 7320 2864 6963      options (dic
+00011ab0: 742c 206f 7074 696f 6e61 6c29 3a20 6f70  t, optional): op
+00011ac0: 7469 6f6e 7320 746f 2070 6173 7320 746f  tions to pass to
+00011ad0: 2067 6461 6c2e 0a0a 2020 2020 5261 6973   gdal...    Rais
+00011ae0: 6573 3a0a 2020 2020 2020 2020 5661 6c75  es:.        Valu
+00011af0: 6545 7272 6f72 3a20 616e 2069 6e76 616c  eError: an inval
+00011b00: 6964 2070 6172 616d 6574 6572 2076 616c  id parameter val
+00011b10: 7565 2077 6173 2070 6173 7365 642e 0a20  ue was passed.. 
+00011b20: 2020 2020 2020 2052 756e 7469 6d65 4572         RuntimeEr
+00011b30: 726f 723a 2074 696d 656f 7574 2077 6173  ror: timeout was
+00011b40: 2072 6561 6368 6564 2077 6869 6c65 2074   reached while t
+00011b50: 7279 696e 6720 746f 2061 7070 656e 6420  rying to append 
+00011b60: 6461 7461 2074 6f20 7061 7468 2e0a 0a20  data to path... 
+00011b70: 2020 202e 2e20 7c73 7061 7469 616c 6974     .. |spatialit
+00011b80: 655f 7265 6665 7265 6e63 655f 6c69 6e6b  e_reference_link
+00011b90: 7c20 7261 773a 3a20 6874 6d6c 0a0a 2020  | raw:: html..  
+00011ba0: 2020 2020 2020 3c61 2068 7265 663d 2268        <a href="h
+00011bb0: 7474 7073 3a2f 2f77 7777 2e67 6169 612d  ttps://www.gaia-
+00011bc0: 6769 732e 6974 2f67 6169 612d 7369 6e73  gis.it/gaia-sins
+00011bd0: 2f73 7061 7469 616c 6974 652d 7371 6c2d  /spatialite-sql-
+00011be0: 6c61 7465 7374 2e68 746d 6c22 2074 6172  latest.html" tar
+00011bf0: 6765 743d 225f 626c 616e 6b22 3e73 7061  get="_blank">spa
+00011c00: 7469 616c 6974 6520 7265 6665 7265 6e63  tialite referenc
+00011c10: 653c 2f61 3e0a 0a20 2020 2022 2222 2020  e</a>..    """  
+00011c20: 2320 6e6f 7161 3a20 4535 3031 0a20 2020  # noqa: E501.   
+00011c30: 2023 2043 6865 636b 2f63 6c65 616e 2069   # Check/clean i
+00011c40: 6e70 7574 2070 6172 616d 730a 2020 2020  nput params.    
+00011c50: 7372 6320 3d20 5061 7468 2873 7263 290a  src = Path(src).
+00011c60: 2020 2020 6473 7420 3d20 5061 7468 2864      dst = Path(d
+00011c70: 7374 290a 2020 2020 6966 2066 6f72 6365  st).    if force
+00011c80: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
+00011c90: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
+00011ca0: 3a0a 2020 2020 2020 2020 666f 7263 655f  :.        force_
+00011cb0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+00011cc0: 7970 6520 3d20 4765 6f6d 6574 7279 5479  ype = GeometryTy
+00011cd0: 7065 2866 6f72 6365 5f6f 7574 7075 745f  pe(force_output_
+00011ce0: 6765 6f6d 6574 7279 7479 7065 290a 0a20  geometrytype).. 
+00011cf0: 2020 2023 2046 696c 6573 2064 6f6e 2774     # Files don't
+00011d00: 2074 7970 6963 616c 6c79 2073 7570 706f   typically suppo
+00011d10: 7274 2068 6176 696e 6720 6d75 6c74 6970  rt having multip
+00011d20: 6c65 2070 726f 6365 7373 6573 2077 7269  le processes wri
+00011d30: 7469 6e67 0a20 2020 2023 2073 696d 756c  ting.    # simul
+00011d40: 7461 6e6f 7573 6c79 2074 6f20 7468 656d  tanously to them
+00011d50: 2c20 736f 2075 7365 206c 6f63 6b20 6669  , so use lock fi
+00011d60: 6c65 2074 6f20 7379 6e63 6872 6f6e 697a  le to synchroniz
+00011d70: 6520 6163 6365 7373 2e0a 2020 2020 6c6f  e access..    lo
+00011d80: 636b 6669 6c65 203d 2050 6174 6828 6622  ckfile = Path(f"
+00011d90: 7b73 7472 2864 7374 297d 2e6c 6f63 6b22  {str(dst)}.lock"
+00011da0: 290a 0a20 2020 2023 2049 6620 7468 6520  )..    # If the 
+00011db0: 6465 7374 696e 6174 696f 6e20 6669 6c65  destination file
+00011dc0: 2064 6f65 736e 2774 2065 7869 7374 2079   doesn't exist y
+00011dd0: 6574 2c20 6275 7420 7468 6520 6c6f 636b  et, but the lock
+00011de0: 6669 6c65 2064 6f65 732c 0a20 2020 2023  file does,.    #
+00011df0: 2074 7279 2072 656d 6f76 696e 6720 7468   try removing th
+00011e00: 6520 6c6f 636b 6669 6c65 2061 7320 6974  e lockfile as it
+00011e10: 206d 6967 6874 2062 6520 6120 6768 6f73   might be a ghos
+00011e20: 7420 6c6f 636b 6669 6c65 2e0a 2020 2020  t lockfile..    
+00011e30: 6966 206e 6f74 2064 7374 2e65 7869 7374  if not dst.exist
+00011e40: 7328 2920 616e 6420 6c6f 636b 6669 6c65  s() and lockfile
+00011e50: 2e65 7869 7374 7328 293a 0a20 2020 2020  .exists():.     
+00011e60: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00011e70: 2020 2020 6c6f 636b 6669 6c65 2e75 6e6c      lockfile.unl
+00011e80: 696e 6b28 290a 2020 2020 2020 2020 6578  ink().        ex
+00011e90: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00011ea0: 2020 2020 2020 2020 2020 2020 5f20 3d20              _ = 
+00011eb0: 4e6f 6e65 0a0a 2020 2020 2320 4372 6561  None..    # Crea
+00011ec0: 7469 6e67 206c 6f63 6b66 696c 6520 616e  ting lockfile an
+00011ed0: 6420 6170 7065 6e64 0a20 2020 2073 7461  d append.    sta
+00011ee0: 7274 5f74 696d 6520 3d20 6461 7465 7469  rt_time = dateti
+00011ef0: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
+00011f00: 290a 2020 2020 7265 6164 7920 3d20 4661  ).    ready = Fa
+00011f10: 6c73 650a 2020 2020 7768 696c 6520 6e6f  lse.    while no
+00011f20: 7420 7265 6164 793a 0a20 2020 2020 2020  t ready:.       
+00011f30: 2069 6620 5f69 6f5f 7574 696c 2e63 7265   if _io_util.cre
+00011f40: 6174 655f 6669 6c65 5f61 746f 6d69 6328  ate_file_atomic(
+00011f50: 6c6f 636b 6669 6c65 2920 6973 2054 7275  lockfile) is Tru
+00011f60: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00011f70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00011f80: 2020 2020 2320 6170 7065 6e64 0a20 2020      # append.   
+00011f90: 2020 2020 2020 2020 2020 2020 205f 6170               _ap
+00011fa0: 7065 6e64 5f74 6f5f 6e6f 6c6f 636b 280a  pend_to_nolock(.
+00011fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fc0: 2020 2020 7372 633d 7372 632c 0a20 2020      src=src,.   
+00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fe0: 2064 7374 3d64 7374 2c0a 2020 2020 2020   dst=dst,.      
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 7372                sr
+00012000: 635f 6c61 7965 723d 7372 635f 6c61 7965  c_layer=src_laye
+00012010: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00012020: 2020 2020 2020 2064 7374 5f6c 6179 6572         dst_layer
+00012030: 3d64 7374 5f6c 6179 6572 2c0a 2020 2020  =dst_layer,.    
 00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012050: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
-00012060: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
-00012070: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
-00012080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012090: 2074 7261 6e73 6163 7469 6f6e 5f73 697a   transaction_siz
-000120a0: 653d 7472 616e 7361 6374 696f 6e5f 7369  e=transaction_si
-000120b0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-000120c0: 2020 2020 2020 2020 7072 6573 6572 7665          preserve
-000120d0: 5f66 6964 3d70 7265 7365 7276 655f 6669  _fid=preserve_fi
-000120e0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000120f0: 2020 2020 2020 206f 7074 696f 6e73 3d6f         options=o
-00012100: 7074 696f 6e73 2c0a 2020 2020 2020 2020  ptions,.        
-00012110: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00012120: 2020 2020 2020 6669 6e61 6c6c 793a 0a20        finally:. 
-00012130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012140: 6561 6479 203d 2054 7275 650a 2020 2020  eady = True.    
-00012150: 2020 2020 2020 2020 2020 2020 6c6f 636b              lock
-00012160: 6669 6c65 2e75 6e6c 696e 6b28 290a 2020  file.unlink().  
-00012170: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012180: 2020 2020 2020 2020 7469 6d65 5f77 6169          time_wai
-00012190: 7469 6e67 203d 2028 6461 7465 7469 6d65  ting = (datetime
-000121a0: 2e64 6174 6574 696d 652e 6e6f 7728 2920  .datetime.now() 
-000121b0: 2d20 7374 6172 745f 7469 6d65 292e 746f  - start_time).to
-000121c0: 7461 6c5f 7365 636f 6e64 7328 290a 2020  tal_seconds().  
-000121d0: 2020 2020 2020 2020 2020 6966 2074 696d            if tim
-000121e0: 655f 7761 6974 696e 6720 3e20 6170 7065  e_waiting > appe
-000121f0: 6e64 5f74 696d 656f 7574 5f73 3a0a 2020  nd_timeout_s:.  
-00012200: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00012210: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-00012220: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012230: 2020 2020 2020 6622 6170 7065 6e64 5f74        f"append_t
-00012240: 6f20 7469 6d65 6f75 7420 6f66 207b 6170  o timeout of {ap
-00012250: 7065 6e64 5f74 696d 656f 7574 5f73 7d20  pend_timeout_s} 
-00012260: 7265 6163 6865 642c 2073 6f20 7374 6f70  reached, so stop
-00012270: 2077 7269 7465 2022 0a20 2020 2020 2020   write ".       
-00012280: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
-00012290: 6f20 7b64 7374 7d21 220a 2020 2020 2020  o {dst}!".      
-000122a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000122b0: 2020 2020 2023 2053 6c65 6570 2066 6f72       # Sleep for
-000122c0: 2061 2073 6563 6f6e 6420 6265 666f 7265   a second before
-000122d0: 2074 7279 696e 6720 6167 6169 6e0a 2020   trying again.  
-000122e0: 2020 2020 2020 7469 6d65 2e73 6c65 6570        time.sleep
-000122f0: 2831 290a 0a0a 6465 6620 5f61 7070 656e  (1)...def _appen
-00012300: 645f 746f 5f6e 6f6c 6f63 6b28 0a20 2020  d_to_nolock(.   
-00012310: 2073 7263 3a20 5061 7468 2c0a 2020 2020   src: Path,.    
-00012320: 6473 743a 2050 6174 682c 0a20 2020 2073  dst: Path,.    s
-00012330: 7263 5f6c 6179 6572 3a20 4f70 7469 6f6e  rc_layer: Option
-00012340: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00012350: 2020 2020 6473 745f 6c61 7965 723a 204f      dst_layer: O
-00012360: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00012370: 6f6e 652c 0a20 2020 2073 7263 5f63 7273  one,.    src_crs
-00012380: 3a20 556e 696f 6e5b 696e 742c 2073 7472  : Union[int, str
-00012390: 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a  , None] = None,.
-000123a0: 2020 2020 6473 745f 6372 733a 2055 6e69      dst_crs: Uni
-000123b0: 6f6e 5b69 6e74 2c20 7374 722c 204e 6f6e  on[int, str, Non
-000123c0: 655d 203d 204e 6f6e 652c 0a20 2020 2077  e] = None,.    w
-000123d0: 6865 7265 3a20 4f70 7469 6f6e 616c 5b73  here: Optional[s
-000123e0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-000123f0: 7265 7072 6f6a 6563 743a 2062 6f6f 6c20  reproject: bool 
-00012400: 3d20 4661 6c73 652c 0a20 2020 2065 7870  = False,.    exp
-00012410: 6c6f 6465 636f 6c6c 6563 7469 6f6e 733a  lodecollections:
-00012420: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00012430: 2020 2063 7265 6174 655f 7370 6174 6961     create_spatia
-00012440: 6c5f 696e 6465 783a 204f 7074 696f 6e61  l_index: Optiona
-00012450: 6c5b 626f 6f6c 5d20 3d20 5472 7565 2c0a  l[bool] = True,.
-00012460: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
-00012470: 5f67 656f 6d65 7472 7974 7970 653a 2055  _geometrytype: U
-00012480: 6e69 6f6e 5b47 656f 6d65 7472 7954 7970  nion[GeometryTyp
-00012490: 652c 2073 7472 2c20 4e6f 6e65 5d20 3d20  e, str, None] = 
-000124a0: 4e6f 6e65 2c0a 2020 2020 7472 616e 7361  None,.    transa
-000124b0: 6374 696f 6e5f 7369 7a65 3a20 696e 7420  ction_size: int 
-000124c0: 3d20 3530 3030 302c 0a20 2020 2070 7265  = 50000,.    pre
-000124d0: 7365 7276 655f 6669 643a 204f 7074 696f  serve_fid: Optio
-000124e0: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
-000124f0: 2c0a 2020 2020 6f70 7469 6f6e 733a 2064  ,.    options: d
-00012500: 6963 7420 3d20 7b7d 2c0a 293a 0a20 2020  ict = {},.):.   
-00012510: 2023 2043 6865 636b 2f63 6c65 616e 2069   # Check/clean i
-00012520: 6e70 7574 2070 6172 616d 730a 2020 2020  nput params.    
-00012530: 6f70 7469 6f6e 7320 3d20 5f6f 6772 5f75  options = _ogr_u
-00012540: 7469 6c2e 5f70 7265 7061 7265 5f67 6461  til._prepare_gda
-00012550: 6c5f 6f70 7469 6f6e 7328 6f70 7469 6f6e  l_options(option
-00012560: 7329 0a20 2020 2069 6620 280a 2020 2020  s).    if (.    
-00012570: 2020 2020 6372 6561 7465 5f73 7061 7469      create_spati
-00012580: 616c 5f69 6e64 6578 2069 7320 6e6f 7420  al_index is not 
-00012590: 4e6f 6e65 0a20 2020 2020 2020 2061 6e64  None.        and
-000125a0: 2022 4c41 5945 525f 4352 4541 5449 4f4e   "LAYER_CREATION
-000125b0: 2e53 5041 5449 414c 5f49 4e44 4558 2220  .SPATIAL_INDEX" 
-000125c0: 6e6f 7420 696e 206f 7074 696f 6e73 0a20  not in options. 
-000125d0: 2020 2029 3a0a 2020 2020 2020 2020 6f70     ):.        op
-000125e0: 7469 6f6e 735b 224c 4159 4552 5f43 5245  tions["LAYER_CRE
-000125f0: 4154 494f 4e2e 5350 4154 4941 4c5f 494e  ATION.SPATIAL_IN
-00012600: 4445 5822 5d20 3d20 6372 6561 7465 5f73  DEX"] = create_s
-00012610: 7061 7469 616c 5f69 6e64 6578 0a0a 2020  patial_index..  
-00012620: 2020 7372 635f 6c61 7965 7269 6e66 6f20    src_layerinfo 
-00012630: 3d20 4e6f 6e65 0a20 2020 2069 6620 7768  = None.    if wh
-00012640: 6572 6520 6973 206e 6f74 204e 6f6e 653a  ere is not None:
-00012650: 0a20 2020 2020 2020 2069 6620 7372 635f  .        if src_
-00012660: 6c61 7965 7269 6e66 6f20 6973 204e 6f6e  layerinfo is Non
-00012670: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00012680: 7263 5f6c 6179 6572 696e 666f 203d 2067  rc_layerinfo = g
-00012690: 6574 5f6c 6179 6572 696e 666f 2873 7263  et_layerinfo(src
-000126a0: 2c20 7372 635f 6c61 7965 7229 0a20 2020  , src_layer).   
-000126b0: 2020 2020 2077 6865 7265 203d 2077 6865       where = whe
-000126c0: 7265 2e66 6f72 6d61 7428 6765 6f6d 6574  re.format(geomet
-000126d0: 7279 636f 6c75 6d6e 3d73 7263 5f6c 6179  rycolumn=src_lay
-000126e0: 6572 696e 666f 2e67 656f 6d65 7472 7963  erinfo.geometryc
-000126f0: 6f6c 756d 6e29 0a0a 2020 2020 2320 5768  olumn)..    # Wh
-00012700: 656e 2063 7265 6174 696e 672f 6170 7065  en creating/appe
-00012710: 6e64 696e 6720 746f 2061 2073 6861 7065  nding to a shape
-00012720: 6669 6c65 2c20 736f 6d65 2065 7874 7261  file, some extra
-00012730: 2074 6869 6e67 7320 6e65 6564 2074 6f20   things need to 
-00012740: 6265 2064 6f6e 652f 6368 6563 6b65 642e  be done/checked.
-00012750: 0a20 2020 2073 716c 5f73 746d 7420 3d20  .    sql_stmt = 
-00012760: 4e6f 6e65 0a20 2020 2069 6620 6473 742e  None.    if dst.
-00012770: 7375 6666 6978 2e6c 6f77 6572 2829 203d  suffix.lower() =
-00012780: 3d20 222e 7368 7022 3a0a 2020 2020 2020  = ".shp":.      
-00012790: 2020 2320 4966 2074 6865 2064 6573 7469    # If the desti
-000127a0: 6e61 7469 6f6e 2066 696c 6520 646f 6573  nation file does
-000127b0: 6e27 7420 6578 6973 7420 7965 742c 2061  n't exist yet, a
-000127c0: 6e64 2074 6865 2073 6f75 7263 6520 6669  nd the source fi
-000127d0: 6c65 2068 6173 0a20 2020 2020 2020 2023  le has.        #
-000127e0: 2067 656f 6d65 7472 7974 7970 6520 2247   geometrytype "G
-000127f0: 656f 6d65 7472 7922 2c20 7261 6973 6520  eometry", raise 
-00012800: 6265 6361 7573 6520 7479 7065 2069 7320  because type is 
-00012810: 6e6f 7420 7375 7070 6f72 7465 6420 6279  not supported by
-00012820: 2073 6870 2028 616e 6420 7769 6c6c 0a20   shp (and will. 
-00012830: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
-00012840: 2074 6f20 6c69 6e65 7374 7269 6e67 292e   to linestring).
-00012850: 0a20 2020 2020 2020 2069 6620 7372 635f  .        if src_
-00012860: 6c61 7965 7269 6e66 6f20 6973 204e 6f6e  layerinfo is Non
-00012870: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00012880: 7263 5f6c 6179 6572 696e 666f 203d 2067  rc_layerinfo = g
-00012890: 6574 5f6c 6179 6572 696e 666f 2873 7263  et_layerinfo(src
-000128a0: 2c20 7372 635f 6c61 7965 7229 0a20 2020  , src_layer).   
-000128b0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-000128c0: 2020 2020 2020 666f 7263 655f 6f75 7470        force_outp
-000128d0: 7574 5f67 656f 6d65 7472 7974 7970 6520  ut_geometrytype 
-000128e0: 6973 204e 6f6e 650a 2020 2020 2020 2020  is None.        
-000128f0: 2020 2020 616e 6420 7372 635f 6c61 7965      and src_laye
-00012900: 7269 6e66 6f2e 6765 6f6d 6574 7279 7479  rinfo.geometryty
-00012910: 7065 0a20 2020 2020 2020 2020 2020 2069  pe.            i
-00012920: 6e20 5b47 656f 6d65 7472 7954 7970 652e  n [GeometryType.
-00012930: 4745 4f4d 4554 5259 2c20 4765 6f6d 6574  GEOMETRY, Geomet
-00012940: 7279 5479 7065 2e47 454f 4d45 5452 5943  ryType.GEOMETRYC
-00012950: 4f4c 4c45 4354 494f 4e5d 0a20 2020 2020  OLLECTION].     
-00012960: 2020 2020 2020 2061 6e64 206e 6f74 2064         and not d
-00012970: 7374 2e65 7869 7374 7328 290a 2020 2020  st.exists().    
-00012980: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00012990: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000129a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-000129b0: 2020 2020 2066 2273 7263 2066 696c 6520       f"src file 
-000129c0: 7b73 7263 7d20 6861 7320 6765 6f6d 6574  {src} has geomet
-000129d0: 7279 7479 7065 207b 7372 635f 6c61 7965  rytype {src_laye
-000129e0: 7269 6e66 6f2e 6765 6f6d 6574 7279 7479  rinfo.geometryty
-000129f0: 7065 6e61 6d65 7d20 220a 2020 2020 2020  pename} ".      
-00012a00: 2020 2020 2020 2020 2020 2277 6869 6368            "which
-00012a10: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
-00012a20: 6420 696e 202e 7368 702e 204d 6179 6265  d in .shp. Maybe
-00012a30: 2075 7365 2066 6f72 6365 5f6f 7574 7075   use force_outpu
-00012a40: 745f 6765 6f6d 6574 7279 7479 7065 3f22  t_geometrytype?"
-00012a50: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00012a60: 2020 2020 2020 2020 2320 4c61 756e 6465          # Launde
-00012a70: 7220 7468 6520 636f 6c75 6d6e 7320 6e61  r the columns na
-00012a80: 6d65 7320 7669 6120 6120 7371 6c20 7374  mes via a sql st
-00012a90: 6174 656d 656e 742c 206f 7468 6572 7769  atement, otherwi
-00012aa0: 7365 2077 6865 6e20 6170 7065 6e64 696e  se when appendin
-00012ab0: 6720 7468 650a 2020 2020 2020 2020 2320  g the.        # 
-00012ac0: 6c61 756e 6465 7265 6420 636f 6c75 6d6e  laundered column
-00012ad0: 7320 7769 6c6c 2067 6574 204e 554c 4c20  s will get NULL 
-00012ae0: 7661 6c75 6573 2069 6e73 7465 6164 206f  values instead o
-00012af0: 6620 7468 6520 6461 7461 2e0a 2020 2020  f the data..    
-00012b00: 2020 2020 7372 635f 636f 6c75 6d6e 7320      src_columns 
-00012b10: 3d20 7372 635f 6c61 7965 7269 6e66 6f2e  = src_layerinfo.
-00012b20: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-00012b30: 636f 6c75 6d6e 735f 6c61 756e 6465 7265  columns_laundere
-00012b40: 6420 3d20 5f6c 6175 6e64 6572 5f63 6f6c  d = _launder_col
-00012b50: 756d 6e5f 6e61 6d65 7328 7372 635f 636f  umn_names(src_co
-00012b60: 6c75 6d6e 7329 0a20 2020 2020 2020 2063  lumns).        c
-00012b70: 6f6c 756d 6e73 5f61 6c69 6173 6564 203d  olumns_aliased =
-00012b80: 205b 0a20 2020 2020 2020 2020 2020 2066   [.            f
-00012b90: 2722 7b63 6f6c 756d 6e7d 2220 4153 2022  '"{column}" AS "
-00012ba0: 7b6c 6175 6e64 6572 6564 7d22 2720 666f  {laundered}"' fo
-00012bb0: 7220 636f 6c75 6d6e 2c20 6c61 756e 6465  r column, launde
-00012bc0: 7265 6420 696e 2063 6f6c 756d 6e73 5f6c  red in columns_l
-00012bd0: 6175 6e64 6572 6564 0a20 2020 2020 2020  aundered.       
-00012be0: 205d 0a20 2020 2020 2020 206c 6179 6572   ].        layer
-00012bf0: 203d 2073 7263 5f6c 6179 6572 2069 6620   = src_layer if 
-00012c00: 7372 635f 6c61 7965 7220 6973 206e 6f74  src_layer is not
-00012c10: 204e 6f6e 6520 656c 7365 2067 6574 5f6f   None else get_o
-00012c20: 6e6c 795f 6c61 7965 7228 7372 6329 0a20  nly_layer(src). 
-00012c30: 2020 2020 2020 2023 2049 6620 7468 6572         # If ther
-00012c40: 6520 6973 2061 2077 6865 7265 2073 7065  e is a where spe
-00012c50: 6369 6669 6564 2c20 696e 7465 6772 6174  cified, integrat
-00012c60: 6520 6974 2e2e 2e0a 2020 2020 2020 2020  e it....        
-00012c70: 7768 6572 655f 636c 6175 7365 203d 2022  where_clause = "
-00012c80: 220a 2020 2020 2020 2020 6966 2077 6865  ".        if whe
-00012c90: 7265 2069 7320 6e6f 7420 4e6f 6e65 3a0a  re is not None:.
-00012ca0: 2020 2020 2020 2020 2020 2020 7768 6572              wher
-00012cb0: 655f 636c 6175 7365 203d 2066 2257 4845  e_clause = f"WHE
-00012cc0: 5245 207b 7768 6572 657d 220a 2020 2020  RE {where}".    
-00012cd0: 2020 2020 2020 2020 7768 6572 6520 3d20          where = 
-00012ce0: 4e6f 6e65 0a20 2020 2020 2020 2073 716c  None.        sql
-00012cf0: 5f73 746d 7420 3d20 6622 2222 0a20 2020  _stmt = f""".   
-00012d00: 2020 2020 2020 2020 2053 454c 4543 5420           SELECT 
-00012d10: 7b73 7263 5f6c 6179 6572 696e 666f 2e67  {src_layerinfo.g
-00012d20: 656f 6d65 7472 7963 6f6c 756d 6e7d 0a20  eometrycolumn}. 
-00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d40: 202c 7b22 2c20 222e 6a6f 696e 2863 6f6c   ,{", ".join(col
-00012d50: 756d 6e73 5f61 6c69 6173 6564 297d 0a20  umns_aliased)}. 
-00012d60: 2020 2020 2020 2020 2020 2020 2046 524f               FRO
-00012d70: 4d20 227b 6c61 7965 727d 220a 2020 2020  M "{layer}".    
-00012d80: 2020 2020 2020 2020 207b 7768 6572 655f           {where_
-00012d90: 636c 6175 7365 7d0a 2020 2020 2020 2020  clause}.        
-00012da0: 2222 220a 0a20 2020 2023 2057 6865 6e20  """..    # When 
-00012db0: 6473 7420 6669 6c65 2064 6f65 736e 2774  dst file doesn't
-00012dc0: 2065 7869 7374 2061 6e64 2073 7263 2069   exist and src i
-00012dd0: 7320 656d 7074 7920 666f 7263 655f 6f75  s empty force_ou
-00012de0: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
-00012df0: 6520 7368 6f75 6c64 2062 650a 2020 2020  e should be.    
-00012e00: 2320 7370 6563 6966 6965 642c 206f 7468  # specified, oth
-00012e10: 6572 7769 7365 2069 6e76 616c 6964 206f  erwise invalid o
-00012e20: 7574 7075 742e 0a20 2020 2069 6620 666f  utput..    if fo
-00012e30: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
-00012e40: 7472 7974 7970 6520 6973 204e 6f6e 6520  trytype is None 
-00012e50: 616e 6420 6e6f 7420 6473 742e 6578 6973  and not dst.exis
-00012e60: 7473 2829 3a0a 2020 2020 2020 2020 6966  ts():.        if
-00012e70: 2073 7263 5f6c 6179 6572 696e 666f 2069   src_layerinfo i
-00012e80: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00012e90: 2020 2020 7372 635f 6c61 7965 7269 6e66      src_layerinf
-00012ea0: 6f20 3d20 6765 745f 6c61 7965 7269 6e66  o = get_layerinf
-00012eb0: 6f28 7372 632c 2073 7263 5f6c 6179 6572  o(src, src_layer
-00012ec0: 290a 2020 2020 2020 2020 666f 7263 655f  ).        force_
-00012ed0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-00012ee0: 7970 6520 3d20 7372 635f 6c61 7965 7269  ype = src_layeri
-00012ef0: 6e66 6f2e 6765 6f6d 6574 7279 7479 7065  nfo.geometrytype
-00012f00: 0a0a 2020 2020 2320 476f 210a 2020 2020  ..    # Go!.    
-00012f10: 7472 616e 736c 6174 655f 696e 666f 203d  translate_info =
-00012f20: 205f 6f67 725f 7574 696c 2e56 6563 746f   _ogr_util.Vecto
-00012f30: 7254 7261 6e73 6c61 7465 496e 666f 280a  rTranslateInfo(.
-00012f40: 2020 2020 2020 2020 696e 7075 745f 7061          input_pa
-00012f50: 7468 3d73 7263 2c0a 2020 2020 2020 2020  th=src,.        
-00012f60: 6f75 7470 7574 5f70 6174 683d 6473 742c  output_path=dst,
-00012f70: 0a20 2020 2020 2020 2069 6e70 7574 5f6c  .        input_l
-00012f80: 6179 6572 733d 7372 635f 6c61 7965 722c  ayers=src_layer,
-00012f90: 0a20 2020 2020 2020 206f 7574 7075 745f  .        output_
-00012fa0: 6c61 7965 723d 6473 745f 6c61 7965 722c  layer=dst_layer,
-00012fb0: 0a20 2020 2020 2020 2069 6e70 7574 5f73  .        input_s
-00012fc0: 7273 3d73 7263 5f63 7273 2c0a 2020 2020  rs=src_crs,.    
-00012fd0: 2020 2020 6f75 7470 7574 5f73 7273 3d64      output_srs=d
-00012fe0: 7374 5f63 7273 2c0a 2020 2020 2020 2020  st_crs,.        
-00012ff0: 7371 6c5f 7374 6d74 3d73 716c 5f73 746d  sql_stmt=sql_stm
-00013000: 742c 0a20 2020 2020 2020 2073 716c 5f64  t,.        sql_d
-00013010: 6961 6c65 6374 3d22 5351 4c49 5445 222c  ialect="SQLITE",
-00013020: 0a20 2020 2020 2020 2077 6865 7265 3d77  .        where=w
-00013030: 6865 7265 2c0a 2020 2020 2020 2020 7265  here,.        re
-00013040: 7072 6f6a 6563 743d 7265 7072 6f6a 6563  project=reprojec
-00013050: 742c 0a20 2020 2020 2020 2074 7261 6e73  t,.        trans
-00013060: 6163 7469 6f6e 5f73 697a 653d 7472 616e  action_size=tran
-00013070: 7361 6374 696f 6e5f 7369 7a65 2c0a 2020  saction_size,.  
-00013080: 2020 2020 2020 6170 7065 6e64 3d54 7275        append=Tru
-00013090: 652c 0a20 2020 2020 2020 2075 7064 6174  e,.        updat
-000130a0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-000130b0: 6578 706c 6f64 6563 6f6c 6c65 6374 696f  explodecollectio
-000130c0: 6e73 3d65 7870 6c6f 6465 636f 6c6c 6563  ns=explodecollec
-000130d0: 7469 6f6e 732c 0a20 2020 2020 2020 2066  tions,.        f
-000130e0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
-000130f0: 6574 7279 7479 7065 3d66 6f72 6365 5f6f  etrytype=force_o
-00013100: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
-00013110: 7065 2c0a 2020 2020 2020 2020 6f70 7469  pe,.        opti
-00013120: 6f6e 733d 6f70 7469 6f6e 732c 0a20 2020  ons=options,.   
-00013130: 2020 2020 2070 7265 7365 7276 655f 6669       preserve_fi
-00013140: 643d 7072 6573 6572 7665 5f66 6964 2c0a  d=preserve_fid,.
-00013150: 2020 2020 290a 2020 2020 5f6f 6772 5f75      ).    _ogr_u
-00013160: 7469 6c2e 7665 6374 6f72 5f74 7261 6e73  til.vector_trans
-00013170: 6c61 7465 5f62 795f 696e 666f 2869 6e66  late_by_info(inf
-00013180: 6f3d 7472 616e 736c 6174 655f 696e 666f  o=translate_info
-00013190: 290a 0a0a 6465 6620 636f 6e76 6572 7428  )...def convert(
-000131a0: 0a20 2020 2073 7263 3a20 556e 696f 6e5b  .    src: Union[
-000131b0: 7374 722c 2022 6f73 2e50 6174 684c 696b  str, "os.PathLik
-000131c0: 655b 416e 795d 225d 2c0a 2020 2020 6473  e[Any]"],.    ds
-000131d0: 743a 2055 6e69 6f6e 5b73 7472 2c20 226f  t: Union[str, "o
-000131e0: 732e 5061 7468 4c69 6b65 5b41 6e79 5d22  s.PathLike[Any]"
-000131f0: 5d2c 0a20 2020 2073 7263 5f6c 6179 6572  ],.    src_layer
-00013200: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00013210: 3d20 4e6f 6e65 2c0a 2020 2020 6473 745f  = None,.    dst_
-00013220: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
-00013230: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00013240: 2073 7263 5f63 7273 3a20 556e 696f 6e5b   src_crs: Union[
-00013250: 7374 722c 2069 6e74 2c20 4e6f 6e65 5d20  str, int, None] 
-00013260: 3d20 4e6f 6e65 2c0a 2020 2020 6473 745f  = None,.    dst_
-00013270: 6372 733a 2055 6e69 6f6e 5b73 7472 2c20  crs: Union[str, 
-00013280: 696e 742c 204e 6f6e 655d 203d 204e 6f6e  int, None] = Non
-00013290: 652c 0a20 2020 2077 6865 7265 3a20 4f70  e,.    where: Op
-000132a0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-000132b0: 6e65 2c0a 2020 2020 7265 7072 6f6a 6563  ne,.    reprojec
-000132c0: 743a 2062 6f6f 6c20 3d20 4661 6c73 652c  t: bool = False,
-000132d0: 0a20 2020 2065 7870 6c6f 6465 636f 6c6c  .    explodecoll
-000132e0: 6563 7469 6f6e 733a 2062 6f6f 6c20 3d20  ections: bool = 
-000132f0: 4661 6c73 652c 0a20 2020 2066 6f72 6365  False,.    force
-00013300: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-00013310: 7479 7065 3a20 556e 696f 6e5b 4765 6f6d  type: Union[Geom
-00013320: 6574 7279 5479 7065 2c20 7374 722c 204e  etryType, str, N
-00013330: 6f6e 655d 203d 204e 6f6e 652c 0a20 2020  one] = None,.   
-00013340: 2063 7265 6174 655f 7370 6174 6961 6c5f   create_spatial_
-00013350: 696e 6465 783a 204f 7074 696f 6e61 6c5b  index: Optional[
-00013360: 626f 6f6c 5d20 3d20 5472 7565 2c0a 2020  bool] = True,.  
-00013370: 2020 7072 6573 6572 7665 5f66 6964 3a20    preserve_fid: 
-00013380: 4f70 7469 6f6e 616c 5b62 6f6f 6c5d 203d  Optional[bool] =
-00013390: 204e 6f6e 652c 0a20 2020 206f 7074 696f   None,.    optio
-000133a0: 6e73 3a20 6469 6374 203d 207b 7d2c 0a20  ns: dict = {},. 
-000133b0: 2020 2061 7070 656e 643a 2062 6f6f 6c20     append: bool 
-000133c0: 3d20 4661 6c73 652c 0a20 2020 2066 6f72  = False,.    for
-000133d0: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
-000133e0: 2c0a 293a 0a20 2020 2022 2222 0a20 2020  ,.):.    """.   
-000133f0: 2044 4550 5245 4341 5445 443a 2070 6c65   DEPRECATED: ple
-00013400: 6173 6520 7573 6520 636f 7079 5f6c 6179  ase use copy_lay
-00013410: 6572 2e0a 2020 2020 2222 220a 2020 2020  er..    """.    
-00013420: 7761 726e 696e 6773 2e77 6172 6e28 2263  warnings.warn("c
-00013430: 6f6e 7665 7274 2069 7320 6465 7072 6563  onvert is deprec
-00013440: 6174 6564 3a20 7573 6520 636f 7079 5f6c  ated: use copy_l
-00013450: 6179 6572 2e22 2c20 4675 7475 7265 5761  ayer.", FutureWa
-00013460: 726e 696e 6729 0a20 2020 2072 6574 7572  rning).    retur
-00013470: 6e20 636f 7079 5f6c 6179 6572 280a 2020  n copy_layer(.  
-00013480: 2020 2020 2020 7372 633d 7372 632c 0a20        src=src,. 
-00013490: 2020 2020 2020 2064 7374 3d64 7374 2c0a         dst=dst,.
-000134a0: 2020 2020 2020 2020 7372 635f 6c61 7965          src_laye
-000134b0: 723d 7372 635f 6c61 7965 722c 0a20 2020  r=src_layer,.   
-000134c0: 2020 2020 2064 7374 5f6c 6179 6572 3d64       dst_layer=d
-000134d0: 7374 5f6c 6179 6572 2c0a 2020 2020 2020  st_layer,.      
-000134e0: 2020 7372 635f 6372 733d 7372 635f 6372    src_crs=src_cr
-000134f0: 732c 0a20 2020 2020 2020 2064 7374 5f63  s,.        dst_c
-00013500: 7273 3d64 7374 5f63 7273 2c0a 2020 2020  rs=dst_crs,.    
-00013510: 2020 2020 7768 6572 653d 7768 6572 652c      where=where,
-00013520: 0a20 2020 2020 2020 2072 6570 726f 6a65  .        reproje
-00013530: 6374 3d72 6570 726f 6a65 6374 2c0a 2020  ct=reproject,.  
-00013540: 2020 2020 2020 6578 706c 6f64 6563 6f6c        explodecol
-00013550: 6c65 6374 696f 6e73 3d65 7870 6c6f 6465  lections=explode
-00013560: 636f 6c6c 6563 7469 6f6e 732c 0a20 2020  collections,.   
-00013570: 2020 2020 2066 6f72 6365 5f6f 7574 7075       force_outpu
-00013580: 745f 6765 6f6d 6574 7279 7479 7065 3d66  t_geometrytype=f
-00013590: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
-000135a0: 6574 7279 7479 7065 2c0a 2020 2020 2020  etrytype,.      
-000135b0: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
-000135c0: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
-000135d0: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
-000135e0: 2020 2020 2070 7265 7365 7276 655f 6669       preserve_fi
-000135f0: 643d 7072 6573 6572 7665 5f66 6964 2c0a  d=preserve_fid,.
-00013600: 2020 2020 2020 2020 6f70 7469 6f6e 733d          options=
-00013610: 6f70 7469 6f6e 732c 0a20 2020 2020 2020  options,.       
-00013620: 2061 7070 656e 643d 6170 7065 6e64 2c0a   append=append,.
-00013630: 2020 2020 2020 2020 666f 7263 653d 666f          force=fo
-00013640: 7263 652c 0a20 2020 2029 0a0a 0a64 6566  rce,.    )...def
-00013650: 2063 6f70 795f 6c61 7965 7228 0a20 2020   copy_layer(.   
-00013660: 2073 7263 3a20 556e 696f 6e5b 7374 722c   src: Union[str,
-00013670: 2022 6f73 2e50 6174 684c 696b 655b 416e   "os.PathLike[An
-00013680: 795d 225d 2c0a 2020 2020 6473 743a 2055  y]"],.    dst: U
-00013690: 6e69 6f6e 5b73 7472 2c20 226f 732e 5061  nion[str, "os.Pa
-000136a0: 7468 4c69 6b65 5b41 6e79 5d22 5d2c 0a20  thLike[Any]"],. 
-000136b0: 2020 2073 7263 5f6c 6179 6572 3a20 4f70     src_layer: Op
-000136c0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-000136d0: 6e65 2c0a 2020 2020 6473 745f 6c61 7965  ne,.    dst_laye
-000136e0: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
-000136f0: 203d 204e 6f6e 652c 0a20 2020 2073 7263   = None,.    src
-00013700: 5f63 7273 3a20 556e 696f 6e5b 7374 722c  _crs: Union[str,
-00013710: 2069 6e74 2c20 4e6f 6e65 5d20 3d20 4e6f   int, None] = No
-00013720: 6e65 2c0a 2020 2020 6473 745f 6372 733a  ne,.    dst_crs:
-00013730: 2055 6e69 6f6e 5b73 7472 2c20 696e 742c   Union[str, int,
-00013740: 204e 6f6e 655d 203d 204e 6f6e 652c 0a20   None] = None,. 
-00013750: 2020 2077 6865 7265 3a20 4f70 7469 6f6e     where: Option
-00013760: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00013770: 2020 2020 7265 7072 6f6a 6563 743a 2062      reproject: b
-00013780: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00013790: 2065 7870 6c6f 6465 636f 6c6c 6563 7469   explodecollecti
-000137a0: 6f6e 733a 2062 6f6f 6c20 3d20 4661 6c73  ons: bool = Fals
-000137b0: 652c 0a20 2020 2066 6f72 6365 5f6f 7574  e,.    force_out
-000137c0: 7075 745f 6765 6f6d 6574 7279 7479 7065  put_geometrytype
-000137d0: 3a20 556e 696f 6e5b 4765 6f6d 6574 7279  : Union[Geometry
-000137e0: 5479 7065 2c20 7374 722c 204e 6f6e 655d  Type, str, None]
-000137f0: 203d 204e 6f6e 652c 0a20 2020 2063 7265   = None,.    cre
-00013800: 6174 655f 7370 6174 6961 6c5f 696e 6465  ate_spatial_inde
-00013810: 783a 204f 7074 696f 6e61 6c5b 626f 6f6c  x: Optional[bool
-00013820: 5d20 3d20 5472 7565 2c0a 2020 2020 7072  ] = True,.    pr
-00013830: 6573 6572 7665 5f66 6964 3a20 4f70 7469  eserve_fid: Opti
-00013840: 6f6e 616c 5b62 6f6f 6c5d 203d 204e 6f6e  onal[bool] = Non
-00013850: 652c 0a20 2020 206f 7074 696f 6e73 3a20  e,.    options: 
-00013860: 6469 6374 203d 207b 7d2c 0a20 2020 2061  dict = {},.    a
-00013870: 7070 656e 643a 2062 6f6f 6c20 3d20 4661  ppend: bool = Fa
-00013880: 6c73 652c 0a20 2020 2066 6f72 6365 3a20  lse,.    force: 
-00013890: 626f 6f6c 203d 2046 616c 7365 2c0a 293a  bool = False,.):
-000138a0: 0a20 2020 2022 2222 0a20 2020 2052 6561  .    """.    Rea
-000138b0: 6420 6120 6c61 7965 7220 6672 6f6d 2061  d a layer from a
-000138c0: 2073 6f75 7263 6520 6669 6c65 2061 6e64   source file and
-000138d0: 2077 7269 7465 2069 7420 746f 2061 206e   write it to a n
-000138e0: 6577 2064 6573 7469 6e61 7469 6f6e 2066  ew destination f
-000138f0: 696c 652e 0a0a 2020 2020 5479 7069 6361  ile...    Typica
-00013900: 6c6c 7920 7573 6564 2074 6f20 636f 6e76  lly used to conv
-00013910: 6572 7420 6672 6f6d 206f 6e65 2066 696c  ert from one fil
-00013920: 6566 6f72 6d61 7420 746f 2061 6e6f 7468  eformat to anoth
-00013930: 6572 206f 7220 746f 2072 6570 726f 6a65  er or to reproje
-00013940: 6374 2e0a 0a20 2020 2054 6865 206f 7074  ct...    The opt
-00013950: 696f 6e73 2070 6172 616d 6574 6572 2063  ions parameter c
-00013960: 616e 2062 6520 7573 6564 2074 6f20 7061  an be used to pa
-00013970: 7373 2061 6e79 2074 7970 6520 6f66 206f  ss any type of o
-00013980: 7074 696f 6e73 2074 6f20 4744 414c 2069  ptions to GDAL i
-00013990: 6e0a 2020 2020 7468 6520 666f 6c6c 6f77  n.    the follow
-000139a0: 696e 6720 666f 726d 3a0a 2020 2020 2020  ing form:.      
-000139b0: 2020 7b20 223c 6f70 7469 6f6e 5f74 7970    { "<option_typ
-000139c0: 653e 2e3c 6f70 7469 6f6e 5f6e 616d 653e  e>.<option_name>
-000139d0: 223a 203c 6f70 7469 6f6e 5f76 616c 7565  ": <option_value
-000139e0: 3e20 7d0a 0a20 2020 2054 6865 206f 7074  > }..    The opt
-000139f0: 696f 6e20 7479 7065 7320 6361 6e20 6265  ion types can be
-00013a00: 2061 6e79 206f 6620 7468 6520 666f 6c6c   any of the foll
-00013a10: 6f77 696e 673a 0a20 2020 2020 2020 202d  owing:.        -
-00013a20: 204c 4159 4552 5f43 5245 4154 494f 4e3a   LAYER_CREATION:
-00013a30: 206c 6179 6572 2063 7265 6174 696f 6e20   layer creation 
-00013a40: 6f70 7469 6f6e 2028 6c63 6f29 0a20 2020  option (lco).   
-00013a50: 2020 2020 202d 2044 4154 4153 4554 5f43       - DATASET_C
-00013a60: 5245 4154 494f 4e3a 2064 6174 6173 6574  REATION: dataset
-00013a70: 2063 7265 6174 696f 6e20 6f70 7469 6f6e   creation option
-00013a80: 2028 6473 636f 290a 2020 2020 2020 2020   (dsco).        
-00013a90: 2d20 494e 5055 545f 4f50 454e 3a20 696e  - INPUT_OPEN: in
-00013aa0: 7075 7420 6461 7461 7365 7420 6f70 656e  put dataset open
-00013ab0: 206f 7074 696f 6e20 286f 6f29 0a20 2020   option (oo).   
-00013ac0: 2020 2020 202d 2044 4553 5449 4e41 5449       - DESTINATI
-00013ad0: 4f4e 5f4f 5045 4e3a 2064 6573 7469 6e61  ON_OPEN: destina
-00013ae0: 7469 6f6e 2064 6174 6173 6574 206f 7065  tion dataset ope
-00013af0: 6e20 6f70 7469 6f6e 2028 646f 6f29 0a20  n option (doo). 
-00013b00: 2020 2020 2020 202d 2043 4f4e 4649 473a         - CONFIG:
-00013b10: 2063 6f6e 6669 6720 6f70 7469 6f6e 2028   config option (
-00013b20: 636f 6e66 6967 290a 0a20 2020 2054 6865  config)..    The
-00013b30: 206f 7074 696f 6e73 2063 616e 2062 6520   options can be 
-00013b40: 666f 756e 6420 696e 2074 6865 205b 4744  found in the [GD
-00013b50: 414c 2076 6563 746f 7220 6472 6976 6572  AL vector driver
-00013b60: 2064 6f63 756d 656e 7461 7469 6f6e 5d0a   documentation].
-00013b70: 2020 2020 2868 7474 7073 3a2f 2f67 6461      (https://gda
-00013b80: 6c2e 6f72 672f 6472 6976 6572 732f 7665  l.org/drivers/ve
-00013b90: 6374 6f72 2f69 6e64 6578 2e68 746d 6c29  ctor/index.html)
-00013ba0: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
-00013bb0: 2020 2020 2073 7263 2028 5061 7468 4c69       src (PathLi
-00013bc0: 6b65 293a 2054 6865 2073 6f75 7263 6520  ke): The source 
-00013bd0: 6669 6c65 2070 6174 682e 0a20 2020 2020  file path..     
-00013be0: 2020 2064 7374 2028 5061 7468 4c69 6b65     dst (PathLike
-00013bf0: 293a 2054 6865 2064 6573 7469 6e61 7469  ): The destinati
-00013c00: 6f6e 2066 696c 6520 7061 7468 2e0a 2020  on file path..  
-00013c10: 2020 2020 2020 7372 635f 6c61 7965 7220        src_layer 
-00013c20: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00013c30: 2054 6865 2073 6f75 7263 6520 6c61 7965   The source laye
-00013c40: 722e 2049 6620 4e6f 6e65 2061 6e64 2074  r. If None and t
-00013c50: 6865 7265 2069 7320 6f6e 6c79 0a20 2020  here is only.   
-00013c60: 2020 2020 2020 2020 206f 6e65 206c 6179           one lay
-00013c70: 6572 2069 6e20 7468 6520 7372 6320 6669  er in the src fi
-00013c80: 6c65 2c20 7468 6174 206c 6179 6572 2069  le, that layer i
-00013c90: 7320 7461 6b65 6e2e 2044 6566 6175 6c74  s taken. Default
-00013ca0: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00013cb0: 2020 2064 7374 5f6c 6179 6572 2028 7374     dst_layer (st
-00013cc0: 722c 206f 7074 696f 6e61 6c29 3a20 5468  r, optional): Th
-00013cd0: 6520 6465 7374 696e 6174 696f 6e20 6c61  e destination la
-00013ce0: 7965 722e 2049 6620 4e6f 6e65 2c20 7468  yer. If None, th
-00013cf0: 6520 6669 6c65 0a20 2020 2020 2020 2020  e file.         
-00013d00: 2020 2073 7465 6d20 6973 2074 616b 656e     stem is taken
-00013d10: 2061 7320 6c61 7965 7220 6e61 6d65 2e20   as layer name. 
-00013d20: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-00013d30: 2e0a 2020 2020 2020 2020 7372 635f 6372  ..        src_cr
-00013d40: 7320 2855 6e69 6f6e 5b73 7472 2c20 696e  s (Union[str, in
-00013d50: 745d 2c20 6f70 7469 6f6e 616c 293a 2061  t], optional): a
-00013d60: 6e20 6570 7367 2069 6e74 206f 7220 616e  n epsg int or an
-00013d70: 7974 6869 6e67 2073 7570 706f 7274 6564  ything supported
-00013d80: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-00013d90: 7468 6520 4f47 5253 7061 7469 616c 5265  the OGRSpatialRe
-00013da0: 6665 7265 6e63 652e 5365 7446 726f 6d55  ference.SetFromU
-00013db0: 7365 7249 6e70 7574 2829 2063 616c 6c2c  serInput() call,
-00013dc0: 2077 6869 6368 2069 6e63 6c75 6465 730a   which includes.
-00013dd0: 2020 2020 2020 2020 2020 2020 616e 2045              an E
-00013de0: 5053 4720 7374 7269 6e67 2028 6567 2e20  PSG string (eg. 
-00013df0: 2245 5053 473a 3433 3236 2229 2c20 6120  "EPSG:4326"), a 
-00013e00: 7765 6c6c 206b 6e6f 776e 2074 6578 7420  well known text 
-00013e10: 2857 4b54 2920 4352 530a 2020 2020 2020  (WKT) CRS.      
-00013e20: 2020 2020 2020 6465 6669 6e69 7469 6f6e        definition
-00013e30: 2c2e 2e2e 2044 6566 6175 6c74 7320 746f  ,... Defaults to
-00013e40: 204e 6f6e 652e 0a20 2020 2020 2020 2064   None..        d
-00013e50: 7374 5f63 7273 2028 556e 696f 6e5b 7374  st_crs (Union[st
-00013e60: 722c 2069 6e74 5d2c 206f 7074 696f 6e61  r, int], optiona
-00013e70: 6c29 3a20 616e 2065 7073 6720 696e 7420  l): an epsg int 
-00013e80: 6f72 2061 6e79 7468 696e 6720 7375 7070  or anything supp
-00013e90: 6f72 7465 640a 2020 2020 2020 2020 2020  orted.          
-00013ea0: 2020 6279 2074 6865 204f 4752 5370 6174    by the OGRSpat
-00013eb0: 6961 6c52 6566 6572 656e 6365 2e53 6574  ialReference.Set
-00013ec0: 4672 6f6d 5573 6572 496e 7075 7428 2920  FromUserInput() 
-00013ed0: 6361 6c6c 2c20 7768 6963 6820 696e 636c  call, which incl
-00013ee0: 7564 6573 0a20 2020 2020 2020 2020 2020  udes.           
-00013ef0: 2061 6e20 4550 5347 2073 7472 696e 6720   an EPSG string 
-00013f00: 2865 672e 2022 4550 5347 3a34 3332 3622  (eg. "EPSG:4326"
-00013f10: 292c 2061 2077 656c 6c20 6b6e 6f77 6e20  ), a well known 
-00013f20: 7465 7874 2028 574b 5429 2043 5253 0a20  text (WKT) CRS. 
-00013f30: 2020 2020 2020 2020 2020 2064 6566 696e             defin
-00013f40: 6974 696f 6e2c 2e2e 2e20 4465 6661 756c  ition,... Defaul
-00013f50: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
-00013f60: 2020 2020 7768 6572 6520 2873 7472 2c20      where (str, 
-00013f70: 6f70 7469 6f6e 616c 293a 206f 6e6c 7920  optional): only 
-00013f80: 6170 7065 6e64 2074 6865 2072 6f77 7320  append the rows 
-00013f90: 6672 6f6d 2073 7263 2074 6861 7420 636f  from src that co
-00013fa0: 6d70 6c79 2074 6f20 7468 6520 6669 6c74  mply to the filt
-00013fb0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-00013fc0: 7065 6369 6669 6564 2e20 4170 706c 6965  pecified. Applie
-00013fd0: 6420 6265 666f 7265 2065 7870 6c6f 6465  d before explode
-00013fe0: 636f 6c6c 6563 7469 6f6e 732e 2046 696c  collections. Fil
-00013ff0: 7465 7220 7368 6f75 6c64 2062 6520 696e  ter should be in
-00014000: 2073 716c 6974 650a 2020 2020 2020 2020   sqlite.        
-00014010: 2020 2020 5351 4c20 5748 4552 4520 7379      SQL WHERE sy
-00014020: 6e74 6178 2061 6e64 207c 7370 6174 6961  ntax and |spatia
-00014030: 6c69 7465 5f72 6566 6572 656e 6365 5f6c  lite_reference_l
-00014040: 696e 6b7c 2066 756e 6374 696f 6e73 2063  ink| functions c
-00014050: 616e 2062 6520 7573 6564 2e20 4966 0a20  an be used. If. 
-00014060: 2020 2020 2020 2020 2020 2077 6865 7265             where
-00014070: 2063 6f6e 7461 696e 7320 7468 6520 7b67   contains the {g
-00014080: 656f 6d65 7472 7963 6f6c 756d 6e7d 2070  eometrycolumn} p
-00014090: 6c61 6365 686f 6c64 6572 2c20 6974 2069  laceholder, it i
-000140a0: 7320 6669 6c6c 6564 206f 7574 2077 6974  s filled out wit
-000140b0: 6820 7468 650a 2020 2020 2020 2020 2020  h the.          
-000140c0: 2020 6765 6f6d 6574 7279 2063 6f6c 756d    geometry colum
-000140d0: 6e20 6e61 6d65 206f 6620 7468 6520 7372  n name of the sr
-000140e0: 6320 6669 6c65 2e20 4465 6661 756c 7473  c file. Defaults
-000140f0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
-00014100: 2020 7265 7072 6f6a 6563 7420 2862 6f6f    reproject (boo
-00014110: 6c2c 206f 7074 696f 6e61 6c29 3a20 5472  l, optional): Tr
-00014120: 7565 2074 6f20 7265 7072 6f6a 6563 7420  ue to reproject 
-00014130: 7768 696c 6520 636f 6e76 6572 7469 6e67  while converting
-00014140: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00014150: 2066 696c 652e 2044 6566 6175 6c74 7320   file. Defaults 
-00014160: 746f 2046 616c 7365 2e0a 2020 2020 2020  to False..      
-00014170: 2020 6578 706c 6f64 6563 6f6c 6c65 6374    explodecollect
-00014180: 696f 6e73 2028 626f 6f6c 2c20 6f70 7469  ions (bool, opti
-00014190: 6f6e 616c 293a 2054 7275 6520 746f 206f  onal): True to o
-000141a0: 7574 7075 7420 6f6e 6c79 2073 696d 706c  utput only simpl
-000141b0: 650a 2020 2020 2020 2020 2020 2020 6765  e.            ge
-000141c0: 6f6d 6574 7269 6573 2e20 4465 6661 756c  ometries. Defaul
-000141d0: 7473 2074 6f20 4661 6c73 652e 0a20 2020  ts to False..   
-000141e0: 2020 2020 2066 6f72 6365 5f6f 7574 7075       force_outpu
-000141f0: 745f 6765 6f6d 6574 7279 7479 7065 2028  t_geometrytype (
-00014200: 556e 696f 6e5b 4765 6f6d 6574 7279 5479  Union[GeometryTy
-00014210: 7065 2c20 7374 725d 2c20 6f70 7469 6f6e  pe, str], option
-00014220: 616c 293a 2047 656f 6d65 7472 7920 7479  al): Geometry ty
-00014230: 7065 2e0a 2020 2020 2020 2020 2020 2020  pe..            
-00014240: 746f 2028 7472 7920 746f 2920 666f 7263  to (try to) forc
-00014250: 6520 7468 6520 6f75 7470 7574 2074 6f2e  e the output to.
-00014260: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00014270: 652e 0a20 2020 2020 2020 2063 7265 6174  e..        creat
-00014280: 655f 7370 6174 6961 6c5f 696e 6465 7820  e_spatial_index 
-00014290: 2862 6f6f 6c2c 206f 7074 696f 6e61 6c29  (bool, optional)
-000142a0: 3a20 5472 7565 2074 6f20 6372 6561 7465  : True to create
-000142b0: 2061 2073 7061 7469 616c 2069 6e64 6578   a spatial index
-000142c0: 0a20 2020 2020 2020 2020 2020 206f 6e20  .            on 
-000142d0: 7468 6520 6465 7374 696e 6174 696f 6e20  the destination 
-000142e0: 6669 6c65 2f6c 6179 6572 2e20 4966 204e  file/layer. If N
-000142f0: 6f6e 652c 2074 6865 2064 6566 6175 6c74  one, the default
-00014300: 2062 6568 6176 696f 7572 2062 7920 6764   behaviour by gd
-00014310: 616c 2066 6f72 0a20 2020 2020 2020 2020  al for.         
-00014320: 2020 2074 6861 7420 6669 6c65 2074 7970     that file typ
-00014330: 6520 6973 2072 6573 7065 6374 6564 2e20  e is respected. 
-00014340: 4966 2074 6865 204c 4159 4552 5f43 5245  If the LAYER_CRE
-00014350: 4154 494f 4e2e 5350 4154 4941 4c5f 494e  ATION.SPATIAL_IN
-00014360: 4445 580a 2020 2020 2020 2020 2020 2020  DEX.            
-00014370: 7061 7261 6d65 7465 7220 6973 2073 7065  parameter is spe
-00014380: 6369 6669 6564 2069 6e20 6f70 7469 6f6e  cified in option
-00014390: 732c 2063 7265 6174 655f 7370 6174 6961  s, create_spatia
-000143a0: 6c5f 696e 6465 7820 6973 2069 676e 6f72  l_index is ignor
-000143b0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-000143c0: 4465 6661 756c 7473 2074 6f20 5472 7565  Defaults to True
-000143d0: 2e0a 2020 2020 2020 2020 7072 6573 6572  ..        preser
-000143e0: 7665 5f66 6964 2028 626f 6f6c 2c20 6f70  ve_fid (bool, op
-000143f0: 7469 6f6e 616c 293a 2054 7275 6520 746f  tional): True to
-00014400: 206d 616b 6520 616e 2065 7874 7261 2065   make an extra e
-00014410: 6666 6f72 7420 746f 2070 7265 7365 7276  ffort to preserv
-00014420: 6520 6669 6427 7320 6f66 0a20 2020 2020  e fid's of.     
-00014430: 2020 2020 2020 2074 6865 2073 6f75 7263         the sourc
-00014440: 6520 6c61 7965 7220 746f 2074 6865 2064  e layer to the d
-00014450: 6573 7469 6e61 7469 6f6e 206c 6179 6572  estination layer
-00014460: 2e20 4661 6c73 6520 6e6f 7420 746f 2064  . False not to d
-00014470: 6f20 616e 7920 6566 666f 7274 2e20 4e6f  o any effort. No
-00014480: 6e65 0a20 2020 2020 2020 2020 2020 2074  ne.            t
-00014490: 6f20 7573 6520 7468 6520 6465 6661 756c  o use the defaul
-000144a0: 7420 6265 6861 7669 6f75 7220 6f66 2067  t behaviour of g
-000144b0: 6461 6c2c 2074 6861 7420 616c 7265 6164  dal, that alread
-000144c0: 7920 7072 6573 6572 7665 7320 696e 2073  y preserves in s
-000144d0: 6f6d 6520 6361 7365 732e 0a20 2020 2020  ome cases..     
-000144e0: 2020 2020 2020 2053 6f6d 6520 6669 6c65         Some file
-000144f0: 2066 6f72 6d61 7473 2064 6f6e 2774 2065   formats don't e
-00014500: 7870 6c69 6369 746c 7920 7374 6f72 6520  xplicitly store 
-00014510: 7468 6520 6669 6420 2865 2e67 2e20 7368  the fid (e.g. sh
-00014520: 6170 6566 696c 6529 2c20 736f 2074 6865  apefile), so the
-00014530: 790a 2020 2020 2020 2020 2020 2020 7769  y.            wi
-00014540: 6c6c 206e 6576 6572 2062 6520 6162 6c65  ll never be able
-00014550: 2074 6f20 7072 6573 6572 7665 2066 6964   to preserve fid
-00014560: 732e 2044 6566 6175 6c74 7320 746f 204e  s. Defaults to N
-00014570: 6f6e 652e 0a20 2020 2020 2020 206f 7074  one..        opt
-00014580: 696f 6e73 2028 6469 6374 2c20 6f70 7469  ions (dict, opti
-00014590: 6f6e 616c 293a 206f 7074 696f 6e73 2074  onal): options t
-000145a0: 6f20 7061 7373 2074 6f20 6764 616c 2e0a  o pass to gdal..
-000145b0: 2020 2020 2020 2020 6170 7065 6e64 2028          append (
-000145c0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
-000145d0: 2054 7275 6520 746f 2061 7070 656e 6420   True to append 
-000145e0: 746f 2074 6865 206f 7574 7075 7420 6669  to the output fi
-000145f0: 6c65 2069 6620 6974 2065 7869 7374 732e  le if it exists.
-00014600: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-00014610: 6175 6c74 7320 746f 2046 616c 7365 2e0a  aults to False..
-00014620: 2020 2020 2020 2020 666f 7263 6520 2862          force (b
-00014630: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
-00014640: 6f76 6572 7772 6974 6520 6578 6973 7469  overwrite existi
-00014650: 6e67 206f 7574 7075 7420 6669 6c65 2873  ng output file(s
-00014660: 290a 2020 2020 2020 2020 2020 2020 4465  ).            De
-00014670: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
-00014680: 0a0a 2020 2020 2e2e 207c 7370 6174 6961  ..    .. |spatia
-00014690: 6c69 7465 5f72 6566 6572 656e 6365 5f6c  lite_reference_l
-000146a0: 696e 6b7c 2072 6177 3a3a 2068 746d 6c0a  ink| raw:: html.
-000146b0: 0a20 2020 2020 2020 203c 6120 6872 6566  .        <a href
-000146c0: 3d22 6874 7470 733a 2f2f 7777 772e 6761  ="https://www.ga
-000146d0: 6961 2d67 6973 2e69 742f 6761 6961 2d73  ia-gis.it/gaia-s
-000146e0: 696e 732f 7370 6174 6961 6c69 7465 2d73  ins/spatialite-s
-000146f0: 716c 2d6c 6174 6573 742e 6874 6d6c 2220  ql-latest.html" 
-00014700: 7461 7267 6574 3d22 5f62 6c61 6e6b 223e  target="_blank">
-00014710: 7370 6174 6961 6c69 7465 2072 6566 6572  spatialite refer
-00014720: 656e 6365 3c2f 613e 0a0a 2020 2020 2222  ence</a>..    ""
-00014730: 2220 2023 206e 6f71 613a 2045 3530 310a  "  # noqa: E501.
-00014740: 2020 2020 2320 496e 6974 0a20 2020 2073      # Init.    s
-00014750: 7263 203d 2050 6174 6828 7372 6329 0a20  rc = Path(src). 
-00014760: 2020 2064 7374 203d 2050 6174 6828 6473     dst = Path(ds
-00014770: 7429 0a0a 2020 2020 2320 4966 2073 6f75  t)..    # If sou
-00014780: 7263 6520 6669 6c65 2064 6f65 736e 2774  rce file doesn't
-00014790: 2065 7869 7374 2c20 7261 6973 6520 6572   exist, raise er
-000147a0: 726f 720a 2020 2020 6966 206e 6f74 2073  ror.    if not s
-000147b0: 7263 2e65 7869 7374 7328 293a 0a20 2020  rc.exists():.   
-000147c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000147d0: 4572 726f 7228 6622 7372 6320 6669 6c65  Error(f"src file
-000147e0: 2064 6f65 736e 2774 2065 7869 7374 3a20   doesn't exist: 
-000147f0: 7b73 7263 7d22 290a 2020 2020 2320 4966  {src}").    # If
-00014800: 2064 6573 7420 6669 6c65 2065 7869 7374   dest file exist
-00014810: 7320 616c 7265 6164 7920 616e 6420 6e6f  s already and no
-00014820: 2061 7070 656e 640a 2020 2020 6966 206e   append.    if n
-00014830: 6f74 2061 7070 656e 6420 616e 6420 6473  ot append and ds
-00014840: 742e 6578 6973 7473 2829 3a0a 2020 2020  t.exists():.    
-00014850: 2020 2020 6966 2066 6f72 6365 2069 7320      if force is 
-00014860: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-00014870: 2020 7265 6d6f 7665 2864 7374 290a 2020    remove(dst).  
-00014880: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00014890: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-000148a0: 6e66 6f28 6622 4f75 7470 7574 2066 696c  nfo(f"Output fil
-000148b0: 6520 6578 6973 7473 2061 6c72 6561 6479  e exists already
-000148c0: 2c20 736f 2073 746f 703a 207b 6473 747d  , so stop: {dst}
-000148d0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-000148e0: 6574 7572 6e0a 0a20 2020 2023 2043 6f6e  eturn..    # Con
-000148f0: 7665 7274 0a20 2020 206c 6f67 6765 722e  vert.    logger.
-00014900: 696e 666f 2866 2243 6f6e 7665 7274 207b  info(f"Convert {
-00014910: 7372 637d 2074 6f20 7b64 7374 7d22 290a  src} to {dst}").
-00014920: 2020 2020 5f61 7070 656e 645f 746f 5f6e      _append_to_n
-00014930: 6f6c 6f63 6b28 0a20 2020 2020 2020 2073  olock(.        s
-00014940: 7263 2c0a 2020 2020 2020 2020 6473 742c  rc,.        dst,
-00014950: 0a20 2020 2020 2020 2073 7263 5f6c 6179  .        src_lay
-00014960: 6572 2c0a 2020 2020 2020 2020 6473 745f  er,.        dst_
-00014970: 6c61 7965 722c 0a20 2020 2020 2020 2073  layer,.        s
-00014980: 7263 5f63 7273 3d73 7263 5f63 7273 2c0a  rc_crs=src_crs,.
-00014990: 2020 2020 2020 2020 6473 745f 6372 733d          dst_crs=
-000149a0: 6473 745f 6372 732c 0a20 2020 2020 2020  dst_crs,.       
-000149b0: 2077 6865 7265 3d77 6865 7265 2c0a 2020   where=where,.  
-000149c0: 2020 2020 2020 7265 7072 6f6a 6563 743d        reproject=
-000149d0: 7265 7072 6f6a 6563 742c 0a20 2020 2020  reproject,.     
-000149e0: 2020 2065 7870 6c6f 6465 636f 6c6c 6563     explodecollec
-000149f0: 7469 6f6e 733d 6578 706c 6f64 6563 6f6c  tions=explodecol
-00014a00: 6c65 6374 696f 6e73 2c0a 2020 2020 2020  lections,.      
-00014a10: 2020 666f 7263 655f 6f75 7470 7574 5f67    force_output_g
-00014a20: 656f 6d65 7472 7974 7970 653d 666f 7263  eometrytype=forc
-00014a30: 655f 6f75 7470 7574 5f67 656f 6d65 7472  e_output_geometr
-00014a40: 7974 7970 652c 0a20 2020 2020 2020 2063  ytype,.        c
-00014a50: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
-00014a60: 6465 783d 6372 6561 7465 5f73 7061 7469  dex=create_spati
-00014a70: 616c 5f69 6e64 6578 2c0a 2020 2020 2020  al_index,.      
-00014a80: 2020 7072 6573 6572 7665 5f66 6964 3d70    preserve_fid=p
-00014a90: 7265 7365 7276 655f 6669 642c 0a20 2020  reserve_fid,.   
-00014aa0: 2020 2020 206f 7074 696f 6e73 3d6f 7074       options=opt
-00014ab0: 696f 6e73 2c0a 2020 2020 290a 0a0a 6465  ions,.    )...de
-00014ac0: 6620 5f6c 6175 6e64 6572 5f63 6f6c 756d  f _launder_colum
-00014ad0: 6e5f 6e61 6d65 7328 636f 6c75 6d6e 733a  n_names(columns:
-00014ae0: 2049 7465 7261 626c 6529 202d 3e20 4c69   Iterable) -> Li
-00014af0: 7374 5b54 7570 6c65 5b73 7472 2c20 7374  st[Tuple[str, st
-00014b00: 725d 5d3a 0a20 2020 2022 2222 0a20 2020  r]]:.    """.   
-00014b10: 204c 6175 6e64 6572 7320 7468 6520 636f   Launders the co
-00014b20: 6c75 6d6e 206e 616d 6573 2070 6173 7365  lumn names passe
-00014b30: 6420 746f 2063 6f6d 706c 7920 7769 7468  d to comply with
-00014b40: 2073 6861 7065 6669 6c65 2072 6573 7472   shapefile restr
-00014b50: 6963 7469 6f6e 732e 0a0a 2020 2020 5261  ictions...    Ra
-00014b60: 7469 6f6e 616c 653a 206e 6f72 6d61 6c6c  tionale: normall
-00014b70: 7920 6764 616c 206c 6175 6e64 6572 7320  y gdal launders 
-00014b80: 7468 656d 2069 6620 6e65 6564 6564 2c20  them if needed, 
-00014b90: 6275 7420 7768 656e 2079 6f75 2061 7070  but when you app
-00014ba0: 656e 640a 2020 2020 6d75 6c74 6970 6c65  end.    multiple
-00014bb0: 2066 696c 6573 2074 6f20 6120 7368 6170   files to a shap
-00014bc0: 6566 696c 6520 7769 7468 2063 6f6c 756d  efile with colum
-00014bd0: 6e73 2074 6861 7420 6e65 6564 2074 6f20  ns that need to 
-00014be0: 6265 206c 6175 6e64 6572 6564 0a20 2020  be laundered.   
-00014bf0: 2074 6865 7920 6172 6520 6e6f 7420 6d61   they are not ma
-00014c00: 7463 6865 6420 616e 6420 736f 2061 7265  tched and so are
-00014c10: 2061 7070 656e 6465 6420 7769 7468 204e   appended with N
-00014c20: 554c 4c20 7661 6c75 6573 2066 6f72 2074  ULL values for t
-00014c30: 6865 7365 0a20 2020 2063 6f6c 756d 6e73  hese.    columns
-00014c40: 2e20 4e6f 726d 616c 6c79 2074 6865 202d  . Normally the -
-00014c50: 7265 6c61 7865 6446 6965 6c64 4e61 6d65  relaxedFieldName
-00014c60: 4d61 7463 6820 7061 7261 6d65 7465 7220  Match parameter 
-00014c70: 696e 206f 6772 326f 6772 0a20 2020 2073  in ogr2ogr.    s
-00014c80: 686f 756c 6420 6669 7820 7468 6973 2c20  hould fix this, 
-00014c90: 6275 7420 6974 2073 6565 6d73 2074 6861  but it seems tha
-00014ca0: 7420 7468 6973 2069 736e 2774 2073 7570  t this isn't sup
-00014cb0: 706f 7274 6564 2066 6f72 2073 6861 7065  ported for shape
-00014cc0: 6669 6c65 732e 0a0a 2020 2020 4c61 756e  files...    Laun
-00014cd0: 6465 7269 6e67 2069 7320 6261 7365 6420  dering is based 
-00014ce0: 6f6e 2074 6869 7320 7465 7874 2066 726f  on this text fro
-00014cf0: 6d20 7468 6520 6764 616c 2073 6861 7065  m the gdal shape
-00014d00: 6669 6c65 2064 7269 7665 720a 2020 2020  file driver.    
-00014d10: 646f 6375 6d65 6e74 6174 696f 6e3a 0a0a  documentation:..
-00014d20: 2020 2020 5368 6170 6566 696c 6520 6665      Shapefile fe
-00014d30: 6174 7572 6520 6174 7472 6962 7574 6573  ature attributes
-00014d40: 2061 7265 2073 746f 7265 6420 696e 2061   are stored in a
-00014d50: 6e20 6173 736f 6369 6174 6564 202e 6462  n associated .db
-00014d60: 6620 6669 6c65 2c20 616e 640a 2020 2020  f file, and.    
-00014d70: 736f 2061 7474 7269 6275 7465 7320 7375  so attributes su
-00014d80: 6666 6572 2061 206e 756d 6265 7220 6f66  ffer a number of
-00014d90: 206c 696d 6974 6174 696f 6e73 3a0a 2020   limitations:.  
-00014da0: 2020 2d20 2020 4174 7472 6962 7574 6520    -   Attribute 
-00014db0: 6e61 6d65 7320 6361 6e20 6f6e 6c79 2062  names can only b
-00014dc0: 6520 7570 2074 6f20 3130 2063 6861 7261  e up to 10 chara
-00014dd0: 6374 6572 7320 6c6f 6e67 2e0a 2020 2020  cters long..    
-00014de0: 2020 2020 5468 6520 4f47 5220 5368 6170      The OGR Shap
-00014df0: 6566 696c 6520 6472 6976 6572 2074 7269  efile driver tri
-00014e00: 6573 2074 6f20 6765 6e65 7261 7465 2075  es to generate u
-00014e10: 6e69 7175 6520 6669 656c 640a 2020 2020  nique field.    
-00014e20: 2020 2020 6e61 6d65 732e 2053 7563 6365      names. Succe
-00014e30: 7373 6976 6520 6475 706c 6963 6174 6520  ssive duplicate 
-00014e40: 6669 656c 6420 6e61 6d65 732c 2069 6e63  field names, inc
-00014e50: 6c75 6469 6e67 2074 686f 7365 2063 7265  luding those cre
-00014e60: 6174 6564 2062 790a 2020 2020 2020 2020  ated by.        
-00014e70: 7472 756e 6361 7469 6f6e 2074 6f20 3130  truncation to 10
-00014e80: 2063 6861 7261 6374 6572 732c 2077 696c   characters, wil
-00014e90: 6c20 6265 2074 7275 6e63 6174 6564 2074  l be truncated t
-00014ea0: 6f20 3820 6368 6172 6163 7465 7273 2061  o 8 characters a
-00014eb0: 6e64 0a20 2020 2020 2020 2061 7070 656e  nd.        appen
-00014ec0: 6465 6420 7769 7468 2061 2073 6572 6961  ded with a seria
-00014ed0: 6c20 6e75 6d62 6572 2066 726f 6d20 3120  l number from 1 
-00014ee0: 746f 2039 392e 0a0a 2020 2020 2020 2020  to 99...        
-00014ef0: 466f 7220 6578 616d 706c 653a 0a0a 2020  For example:..  
-00014f00: 2020 2020 2020 2d20 2061 20e2 8692 2061        -  a ... a
-00014f10: 2c20 6120 e286 9220 615f 312c 2041 20e2  , a ... a_1, A .
-00014f20: 8692 2041 5f32 3b0a 2020 2020 2020 2020  .. A_2;.        
-00014f30: 2d20 2061 6263 6465 6667 6869 6a6b 20e2  -  abcdefghijk .
-00014f40: 8692 2061 6263 6465 6667 6869 6a2c 2061  .. abcdefghij, a
-00014f50: 6263 6465 6667 6869 6a6b 6c20 e286 9220  bcdefghijkl ... 
-00014f60: 6162 6364 6566 6768 5f31 0a0a 2020 2020  abcdefgh_1..    
-00014f70: 2d20 2020 4f6e 6c79 2049 6e74 6567 6572  -   Only Integer
-00014f80: 2c20 496e 7465 6765 7236 342c 2052 6561  , Integer64, Rea
-00014f90: 6c2c 2053 7472 696e 6720 616e 6420 4461  l, String and Da
-00014fa0: 7465 2028 6e6f 7420 4461 7465 5469 6d65  te (not DateTime
-00014fb0: 2c20 6a75 7374 0a20 2020 2020 2020 2079  , just.        y
-00014fc0: 6561 722f 6d6f 6e74 682f 6461 7929 2066  ear/month/day) f
-00014fd0: 6965 6c64 2074 7970 6573 2061 7265 2073  ield types are s
-00014fe0: 7570 706f 7274 6564 2e20 5468 6520 7661  upported. The va
-00014ff0: 7269 6f75 7320 6c69 7374 2c20 616e 640a  rious list, and.
-00015000: 2020 2020 2020 2020 6269 6e61 7279 2066          binary f
-00015010: 6965 6c64 2074 7970 6573 2063 616e 6e6f  ield types canno
-00015020: 7420 6265 2063 7265 6174 6564 2e0a 2020  t be created..  
-00015030: 2020 2d20 2020 5468 6520 6669 656c 6420    -   The field 
-00015040: 7769 6474 6820 616e 6420 7072 6563 6973  width and precis
-00015050: 696f 6e20 6172 6520 6469 7265 6374 6c79  ion are directly
-00015060: 2075 7365 6420 746f 2065 7374 6162 6c69   used to establi
-00015070: 7368 2073 746f 7261 6765 0a20 2020 2020  sh storage.     
-00015080: 2020 2073 697a 6520 696e 2074 6865 202e     size in the .
-00015090: 6462 6620 6669 6c65 2e20 5468 6973 206d  dbf file. This m
-000150a0: 6561 6e73 2074 6861 7420 7374 7269 6e67  eans that string
-000150b0: 7320 6c6f 6e67 6572 2074 6861 6e20 7468  s longer than th
-000150c0: 6520 6669 656c 640a 2020 2020 2020 2020  e field.        
-000150d0: 7769 6474 682c 206f 7220 6e75 6d62 6572  width, or number
-000150e0: 7320 7468 6174 2064 6f6e 2774 2066 6974  s that don't fit
-000150f0: 2069 6e74 6f20 7468 6520 696e 6469 6361   into the indica
-00015100: 7465 6420 6669 656c 6420 666f 726d 6174  ted field format
-00015110: 2077 696c 6c0a 2020 2020 2020 2020 7375   will.        su
-00015120: 6666 6572 2074 7275 6e63 6174 696f 6e2e  ffer truncation.
-00015130: 0a20 2020 202d 2020 2049 6e74 6567 6572  .    -   Integer
-00015140: 2066 6965 6c64 7320 7769 7468 6f75 7420   fields without 
-00015150: 616e 2065 7870 6c69 6369 7420 7769 6474  an explicit widt
-00015160: 6820 6172 6520 7472 6561 7465 6420 6173  h are treated as
-00015170: 2077 6964 7468 2039 2c20 616e 640a 2020   width 9, and.  
-00015180: 2020 2020 2020 6578 7465 6e64 6564 2074        extended t
-00015190: 6f20 3130 206f 7220 3131 2069 6620 6e65  o 10 or 11 if ne
-000151a0: 6564 6564 2e0a 2020 2020 2d20 2020 496e  eded..    -   In
-000151b0: 7465 6765 7236 3420 6669 656c 6473 2077  teger64 fields w
-000151c0: 6974 686f 7574 2061 6e20 6578 706c 6963  ithout an explic
-000151d0: 6974 2077 6964 7468 2061 7265 2074 7265  it width are tre
-000151e0: 6174 6564 2061 7320 7769 6474 6820 3138  ated as width 18
-000151f0: 2c0a 2020 2020 2020 2020 616e 6420 6578  ,.        and ex
-00015200: 7465 6e64 6564 2074 6f20 3139 206f 7220  tended to 19 or 
-00015210: 3230 2069 6620 6e65 6564 6564 2e0a 2020  20 if needed..  
-00015220: 2020 2d20 2020 5265 616c 2028 666c 6f61    -   Real (floa
-00015230: 7469 6e67 2070 6f69 6e74 2920 6669 656c  ting point) fiel
-00015240: 6473 2077 6974 686f 7574 2061 6e20 6578  ds without an ex
-00015250: 706c 6963 6974 2077 6964 7468 2061 7265  plicit width are
-00015260: 2074 7265 6174 6564 2061 730a 2020 2020   treated as.    
-00015270: 2020 2020 7769 6474 6820 3234 2077 6974      width 24 wit
-00015280: 6820 3135 2064 6563 696d 616c 2070 6c61  h 15 decimal pla
-00015290: 6365 7320 6f66 2070 7265 6369 7369 6f6e  ces of precision
-000152a0: 2e0a 2020 2020 2d20 2020 5374 7269 6e67  ..    -   String
-000152b0: 2066 6965 6c64 7320 7769 7468 6f75 7420   fields without 
-000152c0: 616e 2061 7373 6967 6e65 6420 7769 6474  an assigned widt
-000152d0: 6820 6172 6520 7472 6561 7465 6420 6173  h are treated as
-000152e0: 2038 3020 6368 6172 6163 7465 7273 2e0a   80 characters..
-000152f0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-00015300: 2020 2063 6f6c 756d 6e73 2028 4974 6572     columns (Iter
-00015310: 6162 6c65 293a 2074 6865 2063 6f6c 756d  able): the colum
-00015320: 6e73 2074 6f20 6c61 756e 6465 722e 0a0a  ns to launder...
-00015330: 2020 2020 5265 7475 726e 733a 2061 204c      Returns: a L
-00015340: 6973 7420 6f66 2074 7570 706c 6573 2077  ist of tupples w
-00015350: 6974 6820 7468 6520 6f72 6967 696e 616c  ith the original
-00015360: 2061 6e64 206c 6175 6e64 6572 6564 2063   and laundered c
-00015370: 6f6c 756d 6e20 6e61 6d65 732e 0a20 2020  olumn names..   
-00015380: 2022 2222 0a20 2020 206c 6175 6e64 6572   """.    launder
-00015390: 6564 203d 205b 5d0a 2020 2020 6c61 756e  ed = [].    laun
-000153a0: 6465 7265 645f 7570 7065 7220 3d20 5b5d  dered_upper = []
-000153b0: 0a20 2020 2066 6f72 2063 6f6c 756d 6e20  .    for column 
-000153c0: 696e 2063 6f6c 756d 6e73 3a0a 2020 2020  in columns:.    
-000153d0: 2020 2020 2320 446f 7562 6c65 7320 696e      # Doubles in
-000153e0: 2063 6173 696e 6720 6172 6565 206e 6f74   casing aree not
-000153f0: 2061 6c6c 6f77 6564 2065 6974 6865 720a   allowed either.
-00015400: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-00015410: 6f6c 756d 6e29 203c 3d20 3130 3a0a 2020  olumn) <= 10:.  
-00015420: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-00015430: 756d 6e2e 7570 7065 7228 2920 6e6f 7420  umn.upper() not 
-00015440: 696e 206c 6175 6e64 6572 6564 5f75 7070  in laundered_upp
-00015450: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00015460: 2020 2020 6c61 756e 6465 7265 645f 7570      laundered_up
-00015470: 7065 722e 6170 7065 6e64 2863 6f6c 756d  per.append(colum
-00015480: 6e2e 7570 7065 7228 2929 0a20 2020 2020  n.upper()).     
-00015490: 2020 2020 2020 2020 2020 206c 6175 6e64             laund
-000154a0: 6572 6564 2e61 7070 656e 6428 2863 6f6c  ered.append((col
-000154b0: 756d 6e2c 2063 6f6c 756d 6e29 290a 2020  umn, column)).  
-000154c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000154d0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-000154e0: 2320 4c61 756e 6465 7269 6e67 2069 7320  # Laundering is 
-000154f0: 6e65 6564 6564 0a20 2020 2020 2020 2063  needed.        c
-00015500: 6f6c 756d 6e5f 6c61 756e 6465 7265 6420  olumn_laundered 
-00015510: 3d20 636f 6c75 6d6e 5b3a 3130 5d0a 2020  = column[:10].  
-00015520: 2020 2020 2020 6966 2063 6f6c 756d 6e5f        if column_
-00015530: 6c61 756e 6465 7265 642e 7570 7065 7228  laundered.upper(
-00015540: 2920 6e6f 7420 696e 206c 6175 6e64 6572  ) not in launder
-00015550: 6564 5f75 7070 6572 3a0a 2020 2020 2020  ed_upper:.      
-00015560: 2020 2020 2020 6c61 756e 6465 7265 645f        laundered_
-00015570: 7570 7065 722e 6170 7065 6e64 2863 6f6c  upper.append(col
-00015580: 756d 6e5f 6c61 756e 6465 7265 642e 7570  umn_laundered.up
-00015590: 7065 7228 2929 0a20 2020 2020 2020 2020  per()).         
-000155a0: 2020 206c 6175 6e64 6572 6564 2e61 7070     laundered.app
-000155b0: 656e 6428 2863 6f6c 756d 6e2c 2063 6f6c  end((column, col
-000155c0: 756d 6e5f 6c61 756e 6465 7265 6429 290a  umn_laundered)).
-000155d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000155e0: 2020 2020 2020 2020 2020 2320 4a75 7374            # Just
-000155f0: 2074 616b 696e 6720 6669 7273 7420 3130   taking first 10
-00015600: 2063 6861 7261 6374 6572 7320 6469 646e   characters didn
-00015610: 2774 2068 656c 700a 2020 2020 2020 2020  't help.        
-00015620: 2020 2020 666f 7220 696e 6465 7820 696e      for index in
-00015630: 2072 616e 6765 2831 2c20 3130 3129 3a0a   range(1, 101):.
-00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015650: 6966 2069 6e64 6578 203e 3d20 3130 303a  if index >= 100:
-00015660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015670: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-00015680: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
-00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156a0: 2020 2020 2020 2020 224e 6f74 2073 7570          "Not sup
-000156b0: 706f 7274 6564 2074 6f20 6c61 756e 6465  ported to launde
-000156c0: 7220 3e20 3939 2063 6f6c 756d 6e73 2073  r > 99 columns s
-000156d0: 7461 7274 696e 6720 220a 2020 2020 2020  tarting ".      
-000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156f0: 2020 6622 7769 7468 207b 636f 6c75 6d6e    f"with {column
-00015700: 5f6c 6175 6e64 6572 6564 5b3a 385d 7d22  _laundered[:8]}"
-00015710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015720: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00015730: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
-00015740: 3c3d 2039 3a0a 2020 2020 2020 2020 2020  <= 9:.          
-00015750: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00015760: 5f6c 6175 6e64 6572 6564 203d 2066 227b  _laundered = f"{
+00012050: 7372 635f 6372 733d 7372 635f 6372 732c  src_crs=src_crs,
+00012060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012070: 2020 2020 2064 7374 5f63 7273 3d64 7374       dst_crs=dst
+00012080: 5f63 7273 2c0a 2020 2020 2020 2020 2020  _crs,.          
+00012090: 2020 2020 2020 2020 2020 7768 6572 653d            where=
+000120a0: 7768 6572 652c 0a20 2020 2020 2020 2020  where,.         
+000120b0: 2020 2020 2020 2020 2020 2072 6570 726f             repro
+000120c0: 6a65 6374 3d72 6570 726f 6a65 6374 2c0a  ject=reproject,.
+000120d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120e0: 2020 2020 6578 706c 6f64 6563 6f6c 6c65      explodecolle
+000120f0: 6374 696f 6e73 3d65 7870 6c6f 6465 636f  ctions=explodeco
+00012100: 6c6c 6563 7469 6f6e 732c 0a20 2020 2020  llections,.     
+00012110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012120: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+00012130: 6574 7279 7479 7065 3d66 6f72 6365 5f6f  etrytype=force_o
+00012140: 7574 7075 745f 6765 6f6d 6574 7279 7479  utput_geometryty
+00012150: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00012160: 2020 2020 2020 2020 6372 6561 7465 5f73          create_s
+00012170: 7061 7469 616c 5f69 6e64 6578 3d63 7265  patial_index=cre
+00012180: 6174 655f 7370 6174 6961 6c5f 696e 6465  ate_spatial_inde
+00012190: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+000121a0: 2020 2020 2020 2074 7261 6e73 6163 7469         transacti
+000121b0: 6f6e 5f73 697a 653d 7472 616e 7361 6374  on_size=transact
+000121c0: 696f 6e5f 7369 7a65 2c0a 2020 2020 2020  ion_size,.      
+000121d0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000121e0: 6573 6572 7665 5f66 6964 3d70 7265 7365  eserve_fid=prese
+000121f0: 7276 655f 6669 642c 0a20 2020 2020 2020  rve_fid,.       
+00012200: 2020 2020 2020 2020 2020 2020 206f 7074               opt
+00012210: 696f 6e73 3d6f 7074 696f 6e73 2c0a 2020  ions=options,.  
+00012220: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00012230: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+00012240: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+00012250: 2020 2020 2072 6561 6479 203d 2054 7275       ready = Tru
+00012260: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00012270: 2020 6c6f 636b 6669 6c65 2e75 6e6c 696e    lockfile.unlin
+00012280: 6b28 290a 2020 2020 2020 2020 656c 7365  k().        else
+00012290: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+000122a0: 6d65 5f77 6169 7469 6e67 203d 2028 6461  me_waiting = (da
+000122b0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+000122c0: 6e6f 7728 2920 2d20 7374 6172 745f 7469  now() - start_ti
+000122d0: 6d65 292e 746f 7461 6c5f 7365 636f 6e64  me).total_second
+000122e0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+000122f0: 6966 2074 696d 655f 7761 6974 696e 6720  if time_waiting 
+00012300: 3e20 6170 7065 6e64 5f74 696d 656f 7574  > append_timeout
+00012310: 5f73 3a0a 2020 2020 2020 2020 2020 2020  _s:.            
+00012320: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+00012330: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00012340: 2020 2020 2020 2020 2020 2020 6622 6170              f"ap
+00012350: 7065 6e64 5f74 6f20 7469 6d65 6f75 7420  pend_to timeout 
+00012360: 6f66 207b 6170 7065 6e64 5f74 696d 656f  of {append_timeo
+00012370: 7574 5f73 7d20 7265 6163 6865 642c 2073  ut_s} reached, s
+00012380: 6f20 7374 6f70 2077 7269 7465 2022 0a20  o stop write ". 
+00012390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123a0: 2020 2066 2274 6f20 7b64 7374 7d21 220a     f"to {dst}!".
+000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123c0: 290a 0a20 2020 2020 2020 2023 2053 6c65  )..        # Sle
+000123d0: 6570 2066 6f72 2061 2073 6563 6f6e 6420  ep for a second 
+000123e0: 6265 666f 7265 2074 7279 696e 6720 6167  before trying ag
+000123f0: 6169 6e0a 2020 2020 2020 2020 7469 6d65  ain.        time
+00012400: 2e73 6c65 6570 2831 290a 0a0a 6465 6620  .sleep(1)...def 
+00012410: 5f61 7070 656e 645f 746f 5f6e 6f6c 6f63  _append_to_noloc
+00012420: 6b28 0a20 2020 2073 7263 3a20 5061 7468  k(.    src: Path
+00012430: 2c0a 2020 2020 6473 743a 2050 6174 682c  ,.    dst: Path,
+00012440: 0a20 2020 2073 7263 5f6c 6179 6572 3a20  .    src_layer: 
+00012450: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00012460: 4e6f 6e65 2c0a 2020 2020 6473 745f 6c61  None,.    dst_la
+00012470: 7965 723a 204f 7074 696f 6e61 6c5b 7374  yer: Optional[st
+00012480: 725d 203d 204e 6f6e 652c 0a20 2020 2073  r] = None,.    s
+00012490: 7263 5f63 7273 3a20 556e 696f 6e5b 696e  rc_crs: Union[in
+000124a0: 742c 2073 7472 2c20 4e6f 6e65 5d20 3d20  t, str, None] = 
+000124b0: 4e6f 6e65 2c0a 2020 2020 6473 745f 6372  None,.    dst_cr
+000124c0: 733a 2055 6e69 6f6e 5b69 6e74 2c20 7374  s: Union[int, st
+000124d0: 722c 204e 6f6e 655d 203d 204e 6f6e 652c  r, None] = None,
+000124e0: 0a20 2020 2077 6865 7265 3a20 4f70 7469  .    where: Opti
+000124f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00012500: 2c0a 2020 2020 7265 7072 6f6a 6563 743a  ,.    reproject:
+00012510: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+00012520: 2020 2065 7870 6c6f 6465 636f 6c6c 6563     explodecollec
+00012530: 7469 6f6e 733a 2062 6f6f 6c20 3d20 4661  tions: bool = Fa
+00012540: 6c73 652c 0a20 2020 2063 7265 6174 655f  lse,.    create_
+00012550: 7370 6174 6961 6c5f 696e 6465 783a 204f  spatial_index: O
+00012560: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
+00012570: 5472 7565 2c0a 2020 2020 666f 7263 655f  True,.    force_
+00012580: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+00012590: 7970 653a 2055 6e69 6f6e 5b47 656f 6d65  ype: Union[Geome
+000125a0: 7472 7954 7970 652c 2073 7472 2c20 4e6f  tryType, str, No
+000125b0: 6e65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ne] = None,.    
+000125c0: 7472 616e 7361 6374 696f 6e5f 7369 7a65  transaction_size
+000125d0: 3a20 696e 7420 3d20 3530 3030 302c 0a20  : int = 50000,. 
+000125e0: 2020 2070 7265 7365 7276 655f 6669 643a     preserve_fid:
+000125f0: 204f 7074 696f 6e61 6c5b 626f 6f6c 5d20   Optional[bool] 
+00012600: 3d20 4e6f 6e65 2c0a 2020 2020 6f70 7469  = None,.    opti
+00012610: 6f6e 733a 2064 6963 7420 3d20 7b7d 2c0a  ons: dict = {},.
+00012620: 293a 0a20 2020 2023 2043 6865 636b 2f63  ):.    # Check/c
+00012630: 6c65 616e 2069 6e70 7574 2070 6172 616d  lean input param
+00012640: 730a 2020 2020 6f70 7469 6f6e 7320 3d20  s.    options = 
+00012650: 5f6f 6772 5f75 7469 6c2e 5f70 7265 7061  _ogr_util._prepa
+00012660: 7265 5f67 6461 6c5f 6f70 7469 6f6e 7328  re_gdal_options(
+00012670: 6f70 7469 6f6e 7329 0a20 2020 2069 6620  options).    if 
+00012680: 280a 2020 2020 2020 2020 6372 6561 7465  (.        create
+00012690: 5f73 7061 7469 616c 5f69 6e64 6578 2069  _spatial_index i
+000126a0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+000126b0: 2020 2061 6e64 2022 4c41 5945 525f 4352     and "LAYER_CR
+000126c0: 4541 5449 4f4e 2e53 5041 5449 414c 5f49  EATION.SPATIAL_I
+000126d0: 4e44 4558 2220 6e6f 7420 696e 206f 7074  NDEX" not in opt
+000126e0: 696f 6e73 0a20 2020 2029 3a0a 2020 2020  ions.    ):.    
+000126f0: 2020 2020 6f70 7469 6f6e 735b 224c 4159      options["LAY
+00012700: 4552 5f43 5245 4154 494f 4e2e 5350 4154  ER_CREATION.SPAT
+00012710: 4941 4c5f 494e 4445 5822 5d20 3d20 6372  IAL_INDEX"] = cr
+00012720: 6561 7465 5f73 7061 7469 616c 5f69 6e64  eate_spatial_ind
+00012730: 6578 0a0a 2020 2020 7372 635f 6c61 7965  ex..    src_laye
+00012740: 7269 6e66 6f20 3d20 4e6f 6e65 0a20 2020  rinfo = None.   
+00012750: 2069 6620 7768 6572 6520 6973 206e 6f74   if where is not
+00012760: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00012770: 7263 5f6c 6179 6572 696e 666f 203d 2067  rc_layerinfo = g
+00012780: 6574 5f6c 6179 6572 696e 666f 2873 7263  et_layerinfo(src
+00012790: 2c20 7372 635f 6c61 7965 722c 2072 6169  , src_layer, rai
+000127a0: 7365 5f6f 6e5f 6e6f 6765 6f6d 3d46 616c  se_on_nogeom=Fal
+000127b0: 7365 290a 2020 2020 2020 2020 7768 6572  se).        wher
+000127c0: 6520 3d20 7768 6572 652e 666f 726d 6174  e = where.format
+000127d0: 2867 656f 6d65 7472 7963 6f6c 756d 6e3d  (geometrycolumn=
+000127e0: 7372 635f 6c61 7965 7269 6e66 6f2e 6765  src_layerinfo.ge
+000127f0: 6f6d 6574 7279 636f 6c75 6d6e 290a 0a20  ometrycolumn).. 
+00012800: 2020 2023 2057 6865 6e20 6372 6561 7469     # When creati
+00012810: 6e67 2f61 7070 656e 6469 6e67 2074 6f20  ng/appending to 
+00012820: 6120 7368 6170 6566 696c 652c 2073 6f6d  a shapefile, som
+00012830: 6520 6578 7472 6120 7468 696e 6773 206e  e extra things n
+00012840: 6565 6420 746f 2062 6520 646f 6e65 2f63  eed to be done/c
+00012850: 6865 636b 6564 2e0a 2020 2020 7371 6c5f  hecked..    sql_
+00012860: 7374 6d74 203d 204e 6f6e 650a 2020 2020  stmt = None.    
+00012870: 6966 2064 7374 2e73 7566 6669 782e 6c6f  if dst.suffix.lo
+00012880: 7765 7228 2920 3d3d 2022 2e73 6870 223a  wer() == ".shp":
+00012890: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
+000128a0: 6520 6465 7374 696e 6174 696f 6e20 6669  e destination fi
+000128b0: 6c65 2064 6f65 736e 2774 2065 7869 7374  le doesn't exist
+000128c0: 2079 6574 2c20 616e 6420 7468 6520 736f   yet, and the so
+000128d0: 7572 6365 2066 696c 6520 6861 730a 2020  urce file has.  
+000128e0: 2020 2020 2020 2320 6765 6f6d 6574 7279        # geometry
+000128f0: 7479 7065 2022 4765 6f6d 6574 7279 222c  type "Geometry",
+00012900: 2072 6169 7365 2062 6563 6175 7365 2074   raise because t
+00012910: 7970 6520 6973 206e 6f74 2073 7570 706f  ype is not suppo
+00012920: 7274 6564 2062 7920 7368 7020 2861 6e64  rted by shp (and
+00012930: 2077 696c 6c0a 2020 2020 2020 2020 2320   will.        # 
+00012940: 6465 6661 756c 7420 746f 206c 696e 6573  default to lines
+00012950: 7472 696e 6729 2e0a 2020 2020 2020 2020  tring)..        
+00012960: 6966 2073 7263 5f6c 6179 6572 696e 666f  if src_layerinfo
+00012970: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00012980: 2020 2020 2020 7372 635f 6c61 7965 7269        src_layeri
+00012990: 6e66 6f20 3d20 6765 745f 6c61 7965 7269  nfo = get_layeri
+000129a0: 6e66 6f28 7372 632c 2073 7263 5f6c 6179  nfo(src, src_lay
+000129b0: 6572 2c20 7261 6973 655f 6f6e 5f6e 6f67  er, raise_on_nog
+000129c0: 656f 6d3d 4661 6c73 6529 0a20 2020 2020  eom=False).     
+000129d0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+000129e0: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
+000129f0: 5f67 656f 6d65 7472 7974 7970 6520 6973  _geometrytype is
+00012a00: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00012a10: 2020 616e 6420 7372 635f 6c61 7965 7269    and src_layeri
+00012a20: 6e66 6f2e 6765 6f6d 6574 7279 7479 7065  nfo.geometrytype
+00012a30: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+00012a40: 5b47 656f 6d65 7472 7954 7970 652e 4745  [GeometryType.GE
+00012a50: 4f4d 4554 5259 2c20 4765 6f6d 6574 7279  OMETRY, Geometry
+00012a60: 5479 7065 2e47 454f 4d45 5452 5943 4f4c  Type.GEOMETRYCOL
+00012a70: 4c45 4354 494f 4e5d 0a20 2020 2020 2020  LECTION].       
+00012a80: 2020 2020 2061 6e64 206e 6f74 2064 7374       and not dst
+00012a90: 2e65 7869 7374 7328 290a 2020 2020 2020  .exists().      
+00012aa0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00012ab0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00012ac0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00012ad0: 2020 2066 2273 7263 2066 696c 6520 7b73     f"src file {s
+00012ae0: 7263 7d20 6861 7320 6765 6f6d 6574 7279  rc} has geometry
+00012af0: 7479 7065 207b 7372 635f 6c61 7965 7269  type {src_layeri
+00012b00: 6e66 6f2e 6765 6f6d 6574 7279 7479 7065  nfo.geometrytype
+00012b10: 6e61 6d65 7d20 220a 2020 2020 2020 2020  name} ".        
+00012b20: 2020 2020 2020 2020 2277 6869 6368 2069          "which i
+00012b30: 7320 6e6f 7420 7375 7070 6f72 7465 6420  s not supported 
+00012b40: 696e 202e 7368 702e 204d 6179 6265 2075  in .shp. Maybe u
+00012b50: 7365 2066 6f72 6365 5f6f 7574 7075 745f  se force_output_
+00012b60: 6765 6f6d 6574 7279 7479 7065 3f22 0a20  geometrytype?". 
+00012b70: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00012b80: 2020 2020 2020 2320 4c61 756e 6465 7220        # Launder 
+00012b90: 7468 6520 636f 6c75 6d6e 7320 6e61 6d65  the columns name
+00012ba0: 7320 7669 6120 6120 7371 6c20 7374 6174  s via a sql stat
+00012bb0: 656d 656e 742c 206f 7468 6572 7769 7365  ement, otherwise
+00012bc0: 2077 6865 6e20 6170 7065 6e64 696e 6720   when appending 
+00012bd0: 7468 650a 2020 2020 2020 2020 2320 6c61  the.        # la
+00012be0: 756e 6465 7265 6420 636f 6c75 6d6e 7320  undered columns 
+00012bf0: 7769 6c6c 2067 6574 204e 554c 4c20 7661  will get NULL va
+00012c00: 6c75 6573 2069 6e73 7465 6164 206f 6620  lues instead of 
+00012c10: 7468 6520 6461 7461 2e0a 2020 2020 2020  the data..      
+00012c20: 2020 7372 635f 636f 6c75 6d6e 7320 3d20    src_columns = 
+00012c30: 7372 635f 6c61 7965 7269 6e66 6f2e 636f  src_layerinfo.co
+00012c40: 6c75 6d6e 730a 2020 2020 2020 2020 636f  lumns.        co
+00012c50: 6c75 6d6e 735f 6c61 756e 6465 7265 6420  lumns_laundered 
+00012c60: 3d20 5f6c 6175 6e64 6572 5f63 6f6c 756d  = _launder_colum
+00012c70: 6e5f 6e61 6d65 7328 7372 635f 636f 6c75  n_names(src_colu
+00012c80: 6d6e 7329 0a20 2020 2020 2020 2063 6f6c  mns).        col
+00012c90: 756d 6e73 5f61 6c69 6173 6564 203d 205b  umns_aliased = [
+00012ca0: 0a20 2020 2020 2020 2020 2020 2066 2722  .            f'"
+00012cb0: 7b63 6f6c 756d 6e7d 2220 4153 2022 7b6c  {column}" AS "{l
+00012cc0: 6175 6e64 6572 6564 7d22 2720 666f 7220  aundered}"' for 
+00012cd0: 636f 6c75 6d6e 2c20 6c61 756e 6465 7265  column, laundere
+00012ce0: 6420 696e 2063 6f6c 756d 6e73 5f6c 6175  d in columns_lau
+00012cf0: 6e64 6572 6564 0a20 2020 2020 2020 205d  ndered.        ]
+00012d00: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
+00012d10: 2073 7263 5f6c 6179 6572 2069 6620 7372   src_layer if sr
+00012d20: 635f 6c61 7965 7220 6973 206e 6f74 204e  c_layer is not N
+00012d30: 6f6e 6520 656c 7365 2067 6574 5f6f 6e6c  one else get_onl
+00012d40: 795f 6c61 7965 7228 7372 6329 0a20 2020  y_layer(src).   
+00012d50: 2020 2020 2023 2049 6620 7468 6572 6520       # If there 
+00012d60: 6973 2061 2077 6865 7265 2073 7065 6369  is a where speci
+00012d70: 6669 6564 2c20 696e 7465 6772 6174 6520  fied, integrate 
+00012d80: 6974 2e2e 2e0a 2020 2020 2020 2020 7768  it....        wh
+00012d90: 6572 655f 636c 6175 7365 203d 2022 220a  ere_clause = "".
+00012da0: 2020 2020 2020 2020 6966 2077 6865 7265          if where
+00012db0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00012dc0: 2020 2020 2020 2020 2020 7768 6572 655f            where_
+00012dd0: 636c 6175 7365 203d 2066 2257 4845 5245  clause = f"WHERE
+00012de0: 207b 7768 6572 657d 220a 2020 2020 2020   {where}".      
+00012df0: 2020 2020 2020 7768 6572 6520 3d20 4e6f        where = No
+00012e00: 6e65 0a20 2020 2020 2020 2067 656f 6d65  ne.        geome
+00012e10: 7472 7963 6f6c 756d 6e20 3d20 2222 0a20  trycolumn = "". 
+00012e20: 2020 2020 2020 2069 6620 7372 635f 6c61         if src_la
+00012e30: 7965 7269 6e66 6f2e 6765 6f6d 6574 7279  yerinfo.geometry
+00012e40: 636f 6c75 6d6e 2069 7320 6e6f 7420 4e6f  column is not No
+00012e50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012e60: 6765 6f6d 6574 7279 636f 6c75 6d6e 203d  geometrycolumn =
+00012e70: 2066 227b 7372 635f 6c61 7965 7269 6e66   f"{src_layerinf
+00012e80: 6f2e 6765 6f6d 6574 7279 636f 6c75 6d6e  o.geometrycolumn
+00012e90: 7d2c 2022 0a20 2020 2020 2020 2073 716c  }, ".        sql
+00012ea0: 5f73 746d 7420 3d20 6622 2222 0a20 2020  _stmt = f""".   
+00012eb0: 2020 2020 2020 2020 2053 454c 4543 5420           SELECT 
+00012ec0: 7b67 656f 6d65 7472 7963 6f6c 756d 6e7d  {geometrycolumn}
+00012ed0: 7b22 2c20 222e 6a6f 696e 2863 6f6c 756d  {", ".join(colum
+00012ee0: 6e73 5f61 6c69 6173 6564 297d 0a20 2020  ns_aliased)}.   
+00012ef0: 2020 2020 2020 2020 2020 2046 524f 4d20             FROM 
+00012f00: 227b 6c61 7965 727d 220a 2020 2020 2020  "{layer}".      
+00012f10: 2020 2020 2020 207b 7768 6572 655f 636c         {where_cl
+00012f20: 6175 7365 7d0a 2020 2020 2020 2020 2222  ause}.        ""
+00012f30: 220a 0a20 2020 2023 2057 6865 6e20 6473  "..    # When ds
+00012f40: 7420 6669 6c65 2064 6f65 736e 2774 2065  t file doesn't e
+00012f50: 7869 7374 2061 6e64 2073 7263 2069 7320  xist and src is 
+00012f60: 656d 7074 7920 666f 7263 655f 6f75 7470  empty force_outp
+00012f70: 7574 5f67 656f 6d65 7472 7974 7970 6520  ut_geometrytype 
+00012f80: 7368 6f75 6c64 2062 650a 2020 2020 2320  should be.    # 
+00012f90: 7370 6563 6966 6965 642c 206f 7468 6572  specified, other
+00012fa0: 7769 7365 2069 6e76 616c 6964 206f 7574  wise invalid out
+00012fb0: 7075 742e 0a20 2020 2069 6620 666f 7263  put..    if forc
+00012fc0: 655f 6f75 7470 7574 5f67 656f 6d65 7472  e_output_geometr
+00012fd0: 7974 7970 6520 6973 204e 6f6e 6520 616e  ytype is None an
+00012fe0: 6420 6e6f 7420 6473 742e 6578 6973 7473  d not dst.exists
+00012ff0: 2829 3a0a 2020 2020 2020 2020 6966 2073  ():.        if s
+00013000: 7263 5f6c 6179 6572 696e 666f 2069 7320  rc_layerinfo is 
+00013010: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00013020: 2020 7372 635f 6c61 7965 7269 6e66 6f20    src_layerinfo 
+00013030: 3d20 6765 745f 6c61 7965 7269 6e66 6f28  = get_layerinfo(
+00013040: 7372 632c 2073 7263 5f6c 6179 6572 2c20  src, src_layer, 
+00013050: 7261 6973 655f 6f6e 5f6e 6f67 656f 6d3d  raise_on_nogeom=
+00013060: 4661 6c73 6529 0a20 2020 2020 2020 2066  False).        f
+00013070: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+00013080: 6574 7279 7479 7065 203d 2073 7263 5f6c  etrytype = src_l
+00013090: 6179 6572 696e 666f 2e67 656f 6d65 7472  ayerinfo.geometr
+000130a0: 7974 7970 650a 0a20 2020 2023 2047 6f21  ytype..    # Go!
+000130b0: 0a20 2020 2074 7261 6e73 6c61 7465 5f69  .    translate_i
+000130c0: 6e66 6f20 3d20 5f6f 6772 5f75 7469 6c2e  nfo = _ogr_util.
+000130d0: 5665 6374 6f72 5472 616e 736c 6174 6549  VectorTranslateI
+000130e0: 6e66 6f28 0a20 2020 2020 2020 2069 6e70  nfo(.        inp
+000130f0: 7574 5f70 6174 683d 7372 632c 0a20 2020  ut_path=src,.   
+00013100: 2020 2020 206f 7574 7075 745f 7061 7468       output_path
+00013110: 3d64 7374 2c0a 2020 2020 2020 2020 696e  =dst,.        in
+00013120: 7075 745f 6c61 7965 7273 3d73 7263 5f6c  put_layers=src_l
+00013130: 6179 6572 2c0a 2020 2020 2020 2020 6f75  ayer,.        ou
+00013140: 7470 7574 5f6c 6179 6572 3d64 7374 5f6c  tput_layer=dst_l
+00013150: 6179 6572 2c0a 2020 2020 2020 2020 696e  ayer,.        in
+00013160: 7075 745f 7372 733d 7372 635f 6372 732c  put_srs=src_crs,
+00013170: 0a20 2020 2020 2020 206f 7574 7075 745f  .        output_
+00013180: 7372 733d 6473 745f 6372 732c 0a20 2020  srs=dst_crs,.   
+00013190: 2020 2020 2073 716c 5f73 746d 743d 7371       sql_stmt=sq
+000131a0: 6c5f 7374 6d74 2c0a 2020 2020 2020 2020  l_stmt,.        
+000131b0: 7371 6c5f 6469 616c 6563 743d 2253 514c  sql_dialect="SQL
+000131c0: 4954 4522 2c0a 2020 2020 2020 2020 7768  ITE",.        wh
+000131d0: 6572 653d 7768 6572 652c 0a20 2020 2020  ere=where,.     
+000131e0: 2020 2072 6570 726f 6a65 6374 3d72 6570     reproject=rep
+000131f0: 726f 6a65 6374 2c0a 2020 2020 2020 2020  roject,.        
+00013200: 7472 616e 7361 6374 696f 6e5f 7369 7a65  transaction_size
+00013210: 3d74 7261 6e73 6163 7469 6f6e 5f73 697a  =transaction_siz
+00013220: 652c 0a20 2020 2020 2020 2061 7070 656e  e,.        appen
+00013230: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
+00013240: 7570 6461 7465 3d54 7275 652c 0a20 2020  update=True,.   
+00013250: 2020 2020 2065 7870 6c6f 6465 636f 6c6c       explodecoll
+00013260: 6563 7469 6f6e 733d 6578 706c 6f64 6563  ections=explodec
+00013270: 6f6c 6c65 6374 696f 6e73 2c0a 2020 2020  ollections,.    
+00013280: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
+00013290: 5f67 656f 6d65 7472 7974 7970 653d 666f  _geometrytype=fo
+000132a0: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
+000132b0: 7472 7974 7970 652c 0a20 2020 2020 2020  trytype,.       
+000132c0: 206f 7074 696f 6e73 3d6f 7074 696f 6e73   options=options
+000132d0: 2c0a 2020 2020 2020 2020 7072 6573 6572  ,.        preser
+000132e0: 7665 5f66 6964 3d70 7265 7365 7276 655f  ve_fid=preserve_
+000132f0: 6669 642c 0a20 2020 2029 0a20 2020 205f  fid,.    ).    _
+00013300: 6f67 725f 7574 696c 2e76 6563 746f 725f  ogr_util.vector_
+00013310: 7472 616e 736c 6174 655f 6279 5f69 6e66  translate_by_inf
+00013320: 6f28 696e 666f 3d74 7261 6e73 6c61 7465  o(info=translate
+00013330: 5f69 6e66 6f29 0a0a 0a64 6566 2063 6f6e  _info)...def con
+00013340: 7665 7274 280a 2020 2020 7372 633a 2055  vert(.    src: U
+00013350: 6e69 6f6e 5b73 7472 2c20 226f 732e 5061  nion[str, "os.Pa
+00013360: 7468 4c69 6b65 5b41 6e79 5d22 5d2c 0a20  thLike[Any]"],. 
+00013370: 2020 2064 7374 3a20 556e 696f 6e5b 7374     dst: Union[st
+00013380: 722c 2022 6f73 2e50 6174 684c 696b 655b  r, "os.PathLike[
+00013390: 416e 795d 225d 2c0a 2020 2020 7372 635f  Any]"],.    src_
+000133a0: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
+000133b0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+000133c0: 2064 7374 5f6c 6179 6572 3a20 4f70 7469   dst_layer: Opti
+000133d0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+000133e0: 2c0a 2020 2020 7372 635f 6372 733a 2055  ,.    src_crs: U
+000133f0: 6e69 6f6e 5b73 7472 2c20 696e 742c 204e  nion[str, int, N
+00013400: 6f6e 655d 203d 204e 6f6e 652c 0a20 2020  one] = None,.   
+00013410: 2064 7374 5f63 7273 3a20 556e 696f 6e5b   dst_crs: Union[
+00013420: 7374 722c 2069 6e74 2c20 4e6f 6e65 5d20  str, int, None] 
+00013430: 3d20 4e6f 6e65 2c0a 2020 2020 7768 6572  = None,.    wher
+00013440: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+00013450: 203d 204e 6f6e 652c 0a20 2020 2072 6570   = None,.    rep
+00013460: 726f 6a65 6374 3a20 626f 6f6c 203d 2046  roject: bool = F
+00013470: 616c 7365 2c0a 2020 2020 6578 706c 6f64  alse,.    explod
+00013480: 6563 6f6c 6c65 6374 696f 6e73 3a20 626f  ecollections: bo
+00013490: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000134a0: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
+000134b0: 6d65 7472 7974 7970 653a 2055 6e69 6f6e  metrytype: Union
+000134c0: 5b47 656f 6d65 7472 7954 7970 652c 2073  [GeometryType, s
+000134d0: 7472 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65  tr, None] = None
+000134e0: 2c0a 2020 2020 6372 6561 7465 5f73 7061  ,.    create_spa
+000134f0: 7469 616c 5f69 6e64 6578 3a20 4f70 7469  tial_index: Opti
+00013500: 6f6e 616c 5b62 6f6f 6c5d 203d 2054 7275  onal[bool] = Tru
+00013510: 652c 0a20 2020 2070 7265 7365 7276 655f  e,.    preserve_
+00013520: 6669 643a 204f 7074 696f 6e61 6c5b 626f  fid: Optional[bo
+00013530: 6f6c 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ol] = None,.    
+00013540: 6f70 7469 6f6e 733a 2064 6963 7420 3d20  options: dict = 
+00013550: 7b7d 2c0a 2020 2020 6170 7065 6e64 3a20  {},.    append: 
+00013560: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+00013570: 2020 666f 7263 653a 2062 6f6f 6c20 3d20    force: bool = 
+00013580: 4661 6c73 652c 0a29 3a0a 2020 2020 2222  False,.):.    ""
+00013590: 220a 2020 2020 4445 5052 4543 4154 4544  ".    DEPRECATED
+000135a0: 3a20 706c 6561 7365 2075 7365 2063 6f70  : please use cop
+000135b0: 795f 6c61 7965 722e 0a20 2020 2022 2222  y_layer..    """
+000135c0: 0a20 2020 2077 6172 6e69 6e67 732e 7761  .    warnings.wa
+000135d0: 726e 2822 636f 6e76 6572 7420 6973 2064  rn("convert is d
+000135e0: 6570 7265 6361 7465 643a 2075 7365 2063  eprecated: use c
+000135f0: 6f70 795f 6c61 7965 722e 222c 2046 7574  opy_layer.", Fut
+00013600: 7572 6557 6172 6e69 6e67 2c20 7374 6163  ureWarning, stac
+00013610: 6b6c 6576 656c 3d32 290a 2020 2020 7265  klevel=2).    re
+00013620: 7475 726e 2063 6f70 795f 6c61 7965 7228  turn copy_layer(
+00013630: 0a20 2020 2020 2020 2073 7263 3d73 7263  .        src=src
+00013640: 2c0a 2020 2020 2020 2020 6473 743d 6473  ,.        dst=ds
+00013650: 742c 0a20 2020 2020 2020 2073 7263 5f6c  t,.        src_l
+00013660: 6179 6572 3d73 7263 5f6c 6179 6572 2c0a  ayer=src_layer,.
+00013670: 2020 2020 2020 2020 6473 745f 6c61 7965          dst_laye
+00013680: 723d 6473 745f 6c61 7965 722c 0a20 2020  r=dst_layer,.   
+00013690: 2020 2020 2073 7263 5f63 7273 3d73 7263       src_crs=src
+000136a0: 5f63 7273 2c0a 2020 2020 2020 2020 6473  _crs,.        ds
+000136b0: 745f 6372 733d 6473 745f 6372 732c 0a20  t_crs=dst_crs,. 
+000136c0: 2020 2020 2020 2077 6865 7265 3d77 6865         where=whe
+000136d0: 7265 2c0a 2020 2020 2020 2020 7265 7072  re,.        repr
+000136e0: 6f6a 6563 743d 7265 7072 6f6a 6563 742c  oject=reproject,
+000136f0: 0a20 2020 2020 2020 2065 7870 6c6f 6465  .        explode
+00013700: 636f 6c6c 6563 7469 6f6e 733d 6578 706c  collections=expl
+00013710: 6f64 6563 6f6c 6c65 6374 696f 6e73 2c0a  odecollections,.
+00013720: 2020 2020 2020 2020 666f 7263 655f 6f75          force_ou
+00013730: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
+00013740: 653d 666f 7263 655f 6f75 7470 7574 5f67  e=force_output_g
+00013750: 656f 6d65 7472 7974 7970 652c 0a20 2020  eometrytype,.   
+00013760: 2020 2020 2063 7265 6174 655f 7370 6174       create_spat
+00013770: 6961 6c5f 696e 6465 783d 6372 6561 7465  ial_index=create
+00013780: 5f73 7061 7469 616c 5f69 6e64 6578 2c0a  _spatial_index,.
+00013790: 2020 2020 2020 2020 7072 6573 6572 7665          preserve
+000137a0: 5f66 6964 3d70 7265 7365 7276 655f 6669  _fid=preserve_fi
+000137b0: 642c 0a20 2020 2020 2020 206f 7074 696f  d,.        optio
+000137c0: 6e73 3d6f 7074 696f 6e73 2c0a 2020 2020  ns=options,.    
+000137d0: 2020 2020 6170 7065 6e64 3d61 7070 656e      append=appen
+000137e0: 642c 0a20 2020 2020 2020 2066 6f72 6365  d,.        force
+000137f0: 3d66 6f72 6365 2c0a 2020 2020 290a 0a0a  =force,.    )...
+00013800: 6465 6620 636f 7079 5f6c 6179 6572 280a  def copy_layer(.
+00013810: 2020 2020 7372 633a 2055 6e69 6f6e 5b73      src: Union[s
+00013820: 7472 2c20 226f 732e 5061 7468 4c69 6b65  tr, "os.PathLike
+00013830: 5b41 6e79 5d22 5d2c 0a20 2020 2064 7374  [Any]"],.    dst
+00013840: 3a20 556e 696f 6e5b 7374 722c 2022 6f73  : Union[str, "os
+00013850: 2e50 6174 684c 696b 655b 416e 795d 225d  .PathLike[Any]"]
+00013860: 2c0a 2020 2020 7372 635f 6c61 7965 723a  ,.    src_layer:
+00013870: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00013880: 204e 6f6e 652c 0a20 2020 2064 7374 5f6c   None,.    dst_l
+00013890: 6179 6572 3a20 4f70 7469 6f6e 616c 5b73  ayer: Optional[s
+000138a0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+000138b0: 7372 635f 6372 733a 2055 6e69 6f6e 5b73  src_crs: Union[s
+000138c0: 7472 2c20 696e 742c 204e 6f6e 655d 203d  tr, int, None] =
+000138d0: 204e 6f6e 652c 0a20 2020 2064 7374 5f63   None,.    dst_c
+000138e0: 7273 3a20 556e 696f 6e5b 7374 722c 2069  rs: Union[str, i
+000138f0: 6e74 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65  nt, None] = None
+00013900: 2c0a 2020 2020 7768 6572 653a 204f 7074  ,.    where: Opt
+00013910: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00013920: 652c 0a20 2020 2072 6570 726f 6a65 6374  e,.    reproject
+00013930: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00013940: 2020 2020 6578 706c 6f64 6563 6f6c 6c65      explodecolle
+00013950: 6374 696f 6e73 3a20 626f 6f6c 203d 2046  ctions: bool = F
+00013960: 616c 7365 2c0a 2020 2020 666f 7263 655f  alse,.    force_
+00013970: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+00013980: 7970 653a 2055 6e69 6f6e 5b47 656f 6d65  ype: Union[Geome
+00013990: 7472 7954 7970 652c 2073 7472 2c20 4e6f  tryType, str, No
+000139a0: 6e65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ne] = None,.    
+000139b0: 6372 6561 7465 5f73 7061 7469 616c 5f69  create_spatial_i
+000139c0: 6e64 6578 3a20 4f70 7469 6f6e 616c 5b62  ndex: Optional[b
+000139d0: 6f6f 6c5d 203d 2054 7275 652c 0a20 2020  ool] = True,.   
+000139e0: 2070 7265 7365 7276 655f 6669 643a 204f   preserve_fid: O
+000139f0: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
+00013a00: 4e6f 6e65 2c0a 2020 2020 6f70 7469 6f6e  None,.    option
+00013a10: 733a 2064 6963 7420 3d20 7b7d 2c0a 2020  s: dict = {},.  
+00013a20: 2020 6170 7065 6e64 3a20 626f 6f6c 203d    append: bool =
+00013a30: 2046 616c 7365 2c0a 2020 2020 666f 7263   False,.    forc
+00013a40: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
+00013a50: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
+00013a60: 5265 6164 2061 206c 6179 6572 2066 726f  Read a layer fro
+00013a70: 6d20 6120 736f 7572 6365 2066 696c 6520  m a source file 
+00013a80: 616e 6420 7772 6974 6520 6974 2074 6f20  and write it to 
+00013a90: 6120 6e65 7720 6465 7374 696e 6174 696f  a new destinatio
+00013aa0: 6e20 6669 6c65 2e0a 0a20 2020 2054 7970  n file...    Typ
+00013ab0: 6963 616c 6c79 2075 7365 6420 746f 2063  ically used to c
+00013ac0: 6f6e 7665 7274 2066 726f 6d20 6f6e 6520  onvert from one 
+00013ad0: 6669 6c65 666f 726d 6174 2074 6f20 616e  fileformat to an
+00013ae0: 6f74 6865 7220 6f72 2074 6f20 7265 7072  other or to repr
+00013af0: 6f6a 6563 742e 0a0a 2020 2020 5468 6520  oject...    The 
+00013b00: 6f70 7469 6f6e 7320 7061 7261 6d65 7465  options paramete
+00013b10: 7220 6361 6e20 6265 2075 7365 6420 746f  r can be used to
+00013b20: 2070 6173 7320 616e 7920 7479 7065 206f   pass any type o
+00013b30: 6620 6f70 7469 6f6e 7320 746f 2047 4441  f options to GDA
+00013b40: 4c20 696e 0a20 2020 2074 6865 2066 6f6c  L in.    the fol
+00013b50: 6c6f 7769 6e67 2066 6f72 6d3a 0a20 2020  lowing form:.   
+00013b60: 2020 2020 207b 2022 3c6f 7074 696f 6e5f       { "<option_
+00013b70: 7479 7065 3e2e 3c6f 7074 696f 6e5f 6e61  type>.<option_na
+00013b80: 6d65 3e22 3a20 3c6f 7074 696f 6e5f 7661  me>": <option_va
+00013b90: 6c75 653e 207d 0a0a 2020 2020 5468 6520  lue> }..    The 
+00013ba0: 6f70 7469 6f6e 2074 7970 6573 2063 616e  option types can
+00013bb0: 2062 6520 616e 7920 6f66 2074 6865 2066   be any of the f
+00013bc0: 6f6c 6c6f 7769 6e67 3a0a 2020 2020 2020  ollowing:.      
+00013bd0: 2020 2d20 4c41 5945 525f 4352 4541 5449    - LAYER_CREATI
+00013be0: 4f4e 3a20 6c61 7965 7220 6372 6561 7469  ON: layer creati
+00013bf0: 6f6e 206f 7074 696f 6e20 286c 636f 290a  on option (lco).
+00013c00: 2020 2020 2020 2020 2d20 4441 5441 5345          - DATASE
+00013c10: 545f 4352 4541 5449 4f4e 3a20 6461 7461  T_CREATION: data
+00013c20: 7365 7420 6372 6561 7469 6f6e 206f 7074  set creation opt
+00013c30: 696f 6e20 2864 7363 6f29 0a20 2020 2020  ion (dsco).     
+00013c40: 2020 202d 2049 4e50 5554 5f4f 5045 4e3a     - INPUT_OPEN:
+00013c50: 2069 6e70 7574 2064 6174 6173 6574 206f   input dataset o
+00013c60: 7065 6e20 6f70 7469 6f6e 2028 6f6f 290a  pen option (oo).
+00013c70: 2020 2020 2020 2020 2d20 4445 5354 494e          - DESTIN
+00013c80: 4154 494f 4e5f 4f50 454e 3a20 6465 7374  ATION_OPEN: dest
+00013c90: 696e 6174 696f 6e20 6461 7461 7365 7420  ination dataset 
+00013ca0: 6f70 656e 206f 7074 696f 6e20 2864 6f6f  open option (doo
+00013cb0: 290a 2020 2020 2020 2020 2d20 434f 4e46  ).        - CONF
+00013cc0: 4947 3a20 636f 6e66 6967 206f 7074 696f  IG: config optio
+00013cd0: 6e20 2863 6f6e 6669 6729 0a0a 2020 2020  n (config)..    
+00013ce0: 5468 6520 6f70 7469 6f6e 7320 6361 6e20  The options can 
+00013cf0: 6265 2066 6f75 6e64 2069 6e20 7468 6520  be found in the 
+00013d00: 5b47 4441 4c20 7665 6374 6f72 2064 7269  [GDAL vector dri
+00013d10: 7665 7220 646f 6375 6d65 6e74 6174 696f  ver documentatio
+00013d20: 6e5d 0a20 2020 2028 6874 7470 733a 2f2f  n].    (https://
+00013d30: 6764 616c 2e6f 7267 2f64 7269 7665 7273  gdal.org/drivers
+00013d40: 2f76 6563 746f 722f 696e 6465 782e 6874  /vector/index.ht
+00013d50: 6d6c 292e 0a0a 2020 2020 4172 6773 3a0a  ml)...    Args:.
+00013d60: 2020 2020 2020 2020 7372 6320 2850 6174          src (Pat
+00013d70: 684c 696b 6529 3a20 5468 6520 736f 7572  hLike): The sour
+00013d80: 6365 2066 696c 6520 7061 7468 2e0a 2020  ce file path..  
+00013d90: 2020 2020 2020 6473 7420 2850 6174 684c        dst (PathL
+00013da0: 696b 6529 3a20 5468 6520 6465 7374 696e  ike): The destin
+00013db0: 6174 696f 6e20 6669 6c65 2070 6174 682e  ation file path.
+00013dc0: 0a20 2020 2020 2020 2073 7263 5f6c 6179  .        src_lay
+00013dd0: 6572 2028 7374 722c 206f 7074 696f 6e61  er (str, optiona
+00013de0: 6c29 3a20 5468 6520 736f 7572 6365 206c  l): The source l
+00013df0: 6179 6572 2e20 4966 204e 6f6e 6520 616e  ayer. If None an
+00013e00: 6420 7468 6572 6520 6973 206f 6e6c 790a  d there is only.
+00013e10: 2020 2020 2020 2020 2020 2020 6f6e 6520              one 
+00013e20: 6c61 7965 7220 696e 2074 6865 2073 7263  layer in the src
+00013e30: 2066 696c 652c 2074 6861 7420 6c61 7965   file, that laye
+00013e40: 7220 6973 2074 616b 656e 2e20 4465 6661  r is taken. Defa
+00013e50: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
+00013e60: 2020 2020 2020 6473 745f 6c61 7965 7220        dst_layer 
+00013e70: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
+00013e80: 2054 6865 2064 6573 7469 6e61 7469 6f6e   The destination
+00013e90: 206c 6179 6572 2e20 4966 204e 6f6e 652c   layer. If None,
+00013ea0: 2074 6865 2066 696c 650a 2020 2020 2020   the file.      
+00013eb0: 2020 2020 2020 7374 656d 2069 7320 7461        stem is ta
+00013ec0: 6b65 6e20 6173 206c 6179 6572 206e 616d  ken as layer nam
+00013ed0: 652e 2044 6566 6175 6c74 7320 746f 204e  e. Defaults to N
+00013ee0: 6f6e 652e 0a20 2020 2020 2020 2073 7263  one..        src
+00013ef0: 5f63 7273 2028 556e 696f 6e5b 7374 722c  _crs (Union[str,
+00013f00: 2069 6e74 5d2c 206f 7074 696f 6e61 6c29   int], optional)
+00013f10: 3a20 616e 2065 7073 6720 696e 7420 6f72  : an epsg int or
+00013f20: 2061 6e79 7468 696e 6720 7375 7070 6f72   anything suppor
+00013f30: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+00013f40: 6279 2074 6865 204f 4752 5370 6174 6961  by the OGRSpatia
+00013f50: 6c52 6566 6572 656e 6365 2e53 6574 4672  lReference.SetFr
+00013f60: 6f6d 5573 6572 496e 7075 7428 2920 6361  omUserInput() ca
+00013f70: 6c6c 2c20 7768 6963 6820 696e 636c 7564  ll, which includ
+00013f80: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
+00013f90: 6e20 4550 5347 2073 7472 696e 6720 2865  n EPSG string (e
+00013fa0: 672e 2022 4550 5347 3a34 3332 3622 292c  g. "EPSG:4326"),
+00013fb0: 2061 2077 656c 6c20 6b6e 6f77 6e20 7465   a well known te
+00013fc0: 7874 2028 574b 5429 2043 5253 0a20 2020  xt (WKT) CRS.   
+00013fd0: 2020 2020 2020 2020 2064 6566 696e 6974           definit
+00013fe0: 696f 6e2c 2e2e 2e20 4465 6661 756c 7473  ion,... Defaults
+00013ff0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+00014000: 2020 6473 745f 6372 7320 2855 6e69 6f6e    dst_crs (Union
+00014010: 5b73 7472 2c20 696e 745d 2c20 6f70 7469  [str, int], opti
+00014020: 6f6e 616c 293a 2061 6e20 6570 7367 2069  onal): an epsg i
+00014030: 6e74 206f 7220 616e 7974 6869 6e67 2073  nt or anything s
+00014040: 7570 706f 7274 6564 0a20 2020 2020 2020  upported.       
+00014050: 2020 2020 2062 7920 7468 6520 4f47 5253       by the OGRS
+00014060: 7061 7469 616c 5265 6665 7265 6e63 652e  patialReference.
+00014070: 5365 7446 726f 6d55 7365 7249 6e70 7574  SetFromUserInput
+00014080: 2829 2063 616c 6c2c 2077 6869 6368 2069  () call, which i
+00014090: 6e63 6c75 6465 730a 2020 2020 2020 2020  ncludes.        
+000140a0: 2020 2020 616e 2045 5053 4720 7374 7269      an EPSG stri
+000140b0: 6e67 2028 6567 2e20 2245 5053 473a 3433  ng (eg. "EPSG:43
+000140c0: 3236 2229 2c20 6120 7765 6c6c 206b 6e6f  26"), a well kno
+000140d0: 776e 2074 6578 7420 2857 4b54 2920 4352  wn text (WKT) CR
+000140e0: 530a 2020 2020 2020 2020 2020 2020 6465  S.            de
+000140f0: 6669 6e69 7469 6f6e 2c2e 2e2e 2044 6566  finition,... Def
+00014100: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
+00014110: 2020 2020 2020 2077 6865 7265 2028 7374         where (st
+00014120: 722c 206f 7074 696f 6e61 6c29 3a20 6f6e  r, optional): on
+00014130: 6c79 2061 7070 656e 6420 7468 6520 726f  ly append the ro
+00014140: 7773 2066 726f 6d20 7372 6320 7468 6174  ws from src that
+00014150: 2063 6f6d 706c 7920 746f 2074 6865 2066   comply to the f
+00014160: 696c 7465 720a 2020 2020 2020 2020 2020  ilter.          
+00014170: 2020 7370 6563 6966 6965 642e 2041 7070    specified. App
+00014180: 6c69 6564 2062 6566 6f72 6520 6578 706c  lied before expl
+00014190: 6f64 6563 6f6c 6c65 6374 696f 6e73 2e20  odecollections. 
+000141a0: 4669 6c74 6572 2073 686f 756c 6420 6265  Filter should be
+000141b0: 2069 6e20 7371 6c69 7465 0a20 2020 2020   in sqlite.     
+000141c0: 2020 2020 2020 2053 514c 2057 4845 5245         SQL WHERE
+000141d0: 2073 796e 7461 7820 616e 6420 7c73 7061   syntax and |spa
+000141e0: 7469 616c 6974 655f 7265 6665 7265 6e63  tialite_referenc
+000141f0: 655f 6c69 6e6b 7c20 6675 6e63 7469 6f6e  e_link| function
+00014200: 7320 6361 6e20 6265 2075 7365 642e 2049  s can be used. I
+00014210: 660a 2020 2020 2020 2020 2020 2020 7768  f.            wh
+00014220: 6572 6520 636f 6e74 6169 6e73 2074 6865  ere contains the
+00014230: 207b 6765 6f6d 6574 7279 636f 6c75 6d6e   {geometrycolumn
+00014240: 7d20 706c 6163 6568 6f6c 6465 722c 2069  } placeholder, i
+00014250: 7420 6973 2066 696c 6c65 6420 6f75 7420  t is filled out 
+00014260: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
+00014270: 2020 2020 2067 656f 6d65 7472 7920 636f       geometry co
+00014280: 6c75 6d6e 206e 616d 6520 6f66 2074 6865  lumn name of the
+00014290: 2073 7263 2066 696c 652e 2044 6566 6175   src file. Defau
+000142a0: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+000142b0: 2020 2020 2072 6570 726f 6a65 6374 2028       reproject (
+000142c0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+000142d0: 2054 7275 6520 746f 2072 6570 726f 6a65   True to reproje
+000142e0: 6374 2077 6869 6c65 2063 6f6e 7665 7274  ct while convert
+000142f0: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
+00014300: 2020 2020 6669 6c65 2e20 4465 6661 756c      file. Defaul
+00014310: 7473 2074 6f20 4661 6c73 652e 0a20 2020  ts to False..   
+00014320: 2020 2020 2065 7870 6c6f 6465 636f 6c6c       explodecoll
+00014330: 6563 7469 6f6e 7320 2862 6f6f 6c2c 206f  ections (bool, o
+00014340: 7074 696f 6e61 6c29 3a20 5472 7565 2074  ptional): True t
+00014350: 6f20 6f75 7470 7574 206f 6e6c 7920 7369  o output only si
+00014360: 6d70 6c65 0a20 2020 2020 2020 2020 2020  mple.           
+00014370: 2067 656f 6d65 7472 6965 732e 2044 6566   geometries. Def
+00014380: 6175 6c74 7320 746f 2046 616c 7365 2e0a  aults to False..
+00014390: 2020 2020 2020 2020 666f 7263 655f 6f75          force_ou
+000143a0: 7470 7574 5f67 656f 6d65 7472 7974 7970  tput_geometrytyp
+000143b0: 6520 2855 6e69 6f6e 5b47 656f 6d65 7472  e (Union[Geometr
+000143c0: 7954 7970 652c 2073 7472 5d2c 206f 7074  yType, str], opt
+000143d0: 696f 6e61 6c29 3a20 4765 6f6d 6574 7279  ional): Geometry
+000143e0: 2074 7970 652e 0a20 2020 2020 2020 2020   type..         
+000143f0: 2020 2074 6f20 2874 7279 2074 6f29 2066     to (try to) f
+00014400: 6f72 6365 2074 6865 206f 7574 7075 7420  orce the output 
+00014410: 746f 2e20 4465 6661 756c 7473 2074 6f20  to. Defaults to 
+00014420: 4e6f 6e65 2e0a 2020 2020 2020 2020 6372  None..        cr
+00014430: 6561 7465 5f73 7061 7469 616c 5f69 6e64  eate_spatial_ind
+00014440: 6578 2028 626f 6f6c 2c20 6f70 7469 6f6e  ex (bool, option
+00014450: 616c 293a 2054 7275 6520 746f 2063 7265  al): True to cre
+00014460: 6174 6520 6120 7370 6174 6961 6c20 696e  ate a spatial in
+00014470: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
+00014480: 6f6e 2074 6865 2064 6573 7469 6e61 7469  on the destinati
+00014490: 6f6e 2066 696c 652f 6c61 7965 722e 2049  on file/layer. I
+000144a0: 6620 4e6f 6e65 2c20 7468 6520 6465 6661  f None, the defa
+000144b0: 756c 7420 6265 6861 7669 6f75 7220 6279  ult behaviour by
+000144c0: 2067 6461 6c20 666f 720a 2020 2020 2020   gdal for.      
+000144d0: 2020 2020 2020 7468 6174 2066 696c 6520        that file 
+000144e0: 7479 7065 2069 7320 7265 7370 6563 7465  type is respecte
+000144f0: 642e 2049 6620 7468 6520 4c41 5945 525f  d. If the LAYER_
+00014500: 4352 4541 5449 4f4e 2e53 5041 5449 414c  CREATION.SPATIAL
+00014510: 5f49 4e44 4558 0a20 2020 2020 2020 2020  _INDEX.         
+00014520: 2020 2070 6172 616d 6574 6572 2069 7320     parameter is 
+00014530: 7370 6563 6966 6965 6420 696e 206f 7074  specified in opt
+00014540: 696f 6e73 2c20 6372 6561 7465 5f73 7061  ions, create_spa
+00014550: 7469 616c 5f69 6e64 6578 2069 7320 6967  tial_index is ig
+00014560: 6e6f 7265 642e 0a20 2020 2020 2020 2020  nored..         
+00014570: 2020 2044 6566 6175 6c74 7320 746f 2054     Defaults to T
+00014580: 7275 652e 0a20 2020 2020 2020 2070 7265  rue..        pre
+00014590: 7365 7276 655f 6669 6420 2862 6f6f 6c2c  serve_fid (bool,
+000145a0: 206f 7074 696f 6e61 6c29 3a20 5472 7565   optional): True
+000145b0: 2074 6f20 6d61 6b65 2061 6e20 6578 7472   to make an extr
+000145c0: 6120 6566 666f 7274 2074 6f20 7072 6573  a effort to pres
+000145d0: 6572 7665 2066 6964 2773 206f 660a 2020  erve fid's of.  
+000145e0: 2020 2020 2020 2020 2020 7468 6520 736f            the so
+000145f0: 7572 6365 206c 6179 6572 2074 6f20 7468  urce layer to th
+00014600: 6520 6465 7374 696e 6174 696f 6e20 6c61  e destination la
+00014610: 7965 722e 2046 616c 7365 206e 6f74 2074  yer. False not t
+00014620: 6f20 646f 2061 6e79 2065 6666 6f72 742e  o do any effort.
+00014630: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00014640: 2020 746f 2075 7365 2074 6865 2064 6566    to use the def
+00014650: 6175 6c74 2062 6568 6176 696f 7572 206f  ault behaviour o
+00014660: 6620 6764 616c 2c20 7468 6174 2061 6c72  f gdal, that alr
+00014670: 6561 6479 2070 7265 7365 7276 6573 2069  eady preserves i
+00014680: 6e20 736f 6d65 2063 6173 6573 2e0a 2020  n some cases..  
+00014690: 2020 2020 2020 2020 2020 536f 6d65 2066            Some f
+000146a0: 696c 6520 666f 726d 6174 7320 646f 6e27  ile formats don'
+000146b0: 7420 6578 706c 6963 6974 6c79 2073 746f  t explicitly sto
+000146c0: 7265 2074 6865 2066 6964 2028 652e 672e  re the fid (e.g.
+000146d0: 2073 6861 7065 6669 6c65 292c 2073 6f20   shapefile), so 
+000146e0: 7468 6579 0a20 2020 2020 2020 2020 2020  they.           
+000146f0: 2077 696c 6c20 6e65 7665 7220 6265 2061   will never be a
+00014700: 626c 6520 746f 2070 7265 7365 7276 6520  ble to preserve 
+00014710: 6669 6473 2e20 4465 6661 756c 7473 2074  fids. Defaults t
+00014720: 6f20 4e6f 6e65 2e0a 2020 2020 2020 2020  o None..        
+00014730: 6f70 7469 6f6e 7320 2864 6963 742c 206f  options (dict, o
+00014740: 7074 696f 6e61 6c29 3a20 6f70 7469 6f6e  ptional): option
+00014750: 7320 746f 2070 6173 7320 746f 2067 6461  s to pass to gda
+00014760: 6c2e 0a20 2020 2020 2020 2061 7070 656e  l..        appen
+00014770: 6420 2862 6f6f 6c2c 206f 7074 696f 6e61  d (bool, optiona
+00014780: 6c29 3a20 5472 7565 2074 6f20 6170 7065  l): True to appe
+00014790: 6e64 2074 6f20 7468 6520 6f75 7470 7574  nd to the output
+000147a0: 2066 696c 6520 6966 2069 7420 6578 6973   file if it exis
+000147b0: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+000147c0: 4465 6661 756c 7473 2074 6f20 4661 6c73  Defaults to Fals
+000147d0: 652e 0a20 2020 2020 2020 2066 6f72 6365  e..        force
+000147e0: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
+000147f0: 293a 206f 7665 7277 7269 7465 2065 7869  ): overwrite exi
+00014800: 7374 696e 6720 6f75 7470 7574 2066 696c  sting output fil
+00014810: 6528 7329 0a20 2020 2020 2020 2020 2020  e(s).           
+00014820: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
+00014830: 7365 2e0a 0a20 2020 202e 2e20 7c73 7061  se...    .. |spa
+00014840: 7469 616c 6974 655f 7265 6665 7265 6e63  tialite_referenc
+00014850: 655f 6c69 6e6b 7c20 7261 773a 3a20 6874  e_link| raw:: ht
+00014860: 6d6c 0a0a 2020 2020 2020 2020 3c61 2068  ml..        <a h
+00014870: 7265 663d 2268 7474 7073 3a2f 2f77 7777  ref="https://www
+00014880: 2e67 6169 612d 6769 732e 6974 2f67 6169  .gaia-gis.it/gai
+00014890: 612d 7369 6e73 2f73 7061 7469 616c 6974  a-sins/spatialit
+000148a0: 652d 7371 6c2d 6c61 7465 7374 2e68 746d  e-sql-latest.htm
+000148b0: 6c22 2074 6172 6765 743d 225f 626c 616e  l" target="_blan
+000148c0: 6b22 3e73 7061 7469 616c 6974 6520 7265  k">spatialite re
+000148d0: 6665 7265 6e63 653c 2f61 3e0a 0a20 2020  ference</a>..   
+000148e0: 2022 2222 2020 2320 6e6f 7161 3a20 4535   """  # noqa: E5
+000148f0: 3031 0a20 2020 2023 2049 6e69 740a 2020  01.    # Init.  
+00014900: 2020 7372 6320 3d20 5061 7468 2873 7263    src = Path(src
+00014910: 290a 2020 2020 6473 7420 3d20 5061 7468  ).    dst = Path
+00014920: 2864 7374 290a 0a20 2020 2023 2049 6620  (dst)..    # If 
+00014930: 736f 7572 6365 2066 696c 6520 646f 6573  source file does
+00014940: 6e27 7420 6578 6973 742c 2072 6169 7365  n't exist, raise
+00014950: 2065 7272 6f72 0a20 2020 2069 6620 6e6f   error.    if no
+00014960: 7420 7372 632e 6578 6973 7473 2829 3a0a  t src.exists():.
+00014970: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00014980: 6c75 6545 7272 6f72 2866 2273 7263 2066  lueError(f"src f
+00014990: 696c 6520 646f 6573 6e27 7420 6578 6973  ile doesn't exis
+000149a0: 743a 207b 7372 637d 2229 0a20 2020 2023  t: {src}").    #
+000149b0: 2049 6620 6465 7374 2066 696c 6520 6578   If dest file ex
+000149c0: 6973 7473 2061 6c72 6561 6479 2061 6e64  ists already and
+000149d0: 206e 6f20 6170 7065 6e64 0a20 2020 2069   no append.    i
+000149e0: 6620 6e6f 7420 6170 7065 6e64 2061 6e64  f not append and
+000149f0: 2064 7374 2e65 7869 7374 7328 293a 0a20   dst.exists():. 
+00014a00: 2020 2020 2020 2069 6620 666f 7263 6520         if force 
+00014a10: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+00014a20: 2020 2020 2072 656d 6f76 6528 6473 7429       remove(dst)
+00014a30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00014a40: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00014a50: 722e 696e 666f 2866 224f 7574 7075 7420  r.info(f"Output 
+00014a60: 6669 6c65 2065 7869 7374 7320 616c 7265  file exists alre
+00014a70: 6164 792c 2073 6f20 7374 6f70 3a20 7b64  ady, so stop: {d
+00014a80: 7374 7d22 290a 2020 2020 2020 2020 2020  st}").          
+00014a90: 2020 7265 7475 726e 0a0a 2020 2020 2320    return..    # 
+00014aa0: 436f 6e76 6572 740a 2020 2020 6c6f 6767  Convert.    logg
+00014ab0: 6572 2e69 6e66 6f28 6622 436f 6e76 6572  er.info(f"Conver
+00014ac0: 7420 7b73 7263 7d20 746f 207b 6473 747d  t {src} to {dst}
+00014ad0: 2229 0a20 2020 205f 6170 7065 6e64 5f74  ").    _append_t
+00014ae0: 6f5f 6e6f 6c6f 636b 280a 2020 2020 2020  o_nolock(.      
+00014af0: 2020 7372 632c 0a20 2020 2020 2020 2064    src,.        d
+00014b00: 7374 2c0a 2020 2020 2020 2020 7372 635f  st,.        src_
+00014b10: 6c61 7965 722c 0a20 2020 2020 2020 2064  layer,.        d
+00014b20: 7374 5f6c 6179 6572 2c0a 2020 2020 2020  st_layer,.      
+00014b30: 2020 7372 635f 6372 733d 7372 635f 6372    src_crs=src_cr
+00014b40: 732c 0a20 2020 2020 2020 2064 7374 5f63  s,.        dst_c
+00014b50: 7273 3d64 7374 5f63 7273 2c0a 2020 2020  rs=dst_crs,.    
+00014b60: 2020 2020 7768 6572 653d 7768 6572 652c      where=where,
+00014b70: 0a20 2020 2020 2020 2072 6570 726f 6a65  .        reproje
+00014b80: 6374 3d72 6570 726f 6a65 6374 2c0a 2020  ct=reproject,.  
+00014b90: 2020 2020 2020 6578 706c 6f64 6563 6f6c        explodecol
+00014ba0: 6c65 6374 696f 6e73 3d65 7870 6c6f 6465  lections=explode
+00014bb0: 636f 6c6c 6563 7469 6f6e 732c 0a20 2020  collections,.   
+00014bc0: 2020 2020 2066 6f72 6365 5f6f 7574 7075       force_outpu
+00014bd0: 745f 6765 6f6d 6574 7279 7479 7065 3d66  t_geometrytype=f
+00014be0: 6f72 6365 5f6f 7574 7075 745f 6765 6f6d  orce_output_geom
+00014bf0: 6574 7279 7479 7065 2c0a 2020 2020 2020  etrytype,.      
+00014c00: 2020 6372 6561 7465 5f73 7061 7469 616c    create_spatial
+00014c10: 5f69 6e64 6578 3d63 7265 6174 655f 7370  _index=create_sp
+00014c20: 6174 6961 6c5f 696e 6465 782c 0a20 2020  atial_index,.   
+00014c30: 2020 2020 2070 7265 7365 7276 655f 6669       preserve_fi
+00014c40: 643d 7072 6573 6572 7665 5f66 6964 2c0a  d=preserve_fid,.
+00014c50: 2020 2020 2020 2020 6f70 7469 6f6e 733d          options=
+00014c60: 6f70 7469 6f6e 732c 0a20 2020 2029 0a0a  options,.    )..
+00014c70: 0a64 6566 205f 6c61 756e 6465 725f 636f  .def _launder_co
+00014c80: 6c75 6d6e 5f6e 616d 6573 2863 6f6c 756d  lumn_names(colum
+00014c90: 6e73 3a20 4974 6572 6162 6c65 2920 2d3e  ns: Iterable) ->
+00014ca0: 204c 6973 745b 5475 706c 655b 7374 722c   List[Tuple[str,
+00014cb0: 2073 7472 5d5d 3a0a 2020 2020 2222 220a   str]]:.    """.
+00014cc0: 2020 2020 4c61 756e 6465 7273 2074 6865      Launders the
+00014cd0: 2063 6f6c 756d 6e20 6e61 6d65 7320 7061   column names pa
+00014ce0: 7373 6564 2074 6f20 636f 6d70 6c79 2077  ssed to comply w
+00014cf0: 6974 6820 7368 6170 6566 696c 6520 7265  ith shapefile re
+00014d00: 7374 7269 6374 696f 6e73 2e0a 0a20 2020  strictions...   
+00014d10: 2052 6174 696f 6e61 6c65 3a20 6e6f 726d   Rationale: norm
+00014d20: 616c 6c79 2067 6461 6c20 6c61 756e 6465  ally gdal launde
+00014d30: 7273 2074 6865 6d20 6966 206e 6565 6465  rs them if neede
+00014d40: 642c 2062 7574 2077 6865 6e20 796f 7520  d, but when you 
+00014d50: 6170 7065 6e64 0a20 2020 206d 756c 7469  append.    multi
+00014d60: 706c 6520 6669 6c65 7320 746f 2061 2073  ple files to a s
+00014d70: 6861 7065 6669 6c65 2077 6974 6820 636f  hapefile with co
+00014d80: 6c75 6d6e 7320 7468 6174 206e 6565 6420  lumns that need 
+00014d90: 746f 2062 6520 6c61 756e 6465 7265 640a  to be laundered.
+00014da0: 2020 2020 7468 6579 2061 7265 206e 6f74      they are not
+00014db0: 206d 6174 6368 6564 2061 6e64 2073 6f20   matched and so 
+00014dc0: 6172 6520 6170 7065 6e64 6564 2077 6974  are appended wit
+00014dd0: 6820 4e55 4c4c 2076 616c 7565 7320 666f  h NULL values fo
+00014de0: 7220 7468 6573 650a 2020 2020 636f 6c75  r these.    colu
+00014df0: 6d6e 732e 204e 6f72 6d61 6c6c 7920 7468  mns. Normally th
+00014e00: 6520 2d72 656c 6178 6564 4669 656c 644e  e -relaxedFieldN
+00014e10: 616d 654d 6174 6368 2070 6172 616d 6574  ameMatch paramet
+00014e20: 6572 2069 6e20 6f67 7232 6f67 720a 2020  er in ogr2ogr.  
+00014e30: 2020 7368 6f75 6c64 2066 6978 2074 6869    should fix thi
+00014e40: 732c 2062 7574 2069 7420 7365 656d 7320  s, but it seems 
+00014e50: 7468 6174 2074 6869 7320 6973 6e27 7420  that this isn't 
+00014e60: 7375 7070 6f72 7465 6420 666f 7220 7368  supported for sh
+00014e70: 6170 6566 696c 6573 2e0a 0a20 2020 204c  apefiles...    L
+00014e80: 6175 6e64 6572 696e 6720 6973 2062 6173  aundering is bas
+00014e90: 6564 206f 6e20 7468 6973 2074 6578 7420  ed on this text 
+00014ea0: 6672 6f6d 2074 6865 2067 6461 6c20 7368  from the gdal sh
+00014eb0: 6170 6566 696c 6520 6472 6976 6572 0a20  apefile driver. 
+00014ec0: 2020 2064 6f63 756d 656e 7461 7469 6f6e     documentation
+00014ed0: 3a0a 0a20 2020 2053 6861 7065 6669 6c65  :..    Shapefile
+00014ee0: 2066 6561 7475 7265 2061 7474 7269 6275   feature attribu
+00014ef0: 7465 7320 6172 6520 7374 6f72 6564 2069  tes are stored i
+00014f00: 6e20 616e 2061 7373 6f63 6961 7465 6420  n an associated 
+00014f10: 2e64 6266 2066 696c 652c 2061 6e64 0a20  .dbf file, and. 
+00014f20: 2020 2073 6f20 6174 7472 6962 7574 6573     so attributes
+00014f30: 2073 7566 6665 7220 6120 6e75 6d62 6572   suffer a number
+00014f40: 206f 6620 6c69 6d69 7461 7469 6f6e 733a   of limitations:
+00014f50: 0a20 2020 202d 2020 2041 7474 7269 6275  .    -   Attribu
+00014f60: 7465 206e 616d 6573 2063 616e 206f 6e6c  te names can onl
+00014f70: 7920 6265 2075 7020 746f 2031 3020 6368  y be up to 10 ch
+00014f80: 6172 6163 7465 7273 206c 6f6e 672e 0a20  aracters long.. 
+00014f90: 2020 2020 2020 2054 6865 204f 4752 2053         The OGR S
+00014fa0: 6861 7065 6669 6c65 2064 7269 7665 7220  hapefile driver 
+00014fb0: 7472 6965 7320 746f 2067 656e 6572 6174  tries to generat
+00014fc0: 6520 756e 6971 7565 2066 6965 6c64 0a20  e unique field. 
+00014fd0: 2020 2020 2020 206e 616d 6573 2e20 5375         names. Su
+00014fe0: 6363 6573 7369 7665 2064 7570 6c69 6361  ccessive duplica
+00014ff0: 7465 2066 6965 6c64 206e 616d 6573 2c20  te field names, 
+00015000: 696e 636c 7564 696e 6720 7468 6f73 6520  including those 
+00015010: 6372 6561 7465 6420 6279 0a20 2020 2020  created by.     
+00015020: 2020 2074 7275 6e63 6174 696f 6e20 746f     truncation to
+00015030: 2031 3020 6368 6172 6163 7465 7273 2c20   10 characters, 
+00015040: 7769 6c6c 2062 6520 7472 756e 6361 7465  will be truncate
+00015050: 6420 746f 2038 2063 6861 7261 6374 6572  d to 8 character
+00015060: 7320 616e 640a 2020 2020 2020 2020 6170  s and.        ap
+00015070: 7065 6e64 6564 2077 6974 6820 6120 7365  pended with a se
+00015080: 7269 616c 206e 756d 6265 7220 6672 6f6d  rial number from
+00015090: 2031 2074 6f20 3939 2e0a 0a20 2020 2020   1 to 99...     
+000150a0: 2020 2046 6f72 2065 7861 6d70 6c65 3a0a     For example:.
+000150b0: 0a20 2020 2020 2020 202d 2020 6120 e286  .        -  a ..
+000150c0: 9220 612c 2061 20e2 8692 2061 5f31 2c20  . a, a ... a_1, 
+000150d0: 4120 e286 9220 415f 323b 0a20 2020 2020  A ... A_2;.     
+000150e0: 2020 202d 2020 6162 6364 6566 6768 696a     -  abcdefghij
+000150f0: 6b20 e286 9220 6162 6364 6566 6768 696a  k ... abcdefghij
+00015100: 2c20 6162 6364 6566 6768 696a 6b6c 20e2  , abcdefghijkl .
+00015110: 8692 2061 6263 6465 6667 685f 310a 0a20  .. abcdefgh_1.. 
+00015120: 2020 202d 2020 204f 6e6c 7920 496e 7465     -   Only Inte
+00015130: 6765 722c 2049 6e74 6567 6572 3634 2c20  ger, Integer64, 
+00015140: 5265 616c 2c20 5374 7269 6e67 2061 6e64  Real, String and
+00015150: 2044 6174 6520 286e 6f74 2044 6174 6554   Date (not DateT
+00015160: 696d 652c 206a 7573 740a 2020 2020 2020  ime, just.      
+00015170: 2020 7965 6172 2f6d 6f6e 7468 2f64 6179    year/month/day
+00015180: 2920 6669 656c 6420 7479 7065 7320 6172  ) field types ar
+00015190: 6520 7375 7070 6f72 7465 642e 2054 6865  e supported. The
+000151a0: 2076 6172 696f 7573 206c 6973 742c 2061   various list, a
+000151b0: 6e64 0a20 2020 2020 2020 2062 696e 6172  nd.        binar
+000151c0: 7920 6669 656c 6420 7479 7065 7320 6361  y field types ca
+000151d0: 6e6e 6f74 2062 6520 6372 6561 7465 642e  nnot be created.
+000151e0: 0a20 2020 202d 2020 2054 6865 2066 6965  .    -   The fie
+000151f0: 6c64 2077 6964 7468 2061 6e64 2070 7265  ld width and pre
+00015200: 6369 7369 6f6e 2061 7265 2064 6972 6563  cision are direc
+00015210: 746c 7920 7573 6564 2074 6f20 6573 7461  tly used to esta
+00015220: 626c 6973 6820 7374 6f72 6167 650a 2020  blish storage.  
+00015230: 2020 2020 2020 7369 7a65 2069 6e20 7468        size in th
+00015240: 6520 2e64 6266 2066 696c 652e 2054 6869  e .dbf file. Thi
+00015250: 7320 6d65 616e 7320 7468 6174 2073 7472  s means that str
+00015260: 696e 6773 206c 6f6e 6765 7220 7468 616e  ings longer than
+00015270: 2074 6865 2066 6965 6c64 0a20 2020 2020   the field.     
+00015280: 2020 2077 6964 7468 2c20 6f72 206e 756d     width, or num
+00015290: 6265 7273 2074 6861 7420 646f 6e27 7420  bers that don't 
+000152a0: 6669 7420 696e 746f 2074 6865 2069 6e64  fit into the ind
+000152b0: 6963 6174 6564 2066 6965 6c64 2066 6f72  icated field for
+000152c0: 6d61 7420 7769 6c6c 0a20 2020 2020 2020  mat will.       
+000152d0: 2073 7566 6665 7220 7472 756e 6361 7469   suffer truncati
+000152e0: 6f6e 2e0a 2020 2020 2d20 2020 496e 7465  on..    -   Inte
+000152f0: 6765 7220 6669 656c 6473 2077 6974 686f  ger fields witho
+00015300: 7574 2061 6e20 6578 706c 6963 6974 2077  ut an explicit w
+00015310: 6964 7468 2061 7265 2074 7265 6174 6564  idth are treated
+00015320: 2061 7320 7769 6474 6820 392c 2061 6e64   as width 9, and
+00015330: 0a20 2020 2020 2020 2065 7874 656e 6465  .        extende
+00015340: 6420 746f 2031 3020 6f72 2031 3120 6966  d to 10 or 11 if
+00015350: 206e 6565 6465 642e 0a20 2020 202d 2020   needed..    -  
+00015360: 2049 6e74 6567 6572 3634 2066 6965 6c64   Integer64 field
+00015370: 7320 7769 7468 6f75 7420 616e 2065 7870  s without an exp
+00015380: 6c69 6369 7420 7769 6474 6820 6172 6520  licit width are 
+00015390: 7472 6561 7465 6420 6173 2077 6964 7468  treated as width
+000153a0: 2031 382c 0a20 2020 2020 2020 2061 6e64   18,.        and
+000153b0: 2065 7874 656e 6465 6420 746f 2031 3920   extended to 19 
+000153c0: 6f72 2032 3020 6966 206e 6565 6465 642e  or 20 if needed.
+000153d0: 0a20 2020 202d 2020 2052 6561 6c20 2866  .    -   Real (f
+000153e0: 6c6f 6174 696e 6720 706f 696e 7429 2066  loating point) f
+000153f0: 6965 6c64 7320 7769 7468 6f75 7420 616e  ields without an
+00015400: 2065 7870 6c69 6369 7420 7769 6474 6820   explicit width 
+00015410: 6172 6520 7472 6561 7465 6420 6173 0a20  are treated as. 
+00015420: 2020 2020 2020 2077 6964 7468 2032 3420         width 24 
+00015430: 7769 7468 2031 3520 6465 6369 6d61 6c20  with 15 decimal 
+00015440: 706c 6163 6573 206f 6620 7072 6563 6973  places of precis
+00015450: 696f 6e2e 0a20 2020 202d 2020 2053 7472  ion..    -   Str
+00015460: 696e 6720 6669 656c 6473 2077 6974 686f  ing fields witho
+00015470: 7574 2061 6e20 6173 7369 676e 6564 2077  ut an assigned w
+00015480: 6964 7468 2061 7265 2074 7265 6174 6564  idth are treated
+00015490: 2061 7320 3830 2063 6861 7261 6374 6572   as 80 character
+000154a0: 732e 0a0a 2020 2020 4172 6773 3a0a 2020  s...    Args:.  
+000154b0: 2020 2020 2020 636f 6c75 6d6e 7320 2849        columns (I
+000154c0: 7465 7261 626c 6529 3a20 7468 6520 636f  terable): the co
+000154d0: 6c75 6d6e 7320 746f 206c 6175 6e64 6572  lumns to launder
+000154e0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a20  ...    Returns: 
+000154f0: 6120 4c69 7374 206f 6620 7475 7070 6c65  a List of tupple
+00015500: 7320 7769 7468 2074 6865 206f 7269 6769  s with the origi
+00015510: 6e61 6c20 616e 6420 6c61 756e 6465 7265  nal and laundere
+00015520: 6420 636f 6c75 6d6e 206e 616d 6573 2e0a  d column names..
+00015530: 2020 2020 2222 220a 2020 2020 6c61 756e      """.    laun
+00015540: 6465 7265 6420 3d20 5b5d 0a20 2020 206c  dered = [].    l
+00015550: 6175 6e64 6572 6564 5f75 7070 6572 203d  aundered_upper =
+00015560: 205b 5d0a 2020 2020 666f 7220 636f 6c75   [].    for colu
+00015570: 6d6e 2069 6e20 636f 6c75 6d6e 733a 0a20  mn in columns:. 
+00015580: 2020 2020 2020 2023 2044 6f75 626c 6573         # Doubles
+00015590: 2069 6e20 6361 7369 6e67 2061 7265 6520   in casing aree 
+000155a0: 6e6f 7420 616c 6c6f 7765 6420 6569 7468  not allowed eith
+000155b0: 6572 0a20 2020 2020 2020 2069 6620 6c65  er.        if le
+000155c0: 6e28 636f 6c75 6d6e 2920 3c3d 2031 303a  n(column) <= 10:
+000155d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000155e0: 636f 6c75 6d6e 2e75 7070 6572 2829 206e  column.upper() n
+000155f0: 6f74 2069 6e20 6c61 756e 6465 7265 645f  ot in laundered_
+00015600: 7570 7065 723a 0a20 2020 2020 2020 2020  upper:.         
+00015610: 2020 2020 2020 206c 6175 6e64 6572 6564         laundered
+00015620: 5f75 7070 6572 2e61 7070 656e 6428 636f  _upper.append(co
+00015630: 6c75 6d6e 2e75 7070 6572 2829 290a 2020  lumn.upper()).  
+00015640: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00015650: 756e 6465 7265 642e 6170 7065 6e64 2828  undered.append((
+00015660: 636f 6c75 6d6e 2c20 636f 6c75 6d6e 2929  column, column))
+00015670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015680: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+00015690: 2020 2023 204c 6175 6e64 6572 696e 6720     # Laundering 
+000156a0: 6973 206e 6565 6465 640a 2020 2020 2020  is needed.      
+000156b0: 2020 636f 6c75 6d6e 5f6c 6175 6e64 6572    column_launder
+000156c0: 6564 203d 2063 6f6c 756d 6e5b 3a31 305d  ed = column[:10]
+000156d0: 0a20 2020 2020 2020 2069 6620 636f 6c75  .        if colu
+000156e0: 6d6e 5f6c 6175 6e64 6572 6564 2e75 7070  mn_laundered.upp
+000156f0: 6572 2829 206e 6f74 2069 6e20 6c61 756e  er() not in laun
+00015700: 6465 7265 645f 7570 7065 723a 0a20 2020  dered_upper:.   
+00015710: 2020 2020 2020 2020 206c 6175 6e64 6572           launder
+00015720: 6564 5f75 7070 6572 2e61 7070 656e 6428  ed_upper.append(
+00015730: 636f 6c75 6d6e 5f6c 6175 6e64 6572 6564  column_laundered
+00015740: 2e75 7070 6572 2829 290a 2020 2020 2020  .upper()).      
+00015750: 2020 2020 2020 6c61 756e 6465 7265 642e        laundered.
+00015760: 6170 7065 6e64 2828 636f 6c75 6d6e 2c20  append((column, 
 00015770: 636f 6c75 6d6e 5f6c 6175 6e64 6572 6564  column_laundered
-00015780: 5b3a 385d 7d5f 7b69 6e64 6578 7d22 0a20  [:8]}_{index}". 
-00015790: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000157a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000157b0: 2020 2020 2020 2020 2063 6f6c 756d 6e5f           column_
-000157c0: 6c61 756e 6465 7265 6420 3d20 6622 7b63  laundered = f"{c
-000157d0: 6f6c 756d 6e5f 6c61 756e 6465 7265 645b  olumn_laundered[
-000157e0: 3a38 5d7d 7b69 6e64 6578 7d22 0a20 2020  :8]}{index}".   
-000157f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015800: 636f 6c75 6d6e 5f6c 6175 6e64 6572 6564  column_laundered
-00015810: 2e75 7070 6572 2829 206e 6f74 2069 6e20  .upper() not in 
-00015820: 6c61 756e 6465 7265 645f 7570 7065 723a  laundered_upper:
-00015830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015840: 2020 2020 206c 6175 6e64 6572 6564 5f75       laundered_u
-00015850: 7070 6572 2e61 7070 656e 6428 636f 6c75  pper.append(colu
-00015860: 6d6e 5f6c 6175 6e64 6572 6564 2e75 7070  mn_laundered.upp
-00015870: 6572 2829 290a 2020 2020 2020 2020 2020  er()).          
-00015880: 2020 2020 2020 2020 2020 6c61 756e 6465            launde
-00015890: 7265 642e 6170 7065 6e64 2828 636f 6c75  red.append((colu
-000158a0: 6d6e 2c20 636f 6c75 6d6e 5f6c 6175 6e64  mn, column_laund
-000158b0: 6572 6564 2929 0a20 2020 2020 2020 2020  ered)).         
-000158c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000158d0: 0a0a 2020 2020 7265 7475 726e 206c 6175  ..    return lau
-000158e0: 6e64 6572 6564 0a                        ndered.
+00015780: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
+00015790: 0a20 2020 2020 2020 2020 2020 2023 204a  .            # J
+000157a0: 7573 7420 7461 6b69 6e67 2066 6972 7374  ust taking first
+000157b0: 2031 3020 6368 6172 6163 7465 7273 2064   10 characters d
+000157c0: 6964 6e27 7420 6865 6c70 0a20 2020 2020  idn't help.     
+000157d0: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
+000157e0: 2069 6e20 7261 6e67 6528 312c 2031 3031   in range(1, 101
+000157f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00015800: 2020 2069 6620 696e 6465 7820 3e3d 2031     if index >= 1
+00015810: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
+00015820: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+00015830: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+00015840: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00015850: 2020 2020 2020 2020 2020 2022 4e6f 7420             "Not 
+00015860: 7375 7070 6f72 7465 6420 746f 206c 6175  supported to lau
+00015870: 6e64 6572 203e 2039 3920 636f 6c75 6d6e  nder > 99 column
+00015880: 7320 7374 6172 7469 6e67 2022 0a20 2020  s starting ".   
+00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158a0: 2020 2020 2066 2277 6974 6820 7b63 6f6c       f"with {col
+000158b0: 756d 6e5f 6c61 756e 6465 7265 645b 3a38  umn_laundered[:8
+000158c0: 5d7d 220a 2020 2020 2020 2020 2020 2020  ]}".            
+000158d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000158e0: 2020 2020 2020 2020 2020 6966 2069 6e64            if ind
+000158f0: 6578 203c 3d20 393a 0a20 2020 2020 2020  ex <= 9:.       
+00015900: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00015910: 756d 6e5f 6c61 756e 6465 7265 6420 3d20  umn_laundered = 
+00015920: 6622 7b63 6f6c 756d 6e5f 6c61 756e 6465  f"{column_launde
+00015930: 7265 645b 3a38 5d7d 5f7b 696e 6465 787d  red[:8]}_{index}
+00015940: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00015950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015960: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00015970: 6d6e 5f6c 6175 6e64 6572 6564 203d 2066  mn_laundered = f
+00015980: 227b 636f 6c75 6d6e 5f6c 6175 6e64 6572  "{column_launder
+00015990: 6564 5b3a 385d 7d7b 696e 6465 787d 220a  ed[:8]}{index}".
+000159a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159b0: 6966 2063 6f6c 756d 6e5f 6c61 756e 6465  if column_launde
+000159c0: 7265 642e 7570 7065 7228 2920 6e6f 7420  red.upper() not 
+000159d0: 696e 206c 6175 6e64 6572 6564 5f75 7070  in laundered_upp
+000159e0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000159f0: 2020 2020 2020 2020 6c61 756e 6465 7265          laundere
+00015a00: 645f 7570 7065 722e 6170 7065 6e64 2863  d_upper.append(c
+00015a10: 6f6c 756d 6e5f 6c61 756e 6465 7265 642e  olumn_laundered.
+00015a20: 7570 7065 7228 2929 0a20 2020 2020 2020  upper()).       
+00015a30: 2020 2020 2020 2020 2020 2020 206c 6175               lau
+00015a40: 6e64 6572 6564 2e61 7070 656e 6428 2863  ndered.append((c
+00015a50: 6f6c 756d 6e2c 2063 6f6c 756d 6e5f 6c61  olumn, column_la
+00015a60: 756e 6465 7265 6429 290a 2020 2020 2020  undered)).      
+00015a70: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00015a80: 6561 6b0a 0a20 2020 2072 6574 7572 6e20  eak..    return 
+00015a90: 6c61 756e 6465 7265 640a                 laundered.
```

### Comparing `geofileops-0.8.0a6/geofileops/geoops.py` & `geofileops-0.8.0a7/geofileops/geoops.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,29 +1,31 @@
 # -*- coding: utf-8 -*-
 """
 Module exposing all supported operations on geomatries in geofiles.
 """
 
 import logging
 import logging.config
-import os
 from pathlib import Path
-from typing import Any, Callable, List, Literal, Optional, Tuple, Union
+from typing import Any, Callable, List, Literal, Optional, Tuple, Union, TYPE_CHECKING
 import warnings
 
 from geofileops.util import _geoops_gpd
 from geofileops.util import _geoops_sql
 from geofileops.util import _geoops_ogr
 from geofileops.util.geometry_util import (
     BufferEndCapStyle,
     BufferJoinStyle,
     SimplifyAlgorithm,
     GeometryType,
 )
 
+if TYPE_CHECKING:
+    import os
+
 ################################################################################
 # Some init
 ################################################################################
 
 logger = logging.getLogger(__name__)
 
 ################################################################################
@@ -215,15 +217,15 @@
             smaller nb_parallel, will reduce the memory usage.
             Defaults to -1: (try to) determine optimal size automatically.
         force (bool, optional): overwrite existing output file(s).
             Defaults to False.
 
     .. |spatialite_reference_link| raw:: html
 
-        <a href="https://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html" target="_blank">spatialite</a>  # noqa: E501
+        <a href="https://www.gaia-gis.it/gaia-sins/spatialite-sql-latest.html" target="_blank">spatialite</a>
 
     **Buffer style options**
 
     Using the different buffer style option parameters you can control how the
     buffer is created:
 
     - **quadrantsegments** *(int)*
@@ -294,15 +296,15 @@
         :alt: Buffer with joinstyle=BufferJoinStyle.BEVEL
     .. |buffer_mitre_50| image:: ../_static/images/buffer_mitre_50.png
         :alt: Buffer with mitre=5.0
     .. |buffer_mitre_25| image:: ../_static/images/buffer_mitre_25.png
         :alt: Buffer with mitre=2.5
     .. |buffer_mitre_10| image:: ../_static/images/buffer_mitre_10.png
         :alt: Buffer with mitre=1.0
-    """
+    """  # noqa: E501
     logger.info(
         f"Start buffer on {input_path} "
         f"(distance: {distance}, quadrantsegments: {quadrantsegments})"
     )
     if keep_empty_geoms is None:
         keep_empty_geoms = False
         warnings.warn(
@@ -948,14 +950,15 @@
         )
     if precision is not None:
         gridsize = precision
         warnings.warn(
             "the precision parameter is deprecated and will be removed in a future "
             "version: please use gridsize",
             FutureWarning,
+            stacklevel=2,
         )
 
     _geoops_sql.makevalid(
         input_path=Path(input_path),
         output_path=Path(output_path),
         input_layer=input_layer,
         output_layer=output_layer,
@@ -1649,14 +1652,15 @@
     batchsize: int = -1,
     force: bool = False,
 ):
     warnings.warn(
         "intersect() is deprecated because it was renamed intersection(). "
         "Will be removed in a future version",
         FutureWarning,
+        stacklevel=2,
     )
     return intersection(
         input1_path=input1_path,
         input2_path=input2_path,
         output_path=output_path,
         input1_layer=input1_layer,
         input1_columns=input1_columns,
```

### Comparing `geofileops-0.8.0a6/geofileops/helpers/_parameter_helper.py` & `geofileops-0.8.0a7/geofileops/helpers/_parameter_helper.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/helpers/layerstyles.py` & `geofileops-0.8.0a7/geofileops/helpers/layerstyles.py`

 * *Files 2% similar despite different names*

```diff
@@ -30,21 +30,17 @@
 
     Returns:
         pd.DataFrame: the styles found.
     """
     layer_styles_df = fileops.read_file(path, layer="layer_styles", fid_as_index=True)
     layer_styles_df.index.name = "id"
     if layer is not None:
-        layer_styles_df = layer_styles_df.loc[
-            layer_styles_df["f_table_name"] == layer  # type: ignore
-        ]
+        layer_styles_df = layer_styles_df.loc[layer_styles_df["f_table_name"] == layer]
     if name is not None:
-        layer_styles_df = layer_styles_df.loc[
-            layer_styles_df["styleName"] == name  # type: ignore
-        ]
+        layer_styles_df = layer_styles_df.loc[layer_styles_df["styleName"] == name]
 
     return layer_styles_df
 
 
 def add_layerstyle(
     path: Path,
     layer: str,
```

### Comparing `geofileops-0.8.0a6/geofileops/util/_general_util.py` & `geofileops-0.8.0a7/geofileops/util/_general_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/_geoops_gpd.py` & `geofileops-0.8.0a7/geofileops/util/_geoops_gpd.py`

 * *Files 1% similar despite different names*

```diff
@@ -1803,3235 +1803,3227 @@
 000070a0: 6622 7b66 6964 5f63 6f6c 756d 6e7d 5f7b  f"{fid_column}_{
 000070b0: 6669 645f 6e75 6d62 6572 7d22 0a20 2020  fid_number}".   
 000070c0: 2020 2020 2020 2020 2069 6620 6e65 775f           if new_
 000070d0: 6e61 6d65 206e 6f74 2069 6e20 636f 6c75  name not in colu
 000070e0: 6d6e 735f 6c6f 7765 725f 6c6f 6f6b 7570  mns_lower_lookup
 000070f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 00007100: 2020 6461 7461 5f67 6466 203d 2064 6174    data_gdf = dat
-00007110: 615f 6764 662e 7265 6e61 6d65 280a 2020  a_gdf.rename(.  
-00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007130: 2020 636f 6c75 6d6e 733d 7b66 6964 5f63    columns={fid_c
-00007140: 6f6c 756d 6e3a 206e 6577 5f6e 616d 657d  olumn: new_name}
-00007150: 2c20 636f 7079 3d46 616c 7365 2020 2320  , copy=False  # 
-00007160: 7479 7065 3a20 6967 6e6f 7265 0a20 2020  type: ignore.   
-00007170: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00007180: 2020 2069 6620 6578 706c 6f64 6563 6f6c     if explodecol
-00007190: 6c65 6374 696f 6e73 3a0a 2020 2020 2020  lections:.      
-000071a0: 2020 6461 7461 5f67 6466 203d 2064 6174    data_gdf = dat
-000071b0: 615f 6764 662e 6578 706c 6f64 6528 6967  a_gdf.explode(ig
-000071c0: 6e6f 7265 5f69 6e64 6578 3d54 7275 6529  nore_index=True)
-000071d0: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-000071e0: 0a0a 2020 2020 6966 2067 7269 6473 697a  ..    if gridsiz
-000071f0: 6520 213d 2030 2e30 3a0a 2020 2020 2020  e != 0.0:.      
-00007200: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00007210: 6e63 6528 6461 7461 5f67 6466 2c20 6770  nce(data_gdf, gp
-00007220: 642e 4765 6f44 6174 6146 7261 6d65 290a  d.GeoDataFrame).
-00007230: 2020 2020 2020 2020 6461 7461 5f67 6466          data_gdf
-00007240: 2e67 656f 6d65 7472 7920 3d20 7368 6170  .geometry = shap
-00007250: 656c 7932 5f6f 725f 7079 6765 6f73 2e73  ely2_or_pygeos.s
-00007260: 6574 5f70 7265 6369 7369 6f6e 280a 2020  et_precision(.  
-00007270: 2020 2020 2020 2020 2020 6461 7461 5f67            data_g
-00007280: 6466 2e67 656f 6d65 7472 792e 6172 7261  df.geometry.arra
-00007290: 792e 6461 7461 2c20 6772 6964 5f73 697a  y.data, grid_siz
-000072a0: 653d 6772 6964 7369 7a65 0a20 2020 2020  e=gridsize.     
-000072b0: 2020 2029 0a0a 2020 2020 2320 4966 2074     )..    # If t
-000072c0: 6865 2072 6573 756c 7420 6973 2065 6d70  he result is emp
-000072d0: 7479 2c20 616e 6420 6e6f 206f 7574 7075  ty, and no outpu
-000072e0: 7420 6765 6f6d 6574 7279 7479 7065 2073  t geometrytype s
-000072f0: 7065 6369 6669 6564 2c20 7573 6520 696e  pecified, use in
-00007300: 7075 740a 2020 2020 2320 6765 6f6d 6574  put.    # geomet
-00007310: 7279 7479 7065 0a20 2020 2066 6f72 6365  rytype.    force
-00007320: 5f6f 7574 7075 745f 6765 6f6d 6574 7279  _output_geometry
-00007330: 7479 7065 203d 204e 6f6e 650a 2020 2020  type = None.    
-00007340: 6966 206c 656e 2864 6174 615f 6764 6629  if len(data_gdf)
-00007350: 203d 3d20 303a 0a20 2020 2020 2020 2069   == 0:.        i
-00007360: 6e70 7574 5f6c 6179 6572 696e 666f 203d  nput_layerinfo =
-00007370: 2067 666f 2e67 6574 5f6c 6179 6572 696e   gfo.get_layerin
-00007380: 666f 2869 6e70 7574 5f70 6174 682c 2069  fo(input_path, i
-00007390: 6e70 7574 5f6c 6179 6572 290a 2020 2020  nput_layer).    
-000073a0: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
-000073b0: 5f67 656f 6d65 7472 7974 7970 6520 3d20  _geometrytype = 
-000073c0: 696e 7075 745f 6c61 7965 7269 6e66 6f2e  input_layerinfo.
-000073d0: 6765 6f6d 6574 7279 7479 7065 2e74 6f5f  geometrytype.to_
-000073e0: 6d75 6c74 6974 7970 652e 6e61 6d65 0a0a  multitype.name..
-000073f0: 2020 2020 2320 6173 7365 7274 2074 6f20      # assert to 
-00007400: 6576 6164 6520 7079 4c61 6e63 6520 7761  evade pyLance wa
-00007410: 726e 696e 670a 2020 2020 6173 7365 7274  rning.    assert
-00007420: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
-00007430: 5f67 6466 2c20 6770 642e 4765 6f44 6174  _gdf, gpd.GeoDat
-00007440: 6146 7261 6d65 290a 2020 2020 2320 5573  aFrame).    # Us
-00007450: 6520 666f 7263 655f 6d75 6c74 6974 7970  e force_multityp
-00007460: 652c 2074 6f20 6576 6164 6520 7761 726e  e, to evade warn
-00007470: 696e 6773 2077 6865 6e20 736f 6d65 2062  ings when some b
-00007480: 6174 6368 6573 2063 6f6e 7461 696e 0a20  atches contain. 
-00007490: 2020 2023 2073 696e 676c 6574 7970 6520     # singletype 
-000074a0: 616e 6420 736f 6d65 2063 6f6e 7461 696e  and some contain
-000074b0: 206d 756c 7469 7479 7065 2067 656f 6d65   multitype geome
-000074c0: 7472 6965 730a 2020 2020 6766 6f2e 746f  tries.    gfo.to
-000074d0: 5f66 696c 6528 0a20 2020 2020 2020 2067  _file(.        g
-000074e0: 6466 3d64 6174 615f 6764 662c 0a20 2020  df=data_gdf,.   
-000074f0: 2020 2020 2070 6174 683d 6f75 7470 7574       path=output
-00007500: 5f70 6174 682c 0a20 2020 2020 2020 206c  _path,.        l
-00007510: 6179 6572 3d6f 7574 7075 745f 6c61 7965  ayer=output_laye
-00007520: 722c 0a20 2020 2020 2020 2069 6e64 6578  r,.        index
-00007530: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00007540: 666f 7263 655f 6f75 7470 7574 5f67 656f  force_output_geo
-00007550: 6d65 7472 7974 7970 653d 666f 7263 655f  metrytype=force_
-00007560: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-00007570: 7970 652c 0a20 2020 2020 2020 2066 6f72  ype,.        for
-00007580: 6365 5f6d 756c 7469 7479 7065 3d54 7275  ce_multitype=Tru
-00007590: 652c 0a20 2020 2020 2020 2063 7265 6174  e,.        creat
-000075a0: 655f 7370 6174 6961 6c5f 696e 6465 783d  e_spatial_index=
-000075b0: 4661 6c73 652c 0a20 2020 2029 0a0a 2020  False,.    )..  
-000075c0: 2020 6d65 7373 6167 6520 3d20 6622 546f    message = f"To
-000075d0: 6f6b 207b 6461 7465 7469 6d65 2e6e 6f77  ok {datetime.now
-000075e0: 2829 2d73 7461 7274 5f74 696d 657d 2066  ()-start_time} f
-000075f0: 6f72 207b 6c65 6e28 6461 7461 5f67 6466  or {len(data_gdf
-00007600: 297d 2072 6f77 7320 287b 726f 7773 7d29  )} rows ({rows})
-00007610: 2122 0a20 2020 2072 6574 7572 6e20 6d65  !".    return me
-00007620: 7373 6167 650a 0a0a 6465 6620 6469 7373  ssage...def diss
-00007630: 6f6c 7665 280a 2020 2020 696e 7075 745f  olve(.    input_
-00007640: 7061 7468 3a20 5061 7468 2c0a 2020 2020  path: Path,.    
-00007650: 6f75 7470 7574 5f70 6174 683a 2050 6174  output_path: Pat
-00007660: 682c 0a20 2020 2067 726f 7570 6279 5f63  h,.    groupby_c
-00007670: 6f6c 756d 6e73 3a20 4f70 7469 6f6e 616c  olumns: Optional
-00007680: 5b49 7465 7261 626c 655b 7374 725d 5d20  [Iterable[str]] 
-00007690: 3d20 4e6f 6e65 2c0a 2020 2020 6167 675f  = None,.    agg_
-000076a0: 636f 6c75 6d6e 733a 204f 7074 696f 6e61  columns: Optiona
-000076b0: 6c5b 6469 6374 5d20 3d20 4e6f 6e65 2c0a  l[dict] = None,.
-000076c0: 2020 2020 6578 706c 6f64 6563 6f6c 6c65      explodecolle
-000076d0: 6374 696f 6e73 3a20 626f 6f6c 203d 2054  ctions: bool = T
-000076e0: 7275 652c 0a20 2020 2074 696c 6573 5f70  rue,.    tiles_p
-000076f0: 6174 683a 204f 7074 696f 6e61 6c5b 5061  ath: Optional[Pa
-00007700: 7468 5d20 3d20 4e6f 6e65 2c0a 2020 2020  th] = None,.    
-00007710: 6e62 5f73 7175 6172 6973 685f 7469 6c65  nb_squarish_tile
-00007720: 733a 2069 6e74 203d 2031 2c0a 2020 2020  s: int = 1,.    
-00007730: 696e 7075 745f 6c61 7965 723a 204f 7074  input_layer: Opt
-00007740: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00007750: 652c 0a20 2020 206f 7574 7075 745f 6c61  e,.    output_la
-00007760: 7965 723a 204f 7074 696f 6e61 6c5b 7374  yer: Optional[st
-00007770: 725d 203d 204e 6f6e 652c 0a20 2020 2067  r] = None,.    g
-00007780: 7269 6473 697a 653a 2066 6c6f 6174 203d  ridsize: float =
-00007790: 2030 2e30 2c0a 2020 2020 7768 6572 653a   0.0,.    where:
-000077a0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-000077b0: 204e 6f6e 652c 0a20 2020 206e 625f 7061   None,.    nb_pa
-000077c0: 7261 6c6c 656c 3a20 696e 7420 3d20 2d31  rallel: int = -1
-000077d0: 2c0a 2020 2020 6261 7463 6873 697a 653a  ,.    batchsize:
-000077e0: 2069 6e74 203d 202d 312c 0a20 2020 2066   int = -1,.    f
-000077f0: 6f72 6365 3a20 626f 6f6c 203d 2046 616c  orce: bool = Fal
-00007800: 7365 2c0a 2920 2d3e 2064 6963 743a 0a20  se,.) -> dict:. 
-00007810: 2020 2022 2222 0a20 2020 2046 756e 6374     """.    Funct
-00007820: 696f 6e20 7468 6174 2061 7070 6c69 6573  ion that applies
-00007830: 2061 2064 6973 736f 6c76 652e 0a0a 2020   a dissolve...  
-00007840: 2020 4d6f 7265 2064 6574 6169 6c65 6420    More detailed 
-00007850: 646f 6375 6d65 6e74 6174 696f 6e20 696e  documentation in
-00007860: 206d 6f64 756c 6520 6765 6f6f 7073 210a   module geoops!.
-00007870: 0a20 2020 2052 656d 6172 6b3a 206b 6565  .    Remark: kee
-00007880: 705f 656d 7074 795f 6765 6f6d 7320 6973  p_empty_geoms is
-00007890: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
-000078a0: 2062 6563 6175 7365 2074 6869 7320 6973   because this is
-000078b0: 206e 6f74 2073 6f20 6561 7379 2062 6563   not so easy bec
-000078c0: 6175 7365 0a20 2020 2028 666f 7220 706f  ause.    (for po
-000078d0: 6c79 676f 6e20 6469 7373 6f6c 7665 2920  lygon dissolve) 
-000078e0: 7468 6520 6261 7463 6865 7320 6172 6520  the batches are 
-000078f0: 6c6f 6361 7469 6f6e 2062 6173 6564 2c20  location based, 
-00007900: 616e 6420 6e75 6c6c 2f65 6d70 7479 2067  and null/empty g
-00007910: 656f 6d65 7472 6965 730a 2020 2020 646f  eometries.    do
-00007920: 6e27 7420 6861 7665 2061 206c 6f63 6174  n't have a locat
-00007930: 696f 6e2e 2049 7420 636f 756c 6420 6265  ion. It could be
-00007940: 2069 6d70 6c65 6d65 6e74 6564 2c20 6275   implemented, bu
-00007950: 7420 6173 206c 6f6e 6720 6173 206e 6f62  t as long as nob
-00007960: 6f64 7920 6e65 6564 7320 6974 2e2e 2e0a  ody needs it....
-00007970: 2020 2020 2222 220a 0a20 2020 2023 2049      """..    # I
-00007980: 6e69 7420 616e 6420 7661 6c69 6461 7465  nit and validate
-00007990: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
-000079a0: 730a 2020 2020 2320 2d2d 2d2d 2d2d 2d2d  s.    # --------
-000079b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000079c0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073  ----------.    s
-000079d0: 7461 7274 5f74 696d 6520 3d20 6461 7465  tart_time = date
-000079e0: 7469 6d65 2e6e 6f77 2829 0a20 2020 206f  time.now().    o
-000079f0: 7065 7261 7469 6f6e 203d 2022 6469 7373  peration = "diss
-00007a00: 6f6c 7665 220a 2020 2020 7265 7375 6c74  olve".    result
-00007a10: 5f69 6e66 6f20 3d20 7b7d 0a0a 2020 2020  _info = {}..    
-00007a20: 2320 4368 6563 6b20 696e 7075 7420 7061  # Check input pa
-00007a30: 7261 6d65 7465 7273 0a20 2020 2069 6620  rameters.    if 
-00007a40: 6772 6f75 7062 795f 636f 6c75 6d6e 7320  groupby_columns 
-00007a50: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00007a60: 6c65 6e28 6c69 7374 2867 726f 7570 6279  len(list(groupby
-00007a70: 5f63 6f6c 756d 6e73 2929 203d 3d20 303a  _columns)) == 0:
-00007a80: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-00007a90: 616c 7565 4572 726f 7228 2267 726f 7570  alueError("group
-00007aa0: 6279 5f63 6f6c 756d 6e73 3d5b 5d20 6973  by_columns=[] is
-00007ab0: 206e 6f74 2073 7570 706f 7274 6564 2e20   not supported. 
-00007ac0: 5573 6520 4e6f 6e65 2e22 290a 2020 2020  Use None.").    
-00007ad0: 6966 206e 6f74 2069 6e70 7574 5f70 6174  if not input_pat
-00007ae0: 682e 6578 6973 7473 2829 3a0a 2020 2020  h.exists():.    
-00007af0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00007b00: 7272 6f72 2866 2269 6e70 7574 5f70 6174  rror(f"input_pat
-00007b10: 6820 646f 6573 6e27 7420 6578 6973 743a  h doesn't exist:
-00007b20: 207b 696e 7075 745f 7061 7468 7d22 290a   {input_path}").
-00007b30: 2020 2020 6966 2069 6e70 7574 5f70 6174      if input_pat
-00007b40: 6820 3d3d 206f 7574 7075 745f 7061 7468  h == output_path
-00007b50: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00007b60: 5661 6c75 6545 7272 6f72 2822 6f75 7470  ValueError("outp
-00007b70: 7574 5f70 6174 6820 6d75 7374 206e 6f74  ut_path must not
-00007b80: 2065 7175 616c 2069 6e70 7574 5f70 6174   equal input_pat
-00007b90: 6822 290a 0a20 2020 2069 6e70 7574 5f6c  h")..    input_l
-00007ba0: 6179 6572 696e 666f 203d 2067 666f 2e67  ayerinfo = gfo.g
-00007bb0: 6574 5f6c 6179 6572 696e 666f 2869 6e70  et_layerinfo(inp
-00007bc0: 7574 5f70 6174 682c 2069 6e70 7574 5f6c  ut_path, input_l
-00007bd0: 6179 6572 290a 2020 2020 6966 2069 6e70  ayer).    if inp
-00007be0: 7574 5f6c 6179 6572 696e 666f 2e67 656f  ut_layerinfo.geo
-00007bf0: 6d65 7472 7974 7970 652e 746f 5f70 7269  metrytype.to_pri
-00007c00: 6d69 7469 7665 7479 7065 2069 6e20 5b0a  mitivetype in [.
-00007c10: 2020 2020 2020 2020 5072 696d 6974 6976          Primitiv
-00007c20: 6554 7970 652e 504f 494e 542c 0a20 2020  eType.POINT,.   
-00007c30: 2020 2020 2050 7269 6d69 7469 7665 5479       PrimitiveTy
-00007c40: 7065 2e4c 494e 4553 5452 494e 472c 0a20  pe.LINESTRING,. 
-00007c50: 2020 205d 3a0a 2020 2020 2020 2020 6966     ]:.        if
-00007c60: 2074 696c 6573 5f70 6174 6820 6973 206e   tiles_path is n
-00007c70: 6f74 204e 6f6e 6520 6f72 206e 625f 7371  ot None or nb_sq
-00007c80: 7561 7269 7368 5f74 696c 6573 203e 2031  uarish_tiles > 1
-00007c90: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00007ca0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00007cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cc0: 6622 4469 7373 6f6c 7665 2074 6f20 7469  f"Dissolve to ti
-00007cd0: 6c65 7320 6973 206e 6f74 2073 7570 706f  les is not suppo
-00007ce0: 7274 6564 2066 6f72 207b 696e 7075 745f  rted for {input_
-00007cf0: 6c61 7965 7269 6e66 6f2e 6765 6f6d 6574  layerinfo.geomet
-00007d00: 7279 7479 7065 7d22 0a20 2020 2020 2020  rytype}".       
-00007d10: 2020 2020 2020 2020 2022 2c20 736f 2074           ", so t
-00007d20: 696c 6573 5f70 6174 6820 7368 6f75 6c64  iles_path should
-00007d30: 2062 6520 4e6f 6e65 2061 6e64 206e 625f   be None and nb_
-00007d40: 7371 7561 7269 7368 5f74 696c 6573 2073  squarish_tiles s
-00007d50: 686f 756c 6420 6265 2031 2922 0a20 2020  hould be 1)".   
-00007d60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00007d70: 6966 2069 6e70 7574 5f6c 6179 6572 2069  if input_layer i
-00007d80: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00007d90: 696e 7075 745f 6c61 7965 7220 3d20 6766  input_layer = gf
-00007da0: 6f2e 6765 745f 6f6e 6c79 5f6c 6179 6572  o.get_only_layer
-00007db0: 2869 6e70 7574 5f70 6174 6829 0a20 2020  (input_path).   
-00007dc0: 2069 6620 6f75 7470 7574 5f6c 6179 6572   if output_layer
-00007dd0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00007de0: 2020 6f75 7470 7574 5f6c 6179 6572 203d    output_layer =
-00007df0: 2067 666f 2e67 6574 5f64 6566 6175 6c74   gfo.get_default
-00007e00: 5f6c 6179 6572 286f 7574 7075 745f 7061  _layer(output_pa
-00007e10: 7468 290a 0a20 2020 2023 2043 6865 636b  th)..    # Check
-00007e20: 2063 6f6c 756d 6e73 2069 6e20 6772 6f75   columns in grou
-00007e30: 7062 795f 636f 6c75 6d6e 730a 2020 2020  pby_columns.    
-00007e40: 6966 2067 726f 7570 6279 5f63 6f6c 756d  if groupby_colum
-00007e50: 6e73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ns is not None:.
-00007e60: 2020 2020 2020 2020 636f 6c75 6d6e 735f          columns_
-00007e70: 696e 5f6c 6179 6572 5f75 7070 6572 203d  in_layer_upper =
-00007e80: 205b 0a20 2020 2020 2020 2020 2020 2063   [.            c
-00007e90: 6f6c 756d 6e2e 7570 7065 7228 2920 666f  olumn.upper() fo
-00007ea0: 7220 636f 6c75 6d6e 2069 6e20 6c69 7374  r column in list
-00007eb0: 2869 6e70 7574 5f6c 6179 6572 696e 666f  (input_layerinfo
-00007ec0: 2e63 6f6c 756d 6e73 2920 2b20 5b22 6669  .columns) + ["fi
-00007ed0: 6422 5d0a 2020 2020 2020 2020 5d0a 2020  d"].        ].  
-00007ee0: 2020 2020 2020 666f 7220 636f 6c75 6d6e        for column
-00007ef0: 2069 6e20 6772 6f75 7062 795f 636f 6c75   in groupby_colu
-00007f00: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
-00007f10: 2069 6620 636f 6c75 6d6e 2e75 7070 6572   if column.upper
-00007f20: 2829 206e 6f74 2069 6e20 636f 6c75 6d6e  () not in column
-00007f30: 735f 696e 5f6c 6179 6572 5f75 7070 6572  s_in_layer_upper
-00007f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007f50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00007f60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00007f70: 2020 2020 2020 2020 6622 636f 6c75 6d6e          f"column
-00007f80: 2069 6e20 6772 6f75 7062 795f 636f 6c75   in groupby_colu
-00007f90: 6d6e 7320 6e6f 7420 6176 6169 6c61 626c  mns not availabl
-00007fa0: 6520 696e 206c 6179 6572 3a20 7b63 6f6c  e in layer: {col
-00007fb0: 756d 6e7d 220a 2020 2020 2020 2020 2020  umn}".          
-00007fc0: 2020 2020 2020 290a 0a20 2020 2023 2043        )..    # C
-00007fd0: 6865 636b 2061 6767 5f63 6f6c 756d 6e73  heck agg_columns
-00007fe0: 2070 6172 616d 0a20 2020 2069 6620 6167   param.    if ag
-00007ff0: 675f 636f 6c75 6d6e 7320 6973 206e 6f74  g_columns is not
-00008000: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-00008010: 2056 616c 6964 6174 6520 7468 6520 6469   Validate the di
-00008020: 6374 2073 7472 7563 7475 7265 2c20 736f  ct structure, so
-00008030: 2077 6520 6361 6e20 6173 7375 6d65 2065   we can assume e
-00008040: 7665 7279 7468 696e 6720 6973 204f 4b20  verything is OK 
-00008050: 6675 7274 6865 7220 6f6e 0a20 2020 2020  further on.     
-00008060: 2020 205f 7061 7261 6d65 7465 725f 6865     _parameter_he
-00008070: 6c70 6572 2e76 616c 6964 6174 655f 6167  lper.validate_ag
-00008080: 675f 636f 6c75 6d6e 7328 6167 675f 636f  g_columns(agg_co
-00008090: 6c75 6d6e 7329 0a0a 2020 2020 2020 2020  lumns)..        
-000080a0: 2320 4669 7273 7420 7461 6b65 2061 2064  # First take a d
-000080b0: 6565 7020 636f 7079 2c20 6173 2076 616c  eep copy, as val
-000080c0: 7565 7320 6361 6e20 6265 2063 6861 6e67  ues can be chang
-000080d0: 6564 2066 7572 7468 6572 206f 6e20 746f  ed further on to
-000080e0: 2074 7265 6174 2063 6f6c 756d 6e73 0a20   treat columns. 
-000080f0: 2020 2020 2020 2023 2063 6173 6520 696e         # case in
-00008100: 7365 6e73 6974 6976 650a 2020 2020 2020  sensitive.      
-00008110: 2020 6167 675f 636f 6c75 6d6e 7320 3d20    agg_columns = 
-00008120: 6a73 6f6e 2e6c 6f61 6473 286a 736f 6e2e  json.loads(json.
-00008130: 6475 6d70 7328 6167 675f 636f 6c75 6d6e  dumps(agg_column
-00008140: 7329 290a 2020 2020 2020 2020 6173 7365  s)).        asse
-00008150: 7274 2061 6767 5f63 6f6c 756d 6e73 2069  rt agg_columns i
-00008160: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-00008170: 2020 2069 6620 226a 736f 6e22 2069 6e20     if "json" in 
-00008180: 6167 675f 636f 6c75 6d6e 733a 0a20 2020  agg_columns:.   
-00008190: 2020 2020 2020 2020 2069 6620 6167 675f           if agg_
-000081a0: 636f 6c75 6d6e 735b 226a 736f 6e22 5d20  columns["json"] 
-000081b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000081c0: 2020 2020 2020 2020 2061 6767 5f63 6f6c           agg_col
-000081d0: 756d 6e73 5b22 6a73 6f6e 225d 203d 205b  umns["json"] = [
-000081e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000081f0: 2020 2020 2063 6f6c 2066 6f72 2063 6f6c       col for col
-00008200: 2069 6e20 696e 7075 745f 6c61 7965 7269   in input_layeri
-00008210: 6e66 6f2e 636f 6c75 6d6e 7320 6966 2063  nfo.columns if c
-00008220: 6f6c 2e75 7070 6572 2829 2021 3d20 2249  ol.upper() != "I
-00008230: 4e44 4558 220a 2020 2020 2020 2020 2020  NDEX".          
-00008240: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00008250: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008260: 2020 2020 2020 2020 2020 2320 416c 6967            # Alig
-00008270: 6e20 6361 7369 6e67 206f 6620 636f 6c75  n casing of colu
-00008280: 6d6e 206e 616d 6573 2074 6f20 6461 7461  mn names to data
-00008290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000082a0: 2061 6767 5f63 6f6c 756d 6e73 5b22 6a73   agg_columns["js
-000082b0: 6f6e 225d 203d 205f 6765 6e65 7261 6c5f  on"] = _general_
-000082c0: 7574 696c 2e61 6c69 676e 5f63 6173 696e  util.align_casin
-000082d0: 675f 6c69 7374 280a 2020 2020 2020 2020  g_list(.        
-000082e0: 2020 2020 2020 2020 2020 2020 6167 675f              agg_
-000082f0: 636f 6c75 6d6e 735b 226a 736f 6e22 5d2c  columns["json"],
-00008300: 206c 6973 7428 696e 7075 745f 6c61 7965   list(input_laye
-00008310: 7269 6e66 6f2e 636f 6c75 6d6e 7329 202b  rinfo.columns) +
-00008320: 205b 2266 6964 225d 0a20 2020 2020 2020   ["fid"].       
-00008330: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00008340: 2020 2065 6c69 6620 2263 6f6c 756d 6e73     elif "columns
-00008350: 2220 696e 2061 6767 5f63 6f6c 756d 6e73  " in agg_columns
-00008360: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00008370: 4c6f 6f70 2074 6872 6f75 6768 2061 6c6c  Loop through all
-00008380: 2072 6f77 730a 2020 2020 2020 2020 2020   rows.          
-00008390: 2020 666f 7220 6167 675f 636f 6c75 6d6e    for agg_column
-000083a0: 2069 6e20 6167 675f 636f 6c75 6d6e 735b   in agg_columns[
-000083b0: 2263 6f6c 756d 6e73 225d 3a0a 2020 2020  "columns"]:.    
-000083c0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-000083d0: 6563 6b20 6966 2063 6f6c 756d 6e20 6578  eck if column ex
-000083e0: 6973 7473 202b 2073 6574 2063 6173 696e  ists + set casin
-000083f0: 6720 7361 6d65 2061 7320 696e 2064 6174  g same as in dat
-00008400: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
-00008410: 2020 6167 675f 636f 6c75 6d6e 5b22 636f    agg_column["co
-00008420: 6c75 6d6e 225d 203d 205f 6765 6e65 7261  lumn"] = _genera
-00008430: 6c5f 7574 696c 2e61 6c69 676e 5f63 6173  l_util.align_cas
-00008440: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00008450: 2020 2020 2020 2020 2061 6767 5f63 6f6c           agg_col
-00008460: 756d 6e5b 2263 6f6c 756d 6e22 5d2c 206c  umn["column"], l
-00008470: 6973 7428 696e 7075 745f 6c61 7965 7269  ist(input_layeri
-00008480: 6e66 6f2e 636f 6c75 6d6e 7329 202b 205b  nfo.columns) + [
-00008490: 2266 6964 225d 0a20 2020 2020 2020 2020  "fid"].         
-000084a0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
-000084b0: 4e6f 7720 696e 7075 7420 7061 7261 6d65  Now input parame
-000084c0: 7465 7273 2061 7265 2063 6865 636b 6564  ters are checked
-000084d0: 2c20 6368 6563 6b20 6966 2077 6520 6e65  , check if we ne
-000084e0: 6564 2074 6f20 6361 6c63 756c 6174 6520  ed to calculate 
-000084f0: 616e 7977 6179 0a20 2020 2069 6620 6f75  anyway.    if ou
-00008500: 7470 7574 5f70 6174 682e 6578 6973 7473  tput_path.exists
-00008510: 2829 3a0a 2020 2020 2020 2020 6966 2066  ():.        if f
-00008520: 6f72 6365 2069 7320 4661 6c73 653a 0a20  orce is False:. 
-00008530: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00008540: 745f 696e 666f 5b0a 2020 2020 2020 2020  t_info[.        
-00008550: 2020 2020 2020 2020 226d 6573 7361 6765          "message
-00008560: 220a 2020 2020 2020 2020 2020 2020 5d20  ".            ] 
-00008570: 3d20 6622 6f75 7470 7574 2065 7869 7374  = f"output exist
-00008580: 7320 616c 7265 6164 7920 7b6f 7574 7075  s already {outpu
-00008590: 745f 7061 7468 7d20 616e 6420 666f 7263  t_path} and forc
-000085a0: 6520 6973 2066 616c 7365 220a 2020 2020  e is false".    
-000085b0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-000085c0: 6e66 6f28 7265 7375 6c74 5f69 6e66 6f5b  nfo(result_info[
-000085d0: 226d 6573 7361 6765 225d 290a 2020 2020  "message"]).    
-000085e0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-000085f0: 6573 756c 745f 696e 666f 0a20 2020 2020  esult_info.     
-00008600: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00008610: 2020 2020 2067 666f 2e72 656d 6f76 6528       gfo.remove(
-00008620: 6f75 7470 7574 5f70 6174 6829 0a0a 2020  output_path)..  
-00008630: 2020 2320 4e6f 7720 7374 6172 7420 6469    # Now start di
-00008640: 7373 6f6c 7669 6e67 0a20 2020 2023 202d  ssolving.    # -
-00008650: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00008660: 2d2d 2d0a 2020 2020 2320 456d 7074 7920  ---.    # Empty 
-00008670: 6f72 204c 696e 6520 616e 6420 706f 696e  or Line and poin
-00008680: 7420 6c61 7965 7273 2061 7265 3a0a 2020  t layers are:.  
-00008690: 2020 2320 2020 2a20 6e6f 7420 736f 206c    #   * not so l
-000086a0: 6172 6765 2028 6d65 6d6f 7279 2d77 6973  arge (memory-wis
-000086b0: 6529 0a20 2020 2023 2020 202a 2061 7265  e).    #   * are
-000086c0: 6e27 7420 636f 6d70 7574 6174 696f 6e61  n't computationa
-000086d0: 6c6c 7920 6865 6176 790a 2020 2020 2320  lly heavy.    # 
-000086e0: 4164 6469 7469 6f6e 616c 6c79 206c 696e  Additionally lin
-000086f0: 6520 6c61 7965 7273 2061 7265 2061 2070  e layers are a p
-00008700: 6169 6e20 746f 2068 616e 646c 6520 636f  ain to handle co
-00008710: 7272 6563 746c 7920 6265 6361 7573 6520  rrectly because 
-00008720: 6f66 0a20 2020 2023 2072 6f75 6e64 696e  of.    # roundin
-00008730: 6720 6973 7375 6573 2061 7420 7468 6520  g issues at the 
-00008740: 626f 7264 6572 7320 6f66 2074 696c 6573  borders of tiles
-00008750: 2e2e 2e20 736f 206a 7573 7420 6469 7373  ... so just diss
-00008760: 6f6c 7665 2074 6865 6d20 696e 206f 6e65  olve them in one
-00008770: 2067 6f2e 0a20 2020 2069 6620 280a 2020   go..    if (.  
-00008780: 2020 2020 2020 696e 7075 745f 6c61 7965        input_laye
-00008790: 7269 6e66 6f2e 6665 6174 7572 6563 6f75  rinfo.featurecou
-000087a0: 6e74 203d 3d20 300a 2020 2020 2020 2020  nt == 0.        
-000087b0: 6f72 2069 6e70 7574 5f6c 6179 6572 696e  or input_layerin
-000087c0: 666f 2e67 656f 6d65 7472 7974 7970 652e  fo.geometrytype.
-000087d0: 746f 5f70 7269 6d69 7469 7665 7479 7065  to_primitivetype
-000087e0: 0a20 2020 2020 2020 2069 6e20 5b0a 2020  .        in [.  
-000087f0: 2020 2020 2020 2020 2020 5072 696d 6974            Primit
-00008800: 6976 6554 7970 652e 504f 494e 542c 0a20  iveType.POINT,. 
-00008810: 2020 2020 2020 2020 2020 2050 7269 6d69             Primi
-00008820: 7469 7665 5479 7065 2e4c 494e 4553 5452  tiveType.LINESTR
-00008830: 494e 472c 0a20 2020 2020 2020 205d 0a20  ING,.        ]. 
-00008840: 2020 2029 3a0a 2020 2020 2020 2020 5f67     ):.        _g
-00008850: 656f 6f70 735f 7371 6c2e 6469 7373 6f6c  eoops_sql.dissol
-00008860: 7665 5f73 696e 676c 6574 6872 6561 6428  ve_singlethread(
-00008870: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00008880: 7574 5f70 6174 683d 696e 7075 745f 7061  ut_path=input_pa
-00008890: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-000088a0: 6f75 7470 7574 5f70 6174 683d 6f75 7470  output_path=outp
-000088b0: 7574 5f70 6174 682c 0a20 2020 2020 2020  ut_path,.       
-000088c0: 2020 2020 2065 7870 6c6f 6465 636f 6c6c       explodecoll
-000088d0: 6563 7469 6f6e 733d 6578 706c 6f64 6563  ections=explodec
-000088e0: 6f6c 6c65 6374 696f 6e73 2c0a 2020 2020  ollections,.    
-000088f0: 2020 2020 2020 2020 6772 6f75 7062 795f          groupby_
-00008900: 636f 6c75 6d6e 733d 6772 6f75 7062 795f  columns=groupby_
-00008910: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
-00008920: 2020 2020 2061 6767 5f63 6f6c 756d 6e73       agg_columns
-00008930: 3d61 6767 5f63 6f6c 756d 6e73 2c0a 2020  =agg_columns,.  
-00008940: 2020 2020 2020 2020 2020 696e 7075 745f            input_
-00008950: 6c61 7965 723d 696e 7075 745f 6c61 7965  layer=input_laye
-00008960: 722c 0a20 2020 2020 2020 2020 2020 206f  r,.            o
-00008970: 7574 7075 745f 6c61 7965 723d 6f75 7470  utput_layer=outp
-00008980: 7574 5f6c 6179 6572 2c0a 2020 2020 2020  ut_layer,.      
-00008990: 2020 2020 2020 6772 6964 7369 7a65 3d67        gridsize=g
-000089a0: 7269 6473 697a 652c 0a20 2020 2020 2020  ridsize,.       
-000089b0: 2020 2020 206b 6565 705f 656d 7074 795f       keep_empty_
-000089c0: 6765 6f6d 733d 4661 6c73 652c 0a20 2020  geoms=False,.   
-000089d0: 2020 2020 2020 2020 2077 6865 7265 3d77           where=w
-000089e0: 6865 7265 2c0a 2020 2020 2020 2020 2020  here,.          
-000089f0: 2020 666f 7263 653d 666f 7263 652c 0a20    force=force,. 
-00008a00: 2020 2020 2020 2029 0a0a 2020 2020 656c         )..    el
-00008a10: 6966 2069 6e70 7574 5f6c 6179 6572 696e  if input_layerin
-00008a20: 666f 2e67 656f 6d65 7472 7974 7970 652e  fo.geometrytype.
-00008a30: 746f 5f70 7269 6d69 7469 7665 7479 7065  to_primitivetype
-00008a40: 2069 7320 5072 696d 6974 6976 6554 7970   is PrimitiveTyp
-00008a50: 652e 504f 4c59 474f 4e3a 0a20 2020 2020  e.POLYGON:.     
-00008a60: 2020 2023 2050 7265 7061 7265 2077 6865     # Prepare whe
-00008a70: 7265 0a20 2020 2020 2020 2069 6620 7768  re.        if wh
-00008a80: 6572 6520 6973 206e 6f74 204e 6f6e 653a  ere is not None:
-00008a90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008aa0: 7768 6572 6520 3d3d 2022 223a 0a20 2020  where == "":.   
-00008ab0: 2020 2020 2020 2020 2020 2020 2077 6865               whe
-00008ac0: 7265 203d 204e 6f6e 650a 2020 2020 2020  re = None.      
-00008ad0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008ae0: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-00008af0: 7420 6765 6f6d 6574 7279 636f 6c75 6d6e  t geometrycolumn
-00008b00: 2074 6f20 2267 656f 6d22 2c20 6265 6361   to "geom", beca
-00008b10: 7573 6520 7465 6d70 2066 696c 6573 2061  use temp files a
-00008b20: 7265 2073 6176 6564 2061 7320 6770 6b67  re saved as gpkg
-00008b30: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008b40: 2020 7768 6572 6520 3d20 7768 6572 652e    where = where.
-00008b50: 666f 726d 6174 2867 656f 6d65 7472 7963  format(geometryc
-00008b60: 6f6c 756d 6e3d 2267 656f 6d22 290a 0a20  olumn="geom").. 
-00008b70: 2020 2020 2020 2023 2049 6620 6120 7469         # If a ti
-00008b80: 6c65 735f 7061 7468 2069 7320 7370 6563  les_path is spec
-00008b90: 6966 6965 642c 2072 6561 6420 7468 6f73  ified, read thos
-00008ba0: 6520 7469 6c65 732e 2e2e 0a20 2020 2020  e tiles....     
-00008bb0: 2020 2072 6573 756c 745f 7469 6c65 735f     result_tiles_
-00008bc0: 6764 6620 3d20 4e6f 6e65 0a20 2020 2020  gdf = None.     
-00008bd0: 2020 2069 6620 7469 6c65 735f 7061 7468     if tiles_path
-00008be0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00008bf0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00008c00: 5f74 696c 6573 5f67 6466 203d 2067 666f  _tiles_gdf = gfo
-00008c10: 2e72 6561 645f 6669 6c65 2874 696c 6573  .read_file(tiles
-00008c20: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
-00008c30: 2020 2069 6620 6e62 5f70 6172 616c 6c65     if nb_paralle
-00008c40: 6c20 3d3d 202d 313a 0a20 2020 2020 2020  l == -1:.       
-00008c50: 2020 2020 2020 2020 206e 625f 6370 7520           nb_cpu 
-00008c60: 3d20 6d75 6c74 6970 726f 6365 7373 696e  = multiprocessin
-00008c70: 672e 6370 755f 636f 756e 7428 290a 2020  g.cpu_count().  
-00008c80: 2020 2020 2020 2020 2020 2020 2020 6e62                nb
-00008c90: 5f70 6172 616c 6c65 6c20 3d20 6e62 5f63  _parallel = nb_c
-00008ca0: 7075 2020 2320 696e 7428 312e 3235 202a  pu  # int(1.25 *
-00008cb0: 206e 625f 6370 7529 0a20 2020 2020 2020   nb_cpu).       
-00008cc0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00008cd0: 6465 6275 6728 6622 4e62 2063 7075 7320  debug(f"Nb cpus 
-00008ce0: 666f 756e 643a 207b 6e62 5f63 7075 7d2c  found: {nb_cpu},
-00008cf0: 206e 625f 7061 7261 6c6c 656c 3a20 7b6e   nb_parallel: {n
-00008d00: 625f 7061 7261 6c6c 656c 7d22 290a 2020  b_parallel}").  
-00008d10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008d20: 2020 2020 2020 2020 2320 456c 7365 2c20          # Else, 
-00008d30: 6372 6561 7465 2061 2067 7269 6420 6261  create a grid ba
-00008d40: 7365 6420 6f6e 2074 6865 206e 756d 6265  sed on the numbe
-00008d50: 7220 6f66 2074 696c 6573 2077 616e 7465  r of tiles wante
-00008d60: 6420 6173 2072 6573 756c 740a 2020 2020  d as result.    
-00008d70: 2020 2020 2020 2020 2320 5573 6520 6120          # Use a 
-00008d80: 6d61 7267 696e 206f 6620 3120 6d65 7465  margin of 1 mete
-00008d90: 7220 6172 6f75 6e64 2074 6865 2062 6f75  r around the bou
-00008da0: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
-00008db0: 6d61 7267 696e 203d 2031 2e30 0a20 2020  margin = 1.0.   
-00008dc0: 2020 2020 2020 2020 2069 6620 696e 7075           if inpu
-00008dd0: 745f 6c61 7965 7269 6e66 6f2e 6372 7320  t_layerinfo.crs 
-00008de0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00008df0: 6e6f 7420 696e 7075 745f 6c61 7965 7269  not input_layeri
-00008e00: 6e66 6f2e 6372 732e 6973 5f70 726f 6a65  nfo.crs.is_proje
-00008e10: 6374 6564 3a0a 2020 2020 2020 2020 2020  cted:.          
-00008e20: 2020 2020 2020 2320 4966 2067 656f 6772        # If geogr
-00008e30: 6170 6869 6320 6372 732c 2031 2064 6567  aphic crs, 1 deg
-00008e40: 7265 6520 3d20 3131 3120 6b6d 206f 7220  ree = 111 km or 
-00008e50: 3131 3130 3030 206d 0a20 2020 2020 2020  111000 m.       
-00008e60: 2020 2020 2020 2020 206d 6172 6769 6e20           margin 
-00008e70: 2f3d 2031 3131 3030 300a 2020 2020 2020  /= 111000.      
-00008e80: 2020 2020 2020 626f 756e 6473 203d 2069        bounds = i
-00008e90: 6e70 7574 5f6c 6179 6572 696e 666f 2e74  nput_layerinfo.t
-00008ea0: 6f74 616c 5f62 6f75 6e64 730a 2020 2020  otal_bounds.    
-00008eb0: 2020 2020 2020 2020 626f 756e 6473 203d          bounds =
-00008ec0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00008ed0: 2020 2062 6f75 6e64 735b 305d 202d 206d     bounds[0] - m
-00008ee0: 6172 6769 6e2c 0a20 2020 2020 2020 2020  argin,.         
-00008ef0: 2020 2020 2020 2062 6f75 6e64 735b 315d         bounds[1]
-00008f00: 202d 206d 6172 6769 6e2c 0a20 2020 2020   - margin,.     
-00008f10: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
-00008f20: 735b 325d 202b 206d 6172 6769 6e2c 0a20  s[2] + margin,. 
-00008f30: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00008f40: 6f75 6e64 735b 335d 202b 206d 6172 6769  ounds[3] + margi
-00008f50: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
-00008f60: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00008f70: 756c 745f 7469 6c65 735f 6764 6620 3d20  ult_tiles_gdf = 
-00008f80: 6772 6964 5f75 7469 6c2e 6372 6561 7465  grid_util.create
-00008f90: 5f67 7269 6432 280a 2020 2020 2020 2020  _grid2(.        
-00008fa0: 2020 2020 2020 2020 626f 756e 6473 2c20          bounds, 
-00008fb0: 6e62 5f73 7175 6172 6973 685f 7469 6c65  nb_squarish_tile
-00008fc0: 732c 2069 6e70 7574 5f6c 6179 6572 696e  s, input_layerin
-00008fd0: 666f 2e63 7273 0a20 2020 2020 2020 2020  fo.crs.         
-00008fe0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00008ff0: 4170 706c 7920 6772 6964 7369 7a65 2074  Apply gridsize t
-00009000: 6f6c 6572 616e 6365 206f 6e20 7469 6c65  olerance on tile
-00009010: 732c 206f 7468 6572 7769 7365 2074 6865  s, otherwise the
-00009020: 2062 6f72 6465 7220 706f 6c79 676f 6e73   border polygons
-00009030: 2063 616e 2774 2062 650a 2020 2020 2020   can't be.      
-00009040: 2020 2320 756e 696f 6e65 6420 7072 6f70    # unioned prop
-00009050: 6572 6c79 2062 6563 6175 7365 2067 6170  erly because gap
-00009060: 7320 6170 7065 6172 2061 6674 6572 2072  s appear after r
-00009070: 6f75 6e64 696e 6720 636f 6f72 6469 6e61  ounding coordina
-00009080: 7465 732e 0a20 2020 2020 2020 2069 6620  tes..        if 
-00009090: 6772 6964 7369 7a65 2021 3d20 302e 303a  gridsize != 0.0:
-000090a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000090b0: 756c 745f 7469 6c65 735f 6764 662e 6765  ult_tiles_gdf.ge
-000090c0: 6f6d 6574 7279 203d 2073 6861 7065 6c79  ometry = shapely
-000090d0: 325f 6f72 5f70 7967 656f 732e 7365 745f  2_or_pygeos.set_
-000090e0: 7072 6563 6973 696f 6e28 0a20 2020 2020  precision(.     
-000090f0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00009100: 745f 7469 6c65 735f 6764 662e 6765 6f6d  t_tiles_gdf.geom
-00009110: 6574 7279 2e61 7272 6179 2e64 6174 612c  etry.array.data,
-00009120: 2067 7269 645f 7369 7a65 3d67 7269 6473   grid_size=grids
-00009130: 697a 650a 2020 2020 2020 2020 2020 2020  ize.            
-00009140: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00009150: 2872 6573 756c 745f 7469 6c65 735f 6764  (result_tiles_gd
-00009160: 6629 203e 2031 3a0a 2020 2020 2020 2020  f) > 1:.        
-00009170: 2020 2020 6766 6f2e 746f 5f66 696c 6528      gfo.to_file(
-00009180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009190: 2072 6573 756c 745f 7469 6c65 735f 6764   result_tiles_gd
-000091a0: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-000091b0: 2020 206f 7574 7075 745f 7061 7468 2e70     output_path.p
-000091c0: 6172 656e 7420 2f20 6622 7b6f 7574 7075  arent / f"{outpu
-000091d0: 745f 7061 7468 2e73 7465 6d7d 5f74 696c  t_path.stem}_til
-000091e0: 6573 2e67 706b 6722 2c0a 2020 2020 2020  es.gpkg",.      
-000091f0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00009200: 2023 2049 6620 6120 7469 6c65 6420 7265   # If a tiled re
-00009210: 7375 6c74 2069 7320 6173 6b65 642c 2061  sult is asked, a
-00009220: 6464 2074 696c 655f 6964 2074 6f20 6772  dd tile_id to gr
-00009230: 6f75 7020 6f6e 2066 6f72 2074 6865 2072  oup on for the r
-00009240: 6573 756c 740a 2020 2020 2020 2020 6966  esult.        if
-00009250: 206c 656e 2872 6573 756c 745f 7469 6c65   len(result_tile
-00009260: 735f 6764 6629 203e 2031 3a0a 2020 2020  s_gdf) > 1:.    
-00009270: 2020 2020 2020 2020 7265 7375 6c74 5f74          result_t
-00009280: 696c 6573 5f67 6466 5b22 7469 6c65 5f69  iles_gdf["tile_i
-00009290: 6422 5d20 3d20 7265 7375 6c74 5f74 696c  d"] = result_til
-000092a0: 6573 5f67 6466 2e72 6573 6574 5f69 6e64  es_gdf.reset_ind
-000092b0: 6578 2829 2e69 6e64 6578 0a0a 2020 2020  ex().index..    
-000092c0: 2020 2020 2320 5468 6520 6469 7373 6f6c      # The dissol
-000092d0: 7665 2066 6f72 2070 6f6c 7967 6f6e 7320  ve for polygons 
-000092e0: 6973 2064 6f6e 6520 696e 2073 6576 6572  is done in sever
-000092f0: 616c 2070 6173 7365 732c 2061 6e64 2061  al passes, and a
-00009300: 6674 6572 2074 6865 2066 6972 7374 0a20  fter the first. 
-00009310: 2020 2020 2020 2023 2070 6173 732c 206f         # pass, o
-00009320: 6e6c 7920 7468 6520 276f 6e62 6f72 6465  nly the 'onborde
-00009330: 7227 2066 6561 7475 7265 7320 6172 6520  r' features are 
-00009340: 6675 7274 6865 7220 6469 7373 6f6c 7665  further dissolve
-00009350: 642c 2061 7320 7468 650a 2020 2020 2020  d, as the.      
-00009360: 2020 2320 276e 6f74 6f6e 626f 7264 6572    # 'notonborder
-00009370: 2720 6665 6174 7572 6573 2061 7265 2061  ' features are a
-00009380: 6c72 6561 6479 204f 4b2e 0a20 2020 2020  lready OK..     
-00009390: 2020 2074 656d 7064 6972 203d 205f 696f     tempdir = _io
-000093a0: 5f75 7469 6c2e 6372 6561 7465 5f74 656d  _util.create_tem
-000093b0: 7064 6972 2866 2267 656f 6669 6c65 6f70  pdir(f"geofileop
-000093c0: 732f 7b6f 7065 7261 7469 6f6e 7d22 290a  s/{operation}").
-000093d0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000093e0: 2020 2020 2020 2020 2069 6620 6f75 7470           if outp
-000093f0: 7574 5f6c 6179 6572 2069 7320 4e6f 6e65  ut_layer is None
-00009400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009410: 2020 6f75 7470 7574 5f6c 6179 6572 203d    output_layer =
-00009420: 2067 666f 2e67 6574 5f64 6566 6175 6c74   gfo.get_default
-00009430: 5f6c 6179 6572 286f 7574 7075 745f 7061  _layer(output_pa
-00009440: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-00009450: 6f75 7470 7574 5f74 6d70 5f70 6174 6820  output_tmp_path 
-00009460: 3d20 7465 6d70 6469 7220 2f20 226f 7574  = tempdir / "out
-00009470: 7075 745f 746d 702e 6770 6b67 220a 2020  put_tmp.gpkg".  
-00009480: 2020 2020 2020 2020 2020 7072 6576 5f6e            prev_n
-00009490: 625f 6261 7463 6865 7320 3d20 4e6f 6e65  b_batches = None
-000094a0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-000094b0: 745f 7061 7373 203d 2046 616c 7365 0a20  t_pass = False. 
-000094c0: 2020 2020 2020 2020 2020 2070 6173 735f             pass_
-000094d0: 6964 203d 2030 0a20 2020 2020 2020 2020  id = 0.         
-000094e0: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
-000094f0: 2253 7461 7274 2064 6973 736f 6c76 6520  "Start dissolve 
-00009500: 6f6e 2066 696c 6520 7b69 6e70 7574 5f70  on file {input_p
-00009510: 6174 687d 2229 0a20 2020 2020 2020 2020  ath}").         
-00009520: 2020 2069 6e70 7574 5f70 6173 735f 6c61     input_pass_la
-00009530: 7965 7220 3d20 696e 7075 745f 6c61 7965  yer = input_laye
-00009540: 720a 2020 2020 2020 2020 2020 2020 7768  r.            wh
-00009550: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
-00009560: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-00009570: 696e 666f 206f 6620 7468 6520 6375 7272  info of the curr
-00009580: 656e 7420 6669 6c65 2074 6861 7420 6e65  ent file that ne
-00009590: 6564 7320 746f 2062 6520 6469 7373 6f6c  eds to be dissol
-000095a0: 7665 640a 2020 2020 2020 2020 2020 2020  ved.            
-000095b0: 2020 2020 696e 7075 745f 7061 7373 5f6c      input_pass_l
-000095c0: 6179 6572 696e 666f 203d 2067 666f 2e67  ayerinfo = gfo.g
-000095d0: 6574 5f6c 6179 6572 696e 666f 2869 6e70  et_layerinfo(inp
-000095e0: 7574 5f70 6174 682c 2069 6e70 7574 5f70  ut_path, input_p
-000095f0: 6173 735f 6c61 7965 7229 0a20 2020 2020  ass_layer).     
-00009600: 2020 2020 2020 2020 2020 206e 625f 726f             nb_ro
-00009610: 7773 5f74 6f74 616c 203d 2069 6e70 7574  ws_total = input
-00009620: 5f70 6173 735f 6c61 7965 7269 6e66 6f2e  _pass_layerinfo.
-00009630: 6665 6174 7572 6563 6f75 6e74 0a0a 2020  featurecount..  
-00009640: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009650: 4361 6c63 756c 6174 6520 7468 6520 6265  Calculate the be
-00009660: 7374 206e 756d 6265 7220 6f66 2070 6172  st number of par
-00009670: 616c 6c65 6c20 7072 6f63 6573 7365 7320  allel processes 
-00009680: 616e 6420 6261 7463 6865 7320 666f 720a  and batches for.
-00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096a0: 2320 7468 6520 6176 6169 6c61 626c 6520  # the available 
-000096b0: 7265 736f 7572 6365 7320 666f 7220 7468  resources for th
-000096c0: 6520 6375 7272 656e 7420 7061 7373 0a20  e current pass. 
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000096e0: 6620 6261 7463 6873 697a 6520 3e20 303a  f batchsize > 0:
-000096f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009700: 2020 2020 2070 6172 616c 6c65 6c69 7a61       paralleliza
-00009710: 7469 6f6e 5f63 6f6e 6669 6720 3d20 5061  tion_config = Pa
-00009720: 7261 6c6c 656c 697a 6174 696f 6e43 6f6e  rallelizationCon
-00009730: 6669 6728 0a20 2020 2020 2020 2020 2020  fig(.           
-00009740: 2020 2020 2020 2020 2020 2020 206d 696e               min
-00009750: 5f61 7667 5f72 6f77 735f 7065 725f 6261  _avg_rows_per_ba
-00009760: 7463 683d 696e 7428 6d61 7468 2e63 6569  tch=int(math.cei
-00009770: 6c28 6261 7463 6873 697a 6520 2f20 3229  l(batchsize / 2)
-00009780: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00009790: 2020 2020 2020 2020 2020 206d 6178 5f61             max_a
-000097a0: 7667 5f72 6f77 735f 7065 725f 6261 7463  vg_rows_per_batc
-000097b0: 683d 6261 7463 6873 697a 652c 0a20 2020  h=batchsize,.   
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000097e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000097f0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00009800: 616c 6c65 6c69 7a61 7469 6f6e 5f63 6f6e  allelization_con
-00009810: 6669 6720 3d20 5061 7261 6c6c 656c 697a  fig = Paralleliz
-00009820: 6174 696f 6e43 6f6e 6669 6728 290a 2020  ationConfig().  
-00009830: 2020 2020 2020 2020 2020 2020 2020 6e62                nb
-00009840: 5f70 6172 616c 6c65 6c2c 206e 625f 6261  _parallel, nb_ba
-00009850: 7463 6865 735f 7265 636f 6d6d 656e 6465  tches_recommende
-00009860: 642c 205f 203d 2067 6574 5f70 6172 616c  d, _ = get_paral
-00009870: 6c65 6c69 7a61 7469 6f6e 5f70 6172 616d  lelization_param
-00009880: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00009890: 2020 2020 2020 206e 625f 726f 7773 5f74         nb_rows_t
-000098a0: 6f74 616c 3d6e 625f 726f 7773 5f74 6f74  otal=nb_rows_tot
-000098b0: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
-000098c0: 2020 2020 2020 2020 6e62 5f70 6172 616c          nb_paral
-000098d0: 6c65 6c3d 6e62 5f70 6172 616c 6c65 6c2c  lel=nb_parallel,
-000098e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000098f0: 2020 2020 206e 625f 6261 7463 6865 735f       nb_batches_
-00009900: 7072 6576 696f 7573 5f70 6173 733d 7072  previous_pass=pr
-00009910: 6576 5f6e 625f 6261 7463 6865 732c 0a20  ev_nb_batches,. 
-00009920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009930: 2020 2070 6172 616c 6c65 6c69 7a61 7469     parallelizati
-00009940: 6f6e 5f63 6f6e 6669 673d 7061 7261 6c6c  on_config=parall
-00009950: 656c 697a 6174 696f 6e5f 636f 6e66 6967  elization_config
-00009960: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009970: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00009980: 2020 2020 2023 2049 6620 7468 6520 6964       # If the id
-00009990: 6561 6c20 6e75 6d62 6572 206f 6620 6261  eal number of ba
-000099a0: 7463 6865 7320 6973 2063 6c6f 7365 2074  tches is close t
-000099b0: 6f20 7468 6520 6e62 2e20 7265 7375 6c74  o the nb. result
-000099c0: 2074 696c 6573 2061 736b 6564 2c0a 2020   tiles asked,.  
-000099d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000099e0: 6469 7373 6f6c 7665 2074 6f77 6172 6473  dissolve towards
-000099f0: 2074 6865 2061 736b 6564 2072 6573 756c   the asked resul
-00009a00: 7421 0a20 2020 2020 2020 2020 2020 2020  t!.             
-00009a10: 2020 2023 2049 6620 6e6f 742c 2061 2074     # If not, a t
-00009a20: 656d 706f 7261 7279 2072 6573 756c 7420  emporary result 
-00009a30: 6973 2063 7265 6174 6564 2075 7369 6e67  is created using
-00009a40: 2073 6d61 6c6c 6572 2074 696c 6573 0a20   smaller tiles. 
-00009a50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009a60: 6620 6e62 5f62 6174 6368 6573 5f72 6563  f nb_batches_rec
-00009a70: 6f6d 6d65 6e64 6564 203c 3d20 6c65 6e28  ommended <= len(
-00009a80: 7265 7375 6c74 5f74 696c 6573 5f67 6466  result_tiles_gdf
-00009a90: 2920 2a20 312e 313a 0a20 2020 2020 2020  ) * 1.1:.       
-00009aa0: 2020 2020 2020 2020 2020 2020 2074 696c               til
-00009ab0: 6573 5f67 6466 203d 2072 6573 756c 745f  es_gdf = result_
-00009ac0: 7469 6c65 735f 6764 660a 2020 2020 2020  tiles_gdf.      
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00009ae0: 7374 5f70 6173 7320 3d20 5472 7565 0a20  st_pass = True. 
-00009af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b00: 2020 206e 625f 7061 7261 6c6c 656c 203d     nb_parallel =
-00009b10: 206d 696e 286c 656e 2872 6573 756c 745f   min(len(result_
-00009b20: 7469 6c65 735f 6764 6629 2c20 6e62 5f70  tiles_gdf), nb_p
-00009b30: 6172 616c 6c65 6c29 0a20 2020 2020 2020  arallel).       
-00009b40: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-00009b50: 6e28 7265 7375 6c74 5f74 696c 6573 5f67  n(result_tiles_g
-00009b60: 6466 2920 3d3d 2031 3a0a 2020 2020 2020  df) == 1:.      
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009b80: 4372 6561 7465 2061 2067 7269 6420 6261  Create a grid ba
-00009b90: 7365 6420 6f6e 2074 6865 2069 6465 616c  sed on the ideal
-00009ba0: 206e 756d 6265 7220 6f66 2062 6174 6368   number of batch
-00009bb0: 6573 2c20 6275 7420 6d61 6b65 0a20 2020  es, but make.   
+00007110: 615f 6764 662e 7265 6e61 6d65 2863 6f6c  a_gdf.rename(col
+00007120: 756d 6e73 3d7b 6669 645f 636f 6c75 6d6e  umns={fid_column
+00007130: 3a20 6e65 775f 6e61 6d65 7d2c 2063 6f70  : new_name}, cop
+00007140: 793d 4661 6c73 6529 0a20 2020 2069 6620  y=False).    if 
+00007150: 6578 706c 6f64 6563 6f6c 6c65 6374 696f  explodecollectio
+00007160: 6e73 3a0a 2020 2020 2020 2020 6461 7461  ns:.        data
+00007170: 5f67 6466 203d 2064 6174 615f 6764 662e  _gdf = data_gdf.
+00007180: 6578 706c 6f64 6528 6967 6e6f 7265 5f69  explode(ignore_i
+00007190: 6e64 6578 3d54 7275 6529 0a0a 2020 2020  ndex=True)..    
+000071a0: 6966 2067 7269 6473 697a 6520 213d 2030  if gridsize != 0
+000071b0: 2e30 3a0a 2020 2020 2020 2020 6173 7365  .0:.        asse
+000071c0: 7274 2069 7369 6e73 7461 6e63 6528 6461  rt isinstance(da
+000071d0: 7461 5f67 6466 2c20 6770 642e 4765 6f44  ta_gdf, gpd.GeoD
+000071e0: 6174 6146 7261 6d65 290a 2020 2020 2020  ataFrame).      
+000071f0: 2020 6461 7461 5f67 6466 2e67 656f 6d65    data_gdf.geome
+00007200: 7472 7920 3d20 7368 6170 656c 7932 5f6f  try = shapely2_o
+00007210: 725f 7079 6765 6f73 2e73 6574 5f70 7265  r_pygeos.set_pre
+00007220: 6369 7369 6f6e 280a 2020 2020 2020 2020  cision(.        
+00007230: 2020 2020 6461 7461 5f67 6466 2e67 656f      data_gdf.geo
+00007240: 6d65 7472 792e 6172 7261 792e 6461 7461  metry.array.data
+00007250: 2c20 6772 6964 5f73 697a 653d 6772 6964  , grid_size=grid
+00007260: 7369 7a65 0a20 2020 2020 2020 2029 0a0a  size.        )..
+00007270: 2020 2020 2320 4966 2074 6865 2072 6573      # If the res
+00007280: 756c 7420 6973 2065 6d70 7479 2c20 616e  ult is empty, an
+00007290: 6420 6e6f 206f 7574 7075 7420 6765 6f6d  d no output geom
+000072a0: 6574 7279 7479 7065 2073 7065 6369 6669  etrytype specifi
+000072b0: 6564 2c20 7573 6520 696e 7075 740a 2020  ed, use input.  
+000072c0: 2020 2320 6765 6f6d 6574 7279 7479 7065    # geometrytype
+000072d0: 0a20 2020 2066 6f72 6365 5f6f 7574 7075  .    force_outpu
+000072e0: 745f 6765 6f6d 6574 7279 7479 7065 203d  t_geometrytype =
+000072f0: 204e 6f6e 650a 2020 2020 6966 206c 656e   None.    if len
+00007300: 2864 6174 615f 6764 6629 203d 3d20 303a  (data_gdf) == 0:
+00007310: 0a20 2020 2020 2020 2069 6e70 7574 5f6c  .        input_l
+00007320: 6179 6572 696e 666f 203d 2067 666f 2e67  ayerinfo = gfo.g
+00007330: 6574 5f6c 6179 6572 696e 666f 2869 6e70  et_layerinfo(inp
+00007340: 7574 5f70 6174 682c 2069 6e70 7574 5f6c  ut_path, input_l
+00007350: 6179 6572 290a 2020 2020 2020 2020 666f  ayer).        fo
+00007360: 7263 655f 6f75 7470 7574 5f67 656f 6d65  rce_output_geome
+00007370: 7472 7974 7970 6520 3d20 696e 7075 745f  trytype = input_
+00007380: 6c61 7965 7269 6e66 6f2e 6765 6f6d 6574  layerinfo.geomet
+00007390: 7279 7479 7065 2e74 6f5f 6d75 6c74 6974  rytype.to_multit
+000073a0: 7970 652e 6e61 6d65 0a0a 2020 2020 2320  ype.name..    # 
+000073b0: 6173 7365 7274 2074 6f20 6576 6164 6520  assert to evade 
+000073c0: 7079 4c61 6e63 6520 7761 726e 696e 670a  pyLance warning.
+000073d0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+000073e0: 7461 6e63 6528 6461 7461 5f67 6466 2c20  tance(data_gdf, 
+000073f0: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
+00007400: 290a 2020 2020 2320 5573 6520 666f 7263  ).    # Use forc
+00007410: 655f 6d75 6c74 6974 7970 652c 2074 6f20  e_multitype, to 
+00007420: 6576 6164 6520 7761 726e 696e 6773 2077  evade warnings w
+00007430: 6865 6e20 736f 6d65 2062 6174 6368 6573  hen some batches
+00007440: 2063 6f6e 7461 696e 0a20 2020 2023 2073   contain.    # s
+00007450: 696e 676c 6574 7970 6520 616e 6420 736f  ingletype and so
+00007460: 6d65 2063 6f6e 7461 696e 206d 756c 7469  me contain multi
+00007470: 7479 7065 2067 656f 6d65 7472 6965 730a  type geometries.
+00007480: 2020 2020 6766 6f2e 746f 5f66 696c 6528      gfo.to_file(
+00007490: 0a20 2020 2020 2020 2067 6466 3d64 6174  .        gdf=dat
+000074a0: 615f 6764 662c 0a20 2020 2020 2020 2070  a_gdf,.        p
+000074b0: 6174 683d 6f75 7470 7574 5f70 6174 682c  ath=output_path,
+000074c0: 0a20 2020 2020 2020 206c 6179 6572 3d6f  .        layer=o
+000074d0: 7574 7075 745f 6c61 7965 722c 0a20 2020  utput_layer,.   
+000074e0: 2020 2020 2069 6e64 6578 3d46 616c 7365       index=False
+000074f0: 2c0a 2020 2020 2020 2020 666f 7263 655f  ,.        force_
+00007500: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
+00007510: 7970 653d 666f 7263 655f 6f75 7470 7574  ype=force_output
+00007520: 5f67 656f 6d65 7472 7974 7970 652c 0a20  _geometrytype,. 
+00007530: 2020 2020 2020 2066 6f72 6365 5f6d 756c         force_mul
+00007540: 7469 7479 7065 3d54 7275 652c 0a20 2020  titype=True,.   
+00007550: 2020 2020 2063 7265 6174 655f 7370 6174       create_spat
+00007560: 6961 6c5f 696e 6465 783d 4661 6c73 652c  ial_index=False,
+00007570: 0a20 2020 2029 0a0a 2020 2020 6d65 7373  .    )..    mess
+00007580: 6167 6520 3d20 6622 546f 6f6b 207b 6461  age = f"Took {da
+00007590: 7465 7469 6d65 2e6e 6f77 2829 2d73 7461  tetime.now()-sta
+000075a0: 7274 5f74 696d 657d 2066 6f72 207b 6c65  rt_time} for {le
+000075b0: 6e28 6461 7461 5f67 6466 297d 2072 6f77  n(data_gdf)} row
+000075c0: 7320 287b 726f 7773 7d29 2122 0a20 2020  s ({rows})!".   
+000075d0: 2072 6574 7572 6e20 6d65 7373 6167 650a   return message.
+000075e0: 0a0a 6465 6620 6469 7373 6f6c 7665 280a  ..def dissolve(.
+000075f0: 2020 2020 696e 7075 745f 7061 7468 3a20      input_path: 
+00007600: 5061 7468 2c0a 2020 2020 6f75 7470 7574  Path,.    output
+00007610: 5f70 6174 683a 2050 6174 682c 0a20 2020  _path: Path,.   
+00007620: 2067 726f 7570 6279 5f63 6f6c 756d 6e73   groupby_columns
+00007630: 3a20 4f70 7469 6f6e 616c 5b49 7465 7261  : Optional[Itera
+00007640: 626c 655b 7374 725d 5d20 3d20 4e6f 6e65  ble[str]] = None
+00007650: 2c0a 2020 2020 6167 675f 636f 6c75 6d6e  ,.    agg_column
+00007660: 733a 204f 7074 696f 6e61 6c5b 6469 6374  s: Optional[dict
+00007670: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 6578  ] = None,.    ex
+00007680: 706c 6f64 6563 6f6c 6c65 6374 696f 6e73  plodecollections
+00007690: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+000076a0: 2020 2074 696c 6573 5f70 6174 683a 204f     tiles_path: O
+000076b0: 7074 696f 6e61 6c5b 5061 7468 5d20 3d20  ptional[Path] = 
+000076c0: 4e6f 6e65 2c0a 2020 2020 6e62 5f73 7175  None,.    nb_squ
+000076d0: 6172 6973 685f 7469 6c65 733a 2069 6e74  arish_tiles: int
+000076e0: 203d 2031 2c0a 2020 2020 696e 7075 745f   = 1,.    input_
+000076f0: 6c61 7965 723a 204f 7074 696f 6e61 6c5b  layer: Optional[
+00007700: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00007710: 206f 7574 7075 745f 6c61 7965 723a 204f   output_layer: O
+00007720: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00007730: 6f6e 652c 0a20 2020 2067 7269 6473 697a  one,.    gridsiz
+00007740: 653a 2066 6c6f 6174 203d 2030 2e30 2c0a  e: float = 0.0,.
+00007750: 2020 2020 7768 6572 653a 204f 7074 696f      where: Optio
+00007760: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00007770: 0a20 2020 206e 625f 7061 7261 6c6c 656c  .    nb_parallel
+00007780: 3a20 696e 7420 3d20 2d31 2c0a 2020 2020  : int = -1,.    
+00007790: 6261 7463 6873 697a 653a 2069 6e74 203d  batchsize: int =
+000077a0: 202d 312c 0a20 2020 2066 6f72 6365 3a20   -1,.    force: 
+000077b0: 626f 6f6c 203d 2046 616c 7365 2c0a 2920  bool = False,.) 
+000077c0: 2d3e 2064 6963 743a 0a20 2020 2022 2222  -> dict:.    """
+000077d0: 0a20 2020 2046 756e 6374 696f 6e20 7468  .    Function th
+000077e0: 6174 2061 7070 6c69 6573 2061 2064 6973  at applies a dis
+000077f0: 736f 6c76 652e 0a0a 2020 2020 4d6f 7265  solve...    More
+00007800: 2064 6574 6169 6c65 6420 646f 6375 6d65   detailed docume
+00007810: 6e74 6174 696f 6e20 696e 206d 6f64 756c  ntation in modul
+00007820: 6520 6765 6f6f 7073 210a 0a20 2020 2052  e geoops!..    R
+00007830: 656d 6172 6b3a 206b 6565 705f 656d 7074  emark: keep_empt
+00007840: 795f 6765 6f6d 7320 6973 206e 6f74 2069  y_geoms is not i
+00007850: 6d70 6c65 6d65 6e74 6564 2062 6563 6175  mplemented becau
+00007860: 7365 2074 6869 7320 6973 206e 6f74 2073  se this is not s
+00007870: 6f20 6561 7379 2062 6563 6175 7365 0a20  o easy because. 
+00007880: 2020 2028 666f 7220 706f 6c79 676f 6e20     (for polygon 
+00007890: 6469 7373 6f6c 7665 2920 7468 6520 6261  dissolve) the ba
+000078a0: 7463 6865 7320 6172 6520 6c6f 6361 7469  tches are locati
+000078b0: 6f6e 2062 6173 6564 2c20 616e 6420 6e75  on based, and nu
+000078c0: 6c6c 2f65 6d70 7479 2067 656f 6d65 7472  ll/empty geometr
+000078d0: 6965 730a 2020 2020 646f 6e27 7420 6861  ies.    don't ha
+000078e0: 7665 2061 206c 6f63 6174 696f 6e2e 2049  ve a location. I
+000078f0: 7420 636f 756c 6420 6265 2069 6d70 6c65  t could be imple
+00007900: 6d65 6e74 6564 2c20 6275 7420 6173 206c  mented, but as l
+00007910: 6f6e 6720 6173 206e 6f62 6f64 7920 6e65  ong as nobody ne
+00007920: 6564 7320 6974 2e2e 2e0a 2020 2020 2222  eds it....    ""
+00007930: 220a 0a20 2020 2023 2049 6e69 7420 616e  "..    # Init an
+00007940: 6420 7661 6c69 6461 7465 2069 6e70 7574  d validate input
+00007950: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
+00007960: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
+00007970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00007980: 2d2d 2d2d 0a20 2020 2073 7461 7274 5f74  ----.    start_t
+00007990: 696d 6520 3d20 6461 7465 7469 6d65 2e6e  ime = datetime.n
+000079a0: 6f77 2829 0a20 2020 206f 7065 7261 7469  ow().    operati
+000079b0: 6f6e 203d 2022 6469 7373 6f6c 7665 220a  on = "dissolve".
+000079c0: 2020 2020 7265 7375 6c74 5f69 6e66 6f20      result_info 
+000079d0: 3d20 7b7d 0a0a 2020 2020 2320 4368 6563  = {}..    # Chec
+000079e0: 6b20 696e 7075 7420 7061 7261 6d65 7465  k input paramete
+000079f0: 7273 0a20 2020 2069 6620 6772 6f75 7062  rs.    if groupb
+00007a00: 795f 636f 6c75 6d6e 7320 6973 206e 6f74  y_columns is not
+00007a10: 204e 6f6e 6520 616e 6420 6c65 6e28 6c69   None and len(li
+00007a20: 7374 2867 726f 7570 6279 5f63 6f6c 756d  st(groupby_colum
+00007a30: 6e73 2929 203d 3d20 303a 0a20 2020 2020  ns)) == 0:.     
+00007a40: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00007a50: 726f 7228 2267 726f 7570 6279 5f63 6f6c  ror("groupby_col
+00007a60: 756d 6e73 3d5b 5d20 6973 206e 6f74 2073  umns=[] is not s
+00007a70: 7570 706f 7274 6564 2e20 5573 6520 4e6f  upported. Use No
+00007a80: 6e65 2e22 290a 2020 2020 6966 206e 6f74  ne.").    if not
+00007a90: 2069 6e70 7574 5f70 6174 682e 6578 6973   input_path.exis
+00007aa0: 7473 2829 3a0a 2020 2020 2020 2020 7261  ts():.        ra
+00007ab0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00007ac0: 2269 6e70 7574 5f70 6174 6820 646f 6573  "input_path does
+00007ad0: 6e27 7420 6578 6973 743a 207b 696e 7075  n't exist: {inpu
+00007ae0: 745f 7061 7468 7d22 290a 2020 2020 6966  t_path}").    if
+00007af0: 2069 6e70 7574 5f70 6174 6820 3d3d 206f   input_path == o
+00007b00: 7574 7075 745f 7061 7468 3a0a 2020 2020  utput_path:.    
+00007b10: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00007b20: 7272 6f72 2822 6f75 7470 7574 5f70 6174  rror("output_pat
+00007b30: 6820 6d75 7374 206e 6f74 2065 7175 616c  h must not equal
+00007b40: 2069 6e70 7574 5f70 6174 6822 290a 0a20   input_path").. 
+00007b50: 2020 2069 6e70 7574 5f6c 6179 6572 696e     input_layerin
+00007b60: 666f 203d 2067 666f 2e67 6574 5f6c 6179  fo = gfo.get_lay
+00007b70: 6572 696e 666f 2869 6e70 7574 5f70 6174  erinfo(input_pat
+00007b80: 682c 2069 6e70 7574 5f6c 6179 6572 290a  h, input_layer).
+00007b90: 2020 2020 6966 2069 6e70 7574 5f6c 6179      if input_lay
+00007ba0: 6572 696e 666f 2e67 656f 6d65 7472 7974  erinfo.geometryt
+00007bb0: 7970 652e 746f 5f70 7269 6d69 7469 7665  ype.to_primitive
+00007bc0: 7479 7065 2069 6e20 5b0a 2020 2020 2020  type in [.      
+00007bd0: 2020 5072 696d 6974 6976 6554 7970 652e    PrimitiveType.
+00007be0: 504f 494e 542c 0a20 2020 2020 2020 2050  POINT,.        P
+00007bf0: 7269 6d69 7469 7665 5479 7065 2e4c 494e  rimitiveType.LIN
+00007c00: 4553 5452 494e 472c 0a20 2020 205d 3a0a  ESTRING,.    ]:.
+00007c10: 2020 2020 2020 2020 6966 2074 696c 6573          if tiles
+00007c20: 5f70 6174 6820 6973 206e 6f74 204e 6f6e  _path is not Non
+00007c30: 6520 6f72 206e 625f 7371 7561 7269 7368  e or nb_squarish
+00007c40: 5f74 696c 6573 203e 2031 3a0a 2020 2020  _tiles > 1:.    
+00007c50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00007c60: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00007c70: 2020 2020 2020 2020 2020 6622 4469 7373            f"Diss
+00007c80: 6f6c 7665 2074 6f20 7469 6c65 7320 6973  olve to tiles is
+00007c90: 206e 6f74 2073 7570 706f 7274 6564 2066   not supported f
+00007ca0: 6f72 207b 696e 7075 745f 6c61 7965 7269  or {input_layeri
+00007cb0: 6e66 6f2e 6765 6f6d 6574 7279 7479 7065  nfo.geometrytype
+00007cc0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00007cd0: 2020 2022 2c20 736f 2074 696c 6573 5f70     ", so tiles_p
+00007ce0: 6174 6820 7368 6f75 6c64 2062 6520 4e6f  ath should be No
+00007cf0: 6e65 2061 6e64 206e 625f 7371 7561 7269  ne and nb_squari
+00007d00: 7368 5f74 696c 6573 2073 686f 756c 6420  sh_tiles should 
+00007d10: 6265 2031 2922 0a20 2020 2020 2020 2020  be 1)".         
+00007d20: 2020 2029 0a0a 2020 2020 6966 2069 6e70     )..    if inp
+00007d30: 7574 5f6c 6179 6572 2069 7320 4e6f 6e65  ut_layer is None
+00007d40: 3a0a 2020 2020 2020 2020 696e 7075 745f  :.        input_
+00007d50: 6c61 7965 7220 3d20 6766 6f2e 6765 745f  layer = gfo.get_
+00007d60: 6f6e 6c79 5f6c 6179 6572 2869 6e70 7574  only_layer(input
+00007d70: 5f70 6174 6829 0a20 2020 2069 6620 6f75  _path).    if ou
+00007d80: 7470 7574 5f6c 6179 6572 2069 7320 4e6f  tput_layer is No
+00007d90: 6e65 3a0a 2020 2020 2020 2020 6f75 7470  ne:.        outp
+00007da0: 7574 5f6c 6179 6572 203d 2067 666f 2e67  ut_layer = gfo.g
+00007db0: 6574 5f64 6566 6175 6c74 5f6c 6179 6572  et_default_layer
+00007dc0: 286f 7574 7075 745f 7061 7468 290a 0a20  (output_path).. 
+00007dd0: 2020 2023 2043 6865 636b 2063 6f6c 756d     # Check colum
+00007de0: 6e73 2069 6e20 6772 6f75 7062 795f 636f  ns in groupby_co
+00007df0: 6c75 6d6e 730a 2020 2020 6966 2067 726f  lumns.    if gro
+00007e00: 7570 6279 5f63 6f6c 756d 6e73 2069 7320  upby_columns is 
+00007e10: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00007e20: 2020 636f 6c75 6d6e 735f 696e 5f6c 6179    columns_in_lay
+00007e30: 6572 5f75 7070 6572 203d 205b 0a20 2020  er_upper = [.   
+00007e40: 2020 2020 2020 2020 2063 6f6c 756d 6e2e           column.
+00007e50: 7570 7065 7228 2920 666f 7220 636f 6c75  upper() for colu
+00007e60: 6d6e 2069 6e20 6c69 7374 2869 6e70 7574  mn in list(input
+00007e70: 5f6c 6179 6572 696e 666f 2e63 6f6c 756d  _layerinfo.colum
+00007e80: 6e73 2920 2b20 5b22 6669 6422 5d0a 2020  ns) + ["fid"].  
+00007e90: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00007ea0: 666f 7220 636f 6c75 6d6e 2069 6e20 6772  for column in gr
+00007eb0: 6f75 7062 795f 636f 6c75 6d6e 733a 0a20  oupby_columns:. 
+00007ec0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00007ed0: 6c75 6d6e 2e75 7070 6572 2829 206e 6f74  lumn.upper() not
+00007ee0: 2069 6e20 636f 6c75 6d6e 735f 696e 5f6c   in columns_in_l
+00007ef0: 6179 6572 5f75 7070 6572 3a0a 2020 2020  ayer_upper:.    
+00007f00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00007f10: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00007f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f30: 2020 6622 636f 6c75 6d6e 2069 6e20 6772    f"column in gr
+00007f40: 6f75 7062 795f 636f 6c75 6d6e 7320 6e6f  oupby_columns no
+00007f50: 7420 6176 6169 6c61 626c 6520 696e 206c  t available in l
+00007f60: 6179 6572 3a20 7b63 6f6c 756d 6e7d 220a  ayer: {column}".
+00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f80: 290a 0a20 2020 2023 2043 6865 636b 2061  )..    # Check a
+00007f90: 6767 5f63 6f6c 756d 6e73 2070 6172 616d  gg_columns param
+00007fa0: 0a20 2020 2069 6620 6167 675f 636f 6c75  .    if agg_colu
+00007fb0: 6d6e 7320 6973 206e 6f74 204e 6f6e 653a  mns is not None:
+00007fc0: 0a20 2020 2020 2020 2023 2056 616c 6964  .        # Valid
+00007fd0: 6174 6520 7468 6520 6469 6374 2073 7472  ate the dict str
+00007fe0: 7563 7475 7265 2c20 736f 2077 6520 6361  ucture, so we ca
+00007ff0: 6e20 6173 7375 6d65 2065 7665 7279 7468  n assume everyth
+00008000: 696e 6720 6973 204f 4b20 6675 7274 6865  ing is OK furthe
+00008010: 7220 6f6e 0a20 2020 2020 2020 205f 7061  r on.        _pa
+00008020: 7261 6d65 7465 725f 6865 6c70 6572 2e76  rameter_helper.v
+00008030: 616c 6964 6174 655f 6167 675f 636f 6c75  alidate_agg_colu
+00008040: 6d6e 7328 6167 675f 636f 6c75 6d6e 7329  mns(agg_columns)
+00008050: 0a0a 2020 2020 2020 2020 2320 4669 7273  ..        # Firs
+00008060: 7420 7461 6b65 2061 2064 6565 7020 636f  t take a deep co
+00008070: 7079 2c20 6173 2076 616c 7565 7320 6361  py, as values ca
+00008080: 6e20 6265 2063 6861 6e67 6564 2066 7572  n be changed fur
+00008090: 7468 6572 206f 6e20 746f 2074 7265 6174  ther on to treat
+000080a0: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
+000080b0: 2023 2063 6173 6520 696e 7365 6e73 6974   # case insensit
+000080c0: 6976 650a 2020 2020 2020 2020 6167 675f  ive.        agg_
+000080d0: 636f 6c75 6d6e 7320 3d20 6a73 6f6e 2e6c  columns = json.l
+000080e0: 6f61 6473 286a 736f 6e2e 6475 6d70 7328  oads(json.dumps(
+000080f0: 6167 675f 636f 6c75 6d6e 7329 290a 2020  agg_columns)).  
+00008100: 2020 2020 2020 6173 7365 7274 2061 6767        assert agg
+00008110: 5f63 6f6c 756d 6e73 2069 7320 6e6f 7420  _columns is not 
+00008120: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+00008130: 226a 736f 6e22 2069 6e20 6167 675f 636f  "json" in agg_co
+00008140: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
+00008150: 2020 2069 6620 6167 675f 636f 6c75 6d6e     if agg_column
+00008160: 735b 226a 736f 6e22 5d20 6973 204e 6f6e  s["json"] is Non
+00008170: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008180: 2020 2061 6767 5f63 6f6c 756d 6e73 5b22     agg_columns["
+00008190: 6a73 6f6e 225d 203d 205b 0a20 2020 2020  json"] = [.     
+000081a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000081b0: 6f6c 2066 6f72 2063 6f6c 2069 6e20 696e  ol for col in in
+000081c0: 7075 745f 6c61 7965 7269 6e66 6f2e 636f  put_layerinfo.co
+000081d0: 6c75 6d6e 7320 6966 2063 6f6c 2e75 7070  lumns if col.upp
+000081e0: 6572 2829 2021 3d20 2249 4e44 4558 220a  er() != "INDEX".
+000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008200: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+00008210: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00008220: 2020 2020 2320 416c 6967 6e20 6361 7369      # Align casi
+00008230: 6e67 206f 6620 636f 6c75 6d6e 206e 616d  ng of column nam
+00008240: 6573 2074 6f20 6461 7461 0a20 2020 2020  es to data.     
+00008250: 2020 2020 2020 2020 2020 2061 6767 5f63             agg_c
+00008260: 6f6c 756d 6e73 5b22 6a73 6f6e 225d 203d  olumns["json"] =
+00008270: 205f 6765 6e65 7261 6c5f 7574 696c 2e61   _general_util.a
+00008280: 6c69 676e 5f63 6173 696e 675f 6c69 7374  lign_casing_list
+00008290: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000082a0: 2020 2020 2020 6167 675f 636f 6c75 6d6e        agg_column
+000082b0: 735b 226a 736f 6e22 5d2c 206c 6973 7428  s["json"], list(
+000082c0: 696e 7075 745f 6c61 7965 7269 6e66 6f2e  input_layerinfo.
+000082d0: 636f 6c75 6d6e 7329 202b 205b 2266 6964  columns) + ["fid
+000082e0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+000082f0: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
+00008300: 6620 2263 6f6c 756d 6e73 2220 696e 2061  f "columns" in a
+00008310: 6767 5f63 6f6c 756d 6e73 3a0a 2020 2020  gg_columns:.    
+00008320: 2020 2020 2020 2020 2320 4c6f 6f70 2074          # Loop t
+00008330: 6872 6f75 6768 2061 6c6c 2072 6f77 730a  hrough all rows.
+00008340: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008350: 6167 675f 636f 6c75 6d6e 2069 6e20 6167  agg_column in ag
+00008360: 675f 636f 6c75 6d6e 735b 2263 6f6c 756d  g_columns["colum
+00008370: 6e73 225d 3a0a 2020 2020 2020 2020 2020  ns"]:.          
+00008380: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+00008390: 2063 6f6c 756d 6e20 6578 6973 7473 202b   column exists +
+000083a0: 2073 6574 2063 6173 696e 6720 7361 6d65   set casing same
+000083b0: 2061 7320 696e 2064 6174 610a 2020 2020   as in data.    
+000083c0: 2020 2020 2020 2020 2020 2020 6167 675f              agg_
+000083d0: 636f 6c75 6d6e 5b22 636f 6c75 6d6e 225d  column["column"]
+000083e0: 203d 205f 6765 6e65 7261 6c5f 7574 696c   = _general_util
+000083f0: 2e61 6c69 676e 5f63 6173 696e 6728 0a20  .align_casing(. 
+00008400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008410: 2020 2061 6767 5f63 6f6c 756d 6e5b 2263     agg_column["c
+00008420: 6f6c 756d 6e22 5d2c 206c 6973 7428 696e  olumn"], list(in
+00008430: 7075 745f 6c61 7965 7269 6e66 6f2e 636f  put_layerinfo.co
+00008440: 6c75 6d6e 7329 202b 205b 2266 6964 225d  lumns) + ["fid"]
+00008450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008460: 2029 0a0a 2020 2020 2320 4e6f 7720 696e   )..    # Now in
+00008470: 7075 7420 7061 7261 6d65 7465 7273 2061  put parameters a
+00008480: 7265 2063 6865 636b 6564 2c20 6368 6563  re checked, chec
+00008490: 6b20 6966 2077 6520 6e65 6564 2074 6f20  k if we need to 
+000084a0: 6361 6c63 756c 6174 6520 616e 7977 6179  calculate anyway
+000084b0: 0a20 2020 2069 6620 6f75 7470 7574 5f70  .    if output_p
+000084c0: 6174 682e 6578 6973 7473 2829 3a0a 2020  ath.exists():.  
+000084d0: 2020 2020 2020 6966 2066 6f72 6365 2069        if force i
+000084e0: 7320 4661 6c73 653a 0a20 2020 2020 2020  s False:.       
+000084f0: 2020 2020 2072 6573 756c 745f 696e 666f       result_info
+00008500: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00008510: 2020 226d 6573 7361 6765 220a 2020 2020    "message".    
+00008520: 2020 2020 2020 2020 5d20 3d20 6622 6f75          ] = f"ou
+00008530: 7470 7574 2065 7869 7374 7320 616c 7265  tput exists alre
+00008540: 6164 7920 7b6f 7574 7075 745f 7061 7468  ady {output_path
+00008550: 7d20 616e 6420 666f 7263 6520 6973 2066  } and force is f
+00008560: 616c 7365 220a 2020 2020 2020 2020 2020  alse".          
+00008570: 2020 6c6f 6767 6572 2e69 6e66 6f28 7265    logger.info(re
+00008580: 7375 6c74 5f69 6e66 6f5b 226d 6573 7361  sult_info["messa
+00008590: 6765 225d 290a 2020 2020 2020 2020 2020  ge"]).          
+000085a0: 2020 7265 7475 726e 2072 6573 756c 745f    return result_
+000085b0: 696e 666f 0a20 2020 2020 2020 2065 6c73  info.        els
+000085c0: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+000085d0: 666f 2e72 656d 6f76 6528 6f75 7470 7574  fo.remove(output
+000085e0: 5f70 6174 6829 0a0a 2020 2020 2320 4e6f  _path)..    # No
+000085f0: 7720 7374 6172 7420 6469 7373 6f6c 7669  w start dissolvi
+00008600: 6e67 0a20 2020 2023 202d 2d2d 2d2d 2d2d  ng.    # -------
+00008610: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+00008620: 2020 2320 456d 7074 7920 6f72 204c 696e    # Empty or Lin
+00008630: 6520 616e 6420 706f 696e 7420 6c61 7965  e and point laye
+00008640: 7273 2061 7265 3a0a 2020 2020 2320 2020  rs are:.    #   
+00008650: 2a20 6e6f 7420 736f 206c 6172 6765 2028  * not so large (
+00008660: 6d65 6d6f 7279 2d77 6973 6529 0a20 2020  memory-wise).   
+00008670: 2023 2020 202a 2061 7265 6e27 7420 636f   #   * aren't co
+00008680: 6d70 7574 6174 696f 6e61 6c6c 7920 6865  mputationally he
+00008690: 6176 790a 2020 2020 2320 4164 6469 7469  avy.    # Additi
+000086a0: 6f6e 616c 6c79 206c 696e 6520 6c61 7965  onally line laye
+000086b0: 7273 2061 7265 2061 2070 6169 6e20 746f  rs are a pain to
+000086c0: 2068 616e 646c 6520 636f 7272 6563 746c   handle correctl
+000086d0: 7920 6265 6361 7573 6520 6f66 0a20 2020  y because of.   
+000086e0: 2023 2072 6f75 6e64 696e 6720 6973 7375   # rounding issu
+000086f0: 6573 2061 7420 7468 6520 626f 7264 6572  es at the border
+00008700: 7320 6f66 2074 696c 6573 2e2e 2e20 736f  s of tiles... so
+00008710: 206a 7573 7420 6469 7373 6f6c 7665 2074   just dissolve t
+00008720: 6865 6d20 696e 206f 6e65 2067 6f2e 0a20  hem in one go.. 
+00008730: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+00008740: 696e 7075 745f 6c61 7965 7269 6e66 6f2e  input_layerinfo.
+00008750: 6665 6174 7572 6563 6f75 6e74 203d 3d20  featurecount == 
+00008760: 300a 2020 2020 2020 2020 6f72 2069 6e70  0.        or inp
+00008770: 7574 5f6c 6179 6572 696e 666f 2e67 656f  ut_layerinfo.geo
+00008780: 6d65 7472 7974 7970 652e 746f 5f70 7269  metrytype.to_pri
+00008790: 6d69 7469 7665 7479 7065 0a20 2020 2020  mitivetype.     
+000087a0: 2020 2069 6e20 5b0a 2020 2020 2020 2020     in [.        
+000087b0: 2020 2020 5072 696d 6974 6976 6554 7970      PrimitiveTyp
+000087c0: 652e 504f 494e 542c 0a20 2020 2020 2020  e.POINT,.       
+000087d0: 2020 2020 2050 7269 6d69 7469 7665 5479       PrimitiveTy
+000087e0: 7065 2e4c 494e 4553 5452 494e 472c 0a20  pe.LINESTRING,. 
+000087f0: 2020 2020 2020 205d 0a20 2020 2029 3a0a         ].    ):.
+00008800: 2020 2020 2020 2020 5f67 656f 6f70 735f          _geoops_
+00008810: 7371 6c2e 6469 7373 6f6c 7665 5f73 696e  sql.dissolve_sin
+00008820: 676c 6574 6872 6561 6428 0a20 2020 2020  glethread(.     
+00008830: 2020 2020 2020 2069 6e70 7574 5f70 6174         input_pat
+00008840: 683d 696e 7075 745f 7061 7468 2c0a 2020  h=input_path,.  
+00008850: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00008860: 5f70 6174 683d 6f75 7470 7574 5f70 6174  _path=output_pat
+00008870: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
+00008880: 7870 6c6f 6465 636f 6c6c 6563 7469 6f6e  xplodecollection
+00008890: 733d 6578 706c 6f64 6563 6f6c 6c65 6374  s=explodecollect
+000088a0: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
+000088b0: 2020 6772 6f75 7062 795f 636f 6c75 6d6e    groupby_column
+000088c0: 733d 6772 6f75 7062 795f 636f 6c75 6d6e  s=groupby_column
+000088d0: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
+000088e0: 6767 5f63 6f6c 756d 6e73 3d61 6767 5f63  gg_columns=agg_c
+000088f0: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00008900: 2020 2020 696e 7075 745f 6c61 7965 723d      input_layer=
+00008910: 696e 7075 745f 6c61 7965 722c 0a20 2020  input_layer,.   
+00008920: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+00008930: 6c61 7965 723d 6f75 7470 7574 5f6c 6179  layer=output_lay
+00008940: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00008950: 6772 6964 7369 7a65 3d67 7269 6473 697a  gridsize=gridsiz
+00008960: 652c 0a20 2020 2020 2020 2020 2020 206b  e,.            k
+00008970: 6565 705f 656d 7074 795f 6765 6f6d 733d  eep_empty_geoms=
+00008980: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00008990: 2020 2077 6865 7265 3d77 6865 7265 2c0a     where=where,.
+000089a0: 2020 2020 2020 2020 2020 2020 666f 7263              forc
+000089b0: 653d 666f 7263 652c 0a20 2020 2020 2020  e=force,.       
+000089c0: 2029 0a0a 2020 2020 656c 6966 2069 6e70   )..    elif inp
+000089d0: 7574 5f6c 6179 6572 696e 666f 2e67 656f  ut_layerinfo.geo
+000089e0: 6d65 7472 7974 7970 652e 746f 5f70 7269  metrytype.to_pri
+000089f0: 6d69 7469 7665 7479 7065 2069 7320 5072  mitivetype is Pr
+00008a00: 696d 6974 6976 6554 7970 652e 504f 4c59  imitiveType.POLY
+00008a10: 474f 4e3a 0a20 2020 2020 2020 2023 2050  GON:.        # P
+00008a20: 7265 7061 7265 2077 6865 7265 0a20 2020  repare where.   
+00008a30: 2020 2020 2069 6620 7768 6572 6520 6973       if where is
+00008a40: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00008a50: 2020 2020 2020 2069 6620 7768 6572 6520         if where 
+00008a60: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+00008a70: 2020 2020 2020 2077 6865 7265 203d 204e         where = N
+00008a80: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00008a90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008aa0: 2020 2020 2020 2320 5365 7420 6765 6f6d        # Set geom
+00008ab0: 6574 7279 636f 6c75 6d6e 2074 6f20 2267  etrycolumn to "g
+00008ac0: 656f 6d22 2c20 6265 6361 7573 6520 7465  eom", because te
+00008ad0: 6d70 2066 696c 6573 2061 7265 2073 6176  mp files are sav
+00008ae0: 6564 2061 7320 6770 6b67 2e0a 2020 2020  ed as gpkg..    
+00008af0: 2020 2020 2020 2020 2020 2020 7768 6572              wher
+00008b00: 6520 3d20 7768 6572 652e 666f 726d 6174  e = where.format
+00008b10: 2867 656f 6d65 7472 7963 6f6c 756d 6e3d  (geometrycolumn=
+00008b20: 2267 656f 6d22 290a 0a20 2020 2020 2020  "geom")..       
+00008b30: 2023 2049 6620 6120 7469 6c65 735f 7061   # If a tiles_pa
+00008b40: 7468 2069 7320 7370 6563 6966 6965 642c  th is specified,
+00008b50: 2072 6561 6420 7468 6f73 6520 7469 6c65   read those tile
+00008b60: 732e 2e2e 0a20 2020 2020 2020 2072 6573  s....        res
+00008b70: 756c 745f 7469 6c65 735f 6764 6620 3d20  ult_tiles_gdf = 
+00008b80: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+00008b90: 7469 6c65 735f 7061 7468 2069 7320 6e6f  tiles_path is no
+00008ba0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00008bb0: 2020 2020 7265 7375 6c74 5f74 696c 6573      result_tiles
+00008bc0: 5f67 6466 203d 2067 666f 2e72 6561 645f  _gdf = gfo.read_
+00008bd0: 6669 6c65 2874 696c 6573 5f70 6174 6829  file(tiles_path)
+00008be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008bf0: 6e62 5f70 6172 616c 6c65 6c20 3d3d 202d  nb_parallel == -
+00008c00: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00008c10: 2020 206e 625f 6370 7520 3d20 6d75 6c74     nb_cpu = mult
+00008c20: 6970 726f 6365 7373 696e 672e 6370 755f  iprocessing.cpu_
+00008c30: 636f 756e 7428 290a 2020 2020 2020 2020  count().        
+00008c40: 2020 2020 2020 2020 6e62 5f70 6172 616c          nb_paral
+00008c50: 6c65 6c20 3d20 6e62 5f63 7075 2020 2320  lel = nb_cpu  # 
+00008c60: 696e 7428 312e 3235 202a 206e 625f 6370  int(1.25 * nb_cp
+00008c70: 7529 0a20 2020 2020 2020 2020 2020 2020  u).             
+00008c80: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00008c90: 6622 4e62 2063 7075 7320 666f 756e 643a  f"Nb cpus found:
+00008ca0: 207b 6e62 5f63 7075 7d2c 206e 625f 7061   {nb_cpu}, nb_pa
+00008cb0: 7261 6c6c 656c 3a20 7b6e 625f 7061 7261  rallel: {nb_para
+00008cc0: 6c6c 656c 7d22 290a 2020 2020 2020 2020  llel}").        
+00008cd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008ce0: 2020 2320 456c 7365 2c20 6372 6561 7465    # Else, create
+00008cf0: 2061 2067 7269 6420 6261 7365 6420 6f6e   a grid based on
+00008d00: 2074 6865 206e 756d 6265 7220 6f66 2074   the number of t
+00008d10: 696c 6573 2077 616e 7465 6420 6173 2072  iles wanted as r
+00008d20: 6573 756c 740a 2020 2020 2020 2020 2020  esult.          
+00008d30: 2020 2320 5573 6520 6120 6d61 7267 696e    # Use a margin
+00008d40: 206f 6620 3120 6d65 7465 7220 6172 6f75   of 1 meter arou
+00008d50: 6e64 2074 6865 2062 6f75 6e64 730a 2020  nd the bounds.  
+00008d60: 2020 2020 2020 2020 2020 6d61 7267 696e            margin
+00008d70: 203d 2031 2e30 0a20 2020 2020 2020 2020   = 1.0.         
+00008d80: 2020 2069 6620 696e 7075 745f 6c61 7965     if input_laye
+00008d90: 7269 6e66 6f2e 6372 7320 6973 206e 6f74  rinfo.crs is not
+00008da0: 204e 6f6e 6520 616e 6420 6e6f 7420 696e   None and not in
+00008db0: 7075 745f 6c61 7965 7269 6e66 6f2e 6372  put_layerinfo.cr
+00008dc0: 732e 6973 5f70 726f 6a65 6374 6564 3a0a  s.is_projected:.
+00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008de0: 2320 4966 2067 656f 6772 6170 6869 6320  # If geographic 
+00008df0: 6372 732c 2031 2064 6567 7265 6520 3d20  crs, 1 degree = 
+00008e00: 3131 3120 6b6d 206f 7220 3131 3130 3030  111 km or 111000
+00008e10: 206d 0a20 2020 2020 2020 2020 2020 2020   m.             
+00008e20: 2020 206d 6172 6769 6e20 2f3d 2031 3131     margin /= 111
+00008e30: 3030 300a 2020 2020 2020 2020 2020 2020  000.            
+00008e40: 626f 756e 6473 203d 2069 6e70 7574 5f6c  bounds = input_l
+00008e50: 6179 6572 696e 666f 2e74 6f74 616c 5f62  ayerinfo.total_b
+00008e60: 6f75 6e64 730a 2020 2020 2020 2020 2020  ounds.          
+00008e70: 2020 626f 756e 6473 203d 2028 0a20 2020    bounds = (.   
+00008e80: 2020 2020 2020 2020 2020 2020 2062 6f75               bou
+00008e90: 6e64 735b 305d 202d 206d 6172 6769 6e2c  nds[0] - margin,
+00008ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008eb0: 2062 6f75 6e64 735b 315d 202d 206d 6172   bounds[1] - mar
+00008ec0: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
+00008ed0: 2020 2020 2062 6f75 6e64 735b 325d 202b       bounds[2] +
+00008ee0: 206d 6172 6769 6e2c 0a20 2020 2020 2020   margin,.       
+00008ef0: 2020 2020 2020 2020 2062 6f75 6e64 735b           bounds[
+00008f00: 335d 202b 206d 6172 6769 6e2c 0a20 2020  3] + margin,.   
+00008f10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00008f20: 2020 2020 2020 2072 6573 756c 745f 7469         result_ti
+00008f30: 6c65 735f 6764 6620 3d20 6772 6964 5f75  les_gdf = grid_u
+00008f40: 7469 6c2e 6372 6561 7465 5f67 7269 6432  til.create_grid2
+00008f50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008f60: 2020 626f 756e 6473 2c20 6e62 5f73 7175    bounds, nb_squ
+00008f70: 6172 6973 685f 7469 6c65 732c 2069 6e70  arish_tiles, inp
+00008f80: 7574 5f6c 6179 6572 696e 666f 2e63 7273  ut_layerinfo.crs
+00008f90: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00008fa0: 2020 2020 2020 2020 2320 4170 706c 7920          # Apply 
+00008fb0: 6772 6964 7369 7a65 2074 6f6c 6572 616e  gridsize toleran
+00008fc0: 6365 206f 6e20 7469 6c65 732c 206f 7468  ce on tiles, oth
+00008fd0: 6572 7769 7365 2074 6865 2062 6f72 6465  erwise the borde
+00008fe0: 7220 706f 6c79 676f 6e73 2063 616e 2774  r polygons can't
+00008ff0: 2062 650a 2020 2020 2020 2020 2320 756e   be.        # un
+00009000: 696f 6e65 6420 7072 6f70 6572 6c79 2062  ioned properly b
+00009010: 6563 6175 7365 2067 6170 7320 6170 7065  ecause gaps appe
+00009020: 6172 2061 6674 6572 2072 6f75 6e64 696e  ar after roundin
+00009030: 6720 636f 6f72 6469 6e61 7465 732e 0a20  g coordinates.. 
+00009040: 2020 2020 2020 2069 6620 6772 6964 7369         if gridsi
+00009050: 7a65 2021 3d20 302e 303a 0a20 2020 2020  ze != 0.0:.     
+00009060: 2020 2020 2020 2072 6573 756c 745f 7469         result_ti
+00009070: 6c65 735f 6764 662e 6765 6f6d 6574 7279  les_gdf.geometry
+00009080: 203d 2073 6861 7065 6c79 325f 6f72 5f70   = shapely2_or_p
+00009090: 7967 656f 732e 7365 745f 7072 6563 6973  ygeos.set_precis
+000090a0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+000090b0: 2020 2020 2072 6573 756c 745f 7469 6c65       result_tile
+000090c0: 735f 6764 662e 6765 6f6d 6574 7279 2e61  s_gdf.geometry.a
+000090d0: 7272 6179 2e64 6174 612c 2067 7269 645f  rray.data, grid_
+000090e0: 7369 7a65 3d67 7269 6473 697a 650a 2020  size=gridsize.  
+000090f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00009100: 2020 2020 6966 206c 656e 2872 6573 756c      if len(resul
+00009110: 745f 7469 6c65 735f 6764 6629 203e 2031  t_tiles_gdf) > 1
+00009120: 3a0a 2020 2020 2020 2020 2020 2020 6766  :.            gf
+00009130: 6f2e 746f 5f66 696c 6528 0a20 2020 2020  o.to_file(.     
+00009140: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00009150: 745f 7469 6c65 735f 6764 662c 0a20 2020  t_tiles_gdf,.   
+00009160: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00009170: 7075 745f 7061 7468 2e70 6172 656e 7420  put_path.parent 
+00009180: 2f20 6622 7b6f 7574 7075 745f 7061 7468  / f"{output_path
+00009190: 2e73 7465 6d7d 5f74 696c 6573 2e67 706b  .stem}_tiles.gpk
+000091a0: 6722 2c0a 2020 2020 2020 2020 2020 2020  g",.            
+000091b0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+000091c0: 6120 7469 6c65 6420 7265 7375 6c74 2069  a tiled result i
+000091d0: 7320 6173 6b65 642c 2061 6464 2074 696c  s asked, add til
+000091e0: 655f 6964 2074 6f20 6772 6f75 7020 6f6e  e_id to group on
+000091f0: 2066 6f72 2074 6865 2072 6573 756c 740a   for the result.
+00009200: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+00009210: 6573 756c 745f 7469 6c65 735f 6764 6629  esult_tiles_gdf)
+00009220: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+00009230: 2020 7265 7375 6c74 5f74 696c 6573 5f67    result_tiles_g
+00009240: 6466 5b22 7469 6c65 5f69 6422 5d20 3d20  df["tile_id"] = 
+00009250: 7265 7375 6c74 5f74 696c 6573 5f67 6466  result_tiles_gdf
+00009260: 2e72 6573 6574 5f69 6e64 6578 2829 2e69  .reset_index().i
+00009270: 6e64 6578 0a0a 2020 2020 2020 2020 2320  ndex..        # 
+00009280: 5468 6520 6469 7373 6f6c 7665 2066 6f72  The dissolve for
+00009290: 2070 6f6c 7967 6f6e 7320 6973 2064 6f6e   polygons is don
+000092a0: 6520 696e 2073 6576 6572 616c 2070 6173  e in several pas
+000092b0: 7365 732c 2061 6e64 2061 6674 6572 2074  ses, and after t
+000092c0: 6865 2066 6972 7374 0a20 2020 2020 2020  he first.       
+000092d0: 2023 2070 6173 732c 206f 6e6c 7920 7468   # pass, only th
+000092e0: 6520 276f 6e62 6f72 6465 7227 2066 6561  e 'onborder' fea
+000092f0: 7475 7265 7320 6172 6520 6675 7274 6865  tures are furthe
+00009300: 7220 6469 7373 6f6c 7665 642c 2061 7320  r dissolved, as 
+00009310: 7468 650a 2020 2020 2020 2020 2320 276e  the.        # 'n
+00009320: 6f74 6f6e 626f 7264 6572 2720 6665 6174  otonborder' feat
+00009330: 7572 6573 2061 7265 2061 6c72 6561 6479  ures are already
+00009340: 204f 4b2e 0a20 2020 2020 2020 2074 656d   OK..        tem
+00009350: 7064 6972 203d 205f 696f 5f75 7469 6c2e  pdir = _io_util.
+00009360: 6372 6561 7465 5f74 656d 7064 6972 2866  create_tempdir(f
+00009370: 2267 656f 6669 6c65 6f70 732f 7b6f 7065  "geofileops/{ope
+00009380: 7261 7469 6f6e 7d22 290a 2020 2020 2020  ration}").      
+00009390: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000093a0: 2020 2069 6620 6f75 7470 7574 5f6c 6179     if output_lay
+000093b0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+000093c0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+000093d0: 7574 5f6c 6179 6572 203d 2067 666f 2e67  ut_layer = gfo.g
+000093e0: 6574 5f64 6566 6175 6c74 5f6c 6179 6572  et_default_layer
+000093f0: 286f 7574 7075 745f 7061 7468 290a 2020  (output_path).  
+00009400: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00009410: 5f74 6d70 5f70 6174 6820 3d20 7465 6d70  _tmp_path = temp
+00009420: 6469 7220 2f20 226f 7574 7075 745f 746d  dir / "output_tm
+00009430: 702e 6770 6b67 220a 2020 2020 2020 2020  p.gpkg".        
+00009440: 2020 2020 7072 6576 5f6e 625f 6261 7463      prev_nb_batc
+00009450: 6865 7320 3d20 4e6f 6e65 0a20 2020 2020  hes = None.     
+00009460: 2020 2020 2020 206c 6173 745f 7061 7373         last_pass
+00009470: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00009480: 2020 2020 2070 6173 735f 6964 203d 2030       pass_id = 0
+00009490: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+000094a0: 6765 722e 696e 666f 2866 2253 7461 7274  ger.info(f"Start
+000094b0: 2064 6973 736f 6c76 6520 6f6e 2066 696c   dissolve on fil
+000094c0: 6520 7b69 6e70 7574 5f70 6174 687d 2229  e {input_path}")
+000094d0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+000094e0: 7574 5f70 6173 735f 6c61 7965 7220 3d20  ut_pass_layer = 
+000094f0: 696e 7075 745f 6c61 7965 720a 2020 2020  input_layer.    
+00009500: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+00009510: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00009520: 2020 2020 2320 4765 7420 696e 666f 206f      # Get info o
+00009530: 6620 7468 6520 6375 7272 656e 7420 6669  f the current fi
+00009540: 6c65 2074 6861 7420 6e65 6564 7320 746f  le that needs to
+00009550: 2062 6520 6469 7373 6f6c 7665 640a 2020   be dissolved.  
+00009560: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00009570: 7075 745f 7061 7373 5f6c 6179 6572 696e  put_pass_layerin
+00009580: 666f 203d 2067 666f 2e67 6574 5f6c 6179  fo = gfo.get_lay
+00009590: 6572 696e 666f 2869 6e70 7574 5f70 6174  erinfo(input_pat
+000095a0: 682c 2069 6e70 7574 5f70 6173 735f 6c61  h, input_pass_la
+000095b0: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+000095c0: 2020 2020 206e 625f 726f 7773 5f74 6f74       nb_rows_tot
+000095d0: 616c 203d 2069 6e70 7574 5f70 6173 735f  al = input_pass_
+000095e0: 6c61 7965 7269 6e66 6f2e 6665 6174 7572  layerinfo.featur
+000095f0: 6563 6f75 6e74 0a0a 2020 2020 2020 2020  ecount..        
+00009600: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00009610: 6174 6520 7468 6520 6265 7374 206e 756d  ate the best num
+00009620: 6265 7220 6f66 2070 6172 616c 6c65 6c20  ber of parallel 
+00009630: 7072 6f63 6573 7365 7320 616e 6420 6261  processes and ba
+00009640: 7463 6865 7320 666f 720a 2020 2020 2020  tches for.      
+00009650: 2020 2020 2020 2020 2020 2320 7468 6520            # the 
+00009660: 6176 6169 6c61 626c 6520 7265 736f 7572  available resour
+00009670: 6365 7320 666f 7220 7468 6520 6375 7272  ces for the curr
+00009680: 656e 7420 7061 7373 0a20 2020 2020 2020  ent pass.       
+00009690: 2020 2020 2020 2020 2069 6620 6261 7463           if batc
+000096a0: 6873 697a 6520 3e20 303a 0a20 2020 2020  hsize > 0:.     
+000096b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000096c0: 6172 616c 6c65 6c69 7a61 7469 6f6e 5f63  arallelization_c
+000096d0: 6f6e 6669 6720 3d20 5061 7261 6c6c 656c  onfig = Parallel
+000096e0: 697a 6174 696f 6e43 6f6e 6669 6728 0a20  izationConfig(. 
+000096f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009700: 2020 2020 2020 206d 696e 5f61 7667 5f72         min_avg_r
+00009710: 6f77 735f 7065 725f 6261 7463 683d 696e  ows_per_batch=in
+00009720: 7428 6d61 7468 2e63 6569 6c28 6261 7463  t(math.ceil(batc
+00009730: 6873 697a 6520 2f20 3229 292c 0a20 2020  hsize / 2)),.   
+00009740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009750: 2020 2020 206d 6178 5f61 7667 5f72 6f77       max_avg_row
+00009760: 735f 7065 725f 6261 7463 683d 6261 7463  s_per_batch=batc
+00009770: 6873 697a 652c 0a20 2020 2020 2020 2020  hsize,.         
+00009780: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00009790: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000097a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000097b0: 2020 2020 2020 2070 6172 616c 6c65 6c69         paralleli
+000097c0: 7a61 7469 6f6e 5f63 6f6e 6669 6720 3d20  zation_config = 
+000097d0: 5061 7261 6c6c 656c 697a 6174 696f 6e43  ParallelizationC
+000097e0: 6f6e 6669 6728 290a 2020 2020 2020 2020  onfig().        
+000097f0: 2020 2020 2020 2020 6e62 5f70 6172 616c          nb_paral
+00009800: 6c65 6c2c 206e 625f 6261 7463 6865 735f  lel, nb_batches_
+00009810: 7265 636f 6d6d 656e 6465 642c 205f 203d  recommended, _ =
+00009820: 2067 6574 5f70 6172 616c 6c65 6c69 7a61   get_paralleliza
+00009830: 7469 6f6e 5f70 6172 616d 7328 0a20 2020  tion_params(.   
+00009840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009850: 206e 625f 726f 7773 5f74 6f74 616c 3d6e   nb_rows_total=n
+00009860: 625f 726f 7773 5f74 6f74 616c 2c0a 2020  b_rows_total,.  
+00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009880: 2020 6e62 5f70 6172 616c 6c65 6c3d 6e62    nb_parallel=nb
+00009890: 5f70 6172 616c 6c65 6c2c 0a20 2020 2020  _parallel,.     
+000098a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000098b0: 625f 6261 7463 6865 735f 7072 6576 696f  b_batches_previo
+000098c0: 7573 5f70 6173 733d 7072 6576 5f6e 625f  us_pass=prev_nb_
+000098d0: 6261 7463 6865 732c 0a20 2020 2020 2020  batches,.       
+000098e0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+000098f0: 616c 6c65 6c69 7a61 7469 6f6e 5f63 6f6e  allelization_con
+00009900: 6669 673d 7061 7261 6c6c 656c 697a 6174  fig=parallelizat
+00009910: 696f 6e5f 636f 6e66 6967 2c0a 2020 2020  ion_config,.    
+00009920: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00009930: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009940: 2049 6620 7468 6520 6964 6561 6c20 6e75   If the ideal nu
+00009950: 6d62 6572 206f 6620 6261 7463 6865 7320  mber of batches 
+00009960: 6973 2063 6c6f 7365 2074 6f20 7468 6520  is close to the 
+00009970: 6e62 2e20 7265 7375 6c74 2074 696c 6573  nb. result tiles
+00009980: 2061 736b 6564 2c0a 2020 2020 2020 2020   asked,.        
+00009990: 2020 2020 2020 2020 2320 6469 7373 6f6c          # dissol
+000099a0: 7665 2074 6f77 6172 6473 2074 6865 2061  ve towards the a
+000099b0: 736b 6564 2072 6573 756c 7421 0a20 2020  sked result!.   
+000099c0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+000099d0: 6620 6e6f 742c 2061 2074 656d 706f 7261  f not, a tempora
+000099e0: 7279 2072 6573 756c 7420 6973 2063 7265  ry result is cre
+000099f0: 6174 6564 2075 7369 6e67 2073 6d61 6c6c  ated using small
+00009a00: 6572 2074 696c 6573 0a20 2020 2020 2020  er tiles.       
+00009a10: 2020 2020 2020 2020 2069 6620 6e62 5f62           if nb_b
+00009a20: 6174 6368 6573 5f72 6563 6f6d 6d65 6e64  atches_recommend
+00009a30: 6564 203c 3d20 6c65 6e28 7265 7375 6c74  ed <= len(result
+00009a40: 5f74 696c 6573 5f67 6466 2920 2a20 312e  _tiles_gdf) * 1.
+00009a50: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00009a60: 2020 2020 2020 2074 696c 6573 5f67 6466         tiles_gdf
+00009a70: 203d 2072 6573 756c 745f 7469 6c65 735f   = result_tiles_
+00009a80: 6764 660a 2020 2020 2020 2020 2020 2020  gdf.            
+00009a90: 2020 2020 2020 2020 6c61 7374 5f70 6173          last_pas
+00009aa0: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
+00009ab0: 2020 2020 2020 2020 2020 2020 206e 625f               nb_
+00009ac0: 7061 7261 6c6c 656c 203d 206d 696e 286c  parallel = min(l
+00009ad0: 656e 2872 6573 756c 745f 7469 6c65 735f  en(result_tiles_
+00009ae0: 6764 6629 2c20 6e62 5f70 6172 616c 6c65  gdf), nb_paralle
+00009af0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+00009b00: 2020 2065 6c69 6620 6c65 6e28 7265 7375     elif len(resu
+00009b10: 6c74 5f74 696c 6573 5f67 6466 2920 3d3d  lt_tiles_gdf) ==
+00009b20: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00009b30: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+00009b40: 2061 2067 7269 6420 6261 7365 6420 6f6e   a grid based on
+00009b50: 2074 6865 2069 6465 616c 206e 756d 6265   the ideal numbe
+00009b60: 7220 6f66 2062 6174 6368 6573 2c20 6275  r of batches, bu
+00009b70: 7420 6d61 6b65 0a20 2020 2020 2020 2020  t make.         
+00009b80: 2020 2020 2020 2020 2020 2023 2073 7572             # sur
+00009b90: 6520 7468 6520 6e75 6d62 6572 2069 7320  e the number is 
+00009ba0: 736d 616c 6c65 7220 7468 616e 2074 6865  smaller than the
+00009bb0: 206d 6178 696d 756d 2e2e 2e0a 2020 2020   maximum....    
 00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 2023 2073 7572 6520 7468 6520 6e75 6d62   # sure the numb
-00009be0: 6572 2069 7320 736d 616c 6c65 7220 7468  er is smaller th
-00009bf0: 616e 2074 6865 206d 6178 696d 756d 2e2e  an the maximum..
-00009c00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009c10: 2020 2020 2020 6e62 5f73 7175 6172 6973        nb_squaris
-00009c20: 685f 7469 6c65 735f 6d61 7820 3d20 4e6f  h_tiles_max = No
-00009c30: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00009c40: 2020 2020 2020 2069 6620 7072 6576 5f6e         if prev_n
-00009c50: 625f 6261 7463 6865 7320 6973 206e 6f74  b_batches is not
-00009c60: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00009c70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00009c80: 625f 7371 7561 7269 7368 5f74 696c 6573  b_squarish_tiles
-00009c90: 5f6d 6178 203d 206d 6178 2870 7265 765f  _max = max(prev_
-00009ca0: 6e62 5f62 6174 6368 6573 202d 2031 2c20  nb_batches - 1, 
-00009cb0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00009cc0: 2020 2020 2020 2074 696c 6573 5f67 6466         tiles_gdf
-00009cd0: 203d 2067 7269 645f 7574 696c 2e63 7265   = grid_util.cre
-00009ce0: 6174 655f 6772 6964 3228 0a20 2020 2020  ate_grid2(.     
+00009bd0: 6e62 5f73 7175 6172 6973 685f 7469 6c65  nb_squarish_tile
+00009be0: 735f 6d61 7820 3d20 4e6f 6e65 0a20 2020  s_max = None.   
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 2069 6620 7072 6576 5f6e 625f 6261 7463   if prev_nb_batc
+00009c10: 6865 7320 6973 206e 6f74 204e 6f6e 653a  hes is not None:
+00009c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009c30: 2020 2020 2020 2020 206e 625f 7371 7561           nb_squa
+00009c40: 7269 7368 5f74 696c 6573 5f6d 6178 203d  rish_tiles_max =
+00009c50: 206d 6178 2870 7265 765f 6e62 5f62 6174   max(prev_nb_bat
+00009c60: 6368 6573 202d 2031 2c20 3129 0a20 2020  ches - 1, 1).   
+00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c80: 2074 696c 6573 5f67 6466 203d 2067 7269   tiles_gdf = gri
+00009c90: 645f 7574 696c 2e63 7265 6174 655f 6772  d_util.create_gr
+00009ca0: 6964 3228 0a20 2020 2020 2020 2020 2020  id2(.           
+00009cb0: 2020 2020 2020 2020 2020 2020 2074 6f74               tot
+00009cc0: 616c 5f62 6f75 6e64 733d 696e 7075 745f  al_bounds=input_
+00009cd0: 7061 7373 5f6c 6179 6572 696e 666f 2e74  pass_layerinfo.t
+00009ce0: 6f74 616c 5f62 6f75 6e64 732c 0a20 2020  otal_bounds,.   
 00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d00: 2020 2074 6f74 616c 5f62 6f75 6e64 733d     total_bounds=
-00009d10: 696e 7075 745f 7061 7373 5f6c 6179 6572  input_pass_layer
-00009d20: 696e 666f 2e74 6f74 616c 5f62 6f75 6e64  info.total_bound
-00009d30: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00009d40: 2020 2020 2020 2020 2020 206e 625f 7371             nb_sq
-00009d50: 7561 7269 7368 5f74 696c 6573 3d6e 625f  uarish_tiles=nb_
-00009d60: 6261 7463 6865 735f 7265 636f 6d6d 656e  batches_recommen
-00009d70: 6465 642c 0a20 2020 2020 2020 2020 2020  ded,.           
-00009d80: 2020 2020 2020 2020 2020 2020 206e 625f               nb_
-00009d90: 7371 7561 7269 7368 5f74 696c 6573 5f6d  squarish_tiles_m
-00009da0: 6178 3d6e 625f 7371 7561 7269 7368 5f74  ax=nb_squarish_t
-00009db0: 696c 6573 5f6d 6178 2c0a 2020 2020 2020  iles_max,.      
+00009d00: 2020 2020 206e 625f 7371 7561 7269 7368       nb_squarish
+00009d10: 5f74 696c 6573 3d6e 625f 6261 7463 6865  _tiles=nb_batche
+00009d20: 735f 7265 636f 6d6d 656e 6465 642c 0a20  s_recommended,. 
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d40: 2020 2020 2020 206e 625f 7371 7561 7269         nb_squari
+00009d50: 7368 5f74 696c 6573 5f6d 6178 3d6e 625f  sh_tiles_max=nb_
+00009d60: 7371 7561 7269 7368 5f74 696c 6573 5f6d  squarish_tiles_m
+00009d70: 6178 2c0a 2020 2020 2020 2020 2020 2020  ax,.            
+00009d80: 2020 2020 2020 2020 2020 2020 6372 733d              crs=
+00009d90: 696e 7075 745f 7061 7373 5f6c 6179 6572  input_pass_layer
+00009da0: 696e 666f 2e63 7273 2c0a 2020 2020 2020  info.crs,.      
+00009db0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
 00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 2020 6372 733d 696e 7075 745f 7061 7373    crs=input_pass
-00009de0: 5f6c 6179 6572 696e 666f 2e63 7273 2c0a  _layerinfo.crs,.
-00009df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00009e10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e30: 2320 4966 2061 2067 7269 6420 6973 2073  # If a grid is s
-00009e40: 7065 6369 6669 6564 2061 6c72 6561 6479  pecified already
-00009e50: 2c20 6164 6420 6578 7472 6120 636f 6c75  , add extra colu
-00009e60: 6d6e 732f 726f 7773 2069 6e73 7465 6164  mns/rows instead
-00009e70: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-00009e80: 2020 2020 2020 2020 2320 6372 6561 7469          # creati
-00009e90: 6e67 206e 6577 206f 6e65 2e2e 2e0a 2020  ng new one....  
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 2020 7469 6c65 735f 6764 6620 3d20 6772    tiles_gdf = gr
-00009ec0: 6964 5f75 7469 6c2e 7370 6c69 745f 7469  id_util.split_ti
-00009ed0: 6c65 7328 0a20 2020 2020 2020 2020 2020  les(.           
-00009ee0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00009ef0: 756c 745f 7469 6c65 735f 6764 662c 206e  ult_tiles_gdf, n
-00009f00: 625f 6261 7463 6865 735f 7265 636f 6d6d  b_batches_recomm
-00009f10: 656e 6465 640a 2020 2020 2020 2020 2020  ended.          
-00009f20: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00009f30: 2020 2020 2020 2020 2020 2020 2023 2041               # A
-00009f40: 7070 6c79 2067 7269 6473 697a 6520 746f  pply gridsize to
-00009f50: 6c65 7261 6e63 6520 6f6e 2074 696c 6573  lerance on tiles
-00009f60: 2c20 6f74 6865 7277 6973 6520 7468 6520  , otherwise the 
-00009f70: 626f 7264 6572 2070 6f6c 7967 6f6e 7320  border polygons 
-00009f80: 6361 6e27 740a 2020 2020 2020 2020 2020  can't.          
-00009f90: 2020 2020 2020 2320 6265 2075 6e69 6f6e        # be union
-00009fa0: 6564 2070 726f 7065 726c 7920 6265 6361  ed properly beca
-00009fb0: 7573 6520 6761 7073 2061 7070 6561 7220  use gaps appear 
-00009fc0: 6166 7465 7220 726f 756e 6469 6e67 2063  after rounding c
-00009fd0: 6f6f 7264 696e 6174 6573 2e0a 2020 2020  oordinates..    
-00009fe0: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-00009ff0: 7269 6473 697a 6520 213d 2030 2e30 3a0a  ridsize != 0.0:.
-0000a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a010: 2020 2020 7469 6c65 735f 6764 662e 6765      tiles_gdf.ge
-0000a020: 6f6d 6574 7279 203d 2073 6861 7065 6c79  ometry = shapely
-0000a030: 325f 6f72 5f70 7967 656f 732e 7365 745f  2_or_pygeos.set_
-0000a040: 7072 6563 6973 696f 6e28 0a20 2020 2020  precision(.     
+00009dd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00009de0: 2020 2020 2020 2020 2020 2320 4966 2061            # If a
+00009df0: 2067 7269 6420 6973 2073 7065 6369 6669   grid is specifi
+00009e00: 6564 2061 6c72 6561 6479 2c20 6164 6420  ed already, add 
+00009e10: 6578 7472 6120 636f 6c75 6d6e 732f 726f  extra columns/ro
+00009e20: 7773 2069 6e73 7465 6164 206f 660a 2020  ws instead of.  
+00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e40: 2020 2320 6372 6561 7469 6e67 206e 6577    # creating new
+00009e50: 206f 6e65 2e2e 2e0a 2020 2020 2020 2020   one....        
+00009e60: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00009e70: 735f 6764 6620 3d20 6772 6964 5f75 7469  s_gdf = grid_uti
+00009e80: 6c2e 7370 6c69 745f 7469 6c65 7328 0a20  l.split_tiles(. 
+00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ea0: 2020 2020 2020 2072 6573 756c 745f 7469         result_ti
+00009eb0: 6c65 735f 6764 662c 206e 625f 6261 7463  les_gdf, nb_batc
+00009ec0: 6865 735f 7265 636f 6d6d 656e 6465 640a  hes_recommended.
+00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ee0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00009ef0: 2020 2020 2020 2023 2041 7070 6c79 2067         # Apply g
+00009f00: 7269 6473 697a 6520 746f 6c65 7261 6e63  ridsize toleranc
+00009f10: 6520 6f6e 2074 696c 6573 2c20 6f74 6865  e on tiles, othe
+00009f20: 7277 6973 6520 7468 6520 626f 7264 6572  rwise the border
+00009f30: 2070 6f6c 7967 6f6e 7320 6361 6e27 740a   polygons can't.
+00009f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f50: 2320 6265 2075 6e69 6f6e 6564 2070 726f  # be unioned pro
+00009f60: 7065 726c 7920 6265 6361 7573 6520 6761  perly because ga
+00009f70: 7073 2061 7070 6561 7220 6166 7465 7220  ps appear after 
+00009f80: 726f 756e 6469 6e67 2063 6f6f 7264 696e  rounding coordin
+00009f90: 6174 6573 2e0a 2020 2020 2020 2020 2020  ates..          
+00009fa0: 2020 2020 2020 6966 2067 7269 6473 697a        if gridsiz
+00009fb0: 6520 213d 2030 2e30 3a0a 2020 2020 2020  e != 0.0:.      
+00009fc0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00009fd0: 6c65 735f 6764 662e 6765 6f6d 6574 7279  les_gdf.geometry
+00009fe0: 203d 2073 6861 7065 6c79 325f 6f72 5f70   = shapely2_or_p
+00009ff0: 7967 656f 732e 7365 745f 7072 6563 6973  ygeos.set_precis
+0000a000: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0000a010: 2020 2020 2020 2020 2020 2020 2074 696c               til
+0000a020: 6573 5f67 6466 2e67 656f 6d65 7472 792e  es_gdf.geometry.
+0000a030: 6172 7261 792e 6461 7461 2c20 6772 6964  array.data, grid
+0000a040: 5f73 697a 653d 6772 6964 7369 7a65 0a20  _size=gridsize. 
 0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 2020 2074 696c 6573 5f67 6466 2e67 656f     tiles_gdf.geo
-0000a070: 6d65 7472 792e 6172 7261 792e 6461 7461  metry.array.data
-0000a080: 2c20 6772 6964 5f73 697a 653d 6772 6964  , grid_size=grid
-0000a090: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-0000a0a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000a0b0: 2020 2020 2020 2020 2020 2067 666f 2e74             gfo.t
-0000a0c0: 6f5f 6669 6c65 2874 696c 6573 5f67 6466  o_file(tiles_gdf
-0000a0d0: 2c20 7465 6d70 6469 7220 2f20 6622 6f75  , tempdir / f"ou
-0000a0e0: 7470 7574 5f7b 7061 7373 5f69 647d 5f74  tput_{pass_id}_t
-0000a0f0: 696c 6573 2e67 706b 6722 290a 0a20 2020  iles.gpkg")..   
-0000a100: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000a110: 6620 7468 6520 6e75 6d62 6572 206f 6620  f the number of 
-0000a120: 7469 6c65 7320 656e 6473 2075 7020 6173  tiles ends up as
-0000a130: 2031 2c20 6974 2069 7320 7468 6520 6c61   1, it is the la
-0000a140: 7374 2070 6173 7320 616e 7977 6179 2e2e  st pass anyway..
-0000a150: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a160: 2020 6966 206c 656e 2874 696c 6573 5f67    if len(tiles_g
-0000a170: 6466 2920 3d3d 2031 3a0a 2020 2020 2020  df) == 1:.      
-0000a180: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000a190: 7374 5f70 6173 7320 3d20 5472 7565 0a0a  st_pass = True..
-0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1b0: 2320 4966 2077 6520 6172 6520 6e6f 7420  # If we are not 
-0000a1c0: 696e 2074 6865 206c 6173 7420 7061 7373  in the last pass
-0000a1d0: 2c20 6f6e 626f 7264 6572 2070 6172 6365  , onborder parce
-0000a1e0: 6c73 2077 696c 6c20 6e65 6564 2065 7874  ls will need ext
-0000a1f0: 7261 0a20 2020 2020 2020 2020 2020 2020  ra.             
-0000a200: 2020 2023 2070 726f 6365 7373 696e 6720     # processing 
-0000a210: 7374 696c 6c20 696e 2066 7572 7468 6572  still in further
-0000a220: 2070 6173 7365 732c 2073 6f20 6172 6520   passes, so are 
-0000a230: 7361 7665 6420 696e 2061 2073 6570 6572  saved in a seper
-0000a240: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-0000a250: 2020 2020 2320 6766 6f2e 2054 6865 206e      # gfo. The n
-0000a260: 6f74 6f6e 626f 7264 6572 2072 6f77 7320  otonborder rows 
-0000a270: 6172 6520 6669 6e61 6c20 696d 6d65 6469  are final immedi
-0000a280: 6174 656c 790a 2020 2020 2020 2020 2020  ately.          
-0000a290: 2020 2020 2020 6966 206c 6173 745f 7061        if last_pa
-0000a2a0: 7373 2069 7320 6e6f 7420 5472 7565 3a0a  ss is not True:.
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2020 6f75 7470 7574 5f74 6d70 5f6f      output_tmp_o
-0000a2d0: 6e62 6f72 6465 725f 7061 7468 203d 2028  nborder_path = (
-0000a2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a2f0: 2020 2020 2020 2020 2074 656d 7064 6972           tempdir
-0000a300: 202f 2066 226f 7574 7075 745f 7b70 6173   / f"output_{pas
-0000a310: 735f 6964 7d5f 6f6e 626f 7264 6572 2e67  s_id}_onborder.g
-0000a320: 706b 6722 0a20 2020 2020 2020 2020 2020  pkg".           
-0000a330: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000a340: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000a350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a360: 2020 2020 206f 7574 7075 745f 746d 705f       output_tmp_
-0000a370: 6f6e 626f 7264 6572 5f70 6174 6820 3d20  onborder_path = 
-0000a380: 6f75 7470 7574 5f74 6d70 5f70 6174 680a  output_tmp_path.
-0000a390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a3a0: 2023 204e 6f77 2067 6f21 0a20 2020 2020   # Now go!.     
-0000a3b0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000a3c0: 722e 696e 666f 2866 2253 7461 7274 2064  r.info(f"Start d
-0000a3d0: 6973 736f 6c76 6520 7061 7373 207b 7061  issolve pass {pa
-0000a3e0: 7373 5f69 647d 2074 6f20 7b6c 656e 2874  ss_id} to {len(t
-0000a3f0: 696c 6573 5f67 6466 297d 2074 696c 6573  iles_gdf)} tiles
-0000a400: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000a410: 2020 205f 203d 205f 6469 7373 6f6c 7665     _ = _dissolve
-0000a420: 5f70 6f6c 7967 6f6e 735f 7061 7373 280a  _polygons_pass(.
-0000a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a440: 2020 2020 696e 7075 745f 7061 7468 3d69      input_path=i
-0000a450: 6e70 7574 5f70 6174 682c 0a20 2020 2020  nput_path,.     
-0000a460: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000a470: 7574 7075 745f 6e6f 746f 6e62 6f72 6465  utput_notonborde
-0000a480: 725f 7061 7468 3d6f 7574 7075 745f 746d  r_path=output_tm
-0000a490: 705f 7061 7468 2c0a 2020 2020 2020 2020  p_path,.        
-0000a4a0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-0000a4b0: 7574 5f6f 6e62 6f72 6465 725f 7061 7468  ut_onborder_path
-0000a4c0: 3d6f 7574 7075 745f 746d 705f 6f6e 626f  =output_tmp_onbo
-0000a4d0: 7264 6572 5f70 6174 682c 0a20 2020 2020  rder_path,.     
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a4f0: 7870 6c6f 6465 636f 6c6c 6563 7469 6f6e  xplodecollection
-0000a500: 733d 6578 706c 6f64 6563 6f6c 6c65 6374  s=explodecollect
-0000a510: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
-0000a520: 2020 2020 2020 2020 2020 6772 6f75 7062            groupb
-0000a530: 795f 636f 6c75 6d6e 733d 6772 6f75 7062  y_columns=groupb
-0000a540: 795f 636f 6c75 6d6e 732c 0a20 2020 2020  y_columns,.     
-0000a550: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000a560: 6767 5f63 6f6c 756d 6e73 3d61 6767 5f63  gg_columns=agg_c
-0000a570: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
-0000a580: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
-0000a590: 735f 6764 663d 7469 6c65 735f 6764 662c  s_gdf=tiles_gdf,
-0000a5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a5b0: 2020 2020 2069 6e70 7574 5f6c 6179 6572       input_layer
-0000a5c0: 3d69 6e70 7574 5f70 6173 735f 6c61 7965  =input_pass_laye
-0000a5d0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0000a5e0: 2020 2020 2020 206f 7574 7075 745f 6c61         output_la
-0000a5f0: 7965 723d 6f75 7470 7574 5f6c 6179 6572  yer=output_layer
-0000a600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a610: 2020 2020 2020 6772 6964 7369 7a65 3d67        gridsize=g
-0000a620: 7269 6473 697a 652c 0a20 2020 2020 2020  ridsize,.       
-0000a630: 2020 2020 2020 2020 2020 2020 206b 6565               kee
-0000a640: 705f 656d 7074 795f 6765 6f6d 733d 4661  p_empty_geoms=Fa
-0000a650: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0000a660: 2020 2020 2020 2020 206e 625f 7061 7261           nb_para
-0000a670: 6c6c 656c 3d6e 625f 7061 7261 6c6c 656c  llel=nb_parallel
-0000a680: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a690: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0000a6a0: 2020 2020 2023 2050 7265 7061 7265 2074       # Prepare t
-0000a6b0: 6865 206e 6578 7420 7061 7373 0a20 2020  he next pass.   
-0000a6c0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-0000a6d0: 6865 2069 6e70 7574 2070 6174 6820 6973  he input path is
-0000a6e0: 2074 6865 206f 6e62 6f72 6465 7220 6669   the onborder fi
-0000a6f0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-0000a700: 2020 2070 7265 765f 6e62 5f62 6174 6368     prev_nb_batch
-0000a710: 6573 203d 206c 656e 2874 696c 6573 5f67  es = len(tiles_g
-0000a720: 6466 290a 2020 2020 2020 2020 2020 2020  df).            
-0000a730: 2020 2020 696e 7075 745f 7061 7468 203d      input_path =
-0000a740: 206f 7574 7075 745f 746d 705f 6f6e 626f   output_tmp_onbo
-0000a750: 7264 6572 5f70 6174 680a 2020 2020 2020  rder_path.      
-0000a760: 2020 2020 2020 2020 2020 7061 7373 5f69            pass_i
-0000a770: 6420 2b3d 2031 0a20 2020 2020 2020 2020  d += 1.         
-0000a780: 2020 2020 2020 2069 6e70 7574 5f70 6173         input_pas
-0000a790: 735f 6c61 7965 7220 3d20 4e6f 6e65 0a0a  s_layer = None..
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7b0: 2320 4966 2077 6520 6172 6520 7265 6164  # If we are read
-0000a7c0: 792e 2e2e 0a20 2020 2020 2020 2020 2020  y....           
-0000a7d0: 2020 2020 2069 6620 6c61 7374 5f70 6173       if last_pas
-0000a7e0: 7320 6973 2054 7275 653a 0a20 2020 2020  s is True:.     
-0000a7f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a800: 7265 616b 0a0a 2020 2020 2020 2020 2020  reak..          
-0000a810: 2020 2320 4361 6c63 756c 6174 696f 6e20    # Calculation 
-0000a820: 7265 6164 7921 204e 6f77 2066 696e 616c  ready! Now final
-0000a830: 6973 6520 6f75 7470 7574 210a 2020 2020  ise output!.    
-0000a840: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-0000a850: 7265 2069 7320 6120 7265 7375 6c74 206f  re is a result o
-0000a860: 6e20 626f 7264 6572 2c20 6170 7065 6e64  n border, append
-0000a870: 2069 7420 746f 2074 6865 2072 6573 740a   it to the rest.
-0000a880: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0000a060: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000a070: 2020 2020 2067 666f 2e74 6f5f 6669 6c65       gfo.to_file
+0000a080: 2874 696c 6573 5f67 6466 2c20 7465 6d70  (tiles_gdf, temp
+0000a090: 6469 7220 2f20 6622 6f75 7470 7574 5f7b  dir / f"output_{
+0000a0a0: 7061 7373 5f69 647d 5f74 696c 6573 2e67  pass_id}_tiles.g
+0000a0b0: 706b 6722 290a 0a20 2020 2020 2020 2020  pkg")..         
+0000a0c0: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000a0d0: 6e75 6d62 6572 206f 6620 7469 6c65 7320  number of tiles 
+0000a0e0: 656e 6473 2075 7020 6173 2031 2c20 6974  ends up as 1, it
+0000a0f0: 2069 7320 7468 6520 6c61 7374 2070 6173   is the last pas
+0000a100: 7320 616e 7977 6179 2e2e 2e0a 2020 2020  s anyway....    
+0000a110: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000a120: 656e 2874 696c 6573 5f67 6466 2920 3d3d  en(tiles_gdf) ==
+0000a130: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000a140: 2020 2020 2020 2020 6c61 7374 5f70 6173          last_pas
+0000a150: 7320 3d20 5472 7565 0a0a 2020 2020 2020  s = True..      
+0000a160: 2020 2020 2020 2020 2020 2320 4966 2077            # If w
+0000a170: 6520 6172 6520 6e6f 7420 696e 2074 6865  e are not in the
+0000a180: 206c 6173 7420 7061 7373 2c20 6f6e 626f   last pass, onbo
+0000a190: 7264 6572 2070 6172 6365 6c73 2077 696c  rder parcels wil
+0000a1a0: 6c20 6e65 6564 2065 7874 7261 0a20 2020  l need extra.   
+0000a1b0: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+0000a1c0: 726f 6365 7373 696e 6720 7374 696c 6c20  rocessing still 
+0000a1d0: 696e 2066 7572 7468 6572 2070 6173 7365  in further passe
+0000a1e0: 732c 2073 6f20 6172 6520 7361 7665 6420  s, so are saved 
+0000a1f0: 696e 2061 2073 6570 6572 6174 650a 2020  in a seperate.  
+0000a200: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a210: 6766 6f2e 2054 6865 206e 6f74 6f6e 626f  gfo. The notonbo
+0000a220: 7264 6572 2072 6f77 7320 6172 6520 6669  rder rows are fi
+0000a230: 6e61 6c20 696d 6d65 6469 6174 656c 790a  nal immediately.
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a250: 6966 206c 6173 745f 7061 7373 2069 7320  if last_pass is 
+0000a260: 6e6f 7420 5472 7565 3a0a 2020 2020 2020  not True:.      
+0000a270: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0000a280: 7470 7574 5f74 6d70 5f6f 6e62 6f72 6465  tput_tmp_onborde
+0000a290: 725f 7061 7468 203d 2028 0a20 2020 2020  r_path = (.     
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2b0: 2020 2074 656d 7064 6972 202f 2066 226f     tempdir / f"o
+0000a2c0: 7574 7075 745f 7b70 6173 735f 6964 7d5f  utput_{pass_id}_
+0000a2d0: 6f6e 626f 7264 6572 2e67 706b 6722 0a20  onborder.gpkg". 
+0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000a300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a310: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000a320: 7574 7075 745f 746d 705f 6f6e 626f 7264  utput_tmp_onbord
+0000a330: 6572 5f70 6174 6820 3d20 6f75 7470 7574  er_path = output
+0000a340: 5f74 6d70 5f70 6174 680a 0a20 2020 2020  _tmp_path..     
+0000a350: 2020 2020 2020 2020 2020 2023 204e 6f77             # Now
+0000a360: 2067 6f21 0a20 2020 2020 2020 2020 2020   go!.           
+0000a370: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0000a380: 2866 2253 7461 7274 2064 6973 736f 6c76  (f"Start dissolv
+0000a390: 6520 7061 7373 207b 7061 7373 5f69 647d  e pass {pass_id}
+0000a3a0: 2074 6f20 7b6c 656e 2874 696c 6573 5f67   to {len(tiles_g
+0000a3b0: 6466 297d 2074 696c 6573 2229 0a20 2020  df)} tiles").   
+0000a3c0: 2020 2020 2020 2020 2020 2020 205f 203d               _ =
+0000a3d0: 205f 6469 7373 6f6c 7665 5f70 6f6c 7967   _dissolve_polyg
+0000a3e0: 6f6e 735f 7061 7373 280a 2020 2020 2020  ons_pass(.      
+0000a3f0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000a400: 7075 745f 7061 7468 3d69 6e70 7574 5f70  put_path=input_p
+0000a410: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000a420: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0000a430: 6e6f 746f 6e62 6f72 6465 725f 7061 7468  notonborder_path
+0000a440: 3d6f 7574 7075 745f 746d 705f 7061 7468  =output_tmp_path
+0000a450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a460: 2020 2020 2020 6f75 7470 7574 5f6f 6e62        output_onb
+0000a470: 6f72 6465 725f 7061 7468 3d6f 7574 7075  order_path=outpu
+0000a480: 745f 746d 705f 6f6e 626f 7264 6572 5f70  t_tmp_onborder_p
+0000a490: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000a4a0: 2020 2020 2020 2020 2065 7870 6c6f 6465           explode
+0000a4b0: 636f 6c6c 6563 7469 6f6e 733d 6578 706c  collections=expl
+0000a4c0: 6f64 6563 6f6c 6c65 6374 696f 6e73 2c0a  odecollections,.
+0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4e0: 2020 2020 6772 6f75 7062 795f 636f 6c75      groupby_colu
+0000a4f0: 6d6e 733d 6772 6f75 7062 795f 636f 6c75  mns=groupby_colu
+0000a500: 6d6e 732c 0a20 2020 2020 2020 2020 2020  mns,.           
+0000a510: 2020 2020 2020 2020 2061 6767 5f63 6f6c           agg_col
+0000a520: 756d 6e73 3d61 6767 5f63 6f6c 756d 6e73  umns=agg_columns
+0000a530: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a540: 2020 2020 2020 7469 6c65 735f 6764 663d        tiles_gdf=
+0000a550: 7469 6c65 735f 6764 662c 0a20 2020 2020  tiles_gdf,.     
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000a570: 6e70 7574 5f6c 6179 6572 3d69 6e70 7574  nput_layer=input
+0000a580: 5f70 6173 735f 6c61 7965 722c 0a20 2020  _pass_layer,.   
+0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5a0: 206f 7574 7075 745f 6c61 7965 723d 6f75   output_layer=ou
+0000a5b0: 7470 7574 5f6c 6179 6572 2c0a 2020 2020  tput_layer,.    
+0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5d0: 6772 6964 7369 7a65 3d67 7269 6473 697a  gridsize=gridsiz
+0000a5e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000a5f0: 2020 2020 2020 206b 6565 705f 656d 7074         keep_empt
+0000a600: 795f 6765 6f6d 733d 4661 6c73 652c 0a20  y_geoms=False,. 
+0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a620: 2020 206e 625f 7061 7261 6c6c 656c 3d6e     nb_parallel=n
+0000a630: 625f 7061 7261 6c6c 656c 2c0a 2020 2020  b_parallel,.    
+0000a640: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a660: 2050 7265 7061 7265 2074 6865 206e 6578   Prepare the nex
+0000a670: 7420 7061 7373 0a20 2020 2020 2020 2020  t pass.         
+0000a680: 2020 2020 2020 2023 2054 6865 2069 6e70         # The inp
+0000a690: 7574 2070 6174 6820 6973 2074 6865 206f  ut path is the o
+0000a6a0: 6e62 6f72 6465 7220 6669 6c65 0a20 2020  nborder file.   
+0000a6b0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000a6c0: 765f 6e62 5f62 6174 6368 6573 203d 206c  v_nb_batches = l
+0000a6d0: 656e 2874 696c 6573 5f67 6466 290a 2020  en(tiles_gdf).  
+0000a6e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000a6f0: 7075 745f 7061 7468 203d 206f 7574 7075  put_path = outpu
+0000a700: 745f 746d 705f 6f6e 626f 7264 6572 5f70  t_tmp_onborder_p
+0000a710: 6174 680a 2020 2020 2020 2020 2020 2020  ath.            
+0000a720: 2020 2020 7061 7373 5f69 6420 2b3d 2031      pass_id += 1
+0000a730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a740: 2069 6e70 7574 5f70 6173 735f 6c61 7965   input_pass_laye
+0000a750: 7220 3d20 4e6f 6e65 0a0a 2020 2020 2020  r = None..      
+0000a760: 2020 2020 2020 2020 2020 2320 4966 2077            # If w
+0000a770: 6520 6172 6520 7265 6164 792e 2e2e 0a20  e are ready.... 
+0000a780: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000a790: 6620 6c61 7374 5f70 6173 7320 6973 2054  f last_pass is T
+0000a7a0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+0000a7b0: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0000a7c0: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
+0000a7d0: 6c63 756c 6174 696f 6e20 7265 6164 7921  lculation ready!
+0000a7e0: 204e 6f77 2066 696e 616c 6973 6520 6f75   Now finalise ou
+0000a7f0: 7470 7574 210a 2020 2020 2020 2020 2020  tput!.          
+0000a800: 2020 2320 4966 2074 6865 7265 2069 7320    # If there is 
+0000a810: 6120 7265 7375 6c74 206f 6e20 626f 7264  a result on bord
+0000a820: 6572 2c20 6170 7065 6e64 2069 7420 746f  er, append it to
+0000a830: 2074 6865 2072 6573 740a 2020 2020 2020   the rest.      
+0000a840: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+0000a850: 2020 2020 2020 2020 2020 2073 7472 286f             str(o
+0000a860: 7574 7075 745f 746d 705f 6f6e 626f 7264  utput_tmp_onbord
+0000a870: 6572 5f70 6174 6829 2021 3d20 7374 7228  er_path) != str(
+0000a880: 6f75 7470 7574 5f74 6d70 5f70 6174 6829  output_tmp_path)
 0000a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a8a0: 2073 7472 286f 7574 7075 745f 746d 705f   str(output_tmp_
-0000a8b0: 6f6e 626f 7264 6572 5f70 6174 6829 2021  onborder_path) !
-0000a8c0: 3d20 7374 7228 6f75 7470 7574 5f74 6d70  = str(output_tmp
-0000a8d0: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
-0000a8e0: 2020 2020 2020 2061 6e64 206f 7574 7075         and outpu
-0000a8f0: 745f 746d 705f 6f6e 626f 7264 6572 5f70  t_tmp_onborder_p
-0000a900: 6174 682e 6578 6973 7473 2829 0a20 2020  ath.exists().   
-0000a910: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-0000a920: 2020 2020 2020 2020 2020 2020 6766 6f2e              gfo.
-0000a930: 6170 7065 6e64 5f74 6f28 0a20 2020 2020  append_to(.     
-0000a940: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000a950: 7574 7075 745f 746d 705f 6f6e 626f 7264  utput_tmp_onbord
-0000a960: 6572 5f70 6174 682c 206f 7574 7075 745f  er_path, output_
-0000a970: 746d 705f 7061 7468 2c20 6473 745f 6c61  tmp_path, dst_la
-0000a980: 7965 723d 6f75 7470 7574 5f6c 6179 6572  yer=output_layer
-0000a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a9a0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0000a9b0: 2320 4966 2074 6865 7265 2069 7320 6120  # If there is a 
-0000a9c0: 7265 7375 6c74 2e2e 2e0a 2020 2020 2020  result....      
-0000a9d0: 2020 2020 2020 6966 206f 7574 7075 745f        if output_
-0000a9e0: 746d 705f 7061 7468 2e65 7869 7374 7328  tmp_path.exists(
-0000a9f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000aa00: 2020 2023 2049 6620 7469 6c65 6420 6f75     # If tiled ou
-0000aa10: 7470 7574 2061 736b 6564 2c20 6164 6420  tput asked, add 
-0000aa20: 2274 696c 655f 6964 2220 746f 2067 726f  "tile_id" to gro
-0000aa30: 7570 6279 5f63 6f6c 756d 6e73 0a20 2020  upby_columns.   
-0000aa40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000aa50: 6c65 6e28 7265 7375 6c74 5f74 696c 6573  len(result_tiles
-0000aa60: 5f67 6466 2920 3e20 313a 0a20 2020 2020  _gdf) > 1:.     
-0000aa70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000aa80: 6620 6772 6f75 7062 795f 636f 6c75 6d6e  f groupby_column
-0000aa90: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aab0: 2020 2067 726f 7570 6279 5f63 6f6c 756d     groupby_colum
-0000aac0: 6e73 203d 205b 2274 696c 655f 6964 225d  ns = ["tile_id"]
-0000aad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a8a0: 2061 6e64 206f 7574 7075 745f 746d 705f   and output_tmp_
+0000a8b0: 6f6e 626f 7264 6572 5f70 6174 682e 6578  onborder_path.ex
+0000a8c0: 6973 7473 2829 0a20 2020 2020 2020 2020  ists().         
+0000a8d0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0000a8e0: 2020 2020 2020 6766 6f2e 6170 7065 6e64        gfo.append
+0000a8f0: 5f74 6f28 0a20 2020 2020 2020 2020 2020  _to(.           
+0000a900: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0000a910: 746d 705f 6f6e 626f 7264 6572 5f70 6174  tmp_onborder_pat
+0000a920: 682c 206f 7574 7075 745f 746d 705f 7061  h, output_tmp_pa
+0000a930: 7468 2c20 6473 745f 6c61 7965 723d 6f75  th, dst_layer=ou
+0000a940: 7470 7574 5f6c 6179 6572 0a20 2020 2020  tput_layer.     
+0000a950: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000a960: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+0000a970: 6865 7265 2069 7320 6120 7265 7375 6c74  here is a result
+0000a980: 2e2e 2e0a 2020 2020 2020 2020 2020 2020  ....            
+0000a990: 6966 206f 7574 7075 745f 746d 705f 7061  if output_tmp_pa
+0000a9a0: 7468 2e65 7869 7374 7328 293a 0a20 2020  th.exists():.   
+0000a9b0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+0000a9c0: 6620 7469 6c65 6420 6f75 7470 7574 2061  f tiled output a
+0000a9d0: 736b 6564 2c20 6164 6420 2274 696c 655f  sked, add "tile_
+0000a9e0: 6964 2220 746f 2067 726f 7570 6279 5f63  id" to groupby_c
+0000a9f0: 6f6c 756d 6e73 0a20 2020 2020 2020 2020  olumns.         
+0000aa00: 2020 2020 2020 2069 6620 6c65 6e28 7265         if len(re
+0000aa10: 7375 6c74 5f74 696c 6573 5f67 6466 2920  sult_tiles_gdf) 
+0000aa20: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+0000aa30: 2020 2020 2020 2020 2069 6620 6772 6f75           if grou
+0000aa40: 7062 795f 636f 6c75 6d6e 7320 6973 204e  pby_columns is N
+0000aa50: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000aa60: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+0000aa70: 7570 6279 5f63 6f6c 756d 6e73 203d 205b  upby_columns = [
+0000aa80: 2274 696c 655f 6964 225d 0a20 2020 2020  "tile_id"].     
+0000aa90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000aaa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000aab0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+0000aac0: 7570 6279 5f63 6f6c 756d 6e73 203d 206c  upby_columns = l
+0000aad0: 6973 7428 6772 6f75 7062 795f 636f 6c75  ist(groupby_colu
+0000aae0: 6d6e 7329 2e63 6f70 7928 290a 2020 2020  mns).copy().    
 0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab00: 2020 2067 726f 7570 6279 5f63 6f6c 756d     groupby_colum
-0000ab10: 6e73 203d 206c 6973 7428 6772 6f75 7062  ns = list(groupb
-0000ab20: 795f 636f 6c75 6d6e 7329 2e63 6f70 7928  y_columns).copy(
-0000ab30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ab40: 2020 2020 2020 2020 2020 6772 6f75 7062            groupb
-0000ab50: 795f 636f 6c75 6d6e 732e 6170 7065 6e64  y_columns.append
-0000ab60: 2822 7469 6c65 5f69 6422 290a 0a20 2020  ("tile_id")..   
-0000ab70: 2020 2020 2020 2020 2020 2020 2023 2050               # P
-0000ab80: 7265 7061 7265 2073 7472 696e 6773 2074  repare strings t
-0000ab90: 6f20 7573 6520 696e 2073 656c 6563 7420  o use in select 
-0000aba0: 6261 7365 6420 6f6e 2067 726f 7570 6279  based on groupby
-0000abb0: 5f63 6f6c 756d 6e73 0a20 2020 2020 2020  _columns.       
-0000abc0: 2020 2020 2020 2020 2069 6620 6772 6f75           if grou
-0000abd0: 7062 795f 636f 6c75 6d6e 7320 6973 206e  pby_columns is n
-0000abe0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000abf0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-0000ac00: 7570 6279 5f70 7265 6669 7865 645f 6c69  upby_prefixed_li
-0000ac10: 7374 203d 205b 0a20 2020 2020 2020 2020  st = [.         
-0000ac20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ac30: 277b 7b70 7265 6669 787d 7d22 7b63 6f6c  '{{prefix}}"{col
-0000ac40: 756d 6e7d 2227 2066 6f72 2063 6f6c 756d  umn}"' for colum
-0000ac50: 6e20 696e 2067 726f 7570 6279 5f63 6f6c  n in groupby_col
-0000ac60: 756d 6e73 0a20 2020 2020 2020 2020 2020  umns.           
-0000ac70: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0000ac80: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000ac90: 726f 7570 6279 5f73 656c 6563 745f 7072  roupby_select_pr
-0000aca0: 6566 6978 6564 5f73 7472 203d 2028 0a20  efixed_str = (. 
-0000acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acc0: 2020 2020 2020 2066 222c 207b 272c 2027         f", {', '
-0000acd0: 2e6a 6f69 6e28 6772 6f75 7062 795f 7072  .join(groupby_pr
-0000ace0: 6566 6978 6564 5f6c 6973 7429 7d22 0a20  efixed_list)}". 
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000ad10: 2020 2020 2020 2020 2067 726f 7570 6279           groupby
-0000ad20: 5f67 726f 7570 6279 5f70 7265 6669 7865  _groupby_prefixe
-0000ad30: 645f 7374 7220 3d20 280a 2020 2020 2020  d_str = (.      
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad50: 2020 6622 4752 4f55 5020 4259 207b 272c    f"GROUP BY {',
-0000ad60: 2027 2e6a 6f69 6e28 6772 6f75 7062 795f   '.join(groupby_
-0000ad70: 7072 6566 6978 6564 5f6c 6973 7429 7d22  prefixed_list)}"
-0000ad80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad90: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000ada0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
-0000adb0: 7062 795f 6669 6c74 6572 5f6c 6973 7420  pby_filter_list 
-0000adc0: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-0000add0: 2020 2020 2020 2020 2020 2020 6627 2041              f' A
-0000ade0: 4e44 2067 656f 5f64 6174 612e 227b 636f  ND geo_data."{co
-0000adf0: 6c75 6d6e 7d22 203d 206a 736f 6e5f 6461  lumn}" = json_da
-0000ae00: 7461 2e22 7b63 6f6c 756d 6e7d 2227 0a20  ta."{column}"'. 
-0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae20: 2020 2020 2020 2066 6f72 2063 6f6c 756d         for colum
-0000ae30: 6e20 696e 2067 726f 7570 6279 5f63 6f6c  n in groupby_col
-0000ae40: 756d 6e73 0a20 2020 2020 2020 2020 2020  umns.           
-0000ae50: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0000ae60: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000ae70: 726f 7570 6279 5f66 696c 7465 725f 7374  roupby_filter_st
-0000ae80: 7220 3d20 2220 222e 6a6f 696e 2867 726f  r = " ".join(gro
-0000ae90: 7570 6279 5f66 696c 7465 725f 6c69 7374  upby_filter_list
-0000aea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000aeb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000aec0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
-0000aed0: 7062 795f 7365 6c65 6374 5f70 7265 6669  pby_select_prefi
-0000aee0: 7865 645f 7374 7220 3d20 2222 0a20 2020  xed_str = "".   
-0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af00: 2067 726f 7570 6279 5f67 726f 7570 6279   groupby_groupby
-0000af10: 5f70 7265 6669 7865 645f 7374 7220 3d20  _prefixed_str = 
-0000af20: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-0000af30: 2020 2020 2020 2067 726f 7570 6279 5f66         groupby_f
-0000af40: 696c 7465 725f 7374 7220 3d20 2222 0a0a  ilter_str = ""..
-0000af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af60: 2320 5072 6570 6172 6520 7374 7269 6e67  # Prepare string
-0000af70: 7320 746f 2075 7365 2069 6e20 7365 6c65  s to use in sele
-0000af80: 6374 2062 6173 6564 206f 6e20 6167 675f  ct based on agg_
-0000af90: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-0000afa0: 2020 2020 2020 2020 6167 675f 636f 6c75          agg_colu
-0000afb0: 6d6e 735f 7374 7220 3d20 2222 0a20 2020  mns_str = "".   
-0000afc0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000afd0: 6167 675f 636f 6c75 6d6e 7320 6973 206e  agg_columns is n
-0000afe0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000aff0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b000: 226a 736f 6e22 2069 6e20 6167 675f 636f  "json" in agg_co
-0000b010: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
-0000b020: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b030: 2054 6865 2061 6767 7265 6761 7469 6f6e   The aggregation
-0000b040: 2069 7320 746f 2061 206a 736f 6e20 636f   is to a json co
-0000b050: 6c75 6d6e 2c20 736f 2061 6464 0a20 2020  lumn, so add.   
-0000b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b070: 2020 2020 2061 6767 5f63 6f6c 756d 6e73       agg_columns
-0000b080: 5f73 7472 202b 3d20 280a 2020 2020 2020  _str += (.      
-0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0a0: 2020 2020 2020 222c 6a73 6f6e 5f67 726f        ",json_gro
-0000b0b0: 7570 5f61 7272 6179 2844 4953 5449 4e43  up_array(DISTINC
-0000b0c0: 5420 6a73 6f6e 5f64 6174 612e 6a73 6f6e  T json_data.json
-0000b0d0: 5f72 6f77 2920 6173 206a 736f 6e22 0a20  _row) as json". 
-0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000b100: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0000b110: 6620 2263 6f6c 756d 6e73 2220 696e 2061  f "columns" in a
-0000b120: 6767 5f63 6f6c 756d 6e73 3a0a 2020 2020  gg_columns:.    
+0000ab00: 2020 2020 6772 6f75 7062 795f 636f 6c75      groupby_colu
+0000ab10: 6d6e 732e 6170 7065 6e64 2822 7469 6c65  mns.append("tile
+0000ab20: 5f69 6422 290a 0a20 2020 2020 2020 2020  _id")..         
+0000ab30: 2020 2020 2020 2023 2050 7265 7061 7265         # Prepare
+0000ab40: 2073 7472 696e 6773 2074 6f20 7573 6520   strings to use 
+0000ab50: 696e 2073 656c 6563 7420 6261 7365 6420  in select based 
+0000ab60: 6f6e 2067 726f 7570 6279 5f63 6f6c 756d  on groupby_colum
+0000ab70: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
+0000ab80: 2020 2069 6620 6772 6f75 7062 795f 636f     if groupby_co
+0000ab90: 6c75 6d6e 7320 6973 206e 6f74 204e 6f6e  lumns is not Non
+0000aba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000abb0: 2020 2020 2020 2067 726f 7570 6279 5f70         groupby_p
+0000abc0: 7265 6669 7865 645f 6c69 7374 203d 205b  refixed_list = [
+0000abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000abe0: 2020 2020 2020 2020 2066 277b 7b70 7265           f'{{pre
+0000abf0: 6669 787d 7d22 7b63 6f6c 756d 6e7d 2227  fix}}"{column}"'
+0000ac00: 2066 6f72 2063 6f6c 756d 6e20 696e 2067   for column in g
+0000ac10: 726f 7570 6279 5f63 6f6c 756d 6e73 0a20  roupby_columns. 
+0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac30: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0000ac40: 2020 2020 2020 2020 2067 726f 7570 6279           groupby
+0000ac50: 5f73 656c 6563 745f 7072 6566 6978 6564  _select_prefixed
+0000ac60: 5f73 7472 203d 2028 0a20 2020 2020 2020  _str = (.       
+0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac80: 2066 222c 207b 272c 2027 2e6a 6f69 6e28   f", {', '.join(
+0000ac90: 6772 6f75 7062 795f 7072 6566 6978 6564  groupby_prefixed
+0000aca0: 5f6c 6973 7429 7d22 0a20 2020 2020 2020  _list)}".       
+0000acb0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acd0: 2020 2067 726f 7570 6279 5f67 726f 7570     groupby_group
+0000ace0: 6279 5f70 7265 6669 7865 645f 7374 7220  by_prefixed_str 
+0000acf0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000ad00: 2020 2020 2020 2020 2020 2020 6622 4752              f"GR
+0000ad10: 4f55 5020 4259 207b 272c 2027 2e6a 6f69  OUP BY {', '.joi
+0000ad20: 6e28 6772 6f75 7062 795f 7072 6566 6978  n(groupby_prefix
+0000ad30: 6564 5f6c 6973 7429 7d22 0a20 2020 2020  ed_list)}".     
+0000ad40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ad50: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ad60: 2020 2020 2020 6772 6f75 7062 795f 6669        groupby_fi
+0000ad70: 6c74 6572 5f6c 6973 7420 3d20 5b0a 2020  lter_list = [.  
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2020 2020 2020 6627 2041 4e44 2067 656f        f' AND geo
+0000ada0: 5f64 6174 612e 227b 636f 6c75 6d6e 7d22  _data."{column}"
+0000adb0: 203d 206a 736f 6e5f 6461 7461 2e22 7b63   = json_data."{c
+0000adc0: 6f6c 756d 6e7d 2227 0a20 2020 2020 2020  olumn}"'.       
+0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ade0: 2066 6f72 2063 6f6c 756d 6e20 696e 2067   for column in g
+0000adf0: 726f 7570 6279 5f63 6f6c 756d 6e73 0a20  roupby_columns. 
+0000ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae10: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0000ae20: 2020 2020 2020 2020 2067 726f 7570 6279           groupby
+0000ae30: 5f66 696c 7465 725f 7374 7220 3d20 2220  _filter_str = " 
+0000ae40: 222e 6a6f 696e 2867 726f 7570 6279 5f66  ".join(groupby_f
+0000ae50: 696c 7465 725f 6c69 7374 290a 2020 2020  ilter_list).    
+0000ae60: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000ae70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ae80: 2020 2020 2020 6772 6f75 7062 795f 7365        groupby_se
+0000ae90: 6c65 6374 5f70 7265 6669 7865 645f 7374  lect_prefixed_st
+0000aea0: 7220 3d20 2222 0a20 2020 2020 2020 2020  r = "".         
+0000aeb0: 2020 2020 2020 2020 2020 2067 726f 7570             group
+0000aec0: 6279 5f67 726f 7570 6279 5f70 7265 6669  by_groupby_prefi
+0000aed0: 7865 645f 7374 7220 3d20 2222 0a20 2020  xed_str = "".   
+0000aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aef0: 2067 726f 7570 6279 5f66 696c 7465 725f   groupby_filter_
+0000af00: 7374 7220 3d20 2222 0a0a 2020 2020 2020  str = ""..      
+0000af10: 2020 2020 2020 2020 2020 2320 5072 6570            # Prep
+0000af20: 6172 6520 7374 7269 6e67 7320 746f 2075  are strings to u
+0000af30: 7365 2069 6e20 7365 6c65 6374 2062 6173  se in select bas
+0000af40: 6564 206f 6e20 6167 675f 636f 6c75 6d6e  ed on agg_column
+0000af50: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000af60: 2020 6167 675f 636f 6c75 6d6e 735f 7374    agg_columns_st
+0000af70: 7220 3d20 2222 0a20 2020 2020 2020 2020  r = "".         
+0000af80: 2020 2020 2020 2069 6620 6167 675f 636f         if agg_co
+0000af90: 6c75 6d6e 7320 6973 206e 6f74 204e 6f6e  lumns is not Non
+0000afa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000afb0: 2020 2020 2020 2069 6620 226a 736f 6e22         if "json"
+0000afc0: 2069 6e20 6167 675f 636f 6c75 6d6e 733a   in agg_columns:
+0000afd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000afe0: 2020 2020 2020 2020 2023 2054 6865 2061           # The a
+0000aff0: 6767 7265 6761 7469 6f6e 2069 7320 746f  ggregation is to
+0000b000: 2061 206a 736f 6e20 636f 6c75 6d6e 2c20   a json column, 
+0000b010: 736f 2061 6464 0a20 2020 2020 2020 2020  so add.         
+0000b020: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000b030: 6767 5f63 6f6c 756d 6e73 5f73 7472 202b  gg_columns_str +
+0000b040: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b060: 222c 6a73 6f6e 5f67 726f 7570 5f61 7272  ",json_group_arr
+0000b070: 6179 2844 4953 5449 4e43 5420 6a73 6f6e  ay(DISTINCT json
+0000b080: 5f64 6174 612e 6a73 6f6e 5f72 6f77 2920  _data.json_row) 
+0000b090: 6173 206a 736f 6e22 0a20 2020 2020 2020  as json".       
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0b0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000b0c0: 2020 2020 2020 2065 6c69 6620 2263 6f6c         elif "col
+0000b0d0: 756d 6e73 2220 696e 2061 6767 5f63 6f6c  umns" in agg_col
+0000b0e0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+0000b0f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000b100: 7220 6167 675f 636f 6c75 6d6e 2069 6e20  r agg_column in 
+0000b110: 6167 675f 636f 6c75 6d6e 735b 2263 6f6c  agg_columns["col
+0000b120: 756d 6e73 225d 3a0a 2020 2020 2020 2020  umns"]:.        
 0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b140: 2020 2020 666f 7220 6167 675f 636f 6c75      for agg_colu
-0000b150: 6d6e 2069 6e20 6167 675f 636f 6c75 6d6e  mn in agg_column
-0000b160: 735b 2263 6f6c 756d 6e73 225d 3a0a 2020  s["columns"]:.  
-0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b180: 2020 2020 2020 2020 2020 2320 496e 6974            # Init
-0000b190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1a0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-0000b1b0: 7469 6e63 745f 7374 7220 3d20 2222 0a20  tinct_str = "". 
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1d0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-0000b1e0: 5f70 6172 616d 5f73 7472 203d 2022 220a  _param_str = "".
-0000b1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b200: 2020 2020 2020 2020 2020 2020 2023 2050               # P
-0000b210: 7265 7061 7265 2061 6767 7265 6761 7469  repare aggregati
-0000b220: 6f6e 206b 6579 776f 7264 2e0a 2020 2020  on keyword..    
+0000b140: 2020 2020 2320 496e 6974 0a20 2020 2020      # Init.     
+0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b160: 2020 2020 2020 2064 6973 7469 6e63 745f         distinct_
+0000b170: 7374 7220 3d20 2222 0a20 2020 2020 2020  str = "".       
+0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b190: 2020 2020 2065 7874 7261 5f70 6172 616d       extra_param
+0000b1a0: 5f73 7472 203d 2022 220a 0a20 2020 2020  _str = ""..     
+0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1c0: 2020 2020 2020 2023 2050 7265 7061 7265         # Prepare
+0000b1d0: 2061 6767 7265 6761 7469 6f6e 206b 6579   aggregation key
+0000b1e0: 776f 7264 2e0a 2020 2020 2020 2020 2020  word..          
+0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b200: 2020 6966 2061 6767 5f63 6f6c 756d 6e5b    if agg_column[
+0000b210: 2261 6767 225d 2e6c 6f77 6572 2829 2069  "agg"].lower() i
+0000b220: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
 0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b240: 2020 2020 2020 2020 6966 2061 6767 5f63          if agg_c
-0000b250: 6f6c 756d 6e5b 2261 6767 225d 2e6c 6f77  olumn["agg"].low
-0000b260: 6572 2829 2069 6e20 5b0a 2020 2020 2020  er() in [.      
-0000b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b280: 2020 2020 2020 2020 2020 2263 6f75 6e74            "count
-0000b290: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000b240: 2020 2020 2263 6f75 6e74 222c 0a20 2020      "count",.   
+0000b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b260: 2020 2020 2020 2020 2020 2020 2022 7375               "su
+0000b270: 6d22 2c0a 2020 2020 2020 2020 2020 2020  m",.            
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b290: 2020 2020 226d 696e 222c 0a20 2020 2020      "min",.     
 0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2b0: 2020 2022 7375 6d22 2c0a 2020 2020 2020     "sum",.      
-0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2d0: 2020 2020 2020 2020 2020 226d 696e 222c            "min",
-0000b2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b2b0: 2020 2020 2020 2020 2020 2022 6d61 7822             "max"
+0000b2c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2e0: 2020 226d 6564 6961 6e22 2c0a 2020 2020    "median",.    
 0000b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b300: 2022 6d61 7822 2c0a 2020 2020 2020 2020   "max",.        
+0000b300: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
 0000b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b320: 2020 2020 2020 2020 226d 6564 6961 6e22          "median"
-0000b330: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b340: 2020 2020 2020 2020 2020 2020 2020 5d3a                ]:
-0000b350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 2061 6767 7265 6761 7469 6f6e 5f73 7472   aggregation_str
-0000b380: 203d 2061 6767 5f63 6f6c 756d 6e5b 2261   = agg_column["a
-0000b390: 6767 225d 0a20 2020 2020 2020 2020 2020  gg"].           
+0000b320: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
+0000b330: 6761 7469 6f6e 5f73 7472 203d 2061 6767  gation_str = agg
+0000b340: 5f63 6f6c 756d 6e5b 2261 6767 225d 0a20  _column["agg"]. 
+0000b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b360: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000b370: 6167 675f 636f 6c75 6d6e 5b22 6167 6722  agg_column["agg"
+0000b380: 5d2e 6c6f 7765 7228 2920 696e 205b 226d  ].lower() in ["m
+0000b390: 6561 6e22 2c20 2261 7667 225d 3a0a 2020  ean", "avg"]:.  
 0000b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3b0: 2065 6c69 6620 6167 675f 636f 6c75 6d6e   elif agg_column
-0000b3c0: 5b22 6167 6722 5d2e 6c6f 7765 7228 2920  ["agg"].lower() 
-0000b3d0: 696e 205b 226d 6561 6e22 2c20 2261 7667  in ["mean", "avg
-0000b3e0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b400: 2020 2020 6167 6772 6567 6174 696f 6e5f      aggregation_
-0000b410: 7374 7220 3d20 2261 7667 220a 2020 2020  str = "avg".    
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 6167                ag
+0000b3c0: 6772 6567 6174 696f 6e5f 7374 7220 3d20  gregation_str = 
+0000b3d0: 2261 7667 220a 2020 2020 2020 2020 2020  "avg".          
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3f0: 2020 656c 6966 2061 6767 5f63 6f6c 756d    elif agg_colum
+0000b400: 6e5b 2261 6767 225d 2e6c 6f77 6572 2829  n["agg"].lower()
+0000b410: 203d 3d20 2263 6f6e 6361 7422 3a0a 2020   == "concat":.  
 0000b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b430: 2020 2020 2020 2020 656c 6966 2061 6767          elif agg
-0000b440: 5f63 6f6c 756d 6e5b 2261 6767 225d 2e6c  _column["agg"].l
-0000b450: 6f77 6572 2829 203d 3d20 2263 6f6e 6361  ower() == "conca
-0000b460: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-0000b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b480: 2020 2020 6167 6772 6567 6174 696f 6e5f      aggregation_
-0000b490: 7374 7220 3d20 2267 726f 7570 5f63 6f6e  str = "group_con
-0000b4a0: 6361 7422 0a20 2020 2020 2020 2020 2020  cat".           
-0000b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4c0: 2020 2020 2069 6620 2273 6570 2220 696e       if "sep" in
-0000b4d0: 2061 6767 5f63 6f6c 756d 6e3a 0a20 2020   agg_column:.   
-0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b430: 2020 2020 2020 2020 2020 2020 2020 6167                ag
+0000b440: 6772 6567 6174 696f 6e5f 7374 7220 3d20  gregation_str = 
+0000b450: 2267 726f 7570 5f63 6f6e 6361 7422 0a20  "group_concat". 
+0000b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b480: 6620 2273 6570 2220 696e 2061 6767 5f63  f "sep" in agg_c
+0000b490: 6f6c 756d 6e3a 0a20 2020 2020 2020 2020  olumn:.         
+0000b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4b0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+0000b4c0: 5f70 6172 616d 5f73 7472 203d 2066 222c  _param_str = f",
+0000b4d0: 2027 7b61 6767 5f63 6f6c 756d 6e5b 2773   '{agg_column['s
+0000b4e0: 6570 275d 7d27 220a 2020 2020 2020 2020  ep']}'".        
 0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b500: 2065 7874 7261 5f70 6172 616d 5f73 7472   extra_param_str
-0000b510: 203d 2066 222c 2027 7b61 6767 5f63 6f6c   = f", '{agg_col
-0000b520: 756d 6e5b 2773 6570 275d 7d27 220a 2020  umn['sep']}'".  
-0000b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b540: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000b500: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b520: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000b530: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b570: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000b580: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5a0: 2020 2020 2020 6622 6167 6772 6567 6174        f"aggregat
-0000b5b0: 696f 6e20 7b61 6767 5f63 6f6c 756d 6e5b  ion {agg_column[
-0000b5c0: 2761 6767 275d 7d20 6973 206e 6f74 2073  'agg']} is not s
-0000b5d0: 7570 706f 7274 6564 220a 2020 2020 2020  upported".      
-0000b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5f0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b610: 2020 2020 2020 2020 2023 2049 6620 6469           # If di
-0000b620: 7374 696e 6374 2069 7320 7370 6563 6966  stinct is specif
-0000b630: 6965 642c 2061 6464 2074 6865 2064 6973  ied, add the dis
-0000b640: 7469 6e63 7420 6b65 7977 6f72 640a 2020  tinct keyword.  
-0000b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b660: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+0000b560: 6622 6167 6772 6567 6174 696f 6e20 7b61  f"aggregation {a
+0000b570: 6767 5f63 6f6c 756d 6e5b 2761 6767 275d  gg_column['agg']
+0000b580: 7d20 6973 206e 6f74 2073 7570 706f 7274  } is not support
+0000b590: 6564 220a 2020 2020 2020 2020 2020 2020  ed".            
+0000b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5b0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5d0: 2020 2023 2049 6620 6469 7374 696e 6374     # If distinct
+0000b5e0: 2069 7320 7370 6563 6966 6965 642c 2061   is specified, a
+0000b5f0: 6464 2074 6865 2064 6973 7469 6e63 7420  dd the distinct 
+0000b600: 6b65 7977 6f72 640a 2020 2020 2020 2020  keyword.        
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b640: 2020 2020 2020 2020 2022 6469 7374 696e           "distin
+0000b650: 6374 2220 696e 2061 6767 5f63 6f6c 756d  ct" in agg_colum
+0000b660: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
 0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b680: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b690: 6469 7374 696e 6374 2220 696e 2061 6767  distinct" in agg
-0000b6a0: 5f63 6f6c 756d 6e0a 2020 2020 2020 2020  _column.        
+0000b680: 2020 616e 6420 6167 675f 636f 6c75 6d6e    and agg_column
+0000b690: 5b22 6469 7374 696e 6374 225d 2069 7320  ["distinct"] is 
+0000b6a0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
 0000b6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6c0: 2020 2020 2020 2020 616e 6420 6167 675f          and agg_
-0000b6d0: 636f 6c75 6d6e 5b22 6469 7374 696e 6374  column["distinct
-0000b6e0: 225d 2069 7320 5472 7565 0a20 2020 2020  "] is True.     
-0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b720: 2020 2020 2020 2020 2020 6469 7374 696e            distin
-0000b730: 6374 5f73 7472 203d 2022 4449 5354 494e  ct_str = "DISTIN
-0000b740: 4354 2022 0a0a 2020 2020 2020 2020 2020  CT "..          
-0000b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b760: 2020 2320 5072 6570 6172 6520 636f 6c75    # Prepare colu
-0000b770: 6d6e 206e 616d 6520 7374 7269 6e67 2e0a  mn name string..
-0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b790: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0000b7a0: 6d6e 5f73 7472 203d 2028 0a20 2020 2020  mn_str = (.     
+0000b6c0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6e0: 2020 2020 6469 7374 696e 6374 5f73 7472      distinct_str
+0000b6f0: 203d 2022 4449 5354 494e 4354 2022 0a0a   = "DISTINCT "..
+0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b710: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
+0000b720: 6570 6172 6520 636f 6c75 6d6e 206e 616d  epare column nam
+0000b730: 6520 7374 7269 6e67 2e0a 2020 2020 2020  e string..      
+0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b750: 2020 2020 2020 636f 6c75 6d6e 5f73 7472        column_str
+0000b760: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b780: 2020 2020 2022 6a73 6f6e 5f65 7874 7261       "json_extra
+0000b790: 6374 286a 736f 6e5f 6461 7461 2e6a 736f  ct(json_data.jso
+0000b7a0: 6e5f 726f 772c 2022 0a20 2020 2020 2020  n_row, ".       
 0000b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7c0: 2020 2020 2020 2020 2020 2022 6a73 6f6e             "json
-0000b7d0: 5f65 7874 7261 6374 286a 736f 6e5f 6461  _extract(json_da
-0000b7e0: 7461 2e6a 736f 6e5f 726f 772c 2022 0a20  ta.json_row, ". 
+0000b7c0: 2020 2020 2020 2020 2066 2722 242e 7b61           f'"$.{a
+0000b7d0: 6767 5f63 6f6c 756d 6e5b 2263 6f6c 756d  gg_column["colum
+0000b7e0: 6e22 5d7d 2229 270a 2020 2020 2020 2020  n"]}")'.        
 0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b810: 2722 242e 7b61 6767 5f63 6f6c 756d 6e5b  '"$.{agg_column[
-0000b820: 2263 6f6c 756d 6e22 5d7d 2229 270a 2020  "column"]}")'.  
-0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b840: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 2020 2020 2020 2020 2023 204e 6f77 2070           # Now p
-0000b870: 7574 2065 7665 7279 7468 696e 6720 746f  ut everything to
-0000b880: 6765 7468 6572 0a20 2020 2020 2020 2020  gether.         
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2020 2061 6767 5f63 6f6c 756d 6e73 5f73     agg_columns_s
-0000b8b0: 7472 202b 3d20 280a 2020 2020 2020 2020  tr += (.        
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 2020 2020 2020 2020 6622 2c20 7b61 6767          f", {agg
-0000b8e0: 7265 6761 7469 6f6e 5f73 7472 7d28 7b64  regation_str}({d
-0000b8f0: 6973 7469 6e63 745f 7374 727d 7b63 6f6c  istinct_str}{col
-0000b900: 756d 6e5f 7374 727d 220a 2020 2020 2020  umn_str}".      
-0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2020 2020 2020 2020 6627 7b65 7874            f'{ext
-0000b930: 7261 5f70 6172 616d 5f73 7472 7d29 2041  ra_param_str}) A
-0000b940: 5320 227b 6167 675f 636f 6c75 6d6e 5b22  S "{agg_column["
-0000b950: 6173 225d 7d22 270a 2020 2020 2020 2020  as"]}"'.        
-0000b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b970: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-0000b980: 2020 2020 2020 2023 2041 6464 2061 2063         # Add a c
-0000b990: 6f6c 756d 6e20 746f 206f 7264 6572 2074  olumn to order t
-0000b9a0: 6865 2072 6573 756c 7420 6279 2074 6f20  he result by to 
-0000b9b0: 6576 6164 6520 6861 7669 6e67 2061 6c6c  evade having all
-0000b9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b9d0: 2023 2063 6f6d 706c 6578 2067 656f 6d65   # complex geome
-0000b9e0: 7472 6965 7320 746f 6765 7468 6572 2069  tries together i
-0000b9f0: 6e20 7468 6520 6f75 7470 7574 2066 696c  n the output fil
-0000ba00: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000ba10: 2020 206f 7264 6572 6279 5f63 6f6c 756d     orderby_colum
-0000ba20: 6e20 3d20 2274 656d 705f 6f72 6465 7263  n = "temp_orderc
-0000ba30: 6f6c 756d 6e5f 6765 6f68 6173 6822 0a20  olumn_geohash". 
-0000ba40: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000ba50: 6164 645f 6f72 6465 7262 795f 636f 6c75  add_orderby_colu
-0000ba60: 6d6e 280a 2020 2020 2020 2020 2020 2020  mn(.            
-0000ba70: 2020 2020 2020 2020 7061 7468 3d6f 7574          path=out
-0000ba80: 7075 745f 746d 705f 7061 7468 2c20 6c61  put_tmp_path, la
-0000ba90: 7965 723d 6f75 7470 7574 5f6c 6179 6572  yer=output_layer
-0000baa0: 2c20 6e61 6d65 3d6f 7264 6572 6279 5f63  , name=orderby_c
-0000bab0: 6f6c 756d 6e0a 2020 2020 2020 2020 2020  olumn.          
-0000bac0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000bad0: 2020 2020 2020 2020 2023 2050 7265 7061           # Prepa
-0000bae0: 7265 2053 514c 2073 7461 7465 6d65 6e74  re SQL statement
-0000baf0: 2066 6f72 2066 696e 616c 206f 7574 7075   for final outpu
-0000bb00: 7420 6669 6c65 2e0a 2020 2020 2020 2020  t file..        
-0000bb10: 2020 2020 2020 2020 2320 416c 6c20 7469          # All ti
-0000bb20: 6c65 7320 6172 6520 616c 7265 6164 7920  les are already 
-0000bb30: 6469 7373 6f6c 7665 6420 746f 2067 726f  dissolved to gro
-0000bb40: 7570 732c 2062 7574 206e 6f77 2074 6865  ups, but now the
-0000bb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb60: 2023 2072 6573 756c 7473 2066 726f 6d20   # results from 
-0000bb70: 616c 6c20 7469 6c65 7320 7374 696c 6c20  all tiles still 
-0000bb80: 6e65 6564 2074 6f20 6265 0a20 2020 2020  need to be.     
-0000bb90: 2020 2020 2020 2020 2020 2023 2067 726f             # gro
-0000bba0: 7570 6564 2f63 6f6c 6c65 6374 6564 2074  uped/collected t
-0000bbb0: 6f67 6574 6865 722e 0a20 2020 2020 2020  ogether..       
-0000bbc0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000bbd0: 696e 666f 2822 506f 7374 7072 6f63 6573  info("Postproces
-0000bbe0: 7320 7072 6570 6172 6564 2066 6561 7475  s prepared featu
-0000bbf0: 7265 732e 2e2e 2229 0a20 2020 2020 2020  res...").       
-0000bc00: 2020 2020 2020 2020 2069 6620 6167 675f           if agg_
-0000bc10: 636f 6c75 6d6e 7320 6973 204e 6f6e 653a  columns is None:
-0000bc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bc30: 2020 2020 2023 2049 6620 7468 6572 6520       # If there 
-0000bc40: 6172 6520 6e6f 2061 6767 7265 6761 7469  are no aggregati
-0000bc50: 6f6e 2063 6f6c 756d 6e73 2c20 7468 696e  on columns, thin
-0000bc60: 6773 2061 7265 206e 6f74 2074 6f6f 0a20  gs are not too. 
-0000bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc80: 2020 2023 2063 6f6d 706c 6963 6174 6564     # complicated
-0000bc90: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000bca0: 2020 2020 2020 6966 2065 7870 6c6f 6465        if explode
-0000bcb0: 636f 6c6c 6563 7469 6f6e 7320 6973 2054  collections is T
-0000bcc0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-0000bcd0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000bce0: 6620 6578 706c 6f64 6563 6f6c 6c65 6374  f explodecollect
-0000bcf0: 696f 6e73 2069 7320 7472 7565 2c20 6974  ions is true, it
-0000bd00: 2069 7320 7573 656c 6573 7320 746f 0a20   is useless to. 
-0000bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd20: 2020 2020 2020 2023 2066 6972 7374 2067         # first g
-0000bd30: 726f 7570 2074 6865 6d20 6865 7265 2c20  roup them here, 
-0000bd40: 6173 2074 6865 7920 7769 6c6c 2062 6520  as they will be 
-0000bd50: 6578 706c 6f64 6564 2061 6761 696e 0a20  exploded again. 
-0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd70: 2020 2020 2020 2023 2069 6e20 7468 6520         # in the 
-0000bd80: 7365 6c65 6374 2829 2063 616c 6c20 6c61  select() call la
-0000bd90: 7465 7220 6f6e 2e2e 2e20 736f 206a 7573  ter on... so jus
-0000bda0: 7420 6f72 6465 7220 7468 656d 2e0a 2020  t order them..  
-0000bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdc0: 2020 2020 2020 2320 4966 2061 2074 696c        # If a til
-0000bdd0: 6564 2072 6573 756c 7420 6973 2061 736b  ed result is ask
-0000bde0: 6564 2c20 616c 736f 2064 6f6e 2774 2063  ed, also don't c
-0000bdf0: 6f6c 6c65 6374 2e0a 2020 2020 2020 2020  ollect..        
-0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be10: 7371 6c5f 7374 6d74 203d 2066 2222 220a  sql_stmt = f""".
+0000b800: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b820: 2020 2023 204e 6f77 2070 7574 2065 7665     # Now put eve
+0000b830: 7279 7468 696e 6720 746f 6765 7468 6572  rything together
+0000b840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b850: 2020 2020 2020 2020 2020 2020 2061 6767               agg
+0000b860: 5f63 6f6c 756d 6e73 5f73 7472 202b 3d20  _columns_str += 
+0000b870: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2020 6622 2c20 7b61 6767 7265 6761 7469    f", {aggregati
+0000b8a0: 6f6e 5f73 7472 7d28 7b64 6973 7469 6e63  on_str}({distinc
+0000b8b0: 745f 7374 727d 7b63 6f6c 756d 6e5f 7374  t_str}{column_st
+0000b8c0: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8e0: 2020 2020 6627 7b65 7874 7261 5f70 6172      f'{extra_par
+0000b8f0: 616d 5f73 7472 7d29 2041 5320 227b 6167  am_str}) AS "{ag
+0000b900: 675f 636f 6c75 6d6e 5b22 6173 225d 7d22  g_column["as"]}"
+0000b910: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000b920: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000b930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b940: 2023 2041 6464 2061 2063 6f6c 756d 6e20   # Add a column 
+0000b950: 746f 206f 7264 6572 2074 6865 2072 6573  to order the res
+0000b960: 756c 7420 6279 2074 6f20 6576 6164 6520  ult by to evade 
+0000b970: 6861 7669 6e67 2061 6c6c 0a20 2020 2020  having all.     
+0000b980: 2020 2020 2020 2020 2020 2023 2063 6f6d             # com
+0000b990: 706c 6578 2067 656f 6d65 7472 6965 7320  plex geometries 
+0000b9a0: 746f 6765 7468 6572 2069 6e20 7468 6520  together in the 
+0000b9b0: 6f75 7470 7574 2066 696c 652e 0a20 2020  output file..   
+0000b9c0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0000b9d0: 6572 6279 5f63 6f6c 756d 6e20 3d20 2274  erby_column = "t
+0000b9e0: 656d 705f 6f72 6465 7263 6f6c 756d 6e5f  emp_ordercolumn_
+0000b9f0: 6765 6f68 6173 6822 0a20 2020 2020 2020  geohash".       
+0000ba00: 2020 2020 2020 2020 205f 6164 645f 6f72           _add_or
+0000ba10: 6465 7262 795f 636f 6c75 6d6e 280a 2020  derby_column(.  
+0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba30: 2020 7061 7468 3d6f 7574 7075 745f 746d    path=output_tm
+0000ba40: 705f 7061 7468 2c20 6c61 7965 723d 6f75  p_path, layer=ou
+0000ba50: 7470 7574 5f6c 6179 6572 2c20 6e61 6d65  tput_layer, name
+0000ba60: 3d6f 7264 6572 6279 5f63 6f6c 756d 6e0a  =orderby_column.
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba80: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000ba90: 2020 2023 2050 7265 7061 7265 2053 514c     # Prepare SQL
+0000baa0: 2073 7461 7465 6d65 6e74 2066 6f72 2066   statement for f
+0000bab0: 696e 616c 206f 7574 7075 7420 6669 6c65  inal output file
+0000bac0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bad0: 2020 2320 416c 6c20 7469 6c65 7320 6172    # All tiles ar
+0000bae0: 6520 616c 7265 6164 7920 6469 7373 6f6c  e already dissol
+0000baf0: 7665 6420 746f 2067 726f 7570 732c 2062  ved to groups, b
+0000bb00: 7574 206e 6f77 2074 6865 0a20 2020 2020  ut now the.     
+0000bb10: 2020 2020 2020 2020 2020 2023 2072 6573             # res
+0000bb20: 756c 7473 2066 726f 6d20 616c 6c20 7469  ults from all ti
+0000bb30: 6c65 7320 7374 696c 6c20 6e65 6564 2074  les still need t
+0000bb40: 6f20 6265 0a20 2020 2020 2020 2020 2020  o be.           
+0000bb50: 2020 2020 2023 2067 726f 7570 6564 2f63       # grouped/c
+0000bb60: 6f6c 6c65 6374 6564 2074 6f67 6574 6865  ollected togethe
+0000bb70: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
+0000bb80: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
+0000bb90: 506f 7374 7072 6f63 6573 7320 7072 6570  Postprocess prep
+0000bba0: 6172 6564 2066 6561 7475 7265 732e 2e2e  ared features...
+0000bbb0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000bbc0: 2020 2069 6620 6167 675f 636f 6c75 6d6e     if agg_column
+0000bbd0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000bbf0: 2049 6620 7468 6572 6520 6172 6520 6e6f   If there are no
+0000bc00: 2061 6767 7265 6761 7469 6f6e 2063 6f6c   aggregation col
+0000bc10: 756d 6e73 2c20 7468 696e 6773 2061 7265  umns, things are
+0000bc20: 206e 6f74 2074 6f6f 0a20 2020 2020 2020   not too.       
+0000bc30: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0000bc40: 6f6d 706c 6963 6174 6564 2e0a 2020 2020  omplicated..    
+0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc60: 6966 2065 7870 6c6f 6465 636f 6c6c 6563  if explodecollec
+0000bc70: 7469 6f6e 7320 6973 2054 7275 653a 0a20  tions is True:. 
+0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc90: 2020 2020 2020 2023 2049 6620 6578 706c         # If expl
+0000bca0: 6f64 6563 6f6c 6c65 6374 696f 6e73 2069  odecollections i
+0000bcb0: 7320 7472 7565 2c20 6974 2069 7320 7573  s true, it is us
+0000bcc0: 656c 6573 7320 746f 0a20 2020 2020 2020  eless to.       
+0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bce0: 2023 2066 6972 7374 2067 726f 7570 2074   # first group t
+0000bcf0: 6865 6d20 6865 7265 2c20 6173 2074 6865  hem here, as the
+0000bd00: 7920 7769 6c6c 2062 6520 6578 706c 6f64  y will be explod
+0000bd10: 6564 2061 6761 696e 0a20 2020 2020 2020  ed again.       
+0000bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd30: 2023 2069 6e20 7468 6520 7365 6c65 6374   # in the select
+0000bd40: 2829 2063 616c 6c20 6c61 7465 7220 6f6e  () call later on
+0000bd50: 2e2e 2e20 736f 206a 7573 7420 6f72 6465  ... so just orde
+0000bd60: 7220 7468 656d 2e0a 2020 2020 2020 2020  r them..        
+0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd80: 2320 4966 2061 2074 696c 6564 2072 6573  # If a tiled res
+0000bd90: 756c 7420 6973 2061 736b 6564 2c20 616c  ult is asked, al
+0000bda0: 736f 2064 6f6e 2774 2063 6f6c 6c65 6374  so don't collect
+0000bdb0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bdc0: 2020 2020 2020 2020 2020 7371 6c5f 7374            sql_st
+0000bdd0: 6d74 203d 2066 2222 220a 2020 2020 2020  mt = f""".      
+0000bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdf0: 2020 2020 2020 5345 4c45 4354 207b 7b67        SELECT {{g
+0000be00: 656f 6d65 7472 7963 6f6c 756d 6e7d 7d0a  eometrycolumn}}.
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 2020 2020 2020 2020 2020 2020 5345 4c45              SELE
-0000be40: 4354 207b 7b67 656f 6d65 7472 7963 6f6c  CT {{geometrycol
-0000be50: 756d 6e7d 7d0a 2020 2020 2020 2020 2020  umn}}.          
-0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be70: 2020 2020 2020 2020 7b67 726f 7570 6279          {groupby
-0000be80: 5f73 656c 6563 745f 7072 6566 6978 6564  _select_prefixed
-0000be90: 5f73 7472 2e66 6f72 6d61 7428 7072 6566  _str.format(pref
-0000bea0: 6978 3d22 6c61 7965 722e 2229 7d0a 2020  ix="layer.")}.  
+0000be30: 2020 7b67 726f 7570 6279 5f73 656c 6563    {groupby_selec
+0000be40: 745f 7072 6566 6978 6564 5f73 7472 2e66  t_prefixed_str.f
+0000be50: 6f72 6d61 7428 7072 6566 6978 3d22 6c61  ormat(prefix="la
+0000be60: 7965 722e 2229 7d0a 2020 2020 2020 2020  yer.")}.        
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 2020 4652 4f4d 2022 7b7b 696e        FROM "{{in
+0000be90: 7075 745f 6c61 7965 727d 7d22 206c 6179  put_layer}}" lay
+0000bea0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
 0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bec0: 2020 2020 2020 2020 2020 2020 4652 4f4d              FROM
-0000bed0: 2022 7b7b 696e 7075 745f 6c61 7965 727d   "{{input_layer}
-0000bee0: 7d22 206c 6179 6572 0a20 2020 2020 2020  }" layer.       
-0000bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf00: 2020 2020 2020 4f52 4445 5220 4259 206c        ORDER BY l
-0000bf10: 6179 6572 2e7b 6f72 6465 7262 795f 636f  ayer.{orderby_co
-0000bf20: 6c75 6d6e 7d0a 2020 2020 2020 2020 2020  lumn}.          
-0000bf30: 2020 2020 2020 2020 2020 2020 2020 2222                ""
-0000bf40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000bf50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf70: 2020 2020 2320 4e6f 2065 7870 6c6f 6465      # No explode
-0000bf80: 636f 6c6c 6563 7469 6f6e 732c 2073 6f20  collections, so 
-0000bf90: 636f 6c6c 6563 7420 746f 206f 6e65 2067  collect to one g
-0000bfa0: 656f 6d65 7472 790a 2020 2020 2020 2020  eometry.        
-0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfc0: 2320 2870 6572 2067 726f 7570 6279 2069  # (per groupby i
-0000bfd0: 6620 6170 706c 6963 6162 6c65 292e 0a20  f applicable).. 
-0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bff0: 2020 2020 2020 2073 716c 5f73 746d 7420         sql_stmt 
-0000c000: 3d20 6622 2222 0a20 2020 2020 2020 2020  = f""".         
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 2020 2053 454c 4543 5420 5354 5f43 6f6c     SELECT ST_Col
-0000c030: 6c65 6374 287b 7b67 656f 6d65 7472 7963  lect({{geometryc
-0000c040: 6f6c 756d 6e7d 7d29 2041 5320 7b7b 6765  olumn}}) AS {{ge
-0000c050: 6f6d 6574 7279 636f 6c75 6d6e 7d7d 0a20  ometrycolumn}}. 
-0000c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c080: 207b 6772 6f75 7062 795f 7365 6c65 6374   {groupby_select
-0000c090: 5f70 7265 6669 7865 645f 7374 722e 666f  _prefixed_str.fo
-0000c0a0: 726d 6174 2870 7265 6669 783d 226c 6179  rmat(prefix="lay
-0000c0b0: 6572 2e22 297d 0a20 2020 2020 2020 2020  er.")}.         
-0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0d0: 2020 2020 2046 524f 4d20 227b 7b69 6e70       FROM "{{inp
-0000c0e0: 7574 5f6c 6179 6572 7d7d 2220 6c61 7965  ut_layer}}" laye
-0000c0f0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c110: 7b67 726f 7570 6279 5f67 726f 7570 6279  {groupby_groupby
-0000c120: 5f70 7265 6669 7865 645f 7374 722e 666f  _prefixed_str.fo
-0000c130: 726d 6174 2870 7265 6669 783d 226c 6179  rmat(prefix="lay
-0000c140: 6572 2e22 297d 0a20 2020 2020 2020 2020  er.")}.         
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 2020 2020 4f52 4445 5220 4259 204d 494e      ORDER BY MIN
-0000c170: 286c 6179 6572 2e7b 6f72 6465 7262 795f  (layer.{orderby_
-0000c180: 636f 6c75 6d6e 7d29 0a20 2020 2020 2020  column}).       
-0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1a0: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
-0000c1b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c1d0: 2049 6620 6167 675f 636f 6c75 6d6e 7320   If agg_columns 
-0000c1e0: 7370 6563 6966 6965 642c 2070 6f73 7470  specified, postp
-0000c1f0: 726f 6365 7373 696e 6720 6973 2061 2062  rocessing is a b
-0000c200: 6974 206d 6f72 650a 2020 2020 2020 2020  it more.        
-0000c210: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-0000c220: 6d70 6c69 6361 7465 642e 0a20 2020 2020  mplicated..     
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c240: 716c 5f73 746d 7420 3d20 6622 2222 0a20  ql_stmt = f""". 
+0000bec0: 4f52 4445 5220 4259 206c 6179 6572 2e7b  ORDER BY layer.{
+0000bed0: 6f72 6465 7262 795f 636f 6c75 6d6e 7d0a  orderby_column}.
+0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bef0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000bf30: 4e6f 2065 7870 6c6f 6465 636f 6c6c 6563  No explodecollec
+0000bf40: 7469 6f6e 732c 2073 6f20 636f 6c6c 6563  tions, so collec
+0000bf50: 7420 746f 206f 6e65 2067 656f 6d65 7472  t to one geometr
+0000bf60: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0000bf70: 2020 2020 2020 2020 2020 2320 2870 6572            # (per
+0000bf80: 2067 726f 7570 6279 2069 6620 6170 706c   groupby if appl
+0000bf90: 6963 6162 6c65 292e 0a20 2020 2020 2020  icable)..       
+0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfb0: 2073 716c 5f73 746d 7420 3d20 6622 2222   sql_stmt = f"""
+0000bfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfd0: 2020 2020 2020 2020 2020 2020 2053 454c               SEL
+0000bfe0: 4543 5420 5354 5f43 6f6c 6c65 6374 287b  ECT ST_Collect({
+0000bff0: 7b67 656f 6d65 7472 7963 6f6c 756d 6e7d  {geometrycolumn}
+0000c000: 7d29 2041 5320 7b7b 6765 6f6d 6574 7279  }) AS {{geometry
+0000c010: 636f 6c75 6d6e 7d7d 0a20 2020 2020 2020  column}}.       
+0000c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c030: 2020 2020 2020 2020 2020 207b 6772 6f75             {grou
+0000c040: 7062 795f 7365 6c65 6374 5f70 7265 6669  pby_select_prefi
+0000c050: 7865 645f 7374 722e 666f 726d 6174 2870  xed_str.format(p
+0000c060: 7265 6669 783d 226c 6179 6572 2e22 297d  refix="layer.")}
+0000c070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c080: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+0000c090: 524f 4d20 227b 7b69 6e70 7574 5f6c 6179  ROM "{{input_lay
+0000c0a0: 6572 7d7d 2220 6c61 7965 720a 2020 2020  er}}" layer.    
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0c0: 2020 2020 2020 2020 2020 7b67 726f 7570            {group
+0000c0d0: 6279 5f67 726f 7570 6279 5f70 7265 6669  by_groupby_prefi
+0000c0e0: 7865 645f 7374 722e 666f 726d 6174 2870  xed_str.format(p
+0000c0f0: 7265 6669 783d 226c 6179 6572 2e22 297d  refix="layer.")}
+0000c100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c110: 2020 2020 2020 2020 2020 2020 2020 4f52                OR
+0000c120: 4445 5220 4259 204d 494e 286c 6179 6572  DER BY MIN(layer
+0000c130: 2e7b 6f72 6465 7262 795f 636f 6c75 6d6e  .{orderby_column
+0000c140: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0000c150: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+0000c160: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c170: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c180: 2020 2020 2020 2020 2023 2049 6620 6167           # If ag
+0000c190: 675f 636f 6c75 6d6e 7320 7370 6563 6966  g_columns specif
+0000c1a0: 6965 642c 2070 6f73 7470 726f 6365 7373  ied, postprocess
+0000c1b0: 696e 6720 6973 2061 2062 6974 206d 6f72  ing is a bit mor
+0000c1c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000c1d0: 2020 2020 2020 2320 636f 6d70 6c69 6361        # complica
+0000c1e0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+0000c1f0: 2020 2020 2020 2020 2073 716c 5f73 746d           sql_stm
+0000c200: 7420 3d20 6622 2222 0a20 2020 2020 2020  t = f""".       
+0000c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c220: 2053 454c 4543 5420 6765 6f5f 6461 7461   SELECT geo_data
+0000c230: 2e7b 7b67 656f 6d65 7472 7963 6f6c 756d  .{{geometrycolum
+0000c240: 6e7d 7d0a 2020 2020 2020 2020 2020 2020  n}}.            
 0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c260: 2020 2020 2020 2053 454c 4543 5420 6765         SELECT ge
-0000c270: 6f5f 6461 7461 2e7b 7b67 656f 6d65 7472  o_data.{{geometr
-0000c280: 7963 6f6c 756d 6e7d 7d0a 2020 2020 2020  ycolumn}}.      
-0000c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2a0: 2020 2020 2020 2020 7b67 726f 7570 6279          {groupby
-0000c2b0: 5f73 656c 6563 745f 7072 6566 6978 6564  _select_prefixed
-0000c2c0: 5f73 7472 2e66 6f72 6d61 7428 7072 6566  _str.format(pref
-0000c2d0: 6978 3d22 6765 6f5f 6461 7461 2e22 297d  ix="geo_data.")}
-0000c2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-0000c300: 6167 675f 636f 6c75 6d6e 735f 7374 727d  agg_columns_str}
-0000c310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c320: 2020 2020 2020 2020 2020 2046 524f 4d20             FROM 
-0000c330: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c340: 2020 2020 2020 2020 2020 2020 2020 5345                SE
-0000c350: 4c45 4354 2053 545f 436f 6c6c 6563 7428  LECT ST_Collect(
-0000c360: 6c61 7965 725f 6765 6f2e 7b7b 6765 6f6d  layer_geo.{{geom
-0000c370: 6574 7279 636f 6c75 6d6e 7d7d 0a20 2020  etrycolumn}}.   
+0000c260: 2020 7b67 726f 7570 6279 5f73 656c 6563    {groupby_selec
+0000c270: 745f 7072 6566 6978 6564 5f73 7472 2e66  t_prefixed_str.f
+0000c280: 6f72 6d61 7428 7072 6566 6978 3d22 6765  ormat(prefix="ge
+0000c290: 6f5f 6461 7461 2e22 297d 0a20 2020 2020  o_data.")}.     
+0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2b0: 2020 2020 2020 2020 207b 6167 675f 636f           {agg_co
+0000c2c0: 6c75 6d6e 735f 7374 727d 0a20 2020 2020  lumns_str}.     
+0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2e0: 2020 2020 2046 524f 4d20 280a 2020 2020       FROM (.    
+0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c300: 2020 2020 2020 2020 5345 4c45 4354 2053          SELECT S
+0000c310: 545f 436f 6c6c 6563 7428 6c61 7965 725f  T_Collect(layer_
+0000c320: 6765 6f2e 7b7b 6765 6f6d 6574 7279 636f  geo.{{geometryco
+0000c330: 6c75 6d6e 7d7d 0a20 2020 2020 2020 2020  lumn}}.         
+0000c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c350: 2020 2020 2020 2020 2020 2920 4153 207b            ) AS {
+0000c360: 7b67 656f 6d65 7472 7963 6f6c 756d 6e7d  {geometrycolumn}
+0000c370: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
 0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3a0: 2920 4153 207b 7b67 656f 6d65 7472 7963  ) AS {{geometryc
-0000c3b0: 6f6c 756d 6e7d 7d0a 2020 2020 2020 2020  olumn}}.        
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3d0: 2020 2020 2020 2020 2020 7b67 726f 7570            {group
-0000c3e0: 6279 5f73 656c 6563 745f 7072 6566 6978  by_select_prefix
-0000c3f0: 6564 5f73 7472 2e66 6f72 6d61 7428 7072  ed_str.format(pr
-0000c400: 6566 6978 3d22 6c61 7965 725f 6765 6f2e  efix="layer_geo.
-0000c410: 2229 7d0a 2020 2020 2020 2020 2020 2020  ")}.            
-0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c430: 2020 2020 2020 2c4d 494e 286c 6179 6572        ,MIN(layer
-0000c440: 5f67 656f 2e7b 6f72 6465 7262 795f 636f  _geo.{orderby_co
-0000c450: 6c75 6d6e 7d29 2061 7320 7b6f 7264 6572  lumn}) as {order
-0000c460: 6279 5f63 6f6c 756d 6e7d 0a20 2020 2020  by_column}.     
+0000c390: 2020 2020 7b67 726f 7570 6279 5f73 656c      {groupby_sel
+0000c3a0: 6563 745f 7072 6566 6978 6564 5f73 7472  ect_prefixed_str
+0000c3b0: 2e66 6f72 6d61 7428 7072 6566 6978 3d22  .format(prefix="
+0000c3c0: 6c61 7965 725f 6765 6f2e 2229 7d0a 2020  layer_geo.")}.  
+0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3f0: 2c4d 494e 286c 6179 6572 5f67 656f 2e7b  ,MIN(layer_geo.{
+0000c400: 6f72 6465 7262 795f 636f 6c75 6d6e 7d29  orderby_column})
+0000c410: 2061 7320 7b6f 7264 6572 6279 5f63 6f6c   as {orderby_col
+0000c420: 756d 6e7d 0a20 2020 2020 2020 2020 2020  umn}.           
+0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c440: 2020 2046 524f 4d20 227b 7b69 6e70 7574     FROM "{{input
+0000c450: 5f6c 6179 6572 7d7d 2220 6c61 7965 725f  _layer}}" layer_
+0000c460: 6765 6f0a 2020 2020 2020 2020 2020 2020  geo.            
 0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c480: 2020 2020 2020 2020 2046 524f 4d20 227b           FROM "{
-0000c490: 7b69 6e70 7574 5f6c 6179 6572 7d7d 2220  {input_layer}}" 
-0000c4a0: 6c61 7965 725f 6765 6f0a 2020 2020 2020  layer_geo.      
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 7b67 726f 7570 6279          {groupby
-0000c4d0: 5f67 726f 7570 6279 5f70 7265 6669 7865  _groupby_prefixe
-0000c4e0: 645f 7374 722e 666f 726d 6174 2870 7265  d_str.format(pre
-0000c4f0: 6669 783d 226c 6179 6572 5f67 656f 2e22  fix="layer_geo."
-0000c500: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
-0000c510: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000c520: 2067 656f 5f64 6174 610a 2020 2020 2020   geo_data.      
-0000c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c540: 2020 2020 4a4f 494e 2028 0a20 2020 2020      JOIN (.     
-0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c560: 2020 2020 2020 2053 454c 4543 5420 4449         SELECT DI
-0000c570: 5354 494e 4354 206a 736f 6e5f 726f 7773  STINCT json_rows
-0000c580: 5f74 6162 6c65 2e76 616c 7565 2061 7320  _table.value as 
-0000c590: 6a73 6f6e 5f72 6f77 0a20 2020 2020 2020  json_row.       
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2020 207b 6772 6f75 7062           {groupb
-0000c5c0: 795f 7365 6c65 6374 5f70 7265 6669 7865  y_select_prefixe
-0000c5d0: 645f 7374 722e 666f 726d 6174 2870 7265  d_str.format(pre
-0000c5e0: 6669 783d 226c 6179 6572 5f66 6f72 5f6a  fix="layer_for_j
-0000c5f0: 736f 6e2e 2229 7d0a 2020 2020 2020 2020  son.")}.        
+0000c480: 2020 7b67 726f 7570 6279 5f67 726f 7570    {groupby_group
+0000c490: 6279 5f70 7265 6669 7865 645f 7374 722e  by_prefixed_str.
+0000c4a0: 666f 726d 6174 2870 7265 6669 783d 226c  format(prefix="l
+0000c4b0: 6179 6572 5f67 656f 2e22 297d 0a20 2020  ayer_geo.")}.   
+0000c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4d0: 2020 2020 2020 2020 2029 2067 656f 5f64           ) geo_d
+0000c4e0: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 4a4f                JO
+0000c500: 494e 2028 0a20 2020 2020 2020 2020 2020  IN (.           
+0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c520: 2053 454c 4543 5420 4449 5354 494e 4354   SELECT DISTINCT
+0000c530: 206a 736f 6e5f 726f 7773 5f74 6162 6c65   json_rows_table
+0000c540: 2e76 616c 7565 2061 7320 6a73 6f6e 5f72  .value as json_r
+0000c550: 6f77 0a20 2020 2020 2020 2020 2020 2020  ow.             
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c570: 2020 207b 6772 6f75 7062 795f 7365 6c65     {groupby_sele
+0000c580: 6374 5f70 7265 6669 7865 645f 7374 722e  ct_prefixed_str.
+0000c590: 666f 726d 6174 2870 7265 6669 783d 226c  format(prefix="l
+0000c5a0: 6179 6572 5f66 6f72 5f6a 736f 6e2e 2229  ayer_for_json.")
+0000c5b0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5d0: 4652 4f4d 2022 7b7b 696e 7075 745f 6c61  FROM "{{input_la
+0000c5e0: 7965 727d 7d22 206c 6179 6572 5f66 6f72  yer}}" layer_for
+0000c5f0: 5f6a 736f 6e0a 2020 2020 2020 2020 2020  _json.          
 0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c610: 2020 2020 2020 4652 4f4d 2022 7b7b 696e        FROM "{{in
-0000c620: 7075 745f 6c61 7965 727d 7d22 206c 6179  put_layer}}" lay
-0000c630: 6572 5f66 6f72 5f6a 736f 6e0a 2020 2020  er_for_json.    
-0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c650: 2020 2020 2020 2020 2020 4352 4f53 5320            CROSS 
-0000c660: 4a4f 494e 206a 736f 6e5f 6561 6368 280a  JOIN json_each(.
-0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c690: 2020 6c61 7965 725f 666f 725f 6a73 6f6e    layer_for_json
-0000c6a0: 2e5f 5f44 4953 534f 4c56 455f 544f 4a53  .__DISSOLVE_TOJS
-0000c6b0: 4f4e 2c20 2224 2229 206a 736f 6e5f 726f  ON, "$") json_ro
-0000c6c0: 7773 5f74 6162 6c65 0a20 2020 2020 2020  ws_table.       
+0000c610: 2020 2020 4352 4f53 5320 4a4f 494e 206a      CROSS JOIN j
+0000c620: 736f 6e5f 6561 6368 280a 2020 2020 2020  son_each(.      
+0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c640: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000c650: 725f 666f 725f 6a73 6f6e 2e5f 5f44 4953  r_for_json.__DIS
+0000c660: 534f 4c56 455f 544f 4a53 4f4e 2c20 2224  SOLVE_TOJSON, "$
+0000c670: 2229 206a 736f 6e5f 726f 7773 5f74 6162  ") json_rows_tab
+0000c680: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+0000c690: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000c6a0: 206a 736f 6e5f 6461 7461 0a20 2020 2020   json_data.     
+0000c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6c0: 2020 2020 5748 4552 4520 313d 310a 2020      WHERE 1=1.  
 0000c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6e0: 2020 2020 2029 206a 736f 6e5f 6461 7461       ) json_data
-0000c6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c700: 2020 2020 2020 2020 2020 5748 4552 4520            WHERE 
-0000c710: 313d 310a 2020 2020 2020 2020 2020 2020  1=1.            
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c730: 7b67 726f 7570 6279 5f66 696c 7465 725f  {groupby_filter_
-0000c740: 7374 727d 0a20 2020 2020 2020 2020 2020  str}.           
-0000c750: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-0000c760: 6772 6f75 7062 795f 6772 6f75 7062 795f  groupby_groupby_
-0000c770: 7072 6566 6978 6564 5f73 7472 2e66 6f72  prefixed_str.for
-0000c780: 6d61 7428 7072 6566 6978 3d22 6765 6f5f  mat(prefix="geo_
-0000c790: 6461 7461 2e22 297d 0a20 2020 2020 2020  data.")}.       
-0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7b0: 2020 204f 5244 4552 2042 5920 6765 6f5f     ORDER BY geo_
-0000c7c0: 6461 7461 2e7b 6f72 6465 7262 795f 636f  data.{orderby_co
-0000c7d0: 6c75 6d6e 7d0a 2020 2020 2020 2020 2020  lumn}.          
-0000c7e0: 2020 2020 2020 2020 2020 2222 220a 0a20            """.. 
-0000c7f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c800: 2041 7070 6c79 2077 6865 7265 2070 6172   Apply where par
-0000c810: 616d 6574 6572 2069 6620 6e65 6564 6564  ameter if needed
-0000c820: 2f70 6f73 7369 626c 650a 2020 2020 2020  /possible.      
-0000c830: 2020 2020 2020 2020 2020 6966 2077 6865            if whe
-0000c840: 7265 2069 7320 6e6f 7420 4e6f 6e65 2061  re is not None a
-0000c850: 6e64 206e 6f74 206e 6f74 2065 7870 6c6f  nd not not explo
-0000c860: 6465 636f 6c6c 6563 7469 6f6e 733a 0a20  decollections:. 
-0000c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c880: 2020 2023 2065 7870 6c6f 6465 636f 6c6c     # explodecoll
-0000c890: 6563 7469 6f6e 7320 6973 206e 6f74 2054  ections is not T
-0000c8a0: 7275 652c 2073 6f20 7765 2063 616e 2061  rue, so we can a
-0000c8b0: 6464 2069 7420 746f 2073 716c 5f73 746d  dd it to sql_stm
-0000c8c0: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-0000c8d0: 2020 2020 2020 2023 2049 6620 6578 706c         # If expl
-0000c8e0: 6f64 6563 6f6c 6c65 6374 696f 6e73 2077  odecollections w
-0000c8f0: 6f75 6c64 2062 6520 5472 7565 2c20 7765  ould be True, we
-0000c900: 206e 6565 6420 746f 2077 6169 7420 746f   need to wait to
-0000c910: 2061 7070 6c79 2074 6865 0a20 2020 2020   apply the.     
-0000c920: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c930: 2077 6865 7265 2074 696c 6c20 6166 7465   where till afte
-0000c940: 7220 6578 706c 6f64 6563 6f6c 6c65 6374  r explodecollect
-0000c950: 696f 6e73 2069 7320 6170 706c 6965 642c  ions is applied,
-0000c960: 2073 6f20 7768 656e 2061 7070 656e 6469   so when appendi
-0000c970: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0000c980: 2020 2020 2020 2023 2074 6865 2070 6172         # the par
-0000c990: 7469 616c 2072 6573 756c 7473 2074 6f20  tial results to 
-0000c9a0: 7468 6520 6f75 7470 7574 2066 696c 652e  the output file.
-0000c9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9c0: 2020 2020 2077 6865 7265 203d 2077 6865       where = whe
-0000c9d0: 7265 2e66 6f72 6d61 7428 6765 6f6d 6574  re.format(geomet
-0000c9e0: 7279 636f 6c75 6d6e 3d22 6765 6f6d 2229  rycolumn="geom")
-0000c9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ca00: 2020 2020 2073 716c 5f73 746d 7420 3d20       sql_stmt = 
-0000ca10: 6622 2222 0a20 2020 2020 2020 2020 2020  f""".           
-0000ca20: 2020 2020 2020 2020 2020 2020 2053 454c               SEL
-0000ca30: 4543 5420 2a20 4652 4f4d 0a20 2020 2020  ECT * FROM.     
+0000c6e0: 2020 2020 2020 2020 2020 7b67 726f 7570            {group
+0000c6f0: 6279 5f66 696c 7465 725f 7374 727d 0a20  by_filter_str}. 
+0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c710: 2020 2020 2020 2020 207b 6772 6f75 7062           {groupb
+0000c720: 795f 6772 6f75 7062 795f 7072 6566 6978  y_groupby_prefix
+0000c730: 6564 5f73 7472 2e66 6f72 6d61 7428 7072  ed_str.format(pr
+0000c740: 6566 6978 3d22 6765 6f5f 6461 7461 2e22  efix="geo_data."
+0000c750: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
+0000c760: 2020 2020 2020 2020 2020 2020 204f 5244               ORD
+0000c770: 4552 2042 5920 6765 6f5f 6461 7461 2e7b  ER BY geo_data.{
+0000c780: 6f72 6465 7262 795f 636f 6c75 6d6e 7d0a  orderby_column}.
+0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7a0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0000c7b0: 2020 2020 2020 2020 2023 2041 7070 6c79           # Apply
+0000c7c0: 2077 6865 7265 2070 6172 616d 6574 6572   where parameter
+0000c7d0: 2069 6620 6e65 6564 6564 2f70 6f73 7369   if needed/possi
+0000c7e0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+0000c7f0: 2020 2020 6966 2077 6865 7265 2069 7320      if where is 
+0000c800: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
+0000c810: 206e 6f74 2065 7870 6c6f 6465 636f 6c6c   not explodecoll
+0000c820: 6563 7469 6f6e 733a 0a20 2020 2020 2020  ections:.       
+0000c830: 2020 2020 2020 2020 2020 2020 2023 2065               # e
+0000c840: 7870 6c6f 6465 636f 6c6c 6563 7469 6f6e  xplodecollection
+0000c850: 7320 6973 206e 6f74 2054 7275 652c 2073  s is not True, s
+0000c860: 6f20 7765 2063 616e 2061 6464 2069 7420  o we can add it 
+0000c870: 746f 2073 716c 5f73 746d 742e 0a20 2020  to sql_stmt..   
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 2023 2049 6620 6578 706c 6f64 6563 6f6c   # If explodecol
+0000c8a0: 6c65 6374 696f 6e73 2077 6f75 6c64 2062  lections would b
+0000c8b0: 6520 5472 7565 2c20 7765 206e 6565 6420  e True, we need 
+0000c8c0: 746f 2077 6169 7420 746f 2061 7070 6c79  to wait to apply
+0000c8d0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0000c8e0: 2020 2020 2020 2020 2023 2077 6865 7265           # where
+0000c8f0: 2074 696c 6c20 6166 7465 7220 6578 706c   till after expl
+0000c900: 6f64 6563 6f6c 6c65 6374 696f 6e73 2069  odecollections i
+0000c910: 7320 6170 706c 6965 642c 2073 6f20 7768  s applied, so wh
+0000c920: 656e 2061 7070 656e 6469 6e67 0a20 2020  en appending.   
+0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c940: 2023 2074 6865 2070 6172 7469 616c 2072   # the partial r
+0000c950: 6573 756c 7473 2074 6f20 7468 6520 6f75  esults to the ou
+0000c960: 7470 7574 2066 696c 652e 0a20 2020 2020  tput file..     
+0000c970: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000c980: 6865 7265 203d 2077 6865 7265 2e66 6f72  here = where.for
+0000c990: 6d61 7428 6765 6f6d 6574 7279 636f 6c75  mat(geometrycolu
+0000c9a0: 6d6e 3d22 6765 6f6d 2229 0a20 2020 2020  mn="geom").     
+0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000c9c0: 716c 5f73 746d 7420 3d20 6622 2222 0a20  ql_stmt = f""". 
+0000c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9e0: 2020 2020 2020 2053 454c 4543 5420 2a20         SELECT * 
+0000c9f0: 4652 4f4d 0a20 2020 2020 2020 2020 2020  FROM.           
+0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca10: 2028 207b 7371 6c5f 7374 6d74 7d0a 2020   ( {sql_stmt}.  
+0000ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca30: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
 0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca50: 2020 2020 2020 2028 207b 7371 6c5f 7374         ( {sql_st
-0000ca60: 6d74 7d0a 2020 2020 2020 2020 2020 2020  mt}.            
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ca90: 2020 2020 2020 2020 2020 5748 4552 4520            WHERE 
-0000caa0: 7b77 6865 7265 7d0a 2020 2020 2020 2020  {where}.        
-0000cab0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+0000ca50: 2020 2020 5748 4552 4520 7b77 6865 7265      WHERE {where
+0000ca60: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000ca70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ca80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ca90: 5768 6572 6520 6861 7320 6265 656e 2061  Where has been a
+0000caa0: 7070 6c69 6564 2061 6c72 6561 6479 2073  pplied already s
+0000cab0: 6f20 7365 7420 746f 204e 6f6e 652e 0a20  o set to None.. 
 0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2020 2020 2320 5768 6572 6520 6861 7320      # Where has 
-0000cae0: 6265 656e 2061 7070 6c69 6564 2061 6c72  been applied alr
-0000caf0: 6561 6479 2073 6f20 7365 7420 746f 204e  eady so set to N
-0000cb00: 6f6e 652e 0a20 2020 2020 2020 2020 2020  one..           
-0000cb10: 2020 2020 2020 2020 2077 6865 7265 203d           where =
-0000cb20: 204e 6f6e 650a 0a20 2020 2020 2020 2020   None..         
-0000cb30: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-0000cb40: 666f 2822 506f 7374 7072 6f63 6573 7320  fo("Postprocess 
-0000cb50: 6f75 7470 7574 2066 696c 6522 290a 2020  output file").  
-0000cb60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000cb70: 2077 6865 7265 2069 7320 4e6f 6e65 3a0a   where is None:.
-0000cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb90: 2020 2020 6e61 6d65 203d 2066 226f 7574      name = f"out
-0000cba0: 7075 745f 746d 7032 5f66 696e 616c 7b6f  put_tmp2_final{o
-0000cbb0: 7574 7075 745f 7061 7468 2e73 7566 6669  utput_path.suffi
-0000cbc0: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
-0000cbd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000cbe0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0000cbf0: 6d65 203d 2066 226f 7574 7075 745f 746d  me = f"output_tm
-0000cc00: 7032 5f66 696e 616c 7b6f 7574 7075 745f  p2_final{output_
-0000cc10: 746d 705f 7061 7468 2e73 7566 6669 787d  tmp_path.suffix}
-0000cc20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000cc30: 2020 6f75 7470 7574 5f74 6d70 325f 6669    output_tmp2_fi
-0000cc40: 6e61 6c5f 7061 7468 203d 2074 656d 7064  nal_path = tempd
-0000cc50: 6972 202f 206e 616d 650a 2020 2020 2020  ir / name.      
-0000cc60: 2020 2020 2020 2020 2020 7371 6c5f 7374            sql_st
-0000cc70: 6d74 203d 2073 716c 5f73 746d 742e 666f  mt = sql_stmt.fo
-0000cc80: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
-0000cc90: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
-0000cca0: 7279 636f 6c75 6d6e 3d22 6765 6f6d 222c  rycolumn="geom",
-0000ccb0: 2069 6e70 7574 5f6c 6179 6572 3d6f 7574   input_layer=out
-0000ccc0: 7075 745f 6c61 7965 720a 2020 2020 2020  put_layer.      
-0000ccd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000cce0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
-0000ccf0: 7465 5f73 7061 7469 616c 5f69 6e64 6578  te_spatial_index
-0000cd00: 203d 2054 7275 6520 6966 2077 6865 7265   = True if where
-0000cd10: 2069 7320 4e6f 6e65 2065 6c73 6520 4661   is None else Fa
-0000cd20: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000cd30: 2020 2020 5f6f 6772 5f75 7469 6c2e 7665      _ogr_util.ve
-0000cd40: 6374 6f72 5f74 7261 6e73 6c61 7465 280a  ctor_translate(.
-0000cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd60: 2020 2020 696e 7075 745f 7061 7468 3d6f      input_path=o
-0000cd70: 7574 7075 745f 746d 705f 7061 7468 2c0a  utput_tmp_path,.
-0000cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd90: 2020 2020 6f75 7470 7574 5f70 6174 683d      output_path=
-0000cda0: 6f75 7470 7574 5f74 6d70 325f 6669 6e61  output_tmp2_fina
-0000cdb0: 6c5f 7061 7468 2c0a 2020 2020 2020 2020  l_path,.        
-0000cdc0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-0000cdd0: 7574 5f6c 6179 6572 3d6f 7574 7075 745f  ut_layer=output_
-0000cde0: 6c61 7965 722c 0a20 2020 2020 2020 2020  layer,.         
-0000cdf0: 2020 2020 2020 2020 2020 2073 716c 5f73             sql_s
-0000ce00: 746d 743d 7371 6c5f 7374 6d74 2c0a 2020  tmt=sql_stmt,.  
-0000ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce20: 2020 7371 6c5f 6469 616c 6563 743d 2253    sql_dialect="S
-0000ce30: 514c 4954 4522 2c0a 2020 2020 2020 2020  QLITE",.        
-0000ce40: 2020 2020 2020 2020 2020 2020 666f 7263              forc
-0000ce50: 655f 6f75 7470 7574 5f67 656f 6d65 7472  e_output_geometr
-0000ce60: 7974 7970 653d 696e 7075 745f 6c61 7965  ytype=input_laye
-0000ce70: 7269 6e66 6f2e 6765 6f6d 6574 7279 7479  rinfo.geometryty
-0000ce80: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0000ce90: 2020 2020 2020 2020 6578 706c 6f64 6563          explodec
-0000cea0: 6f6c 6c65 6374 696f 6e73 3d65 7870 6c6f  ollections=explo
-0000ceb0: 6465 636f 6c6c 6563 7469 6f6e 732c 0a20  decollections,. 
-0000cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ced0: 2020 206f 7074 696f 6e73 3d7b 224c 4159     options={"LAY
-0000cee0: 4552 5f43 5245 4154 494f 4e2e 5350 4154  ER_CREATION.SPAT
-0000cef0: 4941 4c5f 494e 4445 5822 3a20 6372 6561  IAL_INDEX": crea
-0000cf00: 7465 5f73 7061 7469 616c 5f69 6e64 6578  te_spatial_index
-0000cf10: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-0000cf20: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0000cf30: 2020 2020 2020 2320 5765 2073 7469 6c6c        # We still
-0000cf40: 206e 6565 6420 746f 2061 7070 6c79 2074   need to apply t
-0000cf50: 6865 2077 6865 7265 2066 696c 7465 720a  he where filter.
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 6966 2077 6865 7265 2069 7320 6e6f 7420  if where is not 
-0000cf80: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000cf90: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-0000cfa0: 2066 226f 7574 7075 745f 746d 7033 5f77   f"output_tmp3_w
-0000cfb0: 6865 7265 7b6f 7574 7075 745f 7061 7468  here{output_path
-0000cfc0: 2e73 7566 6669 787d 220a 2020 2020 2020  .suffix}".      
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0000cfe0: 7470 7574 5f74 6d70 335f 7768 6572 655f  tput_tmp3_where_
-0000cff0: 7061 7468 203d 2074 656d 7064 6972 202f  path = tempdir /
-0000d000: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
-0000d010: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000d020: 5f74 6d70 325f 696e 666f 203d 2067 666f  _tmp2_info = gfo
-0000d030: 2e67 6574 5f6c 6179 6572 696e 666f 286f  .get_layerinfo(o
-0000d040: 7574 7075 745f 746d 7032 5f66 696e 616c  utput_tmp2_final
-0000d050: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
-0000d060: 2020 2020 2020 2020 2020 2077 6865 7265             where
-0000d070: 203d 2077 6865 7265 2e66 6f72 6d61 7428   = where.format(
-0000d080: 6765 6f6d 6574 7279 636f 6c75 6d6e 3d6f  geometrycolumn=o
-0000d090: 7574 7075 745f 746d 7032 5f69 6e66 6f2e  utput_tmp2_info.
-0000d0a0: 6765 6f6d 6574 7279 636f 6c75 6d6e 290a  geometrycolumn).
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 2020 2020 7371 6c5f 7374 6d74 203d 2066      sql_stmt = f
-0000d0d0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0000d0e0: 2020 2020 2020 2020 2020 2020 5345 4c45              SELE
-0000d0f0: 4354 202a 2046 524f 4d20 227b 6f75 7470  CT * FROM "{outp
-0000d100: 7574 5f6c 6179 6572 7d22 0a20 2020 2020  ut_layer}".     
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d120: 2020 2020 5748 4552 4520 7b77 6865 7265      WHERE {where
-0000d130: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000d140: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000d150: 2020 2020 2020 2020 2020 2020 2020 746d                tm
-0000d160: 705f 696e 666f 203d 2067 666f 2e67 6574  p_info = gfo.get
-0000d170: 5f6c 6179 6572 696e 666f 286f 7574 7075  _layerinfo(outpu
-0000d180: 745f 746d 7032 5f66 696e 616c 5f70 6174  t_tmp2_final_pat
-0000d190: 682c 206f 7574 7075 745f 6c61 7965 7229  h, output_layer)
-0000d1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d1b0: 2020 2020 2073 716c 5f73 746d 7420 3d20       sql_stmt = 
-0000d1c0: 7371 6c5f 7374 6d74 2e66 6f72 6d61 7428  sql_stmt.format(
-0000d1d0: 6765 6f6d 6574 7279 636f 6c75 6d6e 3d74  geometrycolumn=t
-0000d1e0: 6d70 5f69 6e66 6f2e 6765 6f6d 6574 7279  mp_info.geometry
-0000d1f0: 636f 6c75 6d6e 290a 2020 2020 2020 2020  column).        
-0000d200: 2020 2020 2020 2020 2020 2020 5f6f 6772              _ogr
-0000d210: 5f75 7469 6c2e 7665 6374 6f72 5f74 7261  _util.vector_tra
-0000d220: 6e73 6c61 7465 280a 2020 2020 2020 2020  nslate(.        
-0000d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d240: 696e 7075 745f 7061 7468 3d6f 7574 7075  input_path=outpu
-0000d250: 745f 746d 7032 5f66 696e 616c 5f70 6174  t_tmp2_final_pat
-0000d260: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-0000d270: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-0000d280: 745f 7061 7468 3d6f 7574 7075 745f 746d  t_path=output_tm
-0000d290: 7033 5f77 6865 7265 5f70 6174 682c 0a20  p3_where_path,. 
-0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2b0: 2020 2020 2020 206f 7574 7075 745f 6c61         output_la
-0000d2c0: 7965 723d 6f75 7470 7574 5f6c 6179 6572  yer=output_layer
-0000d2d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d2e0: 2020 2020 2020 2020 2020 666f 7263 655f            force_
-0000d2f0: 6f75 7470 7574 5f67 656f 6d65 7472 7974  output_geometryt
-0000d300: 7970 653d 696e 7075 745f 6c61 7965 7269  ype=input_layeri
-0000d310: 6e66 6f2e 6765 6f6d 6574 7279 7479 7065  nfo.geometrytype
-0000d320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d330: 2020 2020 2020 2020 2020 7371 6c5f 7374            sql_st
-0000d340: 6d74 3d73 716c 5f73 746d 742c 0a20 2020  mt=sql_stmt,.   
-0000d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d360: 2020 2020 2073 716c 5f64 6961 6c65 6374       sql_dialect
-0000d370: 3d22 5351 4c49 5445 222c 0a20 2020 2020  ="SQLITE",.     
+0000cad0: 2020 2077 6865 7265 203d 204e 6f6e 650a     where = None.
+0000cae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000caf0: 206c 6f67 6765 722e 696e 666f 2822 506f   logger.info("Po
+0000cb00: 7374 7072 6f63 6573 7320 6f75 7470 7574  stprocess output
+0000cb10: 2066 696c 6522 290a 2020 2020 2020 2020   file").        
+0000cb20: 2020 2020 2020 2020 6966 2077 6865 7265          if where
+0000cb30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000cb40: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0000cb50: 6d65 203d 2066 226f 7574 7075 745f 746d  me = f"output_tm
+0000cb60: 7032 5f66 696e 616c 7b6f 7574 7075 745f  p2_final{output_
+0000cb70: 7061 7468 2e73 7566 6669 787d 220a 2020  path.suffix}".  
+0000cb80: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000cb90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000cba0: 2020 2020 2020 2020 6e61 6d65 203d 2066          name = f
+0000cbb0: 226f 7574 7075 745f 746d 7032 5f66 696e  "output_tmp2_fin
+0000cbc0: 616c 7b6f 7574 7075 745f 746d 705f 7061  al{output_tmp_pa
+0000cbd0: 7468 2e73 7566 6669 787d 220a 2020 2020  th.suffix}".    
+0000cbe0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+0000cbf0: 7574 5f74 6d70 325f 6669 6e61 6c5f 7061  ut_tmp2_final_pa
+0000cc00: 7468 203d 2074 656d 7064 6972 202f 206e  th = tempdir / n
+0000cc10: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0000cc20: 2020 2020 7371 6c5f 7374 6d74 203d 2073      sql_stmt = s
+0000cc30: 716c 5f73 746d 742e 666f 726d 6174 280a  ql_stmt.format(.
+0000cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc50: 2020 2020 6765 6f6d 6574 7279 636f 6c75      geometrycolu
+0000cc60: 6d6e 3d22 6765 6f6d 222c 2069 6e70 7574  mn="geom", input
+0000cc70: 5f6c 6179 6572 3d6f 7574 7075 745f 6c61  _layer=output_la
+0000cc80: 7965 720a 2020 2020 2020 2020 2020 2020  yer.            
+0000cc90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000cca0: 2020 2020 2020 6372 6561 7465 5f73 7061        create_spa
+0000ccb0: 7469 616c 5f69 6e64 6578 203d 2054 7275  tial_index = Tru
+0000ccc0: 6520 6966 2077 6865 7265 2069 7320 4e6f  e if where is No
+0000ccd0: 6e65 2065 6c73 6520 4661 6c73 650a 2020  ne else False.  
+0000cce0: 2020 2020 2020 2020 2020 2020 2020 5f6f                _o
+0000ccf0: 6772 5f75 7469 6c2e 7665 6374 6f72 5f74  gr_util.vector_t
+0000cd00: 7261 6e73 6c61 7465 280a 2020 2020 2020  ranslate(.      
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000cd20: 7075 745f 7061 7468 3d6f 7574 7075 745f  put_path=output_
+0000cd30: 746d 705f 7061 7468 2c0a 2020 2020 2020  tmp_path,.      
+0000cd40: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0000cd50: 7470 7574 5f70 6174 683d 6f75 7470 7574  tput_path=output
+0000cd60: 5f74 6d70 325f 6669 6e61 6c5f 7061 7468  _tmp2_final_path
+0000cd70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cd80: 2020 2020 2020 6f75 7470 7574 5f6c 6179        output_lay
+0000cd90: 6572 3d6f 7574 7075 745f 6c61 7965 722c  er=output_layer,
+0000cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cdb0: 2020 2020 2073 716c 5f73 746d 743d 7371       sql_stmt=sq
+0000cdc0: 6c5f 7374 6d74 2c0a 2020 2020 2020 2020  l_stmt,.        
+0000cdd0: 2020 2020 2020 2020 2020 2020 7371 6c5f              sql_
+0000cde0: 6469 616c 6563 743d 2253 514c 4954 4522  dialect="SQLITE"
+0000cdf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ce00: 2020 2020 2020 666f 7263 655f 6f75 7470        force_outp
+0000ce10: 7574 5f67 656f 6d65 7472 7974 7970 653d  ut_geometrytype=
+0000ce20: 696e 7075 745f 6c61 7965 7269 6e66 6f2e  input_layerinfo.
+0000ce30: 6765 6f6d 6574 7279 7479 7065 2c0a 2020  geometrytype,.  
+0000ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce50: 2020 6578 706c 6f64 6563 6f6c 6c65 6374    explodecollect
+0000ce60: 696f 6e73 3d65 7870 6c6f 6465 636f 6c6c  ions=explodecoll
+0000ce70: 6563 7469 6f6e 732c 0a20 2020 2020 2020  ections,.       
+0000ce80: 2020 2020 2020 2020 2020 2020 206f 7074               opt
+0000ce90: 696f 6e73 3d7b 224c 4159 4552 5f43 5245  ions={"LAYER_CRE
+0000cea0: 4154 494f 4e2e 5350 4154 4941 4c5f 494e  ATION.SPATIAL_IN
+0000ceb0: 4445 5822 3a20 6372 6561 7465 5f73 7061  DEX": create_spa
+0000cec0: 7469 616c 5f69 6e64 6578 7d2c 0a20 2020  tial_index},.   
+0000ced0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cef0: 2320 5765 2073 7469 6c6c 206e 6565 6420  # We still need 
+0000cf00: 746f 2061 7070 6c79 2074 6865 2077 6865  to apply the whe
+0000cf10: 7265 2066 696c 7465 720a 2020 2020 2020  re filter.      
+0000cf20: 2020 2020 2020 2020 2020 6966 2077 6865            if whe
+0000cf30: 7265 2069 7320 6e6f 7420 4e6f 6e65 3a0a  re is not None:.
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf50: 2020 2020 6e61 6d65 203d 2066 226f 7574      name = f"out
+0000cf60: 7075 745f 746d 7033 5f77 6865 7265 7b6f  put_tmp3_where{o
+0000cf70: 7574 7075 745f 7061 7468 2e73 7566 6669  utput_path.suffi
+0000cf80: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
+0000cf90: 2020 2020 2020 2020 6f75 7470 7574 5f74          output_t
+0000cfa0: 6d70 335f 7768 6572 655f 7061 7468 203d  mp3_where_path =
+0000cfb0: 2074 656d 7064 6972 202f 206e 616d 650a   tempdir / name.
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 2020 2020 6f75 7470 7574 5f74 6d70 325f      output_tmp2_
+0000cfe0: 696e 666f 203d 2067 666f 2e67 6574 5f6c  info = gfo.get_l
+0000cff0: 6179 6572 696e 666f 286f 7574 7075 745f  ayerinfo(output_
+0000d000: 746d 7032 5f66 696e 616c 5f70 6174 6829  tmp2_final_path)
+0000d010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d020: 2020 2020 2077 6865 7265 203d 2077 6865       where = whe
+0000d030: 7265 2e66 6f72 6d61 7428 6765 6f6d 6574  re.format(geomet
+0000d040: 7279 636f 6c75 6d6e 3d6f 7574 7075 745f  rycolumn=output_
+0000d050: 746d 7032 5f69 6e66 6f2e 6765 6f6d 6574  tmp2_info.geomet
+0000d060: 7279 636f 6c75 6d6e 290a 2020 2020 2020  rycolumn).      
+0000d070: 2020 2020 2020 2020 2020 2020 2020 7371                sq
+0000d080: 6c5f 7374 6d74 203d 2066 2222 220a 2020  l_stmt = f""".  
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 2020 2020 2020 5345 4c45 4354 202a 2046        SELECT * F
+0000d0b0: 524f 4d20 227b 6f75 7470 7574 5f6c 6179  ROM "{output_lay
+0000d0c0: 6572 7d22 0a20 2020 2020 2020 2020 2020  er}".           
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 5748                WH
+0000d0e0: 4552 4520 7b77 6865 7265 7d0a 2020 2020  ERE {where}.    
+0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d100: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0000d110: 2020 2020 2020 2020 746d 705f 696e 666f          tmp_info
+0000d120: 203d 2067 666f 2e67 6574 5f6c 6179 6572   = gfo.get_layer
+0000d130: 696e 666f 286f 7574 7075 745f 746d 7032  info(output_tmp2
+0000d140: 5f66 696e 616c 5f70 6174 682c 206f 7574  _final_path, out
+0000d150: 7075 745f 6c61 7965 7229 0a20 2020 2020  put_layer).     
+0000d160: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d170: 716c 5f73 746d 7420 3d20 7371 6c5f 7374  ql_stmt = sql_st
+0000d180: 6d74 2e66 6f72 6d61 7428 6765 6f6d 6574  mt.format(geomet
+0000d190: 7279 636f 6c75 6d6e 3d74 6d70 5f69 6e66  rycolumn=tmp_inf
+0000d1a0: 6f2e 6765 6f6d 6574 7279 636f 6c75 6d6e  o.geometrycolumn
+0000d1b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d1c0: 2020 2020 2020 5f6f 6772 5f75 7469 6c2e        _ogr_util.
+0000d1d0: 7665 6374 6f72 5f74 7261 6e73 6c61 7465  vector_translate
+0000d1e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d1f0: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+0000d200: 7061 7468 3d6f 7574 7075 745f 746d 7032  path=output_tmp2
+0000d210: 5f66 696e 616c 5f70 6174 682c 0a20 2020  _final_path,.   
+0000d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d230: 2020 2020 206f 7574 7075 745f 7061 7468       output_path
+0000d240: 3d6f 7574 7075 745f 746d 7033 5f77 6865  =output_tmp3_whe
+0000d250: 7265 5f70 6174 682c 0a20 2020 2020 2020  re_path,.       
+0000d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d270: 206f 7574 7075 745f 6c61 7965 723d 6f75   output_layer=ou
+0000d280: 7470 7574 5f6c 6179 6572 2c0a 2020 2020  tput_layer,.    
+0000d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2a0: 2020 2020 666f 7263 655f 6f75 7470 7574      force_output
+0000d2b0: 5f67 656f 6d65 7472 7974 7970 653d 696e  _geometrytype=in
+0000d2c0: 7075 745f 6c61 7965 7269 6e66 6f2e 6765  put_layerinfo.ge
+0000d2d0: 6f6d 6574 7279 7479 7065 2c0a 2020 2020  ometrytype,.    
+0000d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2f0: 2020 2020 7371 6c5f 7374 6d74 3d73 716c      sql_stmt=sql
+0000d300: 5f73 746d 742c 0a20 2020 2020 2020 2020  _stmt,.         
+0000d310: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d320: 716c 5f64 6961 6c65 6374 3d22 5351 4c49  ql_dialect="SQLI
+0000d330: 5445 222c 0a20 2020 2020 2020 2020 2020  TE",.           
+0000d340: 2020 2020 2020 2020 2020 2020 206f 7074               opt
+0000d350: 696f 6e73 3d7b 224c 4159 4552 5f43 5245  ions={"LAYER_CRE
+0000d360: 4154 494f 4e2e 5350 4154 4941 4c5f 494e  ATION.SPATIAL_IN
+0000d370: 4445 5822 3a20 5472 7565 7d2c 0a20 2020  DEX": True},.   
 0000d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d390: 2020 206f 7074 696f 6e73 3d7b 224c 4159     options={"LAY
-0000d3a0: 4552 5f43 5245 4154 494f 4e2e 5350 4154  ER_CREATION.SPAT
-0000d3b0: 4941 4c5f 494e 4445 5822 3a20 5472 7565  IAL_INDEX": True
-0000d3c0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-0000d3d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000d3e0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-0000d3f0: 7075 745f 746d 7032 5f66 696e 616c 5f70  put_tmp2_final_p
-0000d400: 6174 6820 3d20 6f75 7470 7574 5f74 6d70  ath = output_tmp
-0000d410: 335f 7768 6572 655f 7061 7468 0a0a 2020  3_where_path..  
-0000d420: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000d430: 4e6f 7720 7765 2061 7265 2072 6561 6479  Now we are ready
-0000d440: 2074 6f20 6d6f 7665 2074 6865 2072 6573   to move the res
-0000d450: 756c 7420 746f 2074 6865 2066 696e 616c  ult to the final
-0000d460: 2073 706f 742e 2e2e 0a20 2020 2020 2020   spot....       
-0000d470: 2020 2020 2020 2020 2067 666f 2e6d 6f76           gfo.mov
-0000d480: 6528 6f75 7470 7574 5f74 6d70 325f 6669  e(output_tmp2_fi
-0000d490: 6e61 6c5f 7061 7468 2c20 6f75 7470 7574  nal_path, output
-0000d4a0: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
-0000d4b0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
-0000d4c0: 2020 2020 2073 6875 7469 6c2e 726d 7472       shutil.rmtr
-0000d4d0: 6565 2874 656d 7064 6972 2c20 6967 6e6f  ee(tempdir, igno
-0000d4e0: 7265 5f65 7272 6f72 733d 5472 7565 290a  re_errors=True).
-0000d4f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d500: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0000d510: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
-0000d520: 2020 2020 2020 2020 2066 2255 6e73 7570           f"Unsup
-0000d530: 706f 7274 6564 2069 6e70 7574 2067 656f  ported input geo
-0000d540: 6d65 7472 7974 7970 653a 207b 696e 7075  metrytype: {inpu
-0000d550: 745f 6c61 7965 7269 6e66 6f2e 6765 6f6d  t_layerinfo.geom
-0000d560: 6574 7279 7479 7065 7d22 0a20 2020 2020  etrytype}".     
-0000d570: 2020 2029 0a0a 2020 2020 2320 5265 7475     )..    # Retu
-0000d580: 726e 2072 6573 756c 7420 696e 666f 0a20  rn result info. 
-0000d590: 2020 2072 6573 756c 745f 696e 666f 5b0a     result_info[.
-0000d5a0: 2020 2020 2020 2020 226d 6573 7361 6765          "message
-0000d5b0: 220a 2020 2020 5d20 3d20 6622 4469 7373  ".    ] = f"Diss
-0000d5c0: 6f6c 7665 2063 6f6d 706c 6574 656c 7920  olve completely 
-0000d5d0: 7265 6164 792c 2074 6f6f 6b20 7b64 6174  ready, took {dat
-0000d5e0: 6574 696d 652e 6e6f 7728 292d 7374 6172  etime.now()-star
-0000d5f0: 745f 7469 6d65 7d21 220a 2020 2020 6c6f  t_time}!".    lo
-0000d600: 6767 6572 2e69 6e66 6f28 7265 7375 6c74  gger.info(result
-0000d610: 5f69 6e66 6f5b 226d 6573 7361 6765 225d  _info["message"]
-0000d620: 290a 2020 2020 7265 7475 726e 2072 6573  ).    return res
-0000d630: 756c 745f 696e 666f 0a0a 0a64 6566 205f  ult_info...def _
-0000d640: 6469 7373 6f6c 7665 5f70 6f6c 7967 6f6e  dissolve_polygon
-0000d650: 735f 7061 7373 280a 2020 2020 696e 7075  s_pass(.    inpu
-0000d660: 745f 7061 7468 3a20 5061 7468 2c0a 2020  t_path: Path,.  
-0000d670: 2020 6f75 7470 7574 5f6e 6f74 6f6e 626f    output_notonbo
-0000d680: 7264 6572 5f70 6174 683a 2050 6174 682c  rder_path: Path,
-0000d690: 0a20 2020 206f 7574 7075 745f 6f6e 626f  .    output_onbo
-0000d6a0: 7264 6572 5f70 6174 683a 2050 6174 682c  rder_path: Path,
-0000d6b0: 0a20 2020 2065 7870 6c6f 6465 636f 6c6c  .    explodecoll
-0000d6c0: 6563 7469 6f6e 733a 2062 6f6f 6c2c 0a20  ections: bool,. 
-0000d6d0: 2020 2067 726f 7570 6279 5f63 6f6c 756d     groupby_colum
-0000d6e0: 6e73 3a20 4f70 7469 6f6e 616c 5b49 7465  ns: Optional[Ite
-0000d6f0: 7261 626c 655b 7374 725d 5d2c 0a20 2020  rable[str]],.   
-0000d700: 2061 6767 5f63 6f6c 756d 6e73 3a20 4f70   agg_columns: Op
-0000d710: 7469 6f6e 616c 5b64 6963 745d 2c0a 2020  tional[dict],.  
-0000d720: 2020 7469 6c65 735f 6764 663a 2067 7064    tiles_gdf: gpd
-0000d730: 2e47 656f 4461 7461 4672 616d 652c 0a20  .GeoDataFrame,. 
-0000d740: 2020 2069 6e70 7574 5f6c 6179 6572 3a20     input_layer: 
-0000d750: 4f70 7469 6f6e 616c 5b73 7472 5d2c 0a20  Optional[str],. 
-0000d760: 2020 206f 7574 7075 745f 6c61 7965 723a     output_layer:
-0000d770: 204f 7074 696f 6e61 6c5b 7374 725d 2c0a   Optional[str],.
-0000d780: 2020 2020 6772 6964 7369 7a65 3a20 666c      gridsize: fl
-0000d790: 6f61 742c 0a20 2020 206b 6565 705f 656d  oat,.    keep_em
-0000d7a0: 7074 795f 6765 6f6d 733a 2062 6f6f 6c2c  pty_geoms: bool,
-0000d7b0: 0a20 2020 206e 625f 7061 7261 6c6c 656c  .    nb_parallel
-0000d7c0: 3a20 696e 742c 0a29 202d 3e20 6469 6374  : int,.) -> dict
-0000d7d0: 3a0a 2020 2020 2320 4d61 6b65 2073 7572  :.    # Make sur
-0000d7e0: 6520 7468 6520 696e 7075 7420 6669 6c65  e the input file
-0000d7f0: 2068 6173 2061 2073 7061 7469 616c 2069   has a spatial i
-0000d800: 6e64 6578 0a20 2020 2067 666f 2e63 7265  ndex.    gfo.cre
-0000d810: 6174 655f 7370 6174 6961 6c5f 696e 6465  ate_spatial_inde
-0000d820: 7828 696e 7075 745f 7061 7468 2c20 6578  x(input_path, ex
-0000d830: 6973 745f 6f6b 3d54 7275 6529 0a0a 2020  ist_ok=True)..  
-0000d840: 2020 2320 5374 6172 7420 6361 6c63 756c    # Start calcul
-0000d850: 6174 696f 6e20 696e 2070 6172 616c 6c65  ation in paralle
-0000d860: 6c0a 2020 2020 7374 6172 745f 7469 6d65  l.    start_time
-0000d870: 203d 2064 6174 6574 696d 652e 6e6f 7728   = datetime.now(
-0000d880: 290a 2020 2020 7265 7375 6c74 5f69 6e66  ).    result_inf
-0000d890: 6f20 3d20 7b7d 0a20 2020 2073 7461 7274  o = {}.    start
-0000d8a0: 5f74 696d 6520 3d20 6461 7465 7469 6d65  _time = datetime
-0000d8b0: 2e6e 6f77 2829 0a20 2020 2069 6e70 7574  .now().    input
-0000d8c0: 5f6c 6179 6572 696e 666f 203d 2067 666f  _layerinfo = gfo
-0000d8d0: 2e67 6574 5f6c 6179 6572 696e 666f 2869  .get_layerinfo(i
-0000d8e0: 6e70 7574 5f70 6174 682c 2069 6e70 7574  nput_path, input
-0000d8f0: 5f6c 6179 6572 290a 0a20 2020 2023 2050  _layer)..    # P
-0000d900: 726f 6365 7373 696e 6720 696e 2074 6872  rocessing in thr
-0000d910: 6561 6473 2069 7320 3278 2066 6173 7465  eads is 2x faste
-0000d920: 7220 666f 7220 736d 616c 6c20 6461 7461  r for small data
-0000d930: 7365 7473 2028 6f6e 2057 696e 646f 7773  sets (on Windows
-0000d940: 290a 2020 2020 6361 6c63 756c 6174 655f  ).    calculate_
-0000d950: 696e 5f74 6872 6561 6473 203d 2054 7275  in_threads = Tru
-0000d960: 6520 6966 2069 6e70 7574 5f6c 6179 6572  e if input_layer
-0000d970: 696e 666f 2e66 6561 7475 7265 636f 756e  info.featurecoun
-0000d980: 7420 3c3d 2031 3030 2065 6c73 6520 4661  t <= 100 else Fa
-0000d990: 6c73 650a 2020 2020 7769 7468 205f 7072  lse.    with _pr
-0000d9a0: 6f63 6573 7369 6e67 5f75 7469 6c2e 506f  ocessing_util.Po
-0000d9b0: 6f6c 6564 4578 6563 7574 6f72 4661 6374  oledExecutorFact
-0000d9c0: 6f72 7928 0a20 2020 2020 2020 2074 6872  ory(.        thr
-0000d9d0: 6561 6470 6f6f 6c3d 6361 6c63 756c 6174  eadpool=calculat
-0000d9e0: 655f 696e 5f74 6872 6561 6473 2c0a 2020  e_in_threads,.  
-0000d9f0: 2020 2020 2020 6d61 785f 776f 726b 6572        max_worker
-0000da00: 733d 6e62 5f70 6172 616c 6c65 6c2c 0a20  s=nb_parallel,. 
-0000da10: 2020 2020 2020 2069 6e69 7469 616c 697a         initializ
-0000da20: 6572 3d5f 7072 6f63 6573 7369 6e67 5f75  er=_processing_u
-0000da30: 7469 6c2e 696e 6974 6961 6c69 7a65 5f77  til.initialize_w
-0000da40: 6f72 6b65 7228 292c 0a20 2020 2029 2061  orker(),.    ) a
-0000da50: 7320 6361 6c63 756c 6174 655f 706f 6f6c  s calculate_pool
-0000da60: 3a0a 2020 2020 2020 2020 2320 5072 6570  :.        # Prep
-0000da70: 6172 6520 6f75 7470 7574 2066 696c 656e  are output filen
-0000da80: 616d 650a 2020 2020 2020 2020 7465 6d70  ame.        temp
-0000da90: 6469 7220 3d20 6f75 7470 7574 5f6f 6e62  dir = output_onb
-0000daa0: 6f72 6465 725f 7061 7468 2e70 6172 656e  order_path.paren
-0000dab0: 740a 0a20 2020 2020 2020 2062 6174 6368  t..        batch
-0000dac0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-0000dad0: 6e62 5f62 6174 6368 6573 203d 206c 656e  nb_batches = len
-0000dae0: 2874 696c 6573 5f67 6466 290a 2020 2020  (tiles_gdf).    
-0000daf0: 2020 2020 6e62 5f62 6174 6368 6573 5f64      nb_batches_d
-0000db00: 6f6e 6520 3d20 300a 2020 2020 2020 2020  one = 0.        
-0000db10: 6675 7475 7265 5f74 6f5f 6261 7463 685f  future_to_batch_
-0000db20: 6964 203d 207b 7d0a 2020 2020 2020 2020  id = {}.        
-0000db30: 6e62 5f72 6f77 735f 646f 6e65 203d 2030  nb_rows_done = 0
-0000db40: 0a20 2020 2020 2020 2066 6f72 2062 6174  .        for bat
-0000db50: 6368 5f69 642c 2074 696c 655f 726f 7720  ch_id, tile_row 
-0000db60: 696e 2065 6e75 6d65 7261 7465 2874 696c  in enumerate(til
-0000db70: 6573 5f67 6466 2e69 7465 7274 7570 6c65  es_gdf.itertuple
-0000db80: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-0000db90: 2020 6261 7463 6865 735b 6261 7463 685f    batches[batch_
-0000dba0: 6964 5d20 3d20 7b7d 0a20 2020 2020 2020  id] = {}.       
-0000dbb0: 2020 2020 2062 6174 6368 6573 5b62 6174       batches[bat
-0000dbc0: 6368 5f69 645d 5b22 6c61 7965 7222 5d20  ch_id]["layer"] 
-0000dbd0: 3d20 6f75 7470 7574 5f6c 6179 6572 0a20  = output_layer. 
-0000dbe0: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-0000dbf0: 6573 5b62 6174 6368 5f69 645d 5b22 626f  es[batch_id]["bo
-0000dc00: 756e 6473 225d 203d 2074 696c 655f 726f  unds"] = tile_ro
-0000dc10: 772e 6765 6f6d 6574 7279 2e62 6f75 6e64  w.geometry.bound
-0000dc20: 730a 0a20 2020 2020 2020 2020 2020 2023  s..            #
-0000dc30: 204f 7574 7075 7420 6561 6368 2062 6174   Output each bat
-0000dc40: 6368 2074 6f20 6120 7365 7065 7261 7465  ch to a seperate
-0000dc50: 2074 656d 706f 7261 7279 2066 696c 652c   temporary file,
-0000dc60: 206f 7468 6572 7769 7365 2074 6865 7265   otherwise there
-0000dc70: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-0000dc80: 7265 2074 696d 656f 7574 2069 7373 7565  re timeout issue
-0000dc90: 7320 7768 656e 2070 726f 6365 7373 696e  s when processin
-0000dca0: 6720 6c61 7267 6520 6669 6c65 730a 2020  g large files.  
-0000dcb0: 2020 2020 2020 2020 2020 7375 6666 6978            suffix
-0000dcc0: 203d 206f 7574 7075 745f 6e6f 746f 6e62   = output_notonb
-0000dcd0: 6f72 6465 725f 7061 7468 2e73 7566 6669  order_path.suffi
-0000dce0: 780a 2020 2020 2020 2020 2020 2020 6e61  x.            na
-0000dcf0: 6d65 203d 2066 227b 6f75 7470 7574 5f6e  me = f"{output_n
-0000dd00: 6f74 6f6e 626f 7264 6572 5f70 6174 682e  otonborder_path.
-0000dd10: 7374 656d 7d5f 7b62 6174 6368 5f69 647d  stem}_{batch_id}
-0000dd20: 7b73 7566 6669 787d 220a 2020 2020 2020  {suffix}".      
-0000dd30: 2020 2020 2020 6f75 7470 7574 5f6e 6f74        output_not
-0000dd40: 6f6e 626f 7264 6572 5f74 6d70 5f70 6172  onborder_tmp_par
-0000dd50: 7469 616c 5f70 6174 6820 3d20 7465 6d70  tial_path = temp
-0000dd60: 6469 7220 2f20 6e61 6d65 0a20 2020 2020  dir / name.     
-0000dd70: 2020 2020 2020 2062 6174 6368 6573 5b62         batches[b
-0000dd80: 6174 6368 5f69 645d 5b0a 2020 2020 2020  atch_id][.      
-0000dd90: 2020 2020 2020 2020 2020 226f 7574 7075            "outpu
-0000dda0: 745f 6e6f 746f 6e62 6f72 6465 725f 746d  t_notonborder_tm
-0000ddb0: 705f 7061 7274 6961 6c5f 7061 7468 220a  p_partial_path".
-0000ddc0: 2020 2020 2020 2020 2020 2020 5d20 3d20              ] = 
-0000ddd0: 6f75 7470 7574 5f6e 6f74 6f6e 626f 7264  output_notonbord
-0000dde0: 6572 5f74 6d70 5f70 6172 7469 616c 5f70  er_tmp_partial_p
-0000ddf0: 6174 680a 2020 2020 2020 2020 2020 2020  ath.            
-0000de00: 6e61 6d65 203d 2066 227b 6f75 7470 7574  name = f"{output
-0000de10: 5f6f 6e62 6f72 6465 725f 7061 7468 2e73  _onborder_path.s
-0000de20: 7465 6d7d 5f7b 6261 7463 685f 6964 7d7b  tem}_{batch_id}{
-0000de30: 7375 6666 6978 7d22 0a20 2020 2020 2020  suffix}".       
-0000de40: 2020 2020 206f 7574 7075 745f 6f6e 626f       output_onbo
-0000de50: 7264 6572 5f74 6d70 5f70 6172 7469 616c  rder_tmp_partial
-0000de60: 5f70 6174 6820 3d20 7465 6d70 6469 7220  _path = tempdir 
-0000de70: 2f20 6e61 6d65 0a20 2020 2020 2020 2020  / name.         
-0000de80: 2020 2062 6174 6368 6573 5b62 6174 6368     batches[batch
-0000de90: 5f69 645d 5b0a 2020 2020 2020 2020 2020  _id][.          
-0000dea0: 2020 2020 2020 226f 7574 7075 745f 6f6e        "output_on
-0000deb0: 626f 7264 6572 5f74 6d70 5f70 6172 7469  border_tmp_parti
-0000dec0: 616c 5f70 6174 6822 0a20 2020 2020 2020  al_path".       
-0000ded0: 2020 2020 205d 203d 206f 7574 7075 745f       ] = output_
-0000dee0: 6f6e 626f 7264 6572 5f74 6d70 5f70 6172  onborder_tmp_par
-0000def0: 7469 616c 5f70 6174 680a 0a20 2020 2020  tial_path..     
-0000df00: 2020 2020 2020 2023 2047 6574 2074 696c         # Get til
-0000df10: 655f 6964 2069 6620 7072 6573 656e 740a  e_id if present.
-0000df20: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
-0000df30: 5f69 6420 3d20 7469 6c65 5f72 6f77 2e74  _id = tile_row.t
-0000df40: 696c 655f 6964 2069 6620 2274 696c 655f  ile_id if "tile_
-0000df50: 6964 2220 696e 2074 696c 655f 726f 772e  id" in tile_row.
-0000df60: 5f66 6965 6c64 7320 656c 7365 204e 6f6e  _fields else Non
-0000df70: 650a 0a20 2020 2020 2020 2020 2020 2066  e..            f
-0000df80: 7574 7572 6520 3d20 6361 6c63 756c 6174  uture = calculat
-0000df90: 655f 706f 6f6c 2e73 7562 6d69 7428 0a20  e_pool.submit(. 
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000dfb0: 6469 7373 6f6c 7665 5f70 6f6c 7967 6f6e  dissolve_polygon
-0000dfc0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000dfd0: 2020 2069 6e70 7574 5f70 6174 683d 696e     input_path=in
-0000dfe0: 7075 745f 7061 7468 2c0a 2020 2020 2020  put_path,.      
-0000dff0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000e000: 5f6e 6f74 6f6e 626f 7264 6572 5f70 6174  _notonborder_pat
-0000e010: 683d 6f75 7470 7574 5f6e 6f74 6f6e 626f  h=output_notonbo
-0000e020: 7264 6572 5f74 6d70 5f70 6172 7469 616c  rder_tmp_partial
-0000e030: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-0000e040: 2020 2020 2020 206f 7574 7075 745f 6f6e         output_on
-0000e050: 626f 7264 6572 5f70 6174 683d 6f75 7470  border_path=outp
-0000e060: 7574 5f6f 6e62 6f72 6465 725f 746d 705f  ut_onborder_tmp_
-0000e070: 7061 7274 6961 6c5f 7061 7468 2c0a 2020  partial_path,.  
-0000e080: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0000e090: 706c 6f64 6563 6f6c 6c65 6374 696f 6e73  plodecollections
-0000e0a0: 3d65 7870 6c6f 6465 636f 6c6c 6563 7469  =explodecollecti
-0000e0b0: 6f6e 732c 0a20 2020 2020 2020 2020 2020  ons,.           
-0000e0c0: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-0000e0d0: 756d 6e73 3d67 726f 7570 6279 5f63 6f6c  umns=groupby_col
-0000e0e0: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
-0000e0f0: 2020 2020 2020 6167 675f 636f 6c75 6d6e        agg_column
-0000e100: 733d 6167 675f 636f 6c75 6d6e 732c 0a20  s=agg_columns,. 
-0000e110: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e120: 6e70 7574 5f67 656f 6d65 7472 7974 7970  nput_geometrytyp
-0000e130: 653d 696e 7075 745f 6c61 7965 7269 6e66  e=input_layerinf
-0000e140: 6f2e 6765 6f6d 6574 7279 7479 7065 2c0a  o.geometrytype,.
-0000e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e160: 696e 7075 745f 6c61 7965 723d 696e 7075  input_layer=inpu
-0000e170: 745f 6c61 7965 722c 0a20 2020 2020 2020  t_layer,.       
-0000e180: 2020 2020 2020 2020 206f 7574 7075 745f           output_
-0000e190: 6c61 7965 723d 6f75 7470 7574 5f6c 6179  layer=output_lay
-0000e1a0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0000e1b0: 2020 2020 6262 6f78 3d74 696c 655f 726f      bbox=tile_ro
-0000e1c0: 772e 6765 6f6d 6574 7279 2e62 6f75 6e64  w.geometry.bound
-0000e1d0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000e1e0: 2020 2074 696c 655f 6964 3d74 696c 655f     tile_id=tile_
-0000e1f0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000e200: 2020 2020 6772 6964 7369 7a65 3d67 7269      gridsize=gri
-0000e210: 6473 697a 652c 0a20 2020 2020 2020 2020  dsize,.         
-0000e220: 2020 2020 2020 206b 6565 705f 656d 7074         keep_empt
-0000e230: 795f 6765 6f6d 733d 6b65 6570 5f65 6d70  y_geoms=keep_emp
-0000e240: 7479 5f67 656f 6d73 2c0a 2020 2020 2020  ty_geoms,.      
-0000e250: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e260: 2020 2020 6675 7475 7265 5f74 6f5f 6261      future_to_ba
-0000e270: 7463 685f 6964 5b66 7574 7572 655d 203d  tch_id[future] =
-0000e280: 2062 6174 6368 5f69 640a 0a20 2020 2020   batch_id..     
-0000e290: 2020 2023 204c 6f6f 7020 7469 6c6c 2061     # Loop till a
-0000e2a0: 6c6c 2070 6172 616c 6c65 6c20 7072 6f63  ll parallel proc
-0000e2b0: 6573 7365 7320 6172 6520 7265 6164 792c  esses are ready,
-0000e2c0: 2062 7574 2070 726f 6365 7373 2065 6163   but process eac
-0000e2d0: 6820 6f6e 650a 2020 2020 2020 2020 2320  h one.        # 
-0000e2e0: 7468 6174 2069 7320 7265 6164 7920 616c  that is ready al
-0000e2f0: 7265 6164 790a 2020 2020 2020 2020 5f67  ready.        _g
-0000e300: 656e 6572 616c 5f75 7469 6c2e 7265 706f  eneral_util.repo
-0000e310: 7274 5f70 726f 6772 6573 7328 0a20 2020  rt_progress(.   
-0000e320: 2020 2020 2020 2020 2073 7461 7274 5f74           start_t
-0000e330: 696d 652c 206e 625f 6261 7463 6865 735f  ime, nb_batches_
-0000e340: 646f 6e65 2c20 6e62 5f62 6174 6368 6573  done, nb_batches
-0000e350: 2c20 2264 6973 736f 6c76 6522 0a20 2020  , "dissolve".   
-0000e360: 2020 2020 2029 0a20 2020 2020 2020 2066       ).        f
-0000e370: 6f72 2066 7574 7572 6520 696e 2066 7574  or future in fut
-0000e380: 7572 6573 2e61 735f 636f 6d70 6c65 7465  ures.as_complete
-0000e390: 6428 6675 7475 7265 5f74 6f5f 6261 7463  d(future_to_batc
-0000e3a0: 685f 6964 293a 0a20 2020 2020 2020 2020  h_id):.         
-0000e3b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000e3c0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-0000e3d0: 2063 616c 6375 6c61 7465 2067 6176 6520   calculate gave 
-0000e3e0: 7265 7375 6c74 730a 2020 2020 2020 2020  results.        
-0000e3f0: 2020 2020 2020 2020 6e62 5f62 6174 6368          nb_batch
-0000e400: 6573 5f64 6f6e 6520 2b3d 2031 0a20 2020  es_done += 1.   
-0000e410: 2020 2020 2020 2020 2020 2020 2062 6174               bat
-0000e420: 6368 5f69 6420 3d20 6675 7475 7265 5f74  ch_id = future_t
-0000e430: 6f5f 6261 7463 685f 6964 5b66 7574 7572  o_batch_id[futur
-0000e440: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-0000e450: 2020 2072 6573 756c 7420 3d20 6675 7475     result = futu
-0000e460: 7265 2e72 6573 756c 7428 290a 0a20 2020  re.result()..   
-0000e470: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000e480: 7265 7375 6c74 2069 7320 6e6f 7420 4e6f  result is not No
-0000e490: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000e4a0: 2020 2020 2020 2020 6e62 5f72 6f77 735f          nb_rows_
-0000e4b0: 646f 6e65 202b 3d20 7265 7375 6c74 5b22  done += result["
-0000e4c0: 6e62 5f72 6f77 735f 646f 6e65 225d 0a20  nb_rows_done"]. 
-0000e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4e0: 2020 2069 6620 7265 7375 6c74 5b22 6e62     if result["nb
-0000e4f0: 5f72 6f77 735f 646f 6e65 225d 203e 2030  _rows_done"] > 0
-0000e500: 2061 6e64 2072 6573 756c 745b 2274 6f74   and result["tot
-0000e510: 616c 5f74 696d 6522 5d20 3e20 303a 0a20  al_time"] > 0:. 
-0000e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e530: 2020 2020 2020 2072 6f77 735f 7065 725f         rows_per_
-0000e540: 7365 6320 3d20 726f 756e 6428 0a20 2020  sec = round(.   
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e560: 2020 2020 2020 2020 2072 6573 756c 745b           result[
-0000e570: 226e 625f 726f 7773 5f64 6f6e 6522 5d20  "nb_rows_done"] 
-0000e580: 2f20 7265 7375 6c74 5b22 746f 7461 6c5f  / result["total_
-0000e590: 7469 6d65 225d 0a20 2020 2020 2020 2020  time"].         
-0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000e5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e5c0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000e5d0: 6465 6275 6728 0a20 2020 2020 2020 2020  debug(.         
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2066 2242 6174 6368 207b 6261 7463     f"Batch {batc
-0000e600: 685f 6964 7d20 7072 6f63 6573 7365 6420  h_id} processed 
-0000e610: 7b72 6573 756c 745b 276e 625f 726f 7773  {result['nb_rows
-0000e620: 5f64 6f6e 6527 5d7d 2072 6f77 7320 220a  _done']} rows ".
-0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e640: 2020 2020 2020 2020 2020 2020 6622 287b              f"({
-0000e650: 726f 7773 5f70 6572 5f73 6563 7d2f 7365  rows_per_sec}/se
-0000e660: 6329 220a 2020 2020 2020 2020 2020 2020  c)".            
-0000e670: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e690: 2020 2020 2020 6966 2022 7065 7266 7374        if "perfst
-0000e6a0: 7269 6e67 2220 696e 2072 6573 756c 743a  ring" in result:
-0000e6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e6c0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0000e6d0: 6765 722e 6465 6275 6728 6622 5065 7266  ger.debug(f"Perf
-0000e6e0: 7374 7269 6e67 3a20 7b72 6573 756c 745b  string: {result[
-0000e6f0: 2770 6572 6673 7472 696e 6727 5d7d 2229  'perfstring']}")
-0000e700: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e710: 2020 2020 2020 2320 5374 6172 7420 636f        # Start co
-0000e720: 7079 206f 6620 7468 6520 7265 7375 6c74  py of the result
-0000e730: 2074 6f20 6120 636f 6d6d 6f6e 2066 696c   to a common fil
-0000e740: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000e750: 2020 2020 2020 6261 7463 685f 6964 203d        batch_id =
-0000e760: 2066 7574 7572 655f 746f 5f62 6174 6368   future_to_batch
-0000e770: 5f69 645b 6675 7475 7265 5d0a 0a20 2020  _id[future]..   
-0000e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e790: 2023 2049 6620 6361 6c63 756c 6174 6520   # If calculate 
-0000e7a0: 6761 7665 206e 6f74 6f6e 626f 7264 6572  gave notonborder
-0000e7b0: 2072 6573 756c 7473 2c20 6170 7065 6e64   results, append
-0000e7c0: 2074 6f20 6f75 7470 7574 0a20 2020 2020   to output.     
-0000e7d0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000e7e0: 7574 7075 745f 6e6f 746f 6e62 6f72 6465  utput_notonborde
-0000e7f0: 725f 746d 705f 7061 7274 6961 6c5f 7061  r_tmp_partial_pa
-0000e800: 7468 203d 2062 6174 6368 6573 5b62 6174  th = batches[bat
-0000e810: 6368 5f69 645d 5b0a 2020 2020 2020 2020  ch_id][.        
-0000e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e830: 226f 7574 7075 745f 6e6f 746f 6e62 6f72  "output_notonbor
-0000e840: 6465 725f 746d 705f 7061 7274 6961 6c5f  der_tmp_partial_
-0000e850: 7061 7468 220a 2020 2020 2020 2020 2020  path".          
-0000e860: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e880: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0000e890: 2020 2020 2020 2020 2020 2020 206f 7574               out
-0000e8a0: 7075 745f 6e6f 746f 6e62 6f72 6465 725f  put_notonborder_
-0000e8b0: 746d 705f 7061 7274 6961 6c5f 7061 7468  tmp_partial_path
-0000e8c0: 2e65 7869 7374 7328 290a 2020 2020 2020  .exists().      
-0000e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8e0: 2020 616e 6420 6f75 7470 7574 5f6e 6f74    and output_not
-0000e8f0: 6f6e 626f 7264 6572 5f74 6d70 5f70 6172  onborder_tmp_par
-0000e900: 7469 616c 5f70 6174 682e 7374 6174 2829  tial_path.stat()
-0000e910: 2e73 745f 7369 7a65 203e 2030 0a20 2020  .st_size > 0.   
-0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e930: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0000e940: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000e950: 6f70 732e 5f61 7070 656e 645f 746f 5f6e  ops._append_to_n
-0000e960: 6f6c 6f63 6b28 0a20 2020 2020 2020 2020  olock(.         
+0000d390: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000d3a0: 2020 2020 2020 206f 7574 7075 745f 746d         output_tm
+0000d3b0: 7032 5f66 696e 616c 5f70 6174 6820 3d20  p2_final_path = 
+0000d3c0: 6f75 7470 7574 5f74 6d70 335f 7768 6572  output_tmp3_wher
+0000d3d0: 655f 7061 7468 0a0a 2020 2020 2020 2020  e_path..        
+0000d3e0: 2020 2020 2020 2020 2320 4e6f 7720 7765          # Now we
+0000d3f0: 2061 7265 2072 6561 6479 2074 6f20 6d6f   are ready to mo
+0000d400: 7665 2074 6865 2072 6573 756c 7420 746f  ve the result to
+0000d410: 2074 6865 2066 696e 616c 2073 706f 742e   the final spot.
+0000d420: 2e2e 0a20 2020 2020 2020 2020 2020 2020  ...             
+0000d430: 2020 2067 666f 2e6d 6f76 6528 6f75 7470     gfo.move(outp
+0000d440: 7574 5f74 6d70 325f 6669 6e61 6c5f 7061  ut_tmp2_final_pa
+0000d450: 7468 2c20 6f75 7470 7574 5f70 6174 6829  th, output_path)
+0000d460: 0a0a 2020 2020 2020 2020 6669 6e61 6c6c  ..        finall
+0000d470: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+0000d480: 6875 7469 6c2e 726d 7472 6565 2874 656d  hutil.rmtree(tem
+0000d490: 7064 6972 2c20 6967 6e6f 7265 5f65 7272  pdir, ignore_err
+0000d4a0: 6f72 733d 5472 7565 290a 2020 2020 656c  ors=True).    el
+0000d4b0: 7365 3a0a 2020 2020 2020 2020 7261 6973  se:.        rais
+0000d4c0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+0000d4d0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000d4e0: 2020 2066 2255 6e73 7570 706f 7274 6564     f"Unsupported
+0000d4f0: 2069 6e70 7574 2067 656f 6d65 7472 7974   input geometryt
+0000d500: 7970 653a 207b 696e 7075 745f 6c61 7965  ype: {input_laye
+0000d510: 7269 6e66 6f2e 6765 6f6d 6574 7279 7479  rinfo.geometryty
+0000d520: 7065 7d22 0a20 2020 2020 2020 2029 0a0a  pe}".        )..
+0000d530: 2020 2020 2320 5265 7475 726e 2072 6573      # Return res
+0000d540: 756c 7420 696e 666f 0a20 2020 2072 6573  ult info.    res
+0000d550: 756c 745f 696e 666f 5b0a 2020 2020 2020  ult_info[.      
+0000d560: 2020 226d 6573 7361 6765 220a 2020 2020    "message".    
+0000d570: 5d20 3d20 6622 4469 7373 6f6c 7665 2063  ] = f"Dissolve c
+0000d580: 6f6d 706c 6574 656c 7920 7265 6164 792c  ompletely ready,
+0000d590: 2074 6f6f 6b20 7b64 6174 6574 696d 652e   took {datetime.
+0000d5a0: 6e6f 7728 292d 7374 6172 745f 7469 6d65  now()-start_time
+0000d5b0: 7d21 220a 2020 2020 6c6f 6767 6572 2e69  }!".    logger.i
+0000d5c0: 6e66 6f28 7265 7375 6c74 5f69 6e66 6f5b  nfo(result_info[
+0000d5d0: 226d 6573 7361 6765 225d 290a 2020 2020  "message"]).    
+0000d5e0: 7265 7475 726e 2072 6573 756c 745f 696e  return result_in
+0000d5f0: 666f 0a0a 0a64 6566 205f 6469 7373 6f6c  fo...def _dissol
+0000d600: 7665 5f70 6f6c 7967 6f6e 735f 7061 7373  ve_polygons_pass
+0000d610: 280a 2020 2020 696e 7075 745f 7061 7468  (.    input_path
+0000d620: 3a20 5061 7468 2c0a 2020 2020 6f75 7470  : Path,.    outp
+0000d630: 7574 5f6e 6f74 6f6e 626f 7264 6572 5f70  ut_notonborder_p
+0000d640: 6174 683a 2050 6174 682c 0a20 2020 206f  ath: Path,.    o
+0000d650: 7574 7075 745f 6f6e 626f 7264 6572 5f70  utput_onborder_p
+0000d660: 6174 683a 2050 6174 682c 0a20 2020 2065  ath: Path,.    e
+0000d670: 7870 6c6f 6465 636f 6c6c 6563 7469 6f6e  xplodecollection
+0000d680: 733a 2062 6f6f 6c2c 0a20 2020 2067 726f  s: bool,.    gro
+0000d690: 7570 6279 5f63 6f6c 756d 6e73 3a20 4f70  upby_columns: Op
+0000d6a0: 7469 6f6e 616c 5b49 7465 7261 626c 655b  tional[Iterable[
+0000d6b0: 7374 725d 5d2c 0a20 2020 2061 6767 5f63  str]],.    agg_c
+0000d6c0: 6f6c 756d 6e73 3a20 4f70 7469 6f6e 616c  olumns: Optional
+0000d6d0: 5b64 6963 745d 2c0a 2020 2020 7469 6c65  [dict],.    tile
+0000d6e0: 735f 6764 663a 2067 7064 2e47 656f 4461  s_gdf: gpd.GeoDa
+0000d6f0: 7461 4672 616d 652c 0a20 2020 2069 6e70  taFrame,.    inp
+0000d700: 7574 5f6c 6179 6572 3a20 4f70 7469 6f6e  ut_layer: Option
+0000d710: 616c 5b73 7472 5d2c 0a20 2020 206f 7574  al[str],.    out
+0000d720: 7075 745f 6c61 7965 723a 204f 7074 696f  put_layer: Optio
+0000d730: 6e61 6c5b 7374 725d 2c0a 2020 2020 6772  nal[str],.    gr
+0000d740: 6964 7369 7a65 3a20 666c 6f61 742c 0a20  idsize: float,. 
+0000d750: 2020 206b 6565 705f 656d 7074 795f 6765     keep_empty_ge
+0000d760: 6f6d 733a 2062 6f6f 6c2c 0a20 2020 206e  oms: bool,.    n
+0000d770: 625f 7061 7261 6c6c 656c 3a20 696e 742c  b_parallel: int,
+0000d780: 0a29 202d 3e20 6469 6374 3a0a 2020 2020  .) -> dict:.    
+0000d790: 2320 4d61 6b65 2073 7572 6520 7468 6520  # Make sure the 
+0000d7a0: 696e 7075 7420 6669 6c65 2068 6173 2061  input file has a
+0000d7b0: 2073 7061 7469 616c 2069 6e64 6578 0a20   spatial index. 
+0000d7c0: 2020 2067 666f 2e63 7265 6174 655f 7370     gfo.create_sp
+0000d7d0: 6174 6961 6c5f 696e 6465 7828 696e 7075  atial_index(inpu
+0000d7e0: 745f 7061 7468 2c20 6578 6973 745f 6f6b  t_path, exist_ok
+0000d7f0: 3d54 7275 6529 0a0a 2020 2020 2320 5374  =True)..    # St
+0000d800: 6172 7420 6361 6c63 756c 6174 696f 6e20  art calculation 
+0000d810: 696e 2070 6172 616c 6c65 6c0a 2020 2020  in parallel.    
+0000d820: 7374 6172 745f 7469 6d65 203d 2064 6174  start_time = dat
+0000d830: 6574 696d 652e 6e6f 7728 290a 2020 2020  etime.now().    
+0000d840: 7265 7375 6c74 5f69 6e66 6f20 3d20 7b7d  result_info = {}
+0000d850: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
+0000d860: 3d20 6461 7465 7469 6d65 2e6e 6f77 2829  = datetime.now()
+0000d870: 0a20 2020 2069 6e70 7574 5f6c 6179 6572  .    input_layer
+0000d880: 696e 666f 203d 2067 666f 2e67 6574 5f6c  info = gfo.get_l
+0000d890: 6179 6572 696e 666f 2869 6e70 7574 5f70  ayerinfo(input_p
+0000d8a0: 6174 682c 2069 6e70 7574 5f6c 6179 6572  ath, input_layer
+0000d8b0: 290a 0a20 2020 2023 2050 726f 6365 7373  )..    # Process
+0000d8c0: 696e 6720 696e 2074 6872 6561 6473 2069  ing in threads i
+0000d8d0: 7320 3278 2066 6173 7465 7220 666f 7220  s 2x faster for 
+0000d8e0: 736d 616c 6c20 6461 7461 7365 7473 2028  small datasets (
+0000d8f0: 6f6e 2057 696e 646f 7773 290a 2020 2020  on Windows).    
+0000d900: 6361 6c63 756c 6174 655f 696e 5f74 6872  calculate_in_thr
+0000d910: 6561 6473 203d 2054 7275 6520 6966 2069  eads = True if i
+0000d920: 6e70 7574 5f6c 6179 6572 696e 666f 2e66  nput_layerinfo.f
+0000d930: 6561 7475 7265 636f 756e 7420 3c3d 2031  eaturecount <= 1
+0000d940: 3030 2065 6c73 6520 4661 6c73 650a 2020  00 else False.  
+0000d950: 2020 7769 7468 205f 7072 6f63 6573 7369    with _processi
+0000d960: 6e67 5f75 7469 6c2e 506f 6f6c 6564 4578  ng_util.PooledEx
+0000d970: 6563 7574 6f72 4661 6374 6f72 7928 0a20  ecutorFactory(. 
+0000d980: 2020 2020 2020 2074 6872 6561 6470 6f6f         threadpoo
+0000d990: 6c3d 6361 6c63 756c 6174 655f 696e 5f74  l=calculate_in_t
+0000d9a0: 6872 6561 6473 2c0a 2020 2020 2020 2020  hreads,.        
+0000d9b0: 6d61 785f 776f 726b 6572 733d 6e62 5f70  max_workers=nb_p
+0000d9c0: 6172 616c 6c65 6c2c 0a20 2020 2020 2020  arallel,.       
+0000d9d0: 2069 6e69 7469 616c 697a 6572 3d5f 7072   initializer=_pr
+0000d9e0: 6f63 6573 7369 6e67 5f75 7469 6c2e 696e  ocessing_util.in
+0000d9f0: 6974 6961 6c69 7a65 5f77 6f72 6b65 7228  itialize_worker(
+0000da00: 292c 0a20 2020 2029 2061 7320 6361 6c63  ),.    ) as calc
+0000da10: 756c 6174 655f 706f 6f6c 3a0a 2020 2020  ulate_pool:.    
+0000da20: 2020 2020 2320 5072 6570 6172 6520 6f75      # Prepare ou
+0000da30: 7470 7574 2066 696c 656e 616d 650a 2020  tput filename.  
+0000da40: 2020 2020 2020 7465 6d70 6469 7220 3d20        tempdir = 
+0000da50: 6f75 7470 7574 5f6f 6e62 6f72 6465 725f  output_onborder_
+0000da60: 7061 7468 2e70 6172 656e 740a 0a20 2020  path.parent..   
+0000da70: 2020 2020 2062 6174 6368 6573 203d 207b       batches = {
+0000da80: 7d0a 2020 2020 2020 2020 6e62 5f62 6174  }.        nb_bat
+0000da90: 6368 6573 203d 206c 656e 2874 696c 6573  ches = len(tiles
+0000daa0: 5f67 6466 290a 2020 2020 2020 2020 6e62  _gdf).        nb
+0000dab0: 5f62 6174 6368 6573 5f64 6f6e 6520 3d20  _batches_done = 
+0000dac0: 300a 2020 2020 2020 2020 6675 7475 7265  0.        future
+0000dad0: 5f74 6f5f 6261 7463 685f 6964 203d 207b  _to_batch_id = {
+0000dae0: 7d0a 2020 2020 2020 2020 6e62 5f72 6f77  }.        nb_row
+0000daf0: 735f 646f 6e65 203d 2030 0a20 2020 2020  s_done = 0.     
+0000db00: 2020 2066 6f72 2062 6174 6368 5f69 642c     for batch_id,
+0000db10: 2074 696c 655f 726f 7720 696e 2065 6e75   tile_row in enu
+0000db20: 6d65 7261 7465 2874 696c 6573 5f67 6466  merate(tiles_gdf
+0000db30: 2e69 7465 7274 7570 6c65 7328 2929 3a0a  .itertuples()):.
+0000db40: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+0000db50: 6865 735b 6261 7463 685f 6964 5d20 3d20  hes[batch_id] = 
+0000db60: 7b7d 0a20 2020 2020 2020 2020 2020 2062  {}.            b
+0000db70: 6174 6368 6573 5b62 6174 6368 5f69 645d  atches[batch_id]
+0000db80: 5b22 6c61 7965 7222 5d20 3d20 6f75 7470  ["layer"] = outp
+0000db90: 7574 5f6c 6179 6572 0a20 2020 2020 2020  ut_layer.       
+0000dba0: 2020 2020 2062 6174 6368 6573 5b62 6174       batches[bat
+0000dbb0: 6368 5f69 645d 5b22 626f 756e 6473 225d  ch_id]["bounds"]
+0000dbc0: 203d 2074 696c 655f 726f 772e 6765 6f6d   = tile_row.geom
+0000dbd0: 6574 7279 2e62 6f75 6e64 730a 0a20 2020  etry.bounds..   
+0000dbe0: 2020 2020 2020 2020 2023 204f 7574 7075           # Outpu
+0000dbf0: 7420 6561 6368 2062 6174 6368 2074 6f20  t each batch to 
+0000dc00: 6120 7365 7065 7261 7465 2074 656d 706f  a seperate tempo
+0000dc10: 7261 7279 2066 696c 652c 206f 7468 6572  rary file, other
+0000dc20: 7769 7365 2074 6865 7265 0a20 2020 2020  wise there.     
+0000dc30: 2020 2020 2020 2023 2061 7265 2074 696d         # are tim
+0000dc40: 656f 7574 2069 7373 7565 7320 7768 656e  eout issues when
+0000dc50: 2070 726f 6365 7373 696e 6720 6c61 7267   processing larg
+0000dc60: 6520 6669 6c65 730a 2020 2020 2020 2020  e files.        
+0000dc70: 2020 2020 7375 6666 6978 203d 206f 7574      suffix = out
+0000dc80: 7075 745f 6e6f 746f 6e62 6f72 6465 725f  put_notonborder_
+0000dc90: 7061 7468 2e73 7566 6669 780a 2020 2020  path.suffix.    
+0000dca0: 2020 2020 2020 2020 6e61 6d65 203d 2066          name = f
+0000dcb0: 227b 6f75 7470 7574 5f6e 6f74 6f6e 626f  "{output_notonbo
+0000dcc0: 7264 6572 5f70 6174 682e 7374 656d 7d5f  rder_path.stem}_
+0000dcd0: 7b62 6174 6368 5f69 647d 7b73 7566 6669  {batch_id}{suffi
+0000dce0: 787d 220a 2020 2020 2020 2020 2020 2020  x}".            
+0000dcf0: 6f75 7470 7574 5f6e 6f74 6f6e 626f 7264  output_notonbord
+0000dd00: 6572 5f74 6d70 5f70 6172 7469 616c 5f70  er_tmp_partial_p
+0000dd10: 6174 6820 3d20 7465 6d70 6469 7220 2f20  ath = tempdir / 
+0000dd20: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+0000dd30: 2062 6174 6368 6573 5b62 6174 6368 5f69   batches[batch_i
+0000dd40: 645d 5b0a 2020 2020 2020 2020 2020 2020  d][.            
+0000dd50: 2020 2020 226f 7574 7075 745f 6e6f 746f      "output_noto
+0000dd60: 6e62 6f72 6465 725f 746d 705f 7061 7274  nborder_tmp_part
+0000dd70: 6961 6c5f 7061 7468 220a 2020 2020 2020  ial_path".      
+0000dd80: 2020 2020 2020 5d20 3d20 6f75 7470 7574        ] = output
+0000dd90: 5f6e 6f74 6f6e 626f 7264 6572 5f74 6d70  _notonborder_tmp
+0000dda0: 5f70 6172 7469 616c 5f70 6174 680a 2020  _partial_path.  
+0000ddb0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+0000ddc0: 2066 227b 6f75 7470 7574 5f6f 6e62 6f72   f"{output_onbor
+0000ddd0: 6465 725f 7061 7468 2e73 7465 6d7d 5f7b  der_path.stem}_{
+0000dde0: 6261 7463 685f 6964 7d7b 7375 6666 6978  batch_id}{suffix
+0000ddf0: 7d22 0a20 2020 2020 2020 2020 2020 206f  }".            o
+0000de00: 7574 7075 745f 6f6e 626f 7264 6572 5f74  utput_onborder_t
+0000de10: 6d70 5f70 6172 7469 616c 5f70 6174 6820  mp_partial_path 
+0000de20: 3d20 7465 6d70 6469 7220 2f20 6e61 6d65  = tempdir / name
+0000de30: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+0000de40: 6368 6573 5b62 6174 6368 5f69 645d 5b0a  ches[batch_id][.
+0000de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de60: 226f 7574 7075 745f 6f6e 626f 7264 6572  "output_onborder
+0000de70: 5f74 6d70 5f70 6172 7469 616c 5f70 6174  _tmp_partial_pat
+0000de80: 6822 0a20 2020 2020 2020 2020 2020 205d  h".            ]
+0000de90: 203d 206f 7574 7075 745f 6f6e 626f 7264   = output_onbord
+0000dea0: 6572 5f74 6d70 5f70 6172 7469 616c 5f70  er_tmp_partial_p
+0000deb0: 6174 680a 0a20 2020 2020 2020 2020 2020  ath..           
+0000dec0: 2023 2047 6574 2074 696c 655f 6964 2069   # Get tile_id i
+0000ded0: 6620 7072 6573 656e 740a 2020 2020 2020  f present.      
+0000dee0: 2020 2020 2020 7469 6c65 5f69 6420 3d20        tile_id = 
+0000def0: 7469 6c65 5f72 6f77 2e74 696c 655f 6964  tile_row.tile_id
+0000df00: 2069 6620 2274 696c 655f 6964 2220 696e   if "tile_id" in
+0000df10: 2074 696c 655f 726f 772e 5f66 6965 6c64   tile_row._field
+0000df20: 7320 656c 7365 204e 6f6e 650a 0a20 2020  s else None..   
+0000df30: 2020 2020 2020 2020 2066 7574 7572 6520           future 
+0000df40: 3d20 6361 6c63 756c 6174 655f 706f 6f6c  = calculate_pool
+0000df50: 2e73 7562 6d69 7428 0a20 2020 2020 2020  .submit(.       
+0000df60: 2020 2020 2020 2020 205f 6469 7373 6f6c           _dissol
+0000df70: 7665 5f70 6f6c 7967 6f6e 732c 0a20 2020  ve_polygons,.   
+0000df80: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
+0000df90: 7574 5f70 6174 683d 696e 7075 745f 7061  ut_path=input_pa
+0000dfa0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000dfb0: 2020 2020 6f75 7470 7574 5f6e 6f74 6f6e      output_noton
+0000dfc0: 626f 7264 6572 5f70 6174 683d 6f75 7470  border_path=outp
+0000dfd0: 7574 5f6e 6f74 6f6e 626f 7264 6572 5f74  ut_notonborder_t
+0000dfe0: 6d70 5f70 6172 7469 616c 5f70 6174 682c  mp_partial_path,
+0000dff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e000: 206f 7574 7075 745f 6f6e 626f 7264 6572   output_onborder
+0000e010: 5f70 6174 683d 6f75 7470 7574 5f6f 6e62  _path=output_onb
+0000e020: 6f72 6465 725f 746d 705f 7061 7274 6961  order_tmp_partia
+0000e030: 6c5f 7061 7468 2c0a 2020 2020 2020 2020  l_path,.        
+0000e040: 2020 2020 2020 2020 6578 706c 6f64 6563          explodec
+0000e050: 6f6c 6c65 6374 696f 6e73 3d65 7870 6c6f  ollections=explo
+0000e060: 6465 636f 6c6c 6563 7469 6f6e 732c 0a20  decollections,. 
+0000e070: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000e080: 726f 7570 6279 5f63 6f6c 756d 6e73 3d67  roupby_columns=g
+0000e090: 726f 7570 6279 5f63 6f6c 756d 6e73 2c0a  roupby_columns,.
+0000e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0b0: 6167 675f 636f 6c75 6d6e 733d 6167 675f  agg_columns=agg_
+0000e0c0: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
+0000e0d0: 2020 2020 2020 2020 2069 6e70 7574 5f67           input_g
+0000e0e0: 656f 6d65 7472 7974 7970 653d 696e 7075  eometrytype=inpu
+0000e0f0: 745f 6c61 7965 7269 6e66 6f2e 6765 6f6d  t_layerinfo.geom
+0000e100: 6574 7279 7479 7065 2c0a 2020 2020 2020  etrytype,.      
+0000e110: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+0000e120: 6c61 7965 723d 696e 7075 745f 6c61 7965  layer=input_laye
+0000e130: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000e140: 2020 206f 7574 7075 745f 6c61 7965 723d     output_layer=
+0000e150: 6f75 7470 7574 5f6c 6179 6572 2c0a 2020  output_layer,.  
+0000e160: 2020 2020 2020 2020 2020 2020 2020 6262                bb
+0000e170: 6f78 3d74 696c 655f 726f 772e 6765 6f6d  ox=tile_row.geom
+0000e180: 6574 7279 2e62 6f75 6e64 732c 0a20 2020  etry.bounds,.   
+0000e190: 2020 2020 2020 2020 2020 2020 2074 696c               til
+0000e1a0: 655f 6964 3d74 696c 655f 6964 2c0a 2020  e_id=tile_id,.  
+0000e1b0: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+0000e1c0: 6964 7369 7a65 3d67 7269 6473 697a 652c  idsize=gridsize,
+0000e1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e1e0: 206b 6565 705f 656d 7074 795f 6765 6f6d   keep_empty_geom
+0000e1f0: 733d 6b65 6570 5f65 6d70 7479 5f67 656f  s=keep_empty_geo
+0000e200: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+0000e210: 290a 2020 2020 2020 2020 2020 2020 6675  ).            fu
+0000e220: 7475 7265 5f74 6f5f 6261 7463 685f 6964  ture_to_batch_id
+0000e230: 5b66 7574 7572 655d 203d 2062 6174 6368  [future] = batch
+0000e240: 5f69 640a 0a20 2020 2020 2020 2023 204c  _id..        # L
+0000e250: 6f6f 7020 7469 6c6c 2061 6c6c 2070 6172  oop till all par
+0000e260: 616c 6c65 6c20 7072 6f63 6573 7365 7320  allel processes 
+0000e270: 6172 6520 7265 6164 792c 2062 7574 2070  are ready, but p
+0000e280: 726f 6365 7373 2065 6163 6820 6f6e 650a  rocess each one.
+0000e290: 2020 2020 2020 2020 2320 7468 6174 2069          # that i
+0000e2a0: 7320 7265 6164 7920 616c 7265 6164 790a  s ready already.
+0000e2b0: 2020 2020 2020 2020 5f67 656e 6572 616c          _general
+0000e2c0: 5f75 7469 6c2e 7265 706f 7274 5f70 726f  _util.report_pro
+0000e2d0: 6772 6573 7328 0a20 2020 2020 2020 2020  gress(.         
+0000e2e0: 2020 2073 7461 7274 5f74 696d 652c 206e     start_time, n
+0000e2f0: 625f 6261 7463 6865 735f 646f 6e65 2c20  b_batches_done, 
+0000e300: 6e62 5f62 6174 6368 6573 2c20 2264 6973  nb_batches, "dis
+0000e310: 736f 6c76 6522 0a20 2020 2020 2020 2029  solve".        )
+0000e320: 0a20 2020 2020 2020 2066 6f72 2066 7574  .        for fut
+0000e330: 7572 6520 696e 2066 7574 7572 6573 2e61  ure in futures.a
+0000e340: 735f 636f 6d70 6c65 7465 6428 6675 7475  s_completed(futu
+0000e350: 7265 5f74 6f5f 6261 7463 685f 6964 293a  re_to_batch_id):
+0000e360: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000e370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e380: 2020 2320 4966 2074 6865 2063 616c 6375    # If the calcu
+0000e390: 6c61 7465 2067 6176 6520 7265 7375 6c74  late gave result
+0000e3a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000e3b0: 2020 6e62 5f62 6174 6368 6573 5f64 6f6e    nb_batches_don
+0000e3c0: 6520 2b3d 2031 0a20 2020 2020 2020 2020  e += 1.         
+0000e3d0: 2020 2020 2020 2062 6174 6368 5f69 6420         batch_id 
+0000e3e0: 3d20 6675 7475 7265 5f74 6f5f 6261 7463  = future_to_batc
+0000e3f0: 685f 6964 5b66 7574 7572 655d 0a20 2020  h_id[future].   
+0000e400: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000e410: 756c 7420 3d20 6675 7475 7265 2e72 6573  ult = future.res
+0000e420: 756c 7428 290a 0a20 2020 2020 2020 2020  ult()..         
+0000e430: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
+0000e440: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e460: 2020 6e62 5f72 6f77 735f 646f 6e65 202b    nb_rows_done +
+0000e470: 3d20 7265 7375 6c74 5b22 6e62 5f72 6f77  = result["nb_row
+0000e480: 735f 646f 6e65 225d 0a20 2020 2020 2020  s_done"].       
+0000e490: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e4a0: 7265 7375 6c74 5b22 6e62 5f72 6f77 735f  result["nb_rows_
+0000e4b0: 646f 6e65 225d 203e 2030 2061 6e64 2072  done"] > 0 and r
+0000e4c0: 6573 756c 745b 2274 6f74 616c 5f74 696d  esult["total_tim
+0000e4d0: 6522 5d20 3e20 303a 0a20 2020 2020 2020  e"] > 0:.       
+0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4f0: 2072 6f77 735f 7065 725f 7365 6320 3d20   rows_per_sec = 
+0000e500: 726f 756e 6428 0a20 2020 2020 2020 2020  round(.         
+0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e520: 2020 2072 6573 756c 745b 226e 625f 726f     result["nb_ro
+0000e530: 7773 5f64 6f6e 6522 5d20 2f20 7265 7375  ws_done"] / resu
+0000e540: 6c74 5b22 746f 7461 6c5f 7469 6d65 225d  lt["total_time"]
+0000e550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e560: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e580: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+0000e590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e5a0: 2020 2020 2020 2020 2020 2020 2066 2242               f"B
+0000e5b0: 6174 6368 207b 6261 7463 685f 6964 7d20  atch {batch_id} 
+0000e5c0: 7072 6f63 6573 7365 6420 7b72 6573 756c  processed {resul
+0000e5d0: 745b 276e 625f 726f 7773 5f64 6f6e 6527  t['nb_rows_done'
+0000e5e0: 5d7d 2072 6f77 7320 220a 2020 2020 2020  ]} rows ".      
+0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e600: 2020 2020 2020 6622 287b 726f 7773 5f70        f"({rows_p
+0000e610: 6572 5f73 6563 7d2f 7365 6329 220a 2020  er_sec}/sec)".  
+0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e630: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 6966 2022 7065 7266 7374 7269 6e67 2220  if "perfstring" 
+0000e660: 696e 2072 6573 756c 743a 0a20 2020 2020  in result:.     
+0000e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e680: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+0000e690: 6275 6728 6622 5065 7266 7374 7269 6e67  bug(f"Perfstring
+0000e6a0: 3a20 7b72 6573 756c 745b 2770 6572 6673  : {result['perfs
+0000e6b0: 7472 696e 6727 5d7d 2229 0a0a 2020 2020  tring']}")..    
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6d0: 2320 5374 6172 7420 636f 7079 206f 6620  # Start copy of 
+0000e6e0: 7468 6520 7265 7375 6c74 2074 6f20 6120  the result to a 
+0000e6f0: 636f 6d6d 6f6e 2066 696c 650a 2020 2020  common file.    
+0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e710: 6261 7463 685f 6964 203d 2066 7574 7572  batch_id = futur
+0000e720: 655f 746f 5f62 6174 6368 5f69 645b 6675  e_to_batch_id[fu
+0000e730: 7475 7265 5d0a 0a20 2020 2020 2020 2020  ture]..         
+0000e740: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000e750: 6361 6c63 756c 6174 6520 6761 7665 206e  calculate gave n
+0000e760: 6f74 6f6e 626f 7264 6572 2072 6573 756c  otonborder resul
+0000e770: 7473 2c20 6170 7065 6e64 2074 6f20 6f75  ts, append to ou
+0000e780: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
+0000e790: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0000e7a0: 6e6f 746f 6e62 6f72 6465 725f 746d 705f  notonborder_tmp_
+0000e7b0: 7061 7274 6961 6c5f 7061 7468 203d 2062  partial_path = b
+0000e7c0: 6174 6368 6573 5b62 6174 6368 5f69 645d  atches[batch_id]
+0000e7d0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0000e7e0: 2020 2020 2020 2020 2020 226f 7574 7075            "outpu
+0000e7f0: 745f 6e6f 746f 6e62 6f72 6465 725f 746d  t_notonborder_tm
+0000e800: 705f 7061 7274 6961 6c5f 7061 7468 220a  p_partial_path".
+0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e820: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+0000e830: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e850: 2020 2020 2020 206f 7574 7075 745f 6e6f         output_no
+0000e860: 746f 6e62 6f72 6465 725f 746d 705f 7061  tonborder_tmp_pa
+0000e870: 7274 6961 6c5f 7061 7468 2e65 7869 7374  rtial_path.exist
+0000e880: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000e890: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000e8a0: 6f75 7470 7574 5f6e 6f74 6f6e 626f 7264  output_notonbord
+0000e8b0: 6572 5f74 6d70 5f70 6172 7469 616c 5f70  er_tmp_partial_p
+0000e8c0: 6174 682e 7374 6174 2829 2e73 745f 7369  ath.stat().st_si
+0000e8d0: 7a65 203e 2030 0a20 2020 2020 2020 2020  ze > 0.         
+0000e8e0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+0000e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e900: 2020 2020 2020 6669 6c65 6f70 732e 5f61        fileops._a
+0000e910: 7070 656e 645f 746f 5f6e 6f6c 6f63 6b28  ppend_to_nolock(
+0000e920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e930: 2020 2020 2020 2020 2020 2020 2073 7263               src
+0000e940: 3d6f 7574 7075 745f 6e6f 746f 6e62 6f72  =output_notonbor
+0000e950: 6465 725f 746d 705f 7061 7274 6961 6c5f  der_tmp_partial_
+0000e960: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
 0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e980: 2020 2073 7263 3d6f 7574 7075 745f 6e6f     src=output_no
-0000e990: 746f 6e62 6f72 6465 725f 746d 705f 7061  tonborder_tmp_pa
-0000e9a0: 7274 6961 6c5f 7061 7468 2c0a 2020 2020  rtial_path,.    
-0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9c0: 2020 2020 2020 2020 6473 743d 6f75 7470          dst=outp
-0000e9d0: 7574 5f6e 6f74 6f6e 626f 7264 6572 5f70  ut_notonborder_p
-0000e9e0: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea00: 2063 7265 6174 655f 7370 6174 6961 6c5f   create_spatial_
-0000ea10: 696e 6465 783d 4661 6c73 652c 0a20 2020  index=False,.   
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000ea50: 666f 2e72 656d 6f76 6528 6f75 7470 7574  fo.remove(output
-0000ea60: 5f6e 6f74 6f6e 626f 7264 6572 5f74 6d70  _notonborder_tmp
-0000ea70: 5f70 6172 7469 616c 5f70 6174 6829 0a0a  _partial_path)..
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea90: 2020 2020 2320 4966 2063 616c 6375 6c61      # If calcula
-0000eaa0: 7465 2067 6176 6520 6f6e 626f 7264 6572  te gave onborder
-0000eab0: 2072 6573 756c 7473 2c20 6170 7065 6e64   results, append
-0000eac0: 2074 6f20 6f75 7470 7574 0a20 2020 2020   to output.     
-0000ead0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000eae0: 7574 7075 745f 6f6e 626f 7264 6572 5f74  utput_onborder_t
-0000eaf0: 6d70 5f70 6172 7469 616c 5f70 6174 6820  mp_partial_path 
-0000eb00: 3d20 6261 7463 6865 735b 6261 7463 685f  = batches[batch_
-0000eb10: 6964 5d5b 0a20 2020 2020 2020 2020 2020  id][.           
-0000eb20: 2020 2020 2020 2020 2020 2020 2022 6f75               "ou
-0000eb30: 7470 7574 5f6f 6e62 6f72 6465 725f 746d  tput_onborder_tm
-0000eb40: 705f 7061 7274 6961 6c5f 7061 7468 220a  p_partial_path".
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb60: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-0000eb70: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+0000e980: 2020 6473 743d 6f75 7470 7574 5f6e 6f74    dst=output_not
+0000e990: 6f6e 626f 7264 6572 5f70 6174 682c 0a20  onborder_path,. 
+0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9b0: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+0000e9c0: 655f 7370 6174 6961 6c5f 696e 6465 783d  e_spatial_index=
+0000e9d0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0000e9e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ea00: 2020 2020 2020 2020 2067 666f 2e72 656d           gfo.rem
+0000ea10: 6f76 6528 6f75 7470 7574 5f6e 6f74 6f6e  ove(output_noton
+0000ea20: 626f 7264 6572 5f74 6d70 5f70 6172 7469  border_tmp_parti
+0000ea30: 616c 5f70 6174 6829 0a0a 2020 2020 2020  al_path)..      
+0000ea40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ea50: 4966 2063 616c 6375 6c61 7465 2067 6176  If calculate gav
+0000ea60: 6520 6f6e 626f 7264 6572 2072 6573 756c  e onborder resul
+0000ea70: 7473 2c20 6170 7065 6e64 2074 6f20 6f75  ts, append to ou
+0000ea80: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
+0000ea90: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0000eaa0: 6f6e 626f 7264 6572 5f74 6d70 5f70 6172  onborder_tmp_par
+0000eab0: 7469 616c 5f70 6174 6820 3d20 6261 7463  tial_path = batc
+0000eac0: 6865 735b 6261 7463 685f 6964 5d5b 0a20  hes[batch_id][. 
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eae0: 2020 2020 2020 2022 6f75 7470 7574 5f6f         "output_o
+0000eaf0: 6e62 6f72 6465 725f 746d 705f 7061 7274  nborder_tmp_part
+0000eb00: 6961 6c5f 7061 7468 220a 2020 2020 2020  ial_path".      
+0000eb10: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb30: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0000eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb50: 206f 7574 7075 745f 6f6e 626f 7264 6572   output_onborder
+0000eb60: 5f74 6d70 5f70 6172 7469 616c 5f70 6174  _tmp_partial_pat
+0000eb70: 682e 6578 6973 7473 2829 0a20 2020 2020  h.exists().     
 0000eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb90: 2020 2020 2020 206f 7574 7075 745f 6f6e         output_on
+0000eb90: 2020 2061 6e64 206f 7574 7075 745f 6f6e     and output_on
 0000eba0: 626f 7264 6572 5f74 6d70 5f70 6172 7469  border_tmp_parti
-0000ebb0: 616c 5f70 6174 682e 6578 6973 7473 2829  al_path.exists()
-0000ebc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ebd0: 2020 2020 2020 2020 2061 6e64 206f 7574           and out
-0000ebe0: 7075 745f 6f6e 626f 7264 6572 5f74 6d70  put_onborder_tmp
-0000ebf0: 5f70 6172 7469 616c 5f70 6174 682e 7374  _partial_path.st
-0000ec00: 6174 2829 2e73 745f 7369 7a65 203e 2030  at().st_size > 0
-0000ec10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ec20: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 6669 6c65 6f70 732e 5f61 7070 656e 645f  fileops._append_
-0000ec50: 746f 5f6e 6f6c 6f63 6b28 0a20 2020 2020  to_nolock(.     
+0000ebb0: 616c 5f70 6174 682e 7374 6174 2829 2e73  al_path.stat().s
+0000ebc0: 745f 7369 7a65 203e 2030 0a20 2020 2020  t_size > 0.     
+0000ebd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ebe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ebf0: 2020 2020 2020 2020 2020 6669 6c65 6f70            fileop
+0000ec00: 732e 5f61 7070 656e 645f 746f 5f6e 6f6c  s._append_to_nol
+0000ec10: 6f63 6b28 0a20 2020 2020 2020 2020 2020  ock(.           
+0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec30: 2073 7263 3d6f 7574 7075 745f 6f6e 626f   src=output_onbo
+0000ec40: 7264 6572 5f74 6d70 5f70 6172 7469 616c  rder_tmp_partial
+0000ec50: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
 0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec70: 2020 2020 2020 2073 7263 3d6f 7574 7075         src=outpu
-0000ec80: 745f 6f6e 626f 7264 6572 5f74 6d70 5f70  t_onborder_tmp_p
-0000ec90: 6172 7469 616c 5f70 6174 682c 0a20 2020  artial_path,.   
-0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecb0: 2020 2020 2020 2020 2064 7374 3d6f 7574           dst=out
-0000ecc0: 7075 745f 6f6e 626f 7264 6572 5f70 6174  put_onborder_pat
-0000ecd0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-0000ece0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000ecf0: 7265 6174 655f 7370 6174 6961 6c5f 696e  reate_spatial_in
-0000ed00: 6465 783d 4661 6c73 652c 0a20 2020 2020  dex=False,.     
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000ed30: 2020 2020 2020 2020 2020 2020 2067 666f               gfo
-0000ed40: 2e72 656d 6f76 6528 6f75 7470 7574 5f6f  .remove(output_o
-0000ed50: 6e62 6f72 6465 725f 746d 705f 7061 7274  nborder_tmp_part
-0000ed60: 6961 6c5f 7061 7468 290a 0a20 2020 2020  ial_path)..     
-0000ed70: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-0000ed80: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
-0000ed90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000eda0: 6174 6368 5f69 6420 3d20 6675 7475 7265  atch_id = future
-0000edb0: 5f74 6f5f 6261 7463 685f 6964 5b66 7574  _to_batch_id[fut
-0000edc0: 7572 655d 0a20 2020 2020 2020 2020 2020  ure].           
-0000edd0: 2020 2020 206d 6573 7361 6765 203d 2066       message = f
-0000ede0: 2245 7272 6f72 2065 7865 6375 7469 6e67  "Error executing
-0000edf0: 207b 6261 7463 6865 735b 6261 7463 685f   {batches[batch_
-0000ee00: 6964 5d7d 3a20 7b65 787d 220a 2020 2020  id]}: {ex}".    
-0000ee10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000ee20: 6572 2e65 7863 6570 7469 6f6e 286d 6573  er.exception(mes
-0000ee30: 7361 6765 290a 2020 2020 2020 2020 2020  sage).          
-0000ee40: 2020 2020 2020 6361 6c63 756c 6174 655f        calculate_
-0000ee50: 706f 6f6c 2e73 6875 7464 6f77 6e28 290a  pool.shutdown().
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee70: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000ee80: 6d65 7373 6167 6529 2066 726f 6d20 6578  message) from ex
-0000ee90: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000eea0: 4c6f 6720 7468 6520 7072 6f67 7265 7373  Log the progress
-0000eeb0: 2061 6e64 2070 7265 6469 6374 696f 6e20   and prediction 
-0000eec0: 7370 6565 640a 2020 2020 2020 2020 2020  speed.          
-0000eed0: 2020 5f67 656e 6572 616c 5f75 7469 6c2e    _general_util.
-0000eee0: 7265 706f 7274 5f70 726f 6772 6573 7328  report_progress(
-0000eef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef00: 2073 7461 7274 5f74 696d 652c 206e 625f   start_time, nb_
-0000ef10: 6261 7463 6865 735f 646f 6e65 2c20 6e62  batches_done, nb
-0000ef20: 5f62 6174 6368 6573 2c20 2264 6973 736f  _batches, "disso
-0000ef30: 6c76 6522 0a20 2020 2020 2020 2020 2020  lve".           
-0000ef40: 2029 0a0a 2020 2020 6c6f 6767 6572 2e69   )..    logger.i
-0000ef50: 6e66 6f28 6622 4469 7373 6f6c 7665 2070  nfo(f"Dissolve p
-0000ef60: 6173 7320 7265 6164 792c 2074 6f6f 6b20  ass ready, took 
-0000ef70: 7b64 6174 6574 696d 652e 6e6f 7728 292d  {datetime.now()-
-0000ef80: 7374 6172 745f 7469 6d65 7d21 2229 0a0a  start_time}!")..
-0000ef90: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0000efa0: 745f 696e 666f 0a0a 0a64 6566 205f 6469  t_info...def _di
-0000efb0: 7373 6f6c 7665 5f70 6f6c 7967 6f6e 7328  ssolve_polygons(
-0000efc0: 0a20 2020 2069 6e70 7574 5f70 6174 683a  .    input_path:
-0000efd0: 2050 6174 682c 0a20 2020 206f 7574 7075   Path,.    outpu
-0000efe0: 745f 6e6f 746f 6e62 6f72 6465 725f 7061  t_notonborder_pa
-0000eff0: 7468 3a20 5061 7468 2c0a 2020 2020 6f75  th: Path,.    ou
-0000f000: 7470 7574 5f6f 6e62 6f72 6465 725f 7061  tput_onborder_pa
-0000f010: 7468 3a20 5061 7468 2c0a 2020 2020 6578  th: Path,.    ex
-0000f020: 706c 6f64 6563 6f6c 6c65 6374 696f 6e73  plodecollections
-0000f030: 3a20 626f 6f6c 2c0a 2020 2020 6772 6f75  : bool,.    grou
-0000f040: 7062 795f 636f 6c75 6d6e 733a 204f 7074  pby_columns: Opt
-0000f050: 696f 6e61 6c5b 4974 6572 6162 6c65 5b73  ional[Iterable[s
-0000f060: 7472 5d5d 2c0a 2020 2020 6167 675f 636f  tr]],.    agg_co
-0000f070: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
-0000f080: 6469 6374 5d2c 0a20 2020 2069 6e70 7574  dict],.    input
-0000f090: 5f67 656f 6d65 7472 7974 7970 653a 2047  _geometrytype: G
-0000f0a0: 656f 6d65 7472 7954 7970 652c 0a20 2020  eometryType,.   
-0000f0b0: 2069 6e70 7574 5f6c 6179 6572 3a20 4f70   input_layer: Op
-0000f0c0: 7469 6f6e 616c 5b73 7472 5d2c 0a20 2020  tional[str],.   
-0000f0d0: 206f 7574 7075 745f 6c61 7965 723a 204f   output_layer: O
-0000f0e0: 7074 696f 6e61 6c5b 7374 725d 2c0a 2020  ptional[str],.  
-0000f0f0: 2020 6262 6f78 3a20 5475 706c 655b 666c    bbox: Tuple[fl
-0000f100: 6f61 742c 2066 6c6f 6174 2c20 666c 6f61  oat, float, floa
-0000f110: 742c 2066 6c6f 6174 5d2c 0a20 2020 2074  t, float],.    t
-0000f120: 696c 655f 6964 3a20 4f70 7469 6f6e 616c  ile_id: Optional
-0000f130: 5b69 6e74 5d2c 0a20 2020 2067 7269 6473  [int],.    grids
-0000f140: 697a 653a 2066 6c6f 6174 2c0a 2020 2020  ize: float,.    
-0000f150: 6b65 6570 5f65 6d70 7479 5f67 656f 6d73  keep_empty_geoms
-0000f160: 3a20 626f 6f6c 2c0a 2920 2d3e 2064 6963  : bool,.) -> dic
-0000f170: 743a 0a20 2020 2023 2049 6e69 740a 2020  t:.    # Init.  
-0000f180: 2020 7065 7266 696e 666f 203d 207b 7d0a    perfinfo = {}.
-0000f190: 2020 2020 7374 6172 745f 7469 6d65 203d      start_time =
-0000f1a0: 2064 6174 6574 696d 652e 6e6f 7728 290a   datetime.now().
-0000f1b0: 2020 2020 7265 7475 726e 5f69 6e66 6f20      return_info 
-0000f1c0: 3d20 7b0a 2020 2020 2020 2020 2269 6e70  = {.        "inp
-0000f1d0: 7574 5f70 6174 6822 3a20 696e 7075 745f  ut_path": input_
-0000f1e0: 7061 7468 2c0a 2020 2020 2020 2020 226f  path,.        "o
-0000f1f0: 7574 7075 745f 6e6f 746f 6e62 6f72 6465  utput_notonborde
-0000f200: 725f 7061 7468 223a 206f 7574 7075 745f  r_path": output_
-0000f210: 6e6f 746f 6e62 6f72 6465 725f 7061 7468  notonborder_path
-0000f220: 2c0a 2020 2020 2020 2020 226f 7574 7075  ,.        "outpu
-0000f230: 745f 6f6e 626f 7264 6572 5f70 6174 6822  t_onborder_path"
-0000f240: 3a20 6f75 7470 7574 5f6f 6e62 6f72 6465  : output_onborde
-0000f250: 725f 7061 7468 2c0a 2020 2020 2020 2020  r_path,.        
-0000f260: 2262 626f 7822 3a20 6262 6f78 2c0a 2020  "bbox": bbox,.  
-0000f270: 2020 2020 2020 2274 696c 655f 6964 223a        "tile_id":
-0000f280: 2074 696c 655f 6964 2c0a 2020 2020 2020   tile_id,.      
-0000f290: 2020 2267 7269 6473 697a 6522 3a20 6772    "gridsize": gr
-0000f2a0: 6964 7369 7a65 2c0a 2020 2020 2020 2020  idsize,.        
-0000f2b0: 226e 625f 726f 7773 5f64 6f6e 6522 3a20  "nb_rows_done": 
-0000f2c0: 302c 0a20 2020 2020 2020 2022 746f 7461  0,.        "tota
-0000f2d0: 6c5f 7469 6d65 223a 2030 2c0a 2020 2020  l_time": 0,.    
-0000f2e0: 2020 2020 2270 6572 6669 6e66 6f22 3a20      "perfinfo": 
-0000f2f0: 2222 2c0a 2020 2020 7d0a 0a20 2020 2023  "",.    }..    #
-0000f300: 2052 6561 6420 616c 6c20 7265 636f 7264   Read all record
-0000f310: 7320 7468 6174 2061 7265 2069 6e20 7468  s that are in th
-0000f320: 6520 6262 6f78 0a20 2020 2072 6574 7279  e bbox.    retry
-0000f330: 5f63 6f75 6e74 203d 2030 0a20 2020 2073  _count = 0.    s
-0000f340: 7461 7274 5f72 6561 6420 3d20 6461 7465  tart_read = date
-0000f350: 7469 6d65 2e6e 6f77 2829 0a20 2020 2061  time.now().    a
-0000f360: 6767 5f63 6f6c 756d 6e73 5f6e 6565 6465  gg_columns_neede
-0000f370: 6420 3d20 4e6f 6e65 0a20 2020 2077 6869  d = None.    whi
-0000f380: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-0000f390: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000f3a0: 2020 636f 6c75 6d6e 735f 746f 5f72 6561    columns_to_rea
-0000f3b0: 6420 3d20 7365 7428 290a 2020 2020 2020  d = set().      
-0000f3c0: 2020 2020 2020 696e 666f 203d 2067 666f        info = gfo
-0000f3d0: 2e67 6574 5f6c 6179 6572 696e 666f 2869  .get_layerinfo(i
-0000f3e0: 6e70 7574 5f70 6174 682c 2069 6e70 7574  nput_path, input
-0000f3f0: 5f6c 6179 6572 290a 2020 2020 2020 2020  _layer).        
-0000f400: 2020 2020 6966 2067 726f 7570 6279 5f63      if groupby_c
-0000f410: 6f6c 756d 6e73 2069 7320 6e6f 7420 4e6f  olumns is not No
-0000f420: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f430: 2020 2020 636f 6c75 6d6e 735f 746f 5f72      columns_to_r
-0000f440: 6561 642e 7570 6461 7465 2867 726f 7570  ead.update(group
-0000f450: 6279 5f63 6f6c 756d 6e73 290a 2020 2020  by_columns).    
-0000f460: 2020 2020 2020 2020 6669 645f 6173 5f69          fid_as_i
-0000f470: 6e64 6578 203d 2046 616c 7365 0a20 2020  ndex = False.   
-0000f480: 2020 2020 2020 2020 2069 6620 6167 675f           if agg_
-0000f490: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
-0000f4a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f4b0: 2020 2020 2066 6964 5f61 735f 696e 6465       fid_as_inde
-0000f4c0: 7820 3d20 5472 7565 0a20 2020 2020 2020  x = True.       
-0000f4d0: 2020 2020 2020 2020 2069 6620 225f 5f44           if "__D
-0000f4e0: 4953 534f 4c56 455f 544f 4a53 4f4e 2220  ISSOLVE_TOJSON" 
-0000f4f0: 696e 2069 6e66 6f2e 636f 6c75 6d6e 733a  in info.columns:
-0000f500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f510: 2020 2020 2023 2049 6620 7765 2061 7265       # If we are
-0000f520: 206e 6f74 2069 6e20 7468 6520 6669 7273   not in the firs
-0000f530: 7420 7061 7373 2c20 7468 6520 636f 6c75  t pass, the colu
-0000f540: 6d6e 7320 746f 2062 6520 7265 6164 0a20  mns to be read. 
-0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f560: 2020 2023 2061 7265 2061 6c72 6561 6479     # are already
-0000f570: 2069 6e20 7468 6520 6a73 6f6e 2063 6f6c   in the json col
-0000f580: 756d 6e0a 2020 2020 2020 2020 2020 2020  umn.            
-0000f590: 2020 2020 2020 2020 636f 6c75 6d6e 735f          columns_
-0000f5a0: 746f 5f72 6561 642e 6164 6428 225f 5f44  to_read.add("__D
-0000f5b0: 4953 534f 4c56 455f 544f 4a53 4f4e 2229  ISSOLVE_TOJSON")
-0000f5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f5d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000f5e0: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-0000f5f0: 2066 6972 7374 2070 6173 732c 2073 6f20   first pass, so 
-0000f600: 7265 6164 2061 6c6c 2072 656c 6576 616e  read all relevan
-0000f610: 7420 636f 6c75 6d6e 7320 746f 2063 6f64  t columns to cod
-0000f620: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f630: 2020 2020 2020 2320 7468 656d 2069 6e20        # them in 
-0000f640: 6a73 6f6e 0a20 2020 2020 2020 2020 2020  json.           
-0000f650: 2020 2020 2020 2020 2069 6620 226a 736f           if "jso
-0000f660: 6e22 2069 6e20 6167 675f 636f 6c75 6d6e  n" in agg_column
-0000f670: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000f680: 2020 2020 2020 2020 2020 2061 6767 5f63             agg_c
-0000f690: 6f6c 756d 6e73 5f6e 6565 6465 6420 3d20  olumns_needed = 
-0000f6a0: 6167 675f 636f 6c75 6d6e 735b 226a 736f  agg_columns["jso
-0000f6b0: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
-0000f6c0: 2020 2020 2020 2020 656c 6966 2022 636f          elif "co
-0000f6d0: 6c75 6d6e 7322 2069 6e20 6167 675f 636f  lumns" in agg_co
-0000f6e0: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
-0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000f700: 6767 5f63 6f6c 756d 6e73 5f6e 6565 6465  gg_columns_neede
-0000f710: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
-0000f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f730: 2020 6167 675f 636f 6c75 6d6e 5b22 636f    agg_column["co
-0000f740: 6c75 6d6e 225d 0a20 2020 2020 2020 2020  lumn"].         
-0000f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f760: 2020 2066 6f72 2061 6767 5f63 6f6c 756d     for agg_colum
-0000f770: 6e20 696e 2061 6767 5f63 6f6c 756d 6e73  n in agg_columns
-0000f780: 5b22 636f 6c75 6d6e 7322 5d0a 2020 2020  ["columns"].    
-0000f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7a0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-0000f7b0: 2020 2020 2020 2020 2020 6966 2061 6767            if agg
-0000f7c0: 5f63 6f6c 756d 6e73 5f6e 6565 6465 6420  _columns_needed 
-0000f7d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7f0: 2020 2020 2063 6f6c 756d 6e73 5f74 6f5f       columns_to_
-0000f800: 7265 6164 2e75 7064 6174 6528 6167 675f  read.update(agg_
-0000f810: 636f 6c75 6d6e 735f 6e65 6564 6564 290a  columns_needed).
-0000f820: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-0000f830: 7574 5f67 6466 203d 2067 666f 2e72 6561  ut_gdf = gfo.rea
-0000f840: 645f 6669 6c65 280a 2020 2020 2020 2020  d_file(.        
-0000f850: 2020 2020 2020 2020 7061 7468 3d69 6e70          path=inp
-0000f860: 7574 5f70 6174 682c 0a20 2020 2020 2020  ut_path,.       
-0000f870: 2020 2020 2020 2020 206c 6179 6572 3d69           layer=i
-0000f880: 6e70 7574 5f6c 6179 6572 2c0a 2020 2020  nput_layer,.    
-0000f890: 2020 2020 2020 2020 2020 2020 6262 6f78              bbox
-0000f8a0: 3d62 626f 782c 0a20 2020 2020 2020 2020  =bbox,.         
-0000f8b0: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
-0000f8c0: 6f6c 756d 6e73 5f74 6f5f 7265 6164 2c0a  olumns_to_read,.
-0000f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8e0: 6669 645f 6173 5f69 6e64 6578 3d66 6964  fid_as_index=fid
-0000f8f0: 5f61 735f 696e 6465 782c 0a20 2020 2020  _as_index,.     
-0000f900: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000f910: 2020 2020 2020 6966 2061 6767 5f63 6f6c        if agg_col
-0000f920: 756d 6e73 2069 7320 6e6f 7420 4e6f 6e65  umns is not None
-0000f930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f940: 2020 696e 7075 745f 6764 665b 2266 6964    input_gdf["fid
-0000f950: 5f6f 7269 6722 5d20 3d20 696e 7075 745f  _orig"] = input_
-0000f960: 6764 662e 696e 6465 780a 2020 2020 2020  gdf.index.      
-0000f970: 2020 2020 2020 2020 2020 6966 2061 6767            if agg
-0000f980: 5f63 6f6c 756d 6e73 5f6e 6565 6465 6420  _columns_needed 
-0000f990: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9b0: 2061 6767 5f63 6f6c 756d 6e73 5f6e 6565   agg_columns_nee
-0000f9c0: 6465 642e 6170 7065 6e64 2822 6669 645f  ded.append("fid_
-0000f9d0: 6f72 6967 2229 0a0a 2020 2020 2020 2020  orig")..        
-0000f9e0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000f9f0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0000fa00: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-0000fa10: 2020 2020 2020 6966 2073 7472 2865 7829        if str(ex)
-0000fa20: 203d 3d20 2264 6174 6162 6173 6520 6973   == "database is
-0000fa30: 206c 6f63 6b65 6422 3a0a 2020 2020 2020   locked":.      
-0000fa40: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-0000fa50: 7279 5f63 6f75 6e74 203c 2031 303a 0a20  ry_count < 10:. 
+0000ec70: 2020 2064 7374 3d6f 7574 7075 745f 6f6e     dst=output_on
+0000ec80: 626f 7264 6572 5f70 6174 682c 0a20 2020  border_path,.   
+0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eca0: 2020 2020 2020 2020 2063 7265 6174 655f           create_
+0000ecb0: 7370 6174 6961 6c5f 696e 6465 783d 4661  spatial_index=Fa
+0000ecc0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0000ecd0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecf0: 2020 2020 2020 2067 666f 2e72 656d 6f76         gfo.remov
+0000ed00: 6528 6f75 7470 7574 5f6f 6e62 6f72 6465  e(output_onborde
+0000ed10: 725f 746d 705f 7061 7274 6961 6c5f 7061  r_tmp_partial_pa
+0000ed20: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
+0000ed30: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000ed40: 6e20 6173 2065 783a 0a20 2020 2020 2020  n as ex:.       
+0000ed50: 2020 2020 2020 2020 2062 6174 6368 5f69           batch_i
+0000ed60: 6420 3d20 6675 7475 7265 5f74 6f5f 6261  d = future_to_ba
+0000ed70: 7463 685f 6964 5b66 7574 7572 655d 0a20  tch_id[future]. 
+0000ed80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000ed90: 6573 7361 6765 203d 2066 2245 7272 6f72  essage = f"Error
+0000eda0: 2065 7865 6375 7469 6e67 207b 6261 7463   executing {batc
+0000edb0: 6865 735b 6261 7463 685f 6964 5d7d 3a20  hes[batch_id]}: 
+0000edc0: 7b65 787d 220a 2020 2020 2020 2020 2020  {ex}".          
+0000edd0: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
+0000ede0: 6570 7469 6f6e 286d 6573 7361 6765 290a  eption(message).
+0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee00: 6361 6c63 756c 6174 655f 706f 6f6c 2e73  calculate_pool.s
+0000ee10: 6875 7464 6f77 6e28 290a 2020 2020 2020  hutdown().      
+0000ee20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000ee30: 4578 6365 7074 696f 6e28 6d65 7373 6167  Exception(messag
+0000ee40: 6529 2066 726f 6d20 6578 0a0a 2020 2020  e) from ex..    
+0000ee50: 2020 2020 2020 2020 2320 4c6f 6720 7468          # Log th
+0000ee60: 6520 7072 6f67 7265 7373 2061 6e64 2070  e progress and p
+0000ee70: 7265 6469 6374 696f 6e20 7370 6565 640a  rediction speed.
+0000ee80: 2020 2020 2020 2020 2020 2020 5f67 656e              _gen
+0000ee90: 6572 616c 5f75 7469 6c2e 7265 706f 7274  eral_util.report
+0000eea0: 5f70 726f 6772 6573 7328 0a20 2020 2020  _progress(.     
+0000eeb0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+0000eec0: 5f74 696d 652c 206e 625f 6261 7463 6865  _time, nb_batche
+0000eed0: 735f 646f 6e65 2c20 6e62 5f62 6174 6368  s_done, nb_batch
+0000eee0: 6573 2c20 2264 6973 736f 6c76 6522 0a20  es, "dissolve". 
+0000eef0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000ef00: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+0000ef10: 4469 7373 6f6c 7665 2070 6173 7320 7265  Dissolve pass re
+0000ef20: 6164 792c 2074 6f6f 6b20 7b64 6174 6574  ady, took {datet
+0000ef30: 696d 652e 6e6f 7728 292d 7374 6172 745f  ime.now()-start_
+0000ef40: 7469 6d65 7d21 2229 0a0a 2020 2020 7265  time}!")..    re
+0000ef50: 7475 726e 2072 6573 756c 745f 696e 666f  turn result_info
+0000ef60: 0a0a 0a64 6566 205f 6469 7373 6f6c 7665  ...def _dissolve
+0000ef70: 5f70 6f6c 7967 6f6e 7328 0a20 2020 2069  _polygons(.    i
+0000ef80: 6e70 7574 5f70 6174 683a 2050 6174 682c  nput_path: Path,
+0000ef90: 0a20 2020 206f 7574 7075 745f 6e6f 746f  .    output_noto
+0000efa0: 6e62 6f72 6465 725f 7061 7468 3a20 5061  nborder_path: Pa
+0000efb0: 7468 2c0a 2020 2020 6f75 7470 7574 5f6f  th,.    output_o
+0000efc0: 6e62 6f72 6465 725f 7061 7468 3a20 5061  nborder_path: Pa
+0000efd0: 7468 2c0a 2020 2020 6578 706c 6f64 6563  th,.    explodec
+0000efe0: 6f6c 6c65 6374 696f 6e73 3a20 626f 6f6c  ollections: bool
+0000eff0: 2c0a 2020 2020 6772 6f75 7062 795f 636f  ,.    groupby_co
+0000f000: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
+0000f010: 4974 6572 6162 6c65 5b73 7472 5d5d 2c0a  Iterable[str]],.
+0000f020: 2020 2020 6167 675f 636f 6c75 6d6e 733a      agg_columns:
+0000f030: 204f 7074 696f 6e61 6c5b 6469 6374 5d2c   Optional[dict],
+0000f040: 0a20 2020 2069 6e70 7574 5f67 656f 6d65  .    input_geome
+0000f050: 7472 7974 7970 653a 2047 656f 6d65 7472  trytype: Geometr
+0000f060: 7954 7970 652c 0a20 2020 2069 6e70 7574  yType,.    input
+0000f070: 5f6c 6179 6572 3a20 4f70 7469 6f6e 616c  _layer: Optional
+0000f080: 5b73 7472 5d2c 0a20 2020 206f 7574 7075  [str],.    outpu
+0000f090: 745f 6c61 7965 723a 204f 7074 696f 6e61  t_layer: Optiona
+0000f0a0: 6c5b 7374 725d 2c0a 2020 2020 6262 6f78  l[str],.    bbox
+0000f0b0: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
+0000f0c0: 6c6f 6174 2c20 666c 6f61 742c 2066 6c6f  loat, float, flo
+0000f0d0: 6174 5d2c 0a20 2020 2074 696c 655f 6964  at],.    tile_id
+0000f0e0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d2c  : Optional[int],
+0000f0f0: 0a20 2020 2067 7269 6473 697a 653a 2066  .    gridsize: f
+0000f100: 6c6f 6174 2c0a 2020 2020 6b65 6570 5f65  loat,.    keep_e
+0000f110: 6d70 7479 5f67 656f 6d73 3a20 626f 6f6c  mpty_geoms: bool
+0000f120: 2c0a 2920 2d3e 2064 6963 743a 0a20 2020  ,.) -> dict:.   
+0000f130: 2023 2049 6e69 740a 2020 2020 7065 7266   # Init.    perf
+0000f140: 696e 666f 203d 207b 7d0a 2020 2020 7374  info = {}.    st
+0000f150: 6172 745f 7469 6d65 203d 2064 6174 6574  art_time = datet
+0000f160: 696d 652e 6e6f 7728 290a 2020 2020 7265  ime.now().    re
+0000f170: 7475 726e 5f69 6e66 6f20 3d20 7b0a 2020  turn_info = {.  
+0000f180: 2020 2020 2020 2269 6e70 7574 5f70 6174        "input_pat
+0000f190: 6822 3a20 696e 7075 745f 7061 7468 2c0a  h": input_path,.
+0000f1a0: 2020 2020 2020 2020 226f 7574 7075 745f          "output_
+0000f1b0: 6e6f 746f 6e62 6f72 6465 725f 7061 7468  notonborder_path
+0000f1c0: 223a 206f 7574 7075 745f 6e6f 746f 6e62  ": output_notonb
+0000f1d0: 6f72 6465 725f 7061 7468 2c0a 2020 2020  order_path,.    
+0000f1e0: 2020 2020 226f 7574 7075 745f 6f6e 626f      "output_onbo
+0000f1f0: 7264 6572 5f70 6174 6822 3a20 6f75 7470  rder_path": outp
+0000f200: 7574 5f6f 6e62 6f72 6465 725f 7061 7468  ut_onborder_path
+0000f210: 2c0a 2020 2020 2020 2020 2262 626f 7822  ,.        "bbox"
+0000f220: 3a20 6262 6f78 2c0a 2020 2020 2020 2020  : bbox,.        
+0000f230: 2274 696c 655f 6964 223a 2074 696c 655f  "tile_id": tile_
+0000f240: 6964 2c0a 2020 2020 2020 2020 2267 7269  id,.        "gri
+0000f250: 6473 697a 6522 3a20 6772 6964 7369 7a65  dsize": gridsize
+0000f260: 2c0a 2020 2020 2020 2020 226e 625f 726f  ,.        "nb_ro
+0000f270: 7773 5f64 6f6e 6522 3a20 302c 0a20 2020  ws_done": 0,.   
+0000f280: 2020 2020 2022 746f 7461 6c5f 7469 6d65       "total_time
+0000f290: 223a 2030 2c0a 2020 2020 2020 2020 2270  ": 0,.        "p
+0000f2a0: 6572 6669 6e66 6f22 3a20 2222 2c0a 2020  erfinfo": "",.  
+0000f2b0: 2020 7d0a 0a20 2020 2023 2052 6561 6420    }..    # Read 
+0000f2c0: 616c 6c20 7265 636f 7264 7320 7468 6174  all records that
+0000f2d0: 2061 7265 2069 6e20 7468 6520 6262 6f78   are in the bbox
+0000f2e0: 0a20 2020 2072 6574 7279 5f63 6f75 6e74  .    retry_count
+0000f2f0: 203d 2030 0a20 2020 2073 7461 7274 5f72   = 0.    start_r
+0000f300: 6561 6420 3d20 6461 7465 7469 6d65 2e6e  ead = datetime.n
+0000f310: 6f77 2829 0a20 2020 2061 6767 5f63 6f6c  ow().    agg_col
+0000f320: 756d 6e73 5f6e 6565 6465 6420 3d20 4e6f  umns_needed = No
+0000f330: 6e65 0a20 2020 2077 6869 6c65 2054 7275  ne.    while Tru
+0000f340: 653a 0a20 2020 2020 2020 2074 7279 3a0a  e:.        try:.
+0000f350: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0000f360: 6d6e 735f 746f 5f72 6561 6420 3d20 7365  mns_to_read = se
+0000f370: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000f380: 696e 666f 203d 2067 666f 2e67 6574 5f6c  info = gfo.get_l
+0000f390: 6179 6572 696e 666f 2869 6e70 7574 5f70  ayerinfo(input_p
+0000f3a0: 6174 682c 2069 6e70 7574 5f6c 6179 6572  ath, input_layer
+0000f3b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000f3c0: 2067 726f 7570 6279 5f63 6f6c 756d 6e73   groupby_columns
+0000f3d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000f3f0: 6c75 6d6e 735f 746f 5f72 6561 642e 7570  lumns_to_read.up
+0000f400: 6461 7465 2867 726f 7570 6279 5f63 6f6c  date(groupby_col
+0000f410: 756d 6e73 290a 2020 2020 2020 2020 2020  umns).          
+0000f420: 2020 6669 645f 6173 5f69 6e64 6578 203d    fid_as_index =
+0000f430: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000f440: 2020 2069 6620 6167 675f 636f 6c75 6d6e     if agg_column
+0000f450: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f470: 6964 5f61 735f 696e 6465 7820 3d20 5472  id_as_index = Tr
+0000f480: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000f490: 2020 2069 6620 225f 5f44 4953 534f 4c56     if "__DISSOLV
+0000f4a0: 455f 544f 4a53 4f4e 2220 696e 2069 6e66  E_TOJSON" in inf
+0000f4b0: 6f2e 636f 6c75 6d6e 733a 0a20 2020 2020  o.columns:.     
+0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000f4d0: 2049 6620 7765 2061 7265 206e 6f74 2069   If we are not i
+0000f4e0: 6e20 7468 6520 6669 7273 7420 7061 7373  n the first pass
+0000f4f0: 2c20 7468 6520 636f 6c75 6d6e 7320 746f  , the columns to
+0000f500: 2062 6520 7265 6164 0a20 2020 2020 2020   be read.       
+0000f510: 2020 2020 2020 2020 2020 2020 2023 2061               # a
+0000f520: 7265 2061 6c72 6561 6479 2069 6e20 7468  re already in th
+0000f530: 6520 6a73 6f6e 2063 6f6c 756d 6e0a 2020  e json column.  
+0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f550: 2020 636f 6c75 6d6e 735f 746f 5f72 6561    columns_to_rea
+0000f560: 642e 6164 6428 225f 5f44 4953 534f 4c56  d.add("__DISSOLV
+0000f570: 455f 544f 4a53 4f4e 2229 0a20 2020 2020  E_TOJSON").     
+0000f580: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000f590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f5a0: 2020 2020 2023 2054 6865 2066 6972 7374       # The first
+0000f5b0: 2070 6173 732c 2073 6f20 7265 6164 2061   pass, so read a
+0000f5c0: 6c6c 2072 656c 6576 616e 7420 636f 6c75  ll relevant colu
+0000f5d0: 6d6e 7320 746f 2063 6f64 650a 2020 2020  mns to code.    
+0000f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5f0: 2320 7468 656d 2069 6e20 6a73 6f6e 0a20  # them in json. 
+0000f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f610: 2020 2069 6620 226a 736f 6e22 2069 6e20     if "json" in 
+0000f620: 6167 675f 636f 6c75 6d6e 733a 0a20 2020  agg_columns:.   
+0000f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f640: 2020 2020 2061 6767 5f63 6f6c 756d 6e73       agg_columns
+0000f650: 5f6e 6565 6465 6420 3d20 6167 675f 636f  _needed = agg_co
+0000f660: 6c75 6d6e 735b 226a 736f 6e22 5d0a 2020  lumns["json"].  
+0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f680: 2020 656c 6966 2022 636f 6c75 6d6e 7322    elif "columns"
+0000f690: 2069 6e20 6167 675f 636f 6c75 6d6e 733a   in agg_columns:
+0000f6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f6b0: 2020 2020 2020 2020 2061 6767 5f63 6f6c           agg_col
+0000f6c0: 756d 6e73 5f6e 6565 6465 6420 3d20 5b0a  umns_needed = [.
+0000f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6e0: 2020 2020 2020 2020 2020 2020 6167 675f              agg_
+0000f6f0: 636f 6c75 6d6e 5b22 636f 6c75 6d6e 225d  column["column"]
+0000f700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f710: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000f720: 2061 6767 5f63 6f6c 756d 6e20 696e 2061   agg_column in a
+0000f730: 6767 5f63 6f6c 756d 6e73 5b22 636f 6c75  gg_columns["colu
+0000f740: 6d6e 7322 5d0a 2020 2020 2020 2020 2020  mns"].          
+0000f750: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f770: 2020 2020 6966 2061 6767 5f63 6f6c 756d      if agg_colum
+0000f780: 6e73 5f6e 6565 6465 6420 6973 206e 6f74  ns_needed is not
+0000f790: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f7a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f7b0: 6f6c 756d 6e73 5f74 6f5f 7265 6164 2e75  olumns_to_read.u
+0000f7c0: 7064 6174 6528 6167 675f 636f 6c75 6d6e  pdate(agg_column
+0000f7d0: 735f 6e65 6564 6564 290a 0a20 2020 2020  s_needed)..     
+0000f7e0: 2020 2020 2020 2069 6e70 7574 5f67 6466         input_gdf
+0000f7f0: 203d 2067 666f 2e72 6561 645f 6669 6c65   = gfo.read_file
+0000f800: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000f810: 2020 7061 7468 3d69 6e70 7574 5f70 6174    path=input_pat
+0000f820: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0000f830: 2020 206c 6179 6572 3d69 6e70 7574 5f6c     layer=input_l
+0000f840: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
+0000f850: 2020 2020 2020 6262 6f78 3d62 626f 782c        bbox=bbox,
+0000f860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f870: 2063 6f6c 756d 6e73 3d63 6f6c 756d 6e73   columns=columns
+0000f880: 5f74 6f5f 7265 6164 2c0a 2020 2020 2020  _to_read,.      
+0000f890: 2020 2020 2020 2020 2020 6669 645f 6173            fid_as
+0000f8a0: 5f69 6e64 6578 3d66 6964 5f61 735f 696e  _index=fid_as_in
+0000f8b0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+0000f8c0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0000f8d0: 6966 2061 6767 5f63 6f6c 756d 6e73 2069  if agg_columns i
+0000f8e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000f8f0: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+0000f900: 745f 6764 665b 2266 6964 5f6f 7269 6722  t_gdf["fid_orig"
+0000f910: 5d20 3d20 696e 7075 745f 6764 662e 696e  ] = input_gdf.in
+0000f920: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
+0000f930: 2020 2020 6966 2061 6767 5f63 6f6c 756d      if agg_colum
+0000f940: 6e73 5f6e 6565 6465 6420 6973 206e 6f74  ns_needed is not
+0000f950: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f960: 2020 2020 2020 2020 2020 2061 6767 5f63             agg_c
+0000f970: 6f6c 756d 6e73 5f6e 6565 6465 642e 6170  olumns_needed.ap
+0000f980: 7065 6e64 2822 6669 645f 6f72 6967 2229  pend("fid_orig")
+0000f990: 0a0a 2020 2020 2020 2020 2020 2020 6272  ..            br
+0000f9a0: 6561 6b0a 2020 2020 2020 2020 6578 6365  eak.        exce
+0000f9b0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0000f9c0: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
+0000f9d0: 6966 2073 7472 2865 7829 203d 3d20 2264  if str(ex) == "d
+0000f9e0: 6174 6162 6173 6520 6973 206c 6f63 6b65  atabase is locke
+0000f9f0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+0000fa00: 2020 2020 6966 2072 6574 7279 5f63 6f75      if retry_cou
+0000fa10: 6e74 203c 2031 303a 0a20 2020 2020 2020  nt < 10:.       
+0000fa20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000fa30: 7279 5f63 6f75 6e74 202b 3d20 310a 2020  ry_count += 1.  
+0000fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa50: 2020 7469 6d65 2e73 6c65 6570 2831 290a    time.sleep(1).
 0000fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa70: 2020 2072 6574 7279 5f63 6f75 6e74 202b     retry_count +
-0000fa80: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0000fa90: 2020 2020 2020 2020 7469 6d65 2e73 6c65          time.sle
-0000faa0: 6570 2831 290a 2020 2020 2020 2020 2020  ep(1).          
-0000fab0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fad0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000fae0: 2272 6574 7269 6564 2031 3020 7469 6d65  "retried 10 time
-0000faf0: 732c 2064 6174 6162 6173 6520 7374 696c  s, database stil
-0000fb00: 6c20 6c6f 636b 6564 2229 2066 726f 6d20  l locked") from 
-0000fb10: 6578 0a20 2020 2020 2020 2020 2020 2065  ex.            e
-0000fb20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000fb30: 2020 2020 2072 6169 7365 2065 780a 0a20       raise ex.. 
-0000fb40: 2020 2023 2043 6865 636b 2072 6573 756c     # Check resul
-0000fb50: 740a 2020 2020 7065 7266 696e 666f 5b22  t.    perfinfo["
-0000fb60: 7469 6d65 5f72 6561 6422 5d20 3d20 2864  time_read"] = (d
-0000fb70: 6174 6574 696d 652e 6e6f 7728 2920 2d20  atetime.now() - 
-0000fb80: 7374 6172 745f 7265 6164 292e 746f 7461  start_read).tota
-0000fb90: 6c5f 7365 636f 6e64 7328 290a 2020 2020  l_seconds().    
-0000fba0: 7265 7475 726e 5f69 6e66 6f5b 226e 625f  return_info["nb_
-0000fbb0: 726f 7773 5f64 6f6e 6522 5d20 3d20 6c65  rows_done"] = le
-0000fbc0: 6e28 696e 7075 745f 6764 6629 0a20 2020  n(input_gdf).   
-0000fbd0: 2069 6620 7265 7475 726e 5f69 6e66 6f5b   if return_info[
-0000fbe0: 226e 625f 726f 7773 5f64 6f6e 6522 5d20  "nb_rows_done"] 
-0000fbf0: 3d3d 2030 3a0a 2020 2020 2020 2020 6d65  == 0:.        me
-0000fc00: 7373 6167 6520 3d20 6622 4e6f 2069 6e70  ssage = f"No inp
-0000fc10: 7574 2067 656f 6d65 7472 6965 7320 666f  ut geometries fo
-0000fc20: 756e 6420 696e 207b 696e 7075 745f 7061  und in {input_pa
-0000fc30: 7468 7d22 0a20 2020 2020 2020 206c 6f67  th}".        log
-0000fc40: 6765 722e 696e 666f 286d 6573 7361 6765  ger.info(message
-0000fc50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000fc60: 5f69 6e66 6f5b 226d 6573 7361 6765 225d  _info["message"]
-0000fc70: 203d 206d 6573 7361 6765 0a20 2020 2020   = message.     
-0000fc80: 2020 2072 6574 7572 6e5f 696e 666f 5b22     return_info["
-0000fc90: 746f 7461 6c5f 7469 6d65 225d 203d 2028  total_time"] = (
-0000fca0: 6461 7465 7469 6d65 2e6e 6f77 2829 202d  datetime.now() -
-0000fcb0: 2073 7461 7274 5f74 696d 6529 2e74 6f74   start_time).tot
-0000fcc0: 616c 5f73 6563 6f6e 6473 2829 0a20 2020  al_seconds().   
-0000fcd0: 2020 2020 2072 6574 7572 6e20 7265 7475       return retu
-0000fce0: 726e 5f69 6e66 6f0a 0a20 2020 2023 204e  rn_info..    # N
-0000fcf0: 6f77 2074 6865 2072 6561 6c20 7072 6f63  ow the real proc
-0000fd00: 6573 7369 6e67 0a20 2020 2069 6620 6167  essing.    if ag
-0000fd10: 675f 636f 6c75 6d6e 7320 6973 206e 6f74  g_columns is not
-0000fd20: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-0000fd30: 6620 225f 5f44 4953 534f 4c56 455f 544f  f "__DISSOLVE_TO
-0000fd40: 4a53 4f4e 2220 6e6f 7420 696e 2069 6e70  JSON" not in inp
-0000fd50: 7574 5f67 6466 2e63 6f6c 756d 6e73 3a0a  ut_gdf.columns:.
-0000fd60: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
-0000fd70: 7273 7420 7061 7373 202d 3e20 7075 7420  rst pass -> put 
-0000fd80: 7265 6c65 7661 6e74 2063 6f6c 756d 6e73  relevant columns
-0000fd90: 2069 6e20 6a73 6f6e 2066 6965 6c64 0a20   in json field. 
-0000fda0: 2020 2020 2020 2020 2020 2061 6767 6675             aggfu
-0000fdb0: 6e63 203d 207b 2274 6f5f 6a73 6f6e 223a  nc = {"to_json":
-0000fdc0: 2061 6767 5f63 6f6c 756d 6e73 5f6e 6565   agg_columns_nee
-0000fdd0: 6465 647d 0a20 2020 2020 2020 2065 6c73  ded}.        els
-0000fde0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0000fdf0: 2043 6f6c 756d 6e73 2061 6c72 6561 6479   Columns already
-0000fe00: 2063 6f64 6564 2069 6e20 6120 6a73 6f6e   coded in a json
-0000fe10: 2063 6f6c 756d 6e2c 2073 6f20 6d65 7267   column, so merg
-0000fe20: 6520 6a73 6f6e 206c 6973 7473 0a20 2020  e json lists.   
-0000fe30: 2020 2020 2020 2020 2061 6767 6675 6e63           aggfunc
-0000fe40: 203d 2022 6d65 7267 655f 6a73 6f6e 5f6c   = "merge_json_l
-0000fe50: 6973 7473 220a 2020 2020 656c 7365 3a0a  ists".    else:.
-0000fe60: 2020 2020 2020 2020 6167 6766 756e 6320          aggfunc 
-0000fe70: 3d20 2266 6972 7374 220a 2020 2020 7374  = "first".    st
-0000fe80: 6172 745f 6469 7373 6f6c 7665 203d 2064  art_dissolve = d
-0000fe90: 6174 6574 696d 652e 6e6f 7728 290a 2020  atetime.now().  
-0000fea0: 2020 6469 7373 5f67 6466 203d 205f 6469    diss_gdf = _di
-0000feb0: 7373 6f6c 7665 280a 2020 2020 2020 2020  ssolve(.        
-0000fec0: 6466 3d69 6e70 7574 5f67 6466 2c20 6279  df=input_gdf, by
-0000fed0: 3d67 726f 7570 6279 5f63 6f6c 756d 6e73  =groupby_columns
-0000fee0: 2c20 6167 6766 756e 633d 6167 6766 756e  , aggfunc=aggfun
-0000fef0: 632c 2061 735f 696e 6465 783d 4661 6c73  c, as_index=Fals
-0000ff00: 652c 2064 726f 706e 613d 4661 6c73 650a  e, dropna=False.
-0000ff10: 2020 2020 290a 2020 2020 7065 7266 696e      ).    perfin
-0000ff20: 666f 5b22 7469 6d65 5f64 6973 736f 6c76  fo["time_dissolv
-0000ff30: 6522 5d20 3d20 2864 6174 6574 696d 652e  e"] = (datetime.
-0000ff40: 6e6f 7728 2920 2d20 7374 6172 745f 6469  now() - start_di
-0000ff50: 7373 6f6c 7665 292e 746f 7461 6c5f 7365  ssolve).total_se
-0000ff60: 636f 6e64 7328 290a 0a20 2020 2023 2049  conds()..    # I
-0000ff70: 6620 6578 706c 6f64 6563 6f6c 6c65 6374  f explodecollect
-0000ff80: 696f 6e73 2069 7320 5472 7565 2061 6e64  ions is True and
-0000ff90: 2046 6f72 2070 6f6c 7967 6f6e 732c 2065   For polygons, e
-0000ffa0: 7870 6c6f 6465 206d 756c 7469 2d67 656f  xplode multi-geo
-0000ffb0: 6d65 7472 6965 732e 0a20 2020 2023 2049  metries..    # I
-0000ffc0: 6620 6e65 6564 6564 2074 6865 7920 7769  f needed they wi
-0000ffd0: 6c6c 2062 6520 2763 6f6c 6c65 6374 6564  ll be 'collected
-0000ffe0: 2720 6166 7465 7277 6172 6473 2074 6f20  ' afterwards to 
-0000fff0: 6d75 6c74 6970 6f6c 7967 6f6e 7320 6167  multipolygons ag
-00010000: 6169 6e2e 0a20 2020 2069 6620 6578 706c  ain..    if expl
-00010010: 6f64 6563 6f6c 6c65 6374 696f 6e73 2069  odecollections i
-00010020: 7320 5472 7565 206f 7220 696e 7075 745f  s True or input_
-00010030: 6765 6f6d 6574 7279 7479 7065 2069 6e20  geometrytype in 
-00010040: 5b0a 2020 2020 2020 2020 4765 6f6d 6574  [.        Geomet
-00010050: 7279 5479 7065 2e50 4f4c 5947 4f4e 2c0a  ryType.POLYGON,.
-00010060: 2020 2020 2020 2020 4765 6f6d 6574 7279          Geometry
-00010070: 5479 7065 2e4d 554c 5449 504f 4c59 474f  Type.MULTIPOLYGO
-00010080: 4e2c 0a20 2020 205d 3a0a 2020 2020 2020  N,.    ]:.      
-00010090: 2020 2320 6173 7365 7274 2074 6f20 6576    # assert to ev
-000100a0: 6164 6520 7079 4c61 6e63 6520 7761 726e  ade pyLance warn
-000100b0: 696e 670a 2020 2020 2020 2020 6173 7365  ing.        asse
-000100c0: 7274 2069 7369 6e73 7461 6e63 6528 6469  rt isinstance(di
-000100d0: 7373 5f67 6466 2c20 6770 642e 4765 6f44  ss_gdf, gpd.GeoD
-000100e0: 6174 6146 7261 6d65 290a 2020 2020 2020  ataFrame).      
-000100f0: 2020 6469 7373 5f67 6466 203d 2064 6973    diss_gdf = dis
-00010100: 735f 6764 662e 6578 706c 6f64 6528 6967  s_gdf.explode(ig
-00010110: 6e6f 7265 5f69 6e64 6578 3d54 7275 6529  nore_index=True)
-00010120: 0a0a 2020 2020 2320 436c 6970 2074 6865  ..    # Clip the
-00010130: 2072 6573 756c 7420 6f6e 2074 6865 2062   result on the b
-00010140: 6f72 6465 7273 206f 6620 7468 6520 6262  orders of the bb
-00010150: 6f78 206e 6f74 2074 6f20 6861 7665 206f  ox not to have o
-00010160: 7665 726c 6170 730a 2020 2020 2320 6265  verlaps.    # be
-00010170: 7477 6565 6e20 7468 6520 6469 6666 6572  tween the differ
-00010180: 656e 7420 7469 6c65 732e 0a20 2020 2023  ent tiles..    #
-00010190: 2049 6620 7468 6973 2069 7320 6e6f 7420   If this is not 
-000101a0: 6170 706c 6965 642c 2074 6869 7320 7265  applied, this re
-000101b0: 7375 6c74 7320 696e 2073 6f6d 6520 6765  sults in some ge
-000101c0: 6f6d 6574 7269 6573 206e 6f74 2062 6569  ometries not bei
-000101d0: 6e67 206d 6572 6765 640a 2020 2020 2320  ng merged.    # 
-000101e0: 6f72 2069 6e20 6475 706c 6963 6174 6573  or in duplicates
-000101f0: 2e0a 2020 2020 2320 5245 4d41 524b 3a20  ..    # REMARK: 
-00010200: 666f 7220 286d 756c 7469 296c 696e 6573  for (multi)lines
-00010210: 7472 696e 6773 2c20 7468 6520 656e 6470  trings, the endp
-00010220: 6f69 6e74 7320 6372 6561 7465 6420 6279  oints created by
-00010230: 2074 6865 2063 6c69 7020 6172 6520 6e6f   the clip are no
-00010240: 740a 2020 2020 2320 616c 7761 7973 2074  t.    # always t
-00010250: 6865 2073 616d 6520 6475 6520 746f 2072  he same due to r
-00010260: 6f75 6e64 696e 672c 2073 6f20 6469 7373  ounding, so diss
-00010270: 6f6c 7669 6e67 2069 6e20 6120 6e65 7874  olving in a next
-00010280: 2070 6173 7320 646f 6573 6e27 740a 2020   pass doesn't.  
-00010290: 2020 2320 616c 7761 7973 2072 6573 756c    # always resul
-000102a0: 7420 696e 206c 696e 6573 7472 696e 6773  t in linestrings
-000102b0: 2062 6569 6e67 2072 652d 636f 6e6e 6563   being re-connec
-000102c0: 7465 642e 2e2e 2042 6563 6175 7365 2064  ted... Because d
-000102d0: 6973 736f 6c76 696e 670a 2020 2020 2320  issolving.    # 
-000102e0: 6c69 6e65 7320 6973 6e27 7420 736f 2063  lines isn't so c
-000102f0: 6f6d 7075 7461 7469 6f6e 616c 6c79 2068  omputationally h
-00010300: 6561 7679 2061 6e79 7761 792c 2064 726f  eavy anyway, dro
-00010310: 7020 7375 7070 6f72 7420 6865 7265 2e0a  p support here..
-00010320: 2020 2020 6966 2062 626f 7820 6973 206e      if bbox is n
-00010330: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00010340: 2073 7461 7274 5f63 6c69 7020 3d20 6461   start_clip = da
-00010350: 7465 7469 6d65 2e6e 6f77 2829 0a20 2020  tetime.now().   
-00010360: 2020 2020 2062 626f 785f 706f 6c79 676f       bbox_polygo
-00010370: 6e20 3d20 7368 5f67 656f 6d2e 506f 6c79  n = sh_geom.Poly
-00010380: 676f 6e28 0a20 2020 2020 2020 2020 2020  gon(.           
-00010390: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-000103a0: 2020 2028 6262 6f78 5b30 5d2c 2062 626f     (bbox[0], bbo
-000103b0: 785b 315d 292c 0a20 2020 2020 2020 2020  x[1]),.         
-000103c0: 2020 2020 2020 2028 6262 6f78 5b30 5d2c         (bbox[0],
-000103d0: 2062 626f 785b 335d 292c 0a20 2020 2020   bbox[3]),.     
-000103e0: 2020 2020 2020 2020 2020 2028 6262 6f78             (bbox
-000103f0: 5b32 5d2c 2062 626f 785b 335d 292c 0a20  [2], bbox[3]),. 
-00010400: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00010410: 6262 6f78 5b32 5d2c 2062 626f 785b 315d  bbox[2], bbox[1]
-00010420: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00010430: 2020 2028 6262 6f78 5b30 5d2c 2062 626f     (bbox[0], bbo
-00010440: 785b 315d 292c 0a20 2020 2020 2020 2020  x[1]),.         
-00010450: 2020 205d 0a20 2020 2020 2020 2029 0a20     ].        ). 
-00010460: 2020 2020 2020 2062 626f 785f 6764 6620         bbox_gdf 
-00010470: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
-00010480: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00010490: 6461 7461 3d5b 315d 2c20 6765 6f6d 6574  data=[1], geomet
-000104a0: 7279 3d5b 6262 6f78 5f70 6f6c 7967 6f6e  ry=[bbox_polygon
-000104b0: 5d2c 2063 7273 3d69 6e70 7574 5f67 6466  ], crs=input_gdf
-000104c0: 2e63 7273 2020 2320 7479 7065 3a20 6967  .crs  # type: ig
-000104d0: 6e6f 7265 0a20 2020 2020 2020 2029 0a0a  nore.        )..
-000104e0: 2020 2020 2020 2020 2320 4361 7463 6820          # Catch 
-000104f0: 6972 7265 6c65 7661 6e74 2070 616e 6461  irrelevant panda
-00010500: 7320 6675 7475 7265 2077 6172 6e69 6e67  s future warning
-00010510: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
-00010520: 2077 6865 6e20 7265 6d6f 7665 6420 696e   when removed in
-00010530: 206c 6174 6572 2076 6572 7369 6f6e 206f   later version o
-00010540: 6620 7061 6e64 6173 2c20 6361 6e20 6265  f pandas, can be
-00010550: 2072 656d 6f76 6564 2068 6572 650a 2020   removed here.  
-00010560: 2020 2020 2020 7769 7468 2077 6172 6e69        with warni
-00010570: 6e67 732e 6361 7463 685f 7761 726e 696e  ngs.catch_warnin
-00010580: 6773 2829 3a0a 2020 2020 2020 2020 2020  gs():.          
-00010590: 2020 6d65 7373 6167 6520 3d20 280a 2020    message = (.  
-000105a0: 2020 2020 2020 2020 2020 2020 2020 2249                "I
-000105b0: 6e20 6120 6675 7475 7265 2076 6572 7369  n a future versi
-000105c0: 6f6e 2c20 6064 662e 696c 6f63 5b3a 2c20  on, `df.iloc[:, 
-000105d0: 695d 203d 206e 6577 7661 6c73 6020 7769  i] = newvals` wi
-000105e0: 6c6c 2061 7474 656d 7074 2074 6f20 220a  ll attempt to ".
-000105f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010600: 2273 6574 2074 6865 2076 616c 7565 7320  "set the values 
-00010610: 696e 706c 6163 6520 696e 7374 6561 6420  inplace instead 
-00010620: 6f66 2061 6c77 6179 7320 7365 7474 696e  of always settin
-00010630: 6720 6120 6e65 7720 6172 7261 792e 220a  g a new array.".
-00010640: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00010650: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00010660: 6773 2e66 696c 7465 7277 6172 6e69 6e67  gs.filterwarning
-00010670: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00010680: 2020 2061 6374 696f 6e3d 2269 676e 6f72     action="ignor
-00010690: 6522 2c20 6361 7465 676f 7279 3d46 7574  e", category=Fut
-000106a0: 7572 6557 6172 6e69 6e67 2c20 6d65 7373  ureWarning, mess
-000106b0: 6167 653d 7265 2e65 7363 6170 6528 6d65  age=re.escape(me
-000106c0: 7373 6167 6529 0a20 2020 2020 2020 2020  ssage).         
-000106d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000106e0: 2023 206b 6565 705f 6765 6f6d 5f74 7970   # keep_geom_typ
-000106f0: 653d 5472 7565 2067 6176 6520 736f 6d65  e=True gave some
-00010700: 7469 6d65 7320 6572 726f 722c 2061 6e64  times error, and
-00010710: 2073 7469 6c6c 2064 6f65 7320 696e 2030   still does in 0
-00010720: 2e39 2e30 0a20 2020 2020 2020 2020 2020  .9.0.           
-00010730: 2023 2073 6f20 7573 6520 6f77 6e20 696d   # so use own im
-00010740: 706c 656d 656e 7461 7469 6f6e 206f 6620  plementation of 
-00010750: 6b65 6570 5f67 656f 6d5f 7479 7065 0a20  keep_geom_type. 
-00010760: 2020 2020 2020 2020 2020 2064 6973 735f             diss_
-00010770: 6764 6620 3d20 6770 642e 636c 6970 2864  gdf = gpd.clip(d
-00010780: 6973 735f 6764 662c 2062 626f 785f 6764  iss_gdf, bbox_gd
-00010790: 6629 2020 2320 2c20 6b65 6570 5f67 656f  f)  # , keep_geo
-000107a0: 6d5f 7479 7065 3d54 7275 6529 0a20 2020  m_type=True).   
-000107b0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-000107c0: 6973 696e 7374 616e 6365 2864 6973 735f  isinstance(diss_
-000107d0: 6764 662c 2067 7064 2e47 656f 4461 7461  gdf, gpd.GeoData
-000107e0: 4672 616d 6529 0a0a 2020 2020 2020 2020  Frame)..        
-000107f0: 2320 4f6e 6c79 206b 6565 7020 6765 6f6d  # Only keep geom
-00010800: 6574 7269 6573 206f 6620 7468 6520 7072  etries of the pr
-00010810: 696d 6974 6976 6520 7479 7065 2073 7065  imitive type spe
-00010820: 6369 6669 6564 2061 6674 6572 2063 6c69  cified after cli
-00010830: 702e 2e2e 0a20 2020 2020 2020 2061 7373  p....        ass
-00010840: 6572 7420 6973 696e 7374 616e 6365 2864  ert isinstance(d
-00010850: 6973 735f 6764 662c 2067 7064 2e47 656f  iss_gdf, gpd.Geo
-00010860: 4461 7461 4672 616d 6529 0a20 2020 2020  DataFrame).     
-00010870: 2020 2064 6973 735f 6764 662e 6765 6f6d     diss_gdf.geom
-00010880: 6574 7279 203d 2067 656f 7365 7269 6573  etry = geoseries
-00010890: 5f75 7469 6c2e 6765 6f6d 6574 7279 5f63  _util.geometry_c
-000108a0: 6f6c 6c65 6374 696f 6e5f 6578 7472 6163  ollection_extrac
-000108b0: 7428 0a20 2020 2020 2020 2020 2020 2064  t(.            d
-000108c0: 6973 735f 6764 662e 6765 6f6d 6574 7279  iss_gdf.geometry
-000108d0: 2c20 696e 7075 745f 6765 6f6d 6574 7279  , input_geometry
-000108e0: 7479 7065 2e74 6f5f 7072 696d 6974 6976  type.to_primitiv
-000108f0: 6574 7970 650a 2020 2020 2020 2020 290a  etype.        ).
-00010900: 0a20 2020 2020 2020 2070 6572 6669 6e66  .        perfinf
-00010910: 6f5b 2274 696d 655f 636c 6970 225d 203d  o["time_clip"] =
-00010920: 2028 6461 7465 7469 6d65 2e6e 6f77 2829   (datetime.now()
-00010930: 202d 2073 7461 7274 5f63 6c69 7029 2e74   - start_clip).t
-00010940: 6f74 616c 5f73 6563 6f6e 6473 2829 0a0a  otal_seconds()..
-00010950: 2020 2020 2320 5365 7420 656d 7074 7920      # Set empty 
-00010960: 6765 6f6d 6574 7269 6573 2074 6f20 6e75  geometries to nu
-00010970: 6c6c 2f4e 6f6e 650a 2020 2020 6173 7365  ll/None.    asse
-00010980: 7274 2064 6973 735f 6764 662e 6765 6f6d  rt diss_gdf.geom
-00010990: 6574 7279 2069 7320 6e6f 7420 4e6f 6e65  etry is not None
-000109a0: 0a20 2020 2064 6973 735f 6764 662e 6c6f  .    diss_gdf.lo
-000109b0: 635b 6469 7373 5f67 6466 2e67 656f 6d65  c[diss_gdf.geome
-000109c0: 7472 792e 6973 5f65 6d70 7479 2c20 5b22  try.is_empty, ["
-000109d0: 6765 6f6d 6574 7279 225d 5d20 3d20 4e6f  geometry"]] = No
-000109e0: 6e65 0a0a 2020 2020 2320 5265 6d6f 7665  ne..    # Remove
-000109f0: 2072 6f77 7320 7768 6572 6520 6765 6f6d   rows where geom
-00010a00: 2069 7320 4e6f 6e65 2f6e 756c 6c2f 656d   is None/null/em
-00010a10: 7074 790a 2020 2020 6966 206e 6f74 206b  pty.    if not k
-00010a20: 6565 705f 656d 7074 795f 6765 6f6d 733a  eep_empty_geoms:
-00010a30: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00010a40: 6973 696e 7374 616e 6365 2864 6973 735f  isinstance(diss_
-00010a50: 6764 662c 2067 7064 2e47 656f 4461 7461  gdf, gpd.GeoData
-00010a60: 4672 616d 6529 0a20 2020 2020 2020 2064  Frame).        d
-00010a70: 6973 735f 6764 6620 3d20 6469 7373 5f67  iss_gdf = diss_g
-00010a80: 6466 5b7e 6469 7373 5f67 6466 2e67 656f  df[~diss_gdf.geo
-00010a90: 6d65 7472 792e 6973 6e61 2829 5d0a 0a20  metry.isna()].. 
-00010aa0: 2020 2023 2049 6620 7468 6572 6520 6973     # If there is
-00010ab0: 206e 6f20 7265 7375 6c74 2c20 7265 7475   no result, retu
-00010ac0: 726e 0a20 2020 2069 6620 6c65 6e28 6469  rn.    if len(di
-00010ad0: 7373 5f67 6466 2920 3d3d 2030 3a0a 2020  ss_gdf) == 0:.  
-00010ae0: 2020 2020 2020 6d65 7373 6167 6520 3d20        message = 
-00010af0: 6622 5265 7375 6c74 2069 7320 656d 7074  f"Result is empt
-00010b00: 7920 666f 7220 7b69 6e70 7574 5f70 6174  y for {input_pat
-00010b10: 687d 220a 2020 2020 2020 2020 7265 7475  h}".        retu
-00010b20: 726e 5f69 6e66 6f5b 226d 6573 7361 6765  rn_info["message
-00010b30: 225d 203d 206d 6573 7361 6765 0a20 2020  "] = message.   
-00010b40: 2020 2020 2072 6574 7572 6e5f 696e 666f       return_info
-00010b50: 5b22 7065 7266 696e 666f 225d 203d 2070  ["perfinfo"] = p
-00010b60: 6572 6669 6e66 6f0a 2020 2020 2020 2020  erfinfo.        
-00010b70: 7265 7475 726e 5f69 6e66 6f5b 2274 6f74  return_info["tot
-00010b80: 616c 5f74 696d 6522 5d20 3d20 2864 6174  al_time"] = (dat
-00010b90: 6574 696d 652e 6e6f 7728 2920 2d20 7374  etime.now() - st
-00010ba0: 6172 745f 7469 6d65 292e 746f 7461 6c5f  art_time).total_
-00010bb0: 7365 636f 6e64 7328 290a 2020 2020 2020  seconds().      
-00010bc0: 2020 7265 7475 726e 2072 6574 7572 6e5f    return return_
-00010bd0: 696e 666f 0a0a 2020 2020 2320 4164 6420  info..    # Add 
-00010be0: 636f 6c75 6d6e 2077 6974 6820 7469 6c65  column with tile
-00010bf0: 5f69 640a 2020 2020 6173 7365 7274 2069  _id.    assert i
-00010c00: 7369 6e73 7461 6e63 6528 6469 7373 5f67  sinstance(diss_g
-00010c10: 6466 2c20 6770 642e 4765 6f44 6174 6146  df, gpd.GeoDataF
-00010c20: 7261 6d65 290a 2020 2020 6966 2074 696c  rame).    if til
-00010c30: 655f 6964 2069 7320 6e6f 7420 4e6f 6e65  e_id is not None
-00010c40: 3a0a 2020 2020 2020 2020 6469 7373 5f67  :.        diss_g
-00010c50: 6466 5b22 7469 6c65 5f69 6422 5d20 3d20  df["tile_id"] = 
-00010c60: 7469 6c65 5f69 640a 0a20 2020 2069 6620  tile_id..    if 
-00010c70: 6772 6964 7369 7a65 2021 3d20 302e 303a  gridsize != 0.0:
-00010c80: 0a20 2020 2020 2020 2064 6973 735f 6764  .        diss_gd
-00010c90: 662e 6765 6f6d 6574 7279 203d 2073 6861  f.geometry = sha
-00010ca0: 7065 6c79 325f 6f72 5f70 7967 656f 732e  pely2_or_pygeos.
-00010cb0: 7365 745f 7072 6563 6973 696f 6e28 0a20  set_precision(. 
-00010cc0: 2020 2020 2020 2020 2020 2064 6973 735f             diss_
-00010cd0: 6764 662e 6765 6f6d 6574 7279 2e61 7272  gdf.geometry.arr
-00010ce0: 6179 2e64 6174 612c 2067 7269 645f 7369  ay.data, grid_si
-00010cf0: 7a65 3d67 7269 6473 697a 650a 2020 2020  ze=gridsize.    
-00010d00: 2020 2020 290a 0a20 2020 2023 2053 6176      )..    # Sav
-00010d10: 6520 7468 6520 7265 7375 6c74 2074 6f20  e the result to 
-00010d20: 6465 7374 696e 6174 696f 6e20 6669 6c65  destination file
-00010d30: 2873 290a 2020 2020 7374 6172 745f 746f  (s).    start_to
-00010d40: 5f66 696c 6520 3d20 6461 7465 7469 6d65  _file = datetime
-00010d50: 2e6e 6f77 2829 0a0a 2020 2020 2320 4966  .now()..    # If
-00010d60: 2074 6865 2074 696c 6573 2064 6f6e 2774   the tiles don't
-00010d70: 206e 6565 6420 746f 2062 6520 6d65 7267   need to be merg
-00010d80: 6564 2061 6674 6572 7761 7264 732c 2077  ed afterwards, w
-00010d90: 6520 6361 6e20 6a75 7374 2073 6176 6520  e can just save 
-00010da0: 7468 6520 7265 7375 6c74 2061 730a 2020  the result as.  
-00010db0: 2020 2320 6974 2069 732e 0a20 2020 2069    # it is..    i
-00010dc0: 6620 7374 7228 6f75 7470 7574 5f6e 6f74  f str(output_not
-00010dd0: 6f6e 626f 7264 6572 5f70 6174 6829 203d  onborder_path) =
-00010de0: 3d20 7374 7228 6f75 7470 7574 5f6f 6e62  = str(output_onb
-00010df0: 6f72 6465 725f 7061 7468 293a 0a20 2020  order_path):.   
-00010e00: 2020 2020 2023 2061 7373 6572 7420 746f       # assert to
-00010e10: 2065 7661 6465 2070 794c 616e 6365 2077   evade pyLance w
-00010e20: 6172 6e69 6e67 0a20 2020 2020 2020 2061  arning.        a
-00010e30: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00010e40: 2864 6973 735f 6764 662c 2067 7064 2e47  (diss_gdf, gpd.G
-00010e50: 656f 4461 7461 4672 616d 6529 0a20 2020  eoDataFrame).   
-00010e60: 2020 2020 2023 2055 7365 2066 6f72 6365       # Use force
-00010e70: 5f6d 756c 7469 7479 7065 2c20 746f 2065  _multitype, to e
-00010e80: 7661 6465 2077 6172 6e69 6e67 7320 7768  vade warnings wh
-00010e90: 656e 2073 6f6d 6520 6261 7463 6865 7320  en some batches 
-00010ea0: 636f 6e74 6169 6e0a 2020 2020 2020 2020  contain.        
-00010eb0: 2320 7369 6e67 6c65 7479 7065 2061 6e64  # singletype and
-00010ec0: 2073 6f6d 6520 636f 6e74 6169 6e20 6d75   some contain mu
-00010ed0: 6c74 6974 7970 6520 6765 6f6d 6574 7269  ltitype geometri
-00010ee0: 6573 0a20 2020 2020 2020 2067 666f 2e74  es.        gfo.t
-00010ef0: 6f5f 6669 6c65 280a 2020 2020 2020 2020  o_file(.        
-00010f00: 2020 2020 6469 7373 5f67 6466 2c0a 2020      diss_gdf,.  
-00010f10: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00010f20: 5f6e 6f74 6f6e 626f 7264 6572 5f70 6174  _notonborder_pat
-00010f30: 682c 0a20 2020 2020 2020 2020 2020 206c  h,.            l
-00010f40: 6179 6572 3d6f 7574 7075 745f 6c61 7965  ayer=output_laye
-00010f50: 722c 0a20 2020 2020 2020 2020 2020 2066  r,.            f
-00010f60: 6f72 6365 5f6d 756c 7469 7479 7065 3d54  orce_multitype=T
-00010f70: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00010f80: 2069 6e64 6578 3d46 616c 7365 2c0a 2020   index=False,.  
-00010f90: 2020 2020 2020 2020 2020 6372 6561 7465            create
-00010fa0: 5f73 7061 7469 616c 5f69 6e64 6578 3d46  _spatial_index=F
-00010fb0: 616c 7365 2c0a 2020 2020 2020 2020 290a  alse,.        ).
-00010fc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00010fd0: 2020 2320 4966 206e 6f74 2c20 7361 7665    # If not, save
-00010fe0: 2074 6865 2070 6f6c 7967 6f6e 7320 6f6e   the polygons on
-00010ff0: 2074 6865 2062 6f72 6465 7220 7365 7065   the border sepe
-00011000: 7261 7465 6c79 0a20 2020 2020 2020 2062  rately.        b
-00011010: 626f 785f 6c69 6e65 735f 6764 6620 3d20  box_lines_gdf = 
-00011020: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
-00011030: 280a 2020 2020 2020 2020 2020 2020 6765  (.            ge
-00011040: 6f6d 6574 7279 3d67 656f 7365 7269 6573  ometry=geoseries
-00011050: 5f75 7469 6c2e 706f 6c79 676f 6e73 5f74  _util.polygons_t
-00011060: 6f5f 6c69 6e65 7328 2020 2320 7479 7065  o_lines(  # type
-00011070: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-00011080: 2020 2020 2020 2020 2067 7064 2e47 656f           gpd.Geo
-00011090: 5365 7269 6573 285b 7368 5f67 656f 6d2e  Series([sh_geom.
-000110a0: 626f 7828 6262 6f78 5b30 5d2c 2062 626f  box(bbox[0], bbo
-000110b0: 785b 315d 2c20 6262 6f78 5b32 5d2c 2062  x[1], bbox[2], b
-000110c0: 626f 785b 335d 295d 290a 2020 2020 2020  box[3])]).      
-000110d0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-000110e0: 2020 2020 2063 7273 3d69 6e70 7574 5f67       crs=input_g
-000110f0: 6466 2e63 7273 2c20 2023 2074 7970 653a  df.crs,  # type:
-00011100: 2069 676e 6f72 650a 2020 2020 2020 2020   ignore.        
-00011110: 290a 2020 2020 2020 2020 6f6e 626f 7264  ).        onbord
-00011120: 6572 5f67 6466 203d 2067 7064 2e73 6a6f  er_gdf = gpd.sjo
-00011130: 696e 2864 6973 735f 6764 662c 2062 626f  in(diss_gdf, bbo
-00011140: 785f 6c69 6e65 735f 6764 662c 2070 7265  x_lines_gdf, pre
-00011150: 6469 6361 7465 3d22 696e 7465 7273 6563  dicate="intersec
-00011160: 7473 2229 0a20 2020 2020 2020 206f 6e62  ts").        onb
-00011170: 6f72 6465 725f 6764 662e 6472 6f70 2822  order_gdf.drop("
-00011180: 696e 6465 785f 7269 6768 7422 2c20 6178  index_right", ax
-00011190: 6973 3d31 2c20 696e 706c 6163 653d 5472  is=1, inplace=Tr
-000111a0: 7565 290a 2020 2020 2020 2020 6966 206c  ue).        if l
-000111b0: 656e 286f 6e62 6f72 6465 725f 6764 6629  en(onborder_gdf)
-000111c0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000111d0: 2020 2320 6173 7365 7274 2074 6f20 6576    # assert to ev
-000111e0: 6164 6520 7079 4c61 6e63 6520 7761 726e  ade pyLance warn
-000111f0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00011200: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-00011210: 6528 6f6e 626f 7264 6572 5f67 6466 2c20  e(onborder_gdf, 
-00011220: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
-00011230: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00011240: 5573 6520 666f 7263 655f 6d75 6c74 6974  Use force_multit
-00011250: 7970 652c 2074 6f20 6576 6164 6520 7761  ype, to evade wa
-00011260: 726e 696e 6773 2077 6865 6e20 736f 6d65  rnings when some
-00011270: 2062 6174 6368 6573 2063 6f6e 7461 696e   batches contain
-00011280: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00011290: 696e 676c 6574 7970 6520 616e 6420 736f  ingletype and so
-000112a0: 6d65 2063 6f6e 7461 696e 206d 756c 7469  me contain multi
-000112b0: 7479 7065 2067 656f 6d65 7472 6965 730a  type geometries.
-000112c0: 2020 2020 2020 2020 2020 2020 6766 6f2e              gfo.
-000112d0: 746f 5f66 696c 6528 0a20 2020 2020 2020  to_file(.       
-000112e0: 2020 2020 2020 2020 206f 6e62 6f72 6465           onborde
-000112f0: 725f 6764 662c 0a20 2020 2020 2020 2020  r_gdf,.         
-00011300: 2020 2020 2020 206f 7574 7075 745f 6f6e         output_on
-00011310: 626f 7264 6572 5f70 6174 682c 0a20 2020  border_path,.   
-00011320: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-00011330: 6572 3d6f 7574 7075 745f 6c61 7965 722c  er=output_layer,
-00011340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011350: 2066 6f72 6365 5f6d 756c 7469 7479 7065   force_multitype
-00011360: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00011370: 2020 2020 2020 2063 7265 6174 655f 7370         create_sp
-00011380: 6174 6961 6c5f 696e 6465 783d 4661 6c73  atial_index=Fals
-00011390: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-000113a0: 0a0a 2020 2020 2020 2020 6e6f 746f 6e62  ..        notonb
-000113b0: 6f72 6465 725f 6764 6620 3d20 6469 7373  order_gdf = diss
-000113c0: 5f67 6466 5b7e 6469 7373 5f67 6466 2e69  _gdf[~diss_gdf.i
-000113d0: 6e64 6578 2e69 7369 6e28 6f6e 626f 7264  ndex.isin(onbord
-000113e0: 6572 5f67 6466 2e69 6e64 6578 295d 0a20  er_gdf.index)]. 
-000113f0: 2020 2020 2020 2069 6620 6c65 6e28 6e6f         if len(no
-00011400: 746f 6e62 6f72 6465 725f 6764 6629 203e  tonborder_gdf) >
-00011410: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00011420: 2320 6173 7365 7274 2074 6f20 6576 6164  # assert to evad
-00011430: 6520 7079 4c61 6e63 6520 7761 726e 696e  e pyLance warnin
-00011440: 670a 2020 2020 2020 2020 2020 2020 6173  g.            as
-00011450: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-00011460: 6e6f 746f 6e62 6f72 6465 725f 6764 662c  notonborder_gdf,
-00011470: 2067 7064 2e47 656f 4461 7461 4672 616d   gpd.GeoDataFram
-00011480: 6529 0a20 2020 2020 2020 2020 2020 2023  e).            #
-00011490: 2055 7365 2066 6f72 6365 5f6d 756c 7469   Use force_multi
-000114a0: 7479 7065 2c20 746f 2065 7661 6465 2077  type, to evade w
-000114b0: 6172 6e69 6e67 7320 7768 656e 2073 6f6d  arnings when som
-000114c0: 6520 6261 7463 6865 7320 636f 6e74 6169  e batches contai
-000114d0: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
-000114e0: 7369 6e67 6c65 7479 7065 2061 6e64 2073  singletype and s
-000114f0: 6f6d 6520 636f 6e74 6169 6e20 6d75 6c74  ome contain mult
-00011500: 6974 7970 6520 6765 6f6d 6574 7269 6573  itype geometries
-00011510: 0a20 2020 2020 2020 2020 2020 2067 666f  .            gfo
-00011520: 2e74 6f5f 6669 6c65 280a 2020 2020 2020  .to_file(.      
-00011530: 2020 2020 2020 2020 2020 6e6f 746f 6e62            notonb
-00011540: 6f72 6465 725f 6764 662c 0a20 2020 2020  order_gdf,.     
-00011550: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00011560: 745f 6e6f 746f 6e62 6f72 6465 725f 7061  t_notonborder_pa
-00011570: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00011580: 2020 2020 6c61 7965 723d 6f75 7470 7574      layer=output
-00011590: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
-000115a0: 2020 2020 2020 2020 666f 7263 655f 6d75          force_mu
-000115b0: 6c74 6974 7970 653d 5472 7565 2c0a 2020  ltitype=True,.  
-000115c0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000115d0: 6465 783d 4661 6c73 652c 0a20 2020 2020  dex=False,.     
-000115e0: 2020 2020 2020 2020 2020 2063 7265 6174             creat
-000115f0: 655f 7370 6174 6961 6c5f 696e 6465 783d  e_spatial_index=
-00011600: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00011610: 2020 2029 0a20 2020 2070 6572 6669 6e66     ).    perfinf
-00011620: 6f5b 2274 696d 655f 746f 5f66 696c 6522  o["time_to_file"
-00011630: 5d20 3d20 2864 6174 6574 696d 652e 6e6f  ] = (datetime.no
-00011640: 7728 2920 2d20 7374 6172 745f 746f 5f66  w() - start_to_f
-00011650: 696c 6529 2e74 6f74 616c 5f73 6563 6f6e  ile).total_secon
-00011660: 6473 2829 0a0a 2020 2020 2320 4669 6e61  ds()..    # Fina
-00011670: 6c69 7365 2e2e 2e0a 2020 2020 6d65 7373  lise....    mess
-00011680: 6167 6520 3d20 6622 6469 7373 6f6c 7665  age = f"dissolve
-00011690: 2072 6561 6479 2069 6e20 7b64 6174 6574   ready in {datet
-000116a0: 696d 652e 6e6f 7728 292d 7374 6172 745f  ime.now()-start_
-000116b0: 7469 6d65 7d20 6f6e 207b 696e 7075 745f  time} on {input_
-000116c0: 7061 7468 7d21 220a 2020 2020 6c6f 6767  path}!".    logg
-000116d0: 6572 2e64 6562 7567 286d 6573 7361 6765  er.debug(message
-000116e0: 290a 0a20 2020 2023 2043 6f6c 6c65 6374  )..    # Collect
-000116f0: 2070 6572 6669 6e66 6f0a 2020 2020 746f   perfinfo.    to
-00011700: 7461 6c5f 7065 7266 5f74 696d 6520 3d20  tal_perf_time = 
-00011710: 300a 2020 2020 7065 7266 7374 7269 6e67  0.    perfstring
-00011720: 203d 2022 220a 2020 2020 666f 7220 7065   = "".    for pe
-00011730: 7266 636f 6465 2069 6e20 7065 7266 696e  rfcode in perfin
-00011740: 666f 3a0a 2020 2020 2020 2020 746f 7461  fo:.        tota
-00011750: 6c5f 7065 7266 5f74 696d 6520 2b3d 2070  l_perf_time += p
-00011760: 6572 6669 6e66 6f5b 7065 7266 636f 6465  erfinfo[perfcode
-00011770: 5d0a 2020 2020 2020 2020 7065 7266 7374  ].        perfst
-00011780: 7269 6e67 202b 3d20 6622 7b70 6572 6663  ring += f"{perfc
-00011790: 6f64 657d 3a20 7b70 6572 6669 6e66 6f5b  ode}: {perfinfo[
-000117a0: 7065 7266 636f 6465 5d3a 2e32 667d 2c20  perfcode]:.2f}, 
-000117b0: 220a 2020 2020 7265 7475 726e 5f69 6e66  ".    return_inf
-000117c0: 6f5b 2274 6f74 616c 5f74 696d 6522 5d20  o["total_time"] 
-000117d0: 3d20 2864 6174 6574 696d 652e 6e6f 7728  = (datetime.now(
-000117e0: 2920 2d20 7374 6172 745f 7469 6d65 292e  ) - start_time).
-000117f0: 746f 7461 6c5f 7365 636f 6e64 7328 290a  total_seconds().
-00011800: 2020 2020 7065 7266 696e 666f 5b22 756e      perfinfo["un
-00011810: 6163 636f 756e 7465 6422 5d20 3d20 7265  accounted"] = re
-00011820: 7475 726e 5f69 6e66 6f5b 2274 6f74 616c  turn_info["total
-00011830: 5f74 696d 6522 5d20 2d20 746f 7461 6c5f  _time"] - total_
-00011840: 7065 7266 5f74 696d 650a 2020 2020 7065  perf_time.    pe
-00011850: 7266 7374 7269 6e67 202b 3d20 6622 756e  rfstring += f"un
-00011860: 6163 636f 756e 7465 643a 207b 7065 7266  accounted: {perf
-00011870: 696e 666f 5b27 756e 6163 636f 756e 7465  info['unaccounte
-00011880: 6427 5d3a 2e32 667d 220a 0a20 2020 2023  d']:.2f}"..    #
-00011890: 2052 6574 7572 6e0a 2020 2020 7265 7475   Return.    retu
-000118a0: 726e 5f69 6e66 6f5b 2270 6572 6669 6e66  rn_info["perfinf
-000118b0: 6f22 5d20 3d20 7065 7266 696e 666f 0a20  o"] = perfinfo. 
-000118c0: 2020 2072 6574 7572 6e5f 696e 666f 5b22     return_info["
-000118d0: 7065 7266 7374 7269 6e67 225d 203d 2070  perfstring"] = p
-000118e0: 6572 6673 7472 696e 670a 2020 2020 7265  erfstring.    re
-000118f0: 7475 726e 5f69 6e66 6f5b 226d 6573 7361  turn_info["messa
-00011900: 6765 225d 203d 206d 6573 7361 6765 0a20  ge"] = message. 
-00011910: 2020 2072 6574 7572 6e20 7265 7475 726e     return return
-00011920: 5f69 6e66 6f0a 0a0a 6465 6620 5f64 6973  _info...def _dis
-00011930: 736f 6c76 6528 0a20 2020 2064 663a 2067  solve(.    df: g
-00011940: 7064 2e47 656f 4461 7461 4672 616d 652c  pd.GeoDataFrame,
-00011950: 0a20 2020 2062 793d 4e6f 6e65 2c0a 2020  .    by=None,.  
-00011960: 2020 6167 6766 756e 633a 204f 7074 696f    aggfunc: Optio
-00011970: 6e61 6c5b 556e 696f 6e5b 7374 722c 2064  nal[Union[str, d
-00011980: 6963 745d 5d20 3d20 2266 6972 7374 222c  ict]] = "first",
-00011990: 0a20 2020 2061 735f 696e 6465 783d 5472  .    as_index=Tr
-000119a0: 7565 2c0a 2020 2020 6c65 7665 6c3d 4e6f  ue,.    level=No
-000119b0: 6e65 2c0a 2020 2020 736f 7274 3d54 7275  ne,.    sort=Tru
-000119c0: 652c 0a20 2020 206f 6273 6572 7665 643d  e,.    observed=
-000119d0: 4661 6c73 652c 0a20 2020 2064 726f 706e  False,.    dropn
-000119e0: 613d 5472 7565 2c0a 2920 2d3e 2067 7064  a=True,.) -> gpd
-000119f0: 2e47 656f 4461 7461 4672 616d 653a 0a20  .GeoDataFrame:. 
-00011a00: 2020 2022 2222 0a20 2020 2044 6973 736f     """.    Disso
-00011a10: 6c76 6520 6765 6f6d 6574 7269 6573 2077  lve geometries w
-00011a20: 6974 6869 6e20 6067 726f 7570 6279 6020  ithin `groupby` 
-00011a30: 696e 746f 2073 696e 676c 6520 6f62 7365  into single obse
-00011a40: 7276 6174 696f 6e2e 0a20 2020 2054 6869  rvation..    Thi
-00011a50: 7320 6973 2061 6363 6f6d 706c 6973 6865  s is accomplishe
-00011a60: 6420 6279 2061 7070 6c79 696e 6720 7468  d by applying th
-00011a70: 6520 6075 6e61 7279 5f75 6e69 6f6e 6020  e `unary_union` 
-00011a80: 6d65 7468 6f64 0a20 2020 2074 6f20 616c  method.    to al
-00011a90: 6c20 6765 6f6d 6574 7269 6573 2077 6974  l geometries wit
-00011aa0: 6869 6e20 6120 6772 6f75 7073 656c 662e  hin a groupself.
-00011ab0: 0a20 2020 204f 6273 6572 7661 7469 6f6e  .    Observation
-00011ac0: 7320 6173 736f 6369 6174 6564 2077 6974  s associated wit
-00011ad0: 6820 6561 6368 2060 6772 6f75 7062 7960  h each `groupby`
-00011ae0: 2067 726f 7570 2077 696c 6c20 6265 2061   group will be a
-00011af0: 6767 7265 6761 7465 640a 2020 2020 7573  ggregated.    us
-00011b00: 696e 6720 7468 6520 6061 6767 6675 6e63  ing the `aggfunc
-00011b10: 602e 0a20 2020 2050 6172 616d 6574 6572  `..    Parameter
-00011b20: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00011b30: 0a20 2020 2062 7920 3a20 7374 7269 6e67  .    by : string
-00011b40: 2c20 6465 6661 756c 7420 4e6f 6e65 0a20  , default None. 
-00011b50: 2020 2020 2020 2043 6f6c 756d 6e20 7768         Column wh
-00011b60: 6f73 6520 7661 6c75 6573 2064 6566 696e  ose values defin
-00011b70: 6520 6772 6f75 7073 2074 6f20 6265 2064  e groups to be d
-00011b80: 6973 736f 6c76 6564 2e20 4966 204e 6f6e  issolved. If Non
-00011b90: 652c 0a20 2020 2020 2020 2077 686f 6c65  e,.        whole
-00011ba0: 2047 656f 4461 7461 4672 616d 6520 6973   GeoDataFrame is
-00011bb0: 2063 6f6e 7369 6465 7265 6420 6120 7369   considered a si
-00011bc0: 6e67 6c65 2067 726f 7570 2e0a 2020 2020  ngle group..    
-00011bd0: 6167 6766 756e 6320 3a20 6675 6e63 7469  aggfunc : functi
-00011be0: 6f6e 2c20 7374 7269 6e67 206f 7220 6469  on, string or di
-00011bf0: 6374 2c20 6465 6661 756c 7420 2266 6972  ct, default "fir
-00011c00: 7374 220a 2020 2020 2020 2020 4167 6772  st".        Aggr
-00011c10: 6567 6174 696f 6e20 6675 6e63 7469 6f6e  egation function
-00011c20: 2066 6f72 206d 616e 6970 756c 6174 696f   for manipulatio
-00011c30: 6e20 6f66 2064 6174 6120 6173 736f 6369  n of data associ
-00011c40: 6174 6564 0a20 2020 2020 2020 2077 6974  ated.        wit
-00011c50: 6820 6561 6368 2067 726f 7570 2e20 5061  h each group. Pa
-00011c60: 7373 6564 2074 6f20 7061 6e64 6173 2060  ssed to pandas `
-00011c70: 6772 6f75 7062 792e 6167 6760 206d 6574  groupby.agg` met
-00011c80: 686f 642e 0a20 2020 2061 735f 696e 6465  hod..    as_inde
-00011c90: 7820 3a20 626f 6f6c 6561 6e2c 2064 6566  x : boolean, def
-00011ca0: 6175 6c74 2054 7275 650a 2020 2020 2020  ault True.      
-00011cb0: 2020 4966 2074 7275 652c 2067 726f 7570    If true, group
-00011cc0: 6279 2063 6f6c 756d 6e73 2062 6563 6f6d  by columns becom
-00011cd0: 6520 696e 6465 7820 6f66 2072 6573 756c  e index of resul
-00011ce0: 742e 0a20 2020 206c 6576 656c 203a 2069  t..    level : i
-00011cf0: 6e74 206f 7220 7374 7220 6f72 2073 6571  nt or str or seq
-00011d00: 7565 6e63 6520 6f66 2069 6e74 206f 7220  uence of int or 
-00011d10: 7365 7175 656e 6365 206f 6620 7374 722c  sequence of str,
-00011d20: 2064 6566 6175 6c74 204e 6f6e 650a 2020   default None.  
-00011d30: 2020 2020 2020 4966 2074 6865 2061 7869        If the axi
-00011d40: 7320 6973 2061 204d 756c 7469 496e 6465  s is a MultiInde
-00011d50: 7820 2868 6965 7261 7263 6869 6361 6c29  x (hierarchical)
-00011d60: 2c20 6772 6f75 7020 6279 2061 0a20 2020  , group by a.   
-00011d70: 2020 2020 2070 6172 7469 6375 6c61 7220       particular 
-00011d80: 6c65 7665 6c20 6f72 206c 6576 656c 732e  level or levels.
-00011d90: 0a20 2020 2020 2020 202e 2e20 7665 7273  .        .. vers
-00011da0: 696f 6e61 6464 6564 3a3a 2030 2e39 2e30  ionadded:: 0.9.0
-00011db0: 0a20 2020 2073 6f72 7420 3a20 626f 6f6c  .    sort : bool
-00011dc0: 2c20 6465 6661 756c 7420 5472 7565 0a20  , default True. 
-00011dd0: 2020 2020 2020 2053 6f72 7420 6772 6f75         Sort grou
-00011de0: 7020 6b65 7973 2e20 4765 7420 6265 7474  p keys. Get bett
-00011df0: 6572 2070 6572 666f 726d 616e 6365 2062  er performance b
-00011e00: 7920 7475 726e 696e 6720 7468 6973 206f  y turning this o
-00011e10: 6666 2e0a 2020 2020 2020 2020 4e6f 7465  ff..        Note
-00011e20: 2074 6869 7320 646f 6573 206e 6f74 2069   this does not i
-00011e30: 6e66 6c75 656e 6365 2074 6865 206f 7264  nfluence the ord
-00011e40: 6572 206f 6620 6f62 7365 7276 6174 696f  er of observatio
-00011e50: 6e73 2077 6974 6869 6e0a 2020 2020 2020  ns within.      
-00011e60: 2020 6561 6368 2067 726f 7570 2e20 4772    each group. Gr
-00011e70: 6f75 7062 7920 7072 6573 6572 7665 7320  oupby preserves 
-00011e80: 7468 6520 6f72 6465 7220 6f66 2072 6f77  the order of row
-00011e90: 7320 7769 7468 696e 2065 6163 6820 6772  s within each gr
-00011ea0: 6f75 702e 0a20 2020 2020 2020 202e 2e20  oup..        .. 
-00011eb0: 7665 7273 696f 6e61 6464 6564 3a3a 2030  versionadded:: 0
-00011ec0: 2e39 2e30 0a20 2020 206f 6273 6572 7665  .9.0.    observe
-00011ed0: 6420 3a20 626f 6f6c 2c20 6465 6661 756c  d : bool, defaul
-00011ee0: 7420 4661 6c73 650a 2020 2020 2020 2020  t False.        
-00011ef0: 5468 6973 206f 6e6c 7920 6170 706c 6965  This only applie
-00011f00: 7320 6966 2061 6e79 206f 6620 7468 6520  s if any of the 
-00011f10: 6772 6f75 7065 7273 2061 7265 2043 6174  groupers are Cat
-00011f20: 6567 6f72 6963 616c 732e 0a20 2020 2020  egoricals..     
-00011f30: 2020 2049 6620 5472 7565 3a20 6f6e 6c79     If True: only
-00011f40: 2073 686f 7720 6f62 7365 7276 6564 2076   show observed v
-00011f50: 616c 7565 7320 666f 7220 6361 7465 676f  alues for catego
-00011f60: 7269 6361 6c20 6772 6f75 7065 7273 2e0a  rical groupers..
-00011f70: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00011f80: 3a20 7368 6f77 2061 6c6c 2076 616c 7565  : show all value
-00011f90: 7320 666f 7220 6361 7465 676f 7269 6361  s for categorica
-00011fa0: 6c20 6772 6f75 7065 7273 2e0a 2020 2020  l groupers..    
-00011fb0: 2020 2020 2e2e 2076 6572 7369 6f6e 6164      .. versionad
-00011fc0: 6465 643a 3a20 302e 392e 300a 2020 2020  ded:: 0.9.0.    
-00011fd0: 6472 6f70 6e61 203a 2062 6f6f 6c2c 2064  dropna : bool, d
-00011fe0: 6566 6175 6c74 2054 7275 650a 2020 2020  efault True.    
-00011ff0: 2020 2020 4966 2054 7275 652c 2061 6e64      If True, and
-00012000: 2069 6620 6772 6f75 7020 6b65 7973 2063   if group keys c
-00012010: 6f6e 7461 696e 204e 4120 7661 6c75 6573  ontain NA values
-00012020: 2c20 4e41 2076 616c 7565 730a 2020 2020  , NA values.    
-00012030: 2020 2020 746f 6765 7468 6572 2077 6974      together wit
-00012040: 6820 726f 772f 636f 6c75 6d6e 2077 696c  h row/column wil
-00012050: 6c20 6265 2064 726f 7070 6564 2e20 4966  l be dropped. If
-00012060: 2046 616c 7365 2c20 4e41 0a20 2020 2020   False, NA.     
-00012070: 2020 2076 616c 7565 7320 7769 6c6c 2061     values will a
-00012080: 6c73 6f20 6265 2074 7265 6174 6564 2061  lso be treated a
-00012090: 7320 7468 6520 6b65 7920 696e 2067 726f  s the key in gro
-000120a0: 7570 732e 0a20 2020 2020 2020 2054 6869  ups..        Thi
-000120b0: 7320 7061 7261 6d65 7465 7220 6973 206e  s parameter is n
-000120c0: 6f74 2073 7570 706f 7274 6564 2066 6f72  ot supported for
-000120d0: 2070 616e 6461 7320 3c20 312e 312e 302e   pandas < 1.1.0.
-000120e0: 0a20 2020 2020 2020 2041 2077 6172 6e69  .        A warni
-000120f0: 6e67 2077 696c 6c20 6265 2065 6d69 7474  ng will be emitt
-00012100: 6564 2066 6f72 2065 6172 6c69 6572 2070  ed for earlier p
-00012110: 616e 6461 7320 7665 7273 696f 6e73 0a20  andas versions. 
-00012120: 2020 2020 2020 2069 6620 6120 6e6f 6e2d         if a non-
-00012130: 6465 6661 756c 7420 7661 6c75 6520 6973  default value is
-00012140: 2067 6976 656e 2066 6f72 2074 6869 7320   given for this 
-00012150: 7061 7261 6d65 7465 722e 0a20 2020 2020  parameter..     
-00012160: 2020 202e 2e20 7665 7273 696f 6e61 6464     .. versionadd
-00012170: 6564 3a3a 2030 2e39 2e30 0a20 2020 2052  ed:: 0.9.0.    R
-00012180: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00012190: 2d2d 0a20 2020 2047 656f 4461 7461 4672  --.    GeoDataFr
-000121a0: 616d 650a 2020 2020 4578 616d 706c 6573  ame.    Examples
-000121b0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-000121c0: 2020 3e3e 3e20 6672 6f6d 2073 6861 7065    >>> from shape
-000121d0: 6c79 2e67 656f 6d65 7472 7920 696d 706f  ly.geometry impo
-000121e0: 7274 2050 6f69 6e74 0a20 2020 203e 3e3e  rt Point.    >>>
-000121f0: 2064 203d 207b 0a20 2020 202e 2e2e 2020   d = {.    ...  
-00012200: 2020 2022 636f 6c31 223a 205b 226e 616d     "col1": ["nam
-00012210: 6531 222c 2022 6e61 6d65 3222 2c20 226e  e1", "name2", "n
-00012220: 616d 6531 225d 2c0a 2020 2020 2e2e 2e20  ame1"],.    ... 
-00012230: 2020 2020 2267 656f 6d65 7472 7922 3a20      "geometry": 
-00012240: 5b50 6f69 6e74 2831 2c20 3229 2c20 506f  [Point(1, 2), Po
-00012250: 696e 7428 322c 2031 292c 2050 6f69 6e74  int(2, 1), Point
-00012260: 2830 2c20 3129 5d2c 0a20 2020 202e 2e2e  (0, 1)],.    ...
-00012270: 207d 0a20 2020 203e 3e3e 2067 6466 203d   }.    >>> gdf =
-00012280: 2067 656f 7061 6e64 6173 2e47 656f 4461   geopandas.GeoDa
-00012290: 7461 4672 616d 6528 642c 2063 7273 3d34  taFrame(d, crs=4
-000122a0: 3332 3629 0a20 2020 203e 3e3e 2067 6466  326).    >>> gdf
-000122b0: 0a20 2020 2020 2020 2063 6f6c 3120 2020  .        col1   
-000122c0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-000122d0: 6f6d 6574 7279 0a20 2020 2030 2020 6e61  ometry.    0  na
-000122e0: 6d65 3120 2050 4f49 4e54 2028 312e 3030  me1  POINT (1.00
-000122f0: 3030 3020 322e 3030 3030 3029 0a20 2020  000 2.00000).   
-00012300: 2031 2020 6e61 6d65 3220 2050 4f49 4e54   1  name2  POINT
-00012310: 2028 322e 3030 3030 3020 312e 3030 3030   (2.00000 1.0000
-00012320: 3029 0a20 2020 2032 2020 6e61 6d65 3120  0).    2  name1 
-00012330: 2050 4f49 4e54 2028 302e 3030 3030 3020   POINT (0.00000 
-00012340: 312e 3030 3030 3029 0a20 2020 203e 3e3e  1.00000).    >>>
-00012350: 2064 6973 736f 6c76 6564 203d 2067 6466   dissolved = gdf
-00012360: 2e64 6973 736f 6c76 6528 2763 6f6c 3127  .dissolve('col1'
-00012370: 290a 2020 2020 3e3e 3e20 6469 7373 6f6c  ).    >>> dissol
-00012380: 7665 6420 2023 2064 6f63 7465 7374 3a20  ved  # doctest: 
-00012390: 2b53 4b49 500a 2020 2020 2020 2020 2020  +SKIP.          
-000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123c0: 2020 2020 2020 6765 6f6d 6574 7279 0a20        geometry. 
-000123d0: 2020 2063 6f6c 310a 2020 2020 6e61 6d65     col1.    name
-000123e0: 3120 204d 554c 5449 504f 494e 5420 2830  1  MULTIPOINT (0
-000123f0: 2e30 3030 3030 2031 2e30 3030 3030 2c20  .00000 1.00000, 
-00012400: 312e 3030 3030 3020 322e 3030 3030 3029  1.00000 2.00000)
-00012410: 0a20 2020 206e 616d 6532 2020 2020 2020  .    name2      
-00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012430: 2020 504f 494e 5420 2832 2e30 3030 3030    POINT (2.00000
-00012440: 2031 2e30 3030 3030 290a 2020 2020 5365   1.00000).    Se
-00012450: 6520 616c 736f 0a20 2020 202d 2d2d 2d2d  e also.    -----
-00012460: 2d2d 2d0a 2020 2020 4765 6f44 6174 6146  ---.    GeoDataF
-00012470: 7261 6d65 2e65 7870 6c6f 6465 203a 2065  rame.explode : e
-00012480: 7870 6c6f 6465 206d 756c 7469 2d70 6172  xplode multi-par
-00012490: 7420 6765 6f6d 6574 7269 6573 2069 6e74  t geometries int
-000124a0: 6f20 7369 6e67 6c65 2067 656f 6d65 7472  o single geometr
-000124b0: 6965 730a 2020 2020 2222 220a 0a20 2020  ies.    """..   
-000124c0: 2069 6620 6279 2069 7320 4e6f 6e65 2061   if by is None a
-000124d0: 6e64 206c 6576 656c 2069 7320 4e6f 6e65  nd level is None
-000124e0: 3a0a 2020 2020 2020 2020 6279 5f6c 6f63  :.        by_loc
-000124f0: 616c 203d 206e 702e 7a65 726f 7328 6c65  al = np.zeros(le
-00012500: 6e28 6466 292c 2064 7479 7065 3d22 696e  n(df), dtype="in
-00012510: 7436 3422 290a 2020 2020 656c 7365 3a0a  t64").    else:.
-00012520: 2020 2020 2020 2020 6279 5f6c 6f63 616c          by_local
-00012530: 203d 2062 790a 0a20 2020 2067 726f 7570   = by..    group
-00012540: 6279 5f6b 7761 7267 7320 3d20 6469 6374  by_kwargs = dict
-00012550: 280a 2020 2020 2020 2020 6279 3d62 795f  (.        by=by_
-00012560: 6c6f 6361 6c2c 206c 6576 656c 3d6c 6576  local, level=lev
-00012570: 656c 2c20 736f 7274 3d73 6f72 742c 206f  el, sort=sort, o
-00012580: 6273 6572 7665 643d 6f62 7365 7276 6564  bserved=observed
-00012590: 2c20 6472 6f70 6e61 3d64 726f 706e 610a  , dropna=dropna.
-000125a0: 2020 2020 290a 2020 2020 2222 220a 2020      ).    """.  
-000125b0: 2020 6966 206e 6f74 2063 6f6d 7061 742e    if not compat.
-000125c0: 5041 4e44 4153 5f47 455f 3131 3a0a 2020  PANDAS_GE_11:.  
-000125d0: 2020 2020 2020 6772 6f75 7062 795f 6b77        groupby_kw
-000125e0: 6172 6773 2e70 6f70 2822 6472 6f70 6e61  args.pop("dropna
-000125f0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
-00012600: 6f74 2064 726f 706e 613a 2020 2320 4966  ot dropna:  # If
-00012610: 2074 6865 7920 7061 7373 6564 2061 206e   they passed a n
-00012620: 6f6e 2d64 6566 6175 6c74 2064 726f 706e  on-default dropn
-00012630: 6120 7661 6c75 650a 2020 2020 2020 2020  a value.        
-00012640: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-00012650: 6e28 2264 726f 706e 6120 6b77 6172 6720  n("dropna kwarg 
-00012660: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
-00012670: 2066 6f72 2070 616e 6461 7320 3c20 312e   for pandas < 1.
-00012680: 312e 3022 290a 2020 2020 2222 220a 0a20  1.0").    """.. 
-00012690: 2020 2023 2050 726f 6365 7373 206e 6f6e     # Process non
-000126a0: 2d73 7061 7469 616c 2063 6f6d 706f 6e65  -spatial compone
-000126b0: 6e74 0a20 2020 2064 6174 6120 3d20 7064  nt.    data = pd
-000126c0: 2e44 6174 6146 7261 6d65 2864 662e 6472  .DataFrame(df.dr
-000126d0: 6f70 2863 6f6c 756d 6e73 3d64 662e 6765  op(columns=df.ge
-000126e0: 6f6d 6574 7279 2e6e 616d 6529 290a 0a20  ometry.name)).. 
-000126f0: 2020 2069 6620 6167 6766 756e 6320 6973     if aggfunc is
-00012700: 206e 6f74 204e 6f6e 6520 616e 6420 6973   not None and is
-00012710: 696e 7374 616e 6365 2861 6767 6675 6e63  instance(aggfunc
-00012720: 2c20 6469 6374 2920 616e 6420 2274 6f5f  , dict) and "to_
-00012730: 6a73 6f6e 2220 696e 2061 6767 6675 6e63  json" in aggfunc
-00012740: 3a0a 2020 2020 2020 2020 6167 675f 636f  :.        agg_co
-00012750: 6c75 6d6e 7320 3d20 6c69 7374 2873 6574  lumns = list(set
-00012760: 2861 6767 6675 6e63 5b22 746f 5f6a 736f  (aggfunc["to_jso
-00012770: 6e22 5d29 290a 2020 2020 2020 2020 6167  n"])).        ag
-00012780: 6772 6567 6174 6564 5f64 6174 6120 3d20  gregated_data = 
-00012790: 280a 2020 2020 2020 2020 2020 2020 6461  (.            da
-000127a0: 7461 2e67 726f 7570 6279 282a 2a67 726f  ta.groupby(**gro
-000127b0: 7570 6279 5f6b 7761 7267 7329 0a20 2020  upby_kwargs).   
-000127c0: 2020 2020 2020 2020 202e 6170 706c 7928           .apply(
-000127d0: 6c61 6d62 6461 2067 3a20 675b 6167 675f  lambda g: g[agg_
-000127e0: 636f 6c75 6d6e 735d 2e74 6f5f 6a73 6f6e  columns].to_json
-000127f0: 286f 7269 656e 743d 2272 6563 6f72 6473  (orient="records
-00012800: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
-00012810: 2e74 6f5f 6672 616d 6528 6e61 6d65 3d22  .to_frame(name="
-00012820: 5f5f 4449 5353 4f4c 5645 5f54 4f4a 534f  __DISSOLVE_TOJSO
-00012830: 4e22 290a 2020 2020 2020 2020 290a 2020  N").        ).  
-00012840: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00012850: 6528 6167 6766 756e 632c 2073 7472 2920  e(aggfunc, str) 
-00012860: 616e 6420 6167 6766 756e 6320 3d3d 2022  and aggfunc == "
-00012870: 6d65 7267 655f 6a73 6f6e 5f6c 6973 7473  merge_json_lists
-00012880: 223a 0a20 2020 2020 2020 2023 204d 6572  ":.        # Mer
-00012890: 6765 2061 6e64 2066 6c61 7474 656e 2074  ge and flatten t
-000128a0: 6865 206a 736f 6e20 6c69 7374 7320 696e  he json lists in
-000128b0: 2074 6865 2067 726f 7570 730a 2020 2020   the groups.    
-000128c0: 2020 2020 6465 6620 6772 6f75 705f 666c      def group_fl
-000128d0: 6174 7465 6e5f 6a73 6f6e 5f6c 6973 7428  atten_json_list(
-000128e0: 6729 3a0a 2020 2020 2020 2020 2020 2020  g):.            
-000128f0: 2320 4576 616c 7561 7465 2061 6c6c 2067  # Evaluate all g
-00012900: 726f 7570 6564 2072 6f77 7320 746f 206a  rouped rows to j
-00012910: 736f 6e20 6f62 6a65 6374 732e 2054 6869  son objects. Thi
-00012920: 7320 7265 7375 6c74 7320 696e 2061 206c  s results in a l
-00012930: 6973 7420 6f66 0a20 2020 2020 2020 2020  ist of.         
-00012940: 2020 2023 206c 6973 7473 206f 6620 6a73     # lists of js
-00012950: 6f6e 206f 626a 6563 7473 2e0a 2020 2020  on objects..    
-00012960: 2020 2020 2020 2020 6a73 6f6e 5f6e 6573          json_nes
-00012970: 7465 645f 6c69 7374 7320 3d20 5b0a 2020  ted_lists = [.  
-00012980: 2020 2020 2020 2020 2020 2020 2020 6a73                js
-00012990: 6f6e 2e6c 6f61 6473 286a 736f 6e5f 7661  on.loads(json_va
-000129a0: 6c75 6573 2920 666f 7220 6a73 6f6e 5f76  lues) for json_v
-000129b0: 616c 7565 7320 696e 2067 5b22 5f5f 4449  alues in g["__DI
-000129c0: 5353 4f4c 5645 5f54 4f4a 534f 4e22 5d0a  SSOLVE_TOJSON"].
-000129d0: 2020 2020 2020 2020 2020 2020 5d0a 0a20              ].. 
-000129e0: 2020 2020 2020 2020 2020 2023 2045 7874             # Ext
-000129f0: 7261 6374 2074 6865 2072 6f77 7320 6672  ract the rows fr
-00012a00: 6f6d 2074 6865 206e 6573 7465 6420 6c69  om the nested li
-00012a10: 7374 7320 2b20 7075 7420 696e 2061 2066  sts + put in a f
-00012a20: 6c61 7420 6c69 7374 2061 7320 7374 7269  lat list as stri
-00012a30: 6e67 730a 2020 2020 2020 2020 2020 2020  ngs.            
-00012a40: 6a73 6f6e 7374 725f 666c 6174 203d 205b  jsonstr_flat = [
-00012a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a60: 206a 736f 6e2e 6475 6d70 7328 6a73 6f6e   json.dumps(json
-00012a70: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
-00012a80: 2020 2020 2020 2020 666f 7220 6a73 6f6e          for json
-00012a90: 5f76 616c 7565 7320 696e 206a 736f 6e5f  _values in json_
-00012aa0: 6e65 7374 6564 5f6c 6973 7473 0a20 2020  nested_lists.   
-00012ab0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00012ac0: 206a 736f 6e5f 7661 6c75 6520 696e 206a   json_value in j
-00012ad0: 736f 6e5f 7661 6c75 6573 0a20 2020 2020  son_values.     
-00012ae0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-00012af0: 2020 2020 2020 2320 5265 6d6f 7665 2064        # Remove d
-00012b00: 7570 6c69 6361 7465 730a 2020 2020 2020  uplicates.      
-00012b10: 2020 2020 2020 6a73 6f6e 7373 7472 5f64        jsonsstr_d
-00012b20: 6973 7469 6e63 7420 3d20 7365 7428 6a73  istinct = set(js
-00012b30: 6f6e 7374 725f 666c 6174 290a 0a20 2020  onstr_flat)..   
-00012b40: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
-00012b50: 7274 2074 6865 2064 6174 6120 6167 6169  rt the data agai
-00012b60: 6e20 746f 2061 206c 6973 7420 6f66 206a  n to a list of j
-00012b70: 736f 6e20 6f62 6a65 6374 730a 2020 2020  son objects.    
-00012b80: 2020 2020 2020 2020 6a73 6f6e 5f64 6973          json_dis
-00012b90: 7469 6e63 7420 3d20 5b6a 736f 6e2e 6c6f  tinct = [json.lo
-00012ba0: 6164 7328 6a73 6f6e 5f76 616c 7565 2920  ads(json_value) 
-00012bb0: 666f 7220 6a73 6f6e 5f76 616c 7565 2069  for json_value i
-00012bc0: 6e20 6a73 6f6e 7373 7472 5f64 6973 7469  n jsonsstr_disti
-00012bd0: 6e63 745d 0a0a 2020 2020 2020 2020 2020  nct]..          
-00012be0: 2020 2320 5265 7475 726e 2061 7320 6a73    # Return as js
-00012bf0: 6f6e 2073 7472 696e 670a 2020 2020 2020  on string.      
-00012c00: 2020 2020 2020 7265 7475 726e 206a 736f        return jso
-00012c10: 6e2e 6475 6d70 7328 6a73 6f6e 5f64 6973  n.dumps(json_dis
-00012c20: 7469 6e63 7429 0a0a 2020 2020 2020 2020  tinct)..        
-00012c30: 6167 6772 6567 6174 6564 5f64 6174 6120  aggregated_data 
-00012c40: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00012c50: 6461 7461 2e67 726f 7570 6279 282a 2a67  data.groupby(**g
-00012c60: 726f 7570 6279 5f6b 7761 7267 7329 0a20  roupby_kwargs). 
-00012c70: 2020 2020 2020 2020 2020 202e 6170 706c             .appl
-00012c80: 7928 6c61 6d62 6461 2067 3a20 6772 6f75  y(lambda g: grou
-00012c90: 705f 666c 6174 7465 6e5f 6a73 6f6e 5f6c  p_flatten_json_l
-00012ca0: 6973 7428 6729 290a 2020 2020 2020 2020  ist(g)).        
-00012cb0: 2020 2020 2e74 6f5f 6672 616d 6528 6e61      .to_frame(na
-00012cc0: 6d65 3d22 5f5f 4449 5353 4f4c 5645 5f54  me="__DISSOLVE_T
-00012cd0: 4f4a 534f 4e22 290a 2020 2020 2020 2020  OJSON").        
-00012ce0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00012cf0: 2020 2020 6167 6772 6567 6174 6564 5f64      aggregated_d
-00012d00: 6174 6120 3d20 6461 7461 2e67 726f 7570  ata = data.group
-00012d10: 6279 282a 2a67 726f 7570 6279 5f6b 7761  by(**groupby_kwa
-00012d20: 7267 7329 2e61 6767 2861 6767 6675 6e63  rgs).agg(aggfunc
-00012d30: 2920 2023 2074 7970 653a 2069 676e 6f72  )  # type: ignor
-00012d40: 650a 2020 2020 2020 2020 2320 4368 6563  e.        # Chec
-00012d50: 6b20 6966 2061 6c6c 2063 6f6c 756d 6e73  k if all columns
-00012d60: 2077 6572 6520 7072 6f70 6572 6c79 2061   were properly a
-00012d70: 6767 7265 6761 7465 640a 2020 2020 2020  ggregated.      
-00012d80: 2020 6173 7365 7274 2062 795f 6c6f 6361    assert by_loca
-00012d90: 6c20 6973 206e 6f74 204e 6f6e 650a 2020  l is not None.  
-00012da0: 2020 2020 2020 636f 6c75 6d6e 735f 746f        columns_to
-00012db0: 5f61 6767 203d 205b 636f 6c75 6d6e 2066  _agg = [column f
-00012dc0: 6f72 2063 6f6c 756d 6e20 696e 2064 6174  or column in dat
-00012dd0: 612e 636f 6c75 6d6e 7320 6966 2063 6f6c  a.columns if col
-00012de0: 756d 6e20 6e6f 7420 696e 2062 795f 6c6f  umn not in by_lo
-00012df0: 6361 6c5d 0a20 2020 2020 2020 2069 6620  cal].        if 
-00012e00: 6c65 6e28 636f 6c75 6d6e 735f 746f 5f61  len(columns_to_a
-00012e10: 6767 2920 213d 206c 656e 2861 6767 7265  gg) != len(aggre
-00012e20: 6761 7465 645f 6461 7461 2e63 6f6c 756d  gated_data.colum
-00012e30: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-00012e40: 2064 726f 7070 6564 5f63 6f6c 756d 6e73   dropped_columns
-00012e50: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00012e60: 2020 2020 2063 6f6c 756d 6e0a 2020 2020       column.    
-00012e70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00012e80: 636f 6c75 6d6e 2069 6e20 636f 6c75 6d6e  column in column
-00012e90: 735f 746f 5f61 6767 0a20 2020 2020 2020  s_to_agg.       
-00012ea0: 2020 2020 2020 2020 2069 6620 636f 6c75           if colu
-00012eb0: 6d6e 206e 6f74 2069 6e20 6167 6772 6567  mn not in aggreg
-00012ec0: 6174 6564 5f64 6174 612e 636f 6c75 6d6e  ated_data.column
-00012ed0: 730a 2020 2020 2020 2020 2020 2020 5d0a  s.            ].
-00012ee0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00012ef0: 6520 4578 6365 7074 696f 6e28 0a20 2020  e Exception(.   
-00012f00: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
-00012f10: 6f6c 756d 6e28 7329 207b 6472 6f70 7065  olumn(s) {droppe
-00012f20: 645f 636f 6c75 6d6e 737d 2061 7265 206e  d_columns} are n
-00012f30: 6f74 2073 7570 706f 7274 6564 2066 6f72  ot supported for
-00012f40: 2061 6767 7265 6761 7469 6f6e 2c20 7374   aggregation, st
-00012f50: 6f70 220a 2020 2020 2020 2020 2020 2020  op".            
-00012f60: 290a 0a20 2020 2023 2050 726f 6365 7373  )..    # Process
-00012f70: 2073 7061 7469 616c 2063 6f6d 706f 6e65   spatial compone
-00012f80: 6e74 0a20 2020 2064 6566 206d 6572 6765  nt.    def merge
-00012f90: 5f67 656f 6d65 7472 6965 7328 626c 6f63  _geometries(bloc
-00012fa0: 6b29 3a0a 2020 2020 2020 2020 6d65 7267  k):.        merg
-00012fb0: 6564 5f67 656f 6d20 3d20 626c 6f63 6b2e  ed_geom = block.
-00012fc0: 756e 6172 795f 756e 696f 6e0a 2020 2020  unary_union.    
-00012fd0: 2020 2020 7265 7475 726e 206d 6572 6765      return merge
-00012fe0: 645f 6765 6f6d 0a0a 2020 2020 6720 3d20  d_geom..    g = 
-00012ff0: 6466 2e67 726f 7570 6279 2867 726f 7570  df.groupby(group
-00013000: 5f6b 6579 733d 4661 6c73 652c 202a 2a67  _keys=False, **g
-00013010: 726f 7570 6279 5f6b 7761 7267 7329 5b64  roupby_kwargs)[d
-00013020: 662e 6765 6f6d 6574 7279 2e6e 616d 655d  f.geometry.name]
-00013030: 2e61 6767 280a 2020 2020 2020 2020 6d65  .agg(.        me
-00013040: 7267 655f 6765 6f6d 6574 7269 6573 0a20  rge_geometries. 
-00013050: 2020 2029 0a0a 2020 2020 2320 4167 6772     )..    # Aggr
-00013060: 6567 6174 650a 2020 2020 6167 6772 6567  egate.    aggreg
-00013070: 6174 6564 5f67 656f 6d65 7472 7920 3d20  ated_geometry = 
-00013080: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
-00013090: 280a 2020 2020 2020 2020 6461 7461 3d67  (.        data=g
-000130a0: 2c20 6765 6f6d 6574 7279 3d64 662e 6765  , geometry=df.ge
-000130b0: 6f6d 6574 7279 2e6e 616d 652c 2063 7273  ometry.name, crs
-000130c0: 3d64 662e 6372 7320 2023 2074 7970 653a  =df.crs  # type:
-000130d0: 2069 676e 6f72 650a 2020 2020 290a 2020   ignore.    ).  
-000130e0: 2020 2320 5265 636f 6d62 696e 650a 2020    # Recombine.  
-000130f0: 2020 6167 6772 6567 6174 6564 203d 2061    aggregated = a
-00013100: 6767 7265 6761 7465 645f 6765 6f6d 6574  ggregated_geomet
-00013110: 7279 2e6a 6f69 6e28 6167 6772 6567 6174  ry.join(aggregat
-00013120: 6564 5f64 6174 6129 0a0a 2020 2020 2320  ed_data)..    # 
-00013130: 5265 7365 7420 6966 2072 6571 7565 7374  Reset if request
-00013140: 6564 0a20 2020 2069 6620 6e6f 7420 6173  ed.    if not as
-00013150: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-00013160: 6167 6772 6567 6174 6564 203d 2061 6767  aggregated = agg
-00013170: 7265 6761 7465 642e 7265 7365 745f 696e  regated.reset_in
-00013180: 6465 7828 290a 0a20 2020 2023 204d 616b  dex()..    # Mak
-00013190: 6520 7375 7265 206f 7574 7075 7420 7479  e sure output ty
-000131a0: 7065 7320 6f66 2067 726f 7570 6564 2063  pes of grouped c
-000131b0: 6f6c 756d 6e73 2061 7265 2074 6865 2073  olumns are the s
-000131c0: 616d 6520 6173 2069 6e70 7574 2074 7970  ame as input typ
-000131d0: 6573 2e0a 2020 2020 2320 452e 672e 206f  es..    # E.g. o
-000131e0: 626a 6563 7420 636f 6c75 6d6e 7320 6265  bject columns be
-000131f0: 636f 6d65 2066 6c6f 6174 2069 6620 616c  come float if al
-00013200: 6c20 7661 6c75 6573 2061 7265 204e 6f6e  l values are Non
-00013210: 652e 0a20 2020 2069 6620 6279 2069 7320  e..    if by is 
-00013220: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00013230: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00013240: 6279 2c20 7374 7229 3a0a 2020 2020 2020  by, str):.      
-00013250: 2020 2020 2020 6966 2062 7920 696e 2061        if by in a
-00013260: 6767 7265 6761 7465 642e 636f 6c75 6d6e  ggregated.column
-00013270: 7320 616e 6420 6466 5b62 795d 2e64 7479  s and df[by].dty
-00013280: 7065 2021 3d20 6167 6772 6567 6174 6564  pe != aggregated
-00013290: 5b62 795d 2e64 7479 7065 3a0a 2020 2020  [by].dtype:.    
-000132a0: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
-000132b0: 6567 6174 6564 5b62 795d 203d 2061 6767  egated[by] = agg
-000132c0: 7265 6761 7465 645b 6279 5d2e 6173 7479  regated[by].asty
-000132d0: 7065 2864 665b 6279 5d2e 6474 7970 6529  pe(df[by].dtype)
-000132e0: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-000132f0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-00013300: 696e 7374 616e 6365 2862 792c 2049 7465  instance(by, Ite
-00013310: 7261 626c 6529 3a0a 2020 2020 2020 2020  rable):.        
-00013320: 2020 2020 666f 7220 636f 6c20 696e 2062      for col in b
-00013330: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00013340: 2020 2069 6620 636f 6c20 696e 2061 6767     if col in agg
-00013350: 7265 6761 7465 642e 636f 6c75 6d6e 7320  regated.columns 
-00013360: 616e 6420 6466 5b63 6f6c 5d2e 6474 7970  and df[col].dtyp
-00013370: 6520 213d 2061 6767 7265 6761 7465 645b  e != aggregated[
-00013380: 636f 6c5d 2e64 7479 7065 3a0a 2020 2020  col].dtype:.    
-00013390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133a0: 6167 6772 6567 6174 6564 5b63 6f6c 5d20  aggregated[col] 
-000133b0: 3d20 6167 6772 6567 6174 6564 5b63 6f6c  = aggregated[col
-000133c0: 5d2e 6173 7479 7065 2864 665b 636f 6c5d  ].astype(df[col]
-000133d0: 2e64 7479 7065 290a 0a20 2020 2061 7373  .dtype)..    ass
-000133e0: 6572 7420 6973 696e 7374 616e 6365 2861  ert isinstance(a
-000133f0: 6767 7265 6761 7465 642c 2067 7064 2e47  ggregated, gpd.G
-00013400: 656f 4461 7461 4672 616d 6529 0a20 2020  eoDataFrame).   
-00013410: 2072 6574 7572 6e20 6167 6772 6567 6174   return aggregat
-00013420: 6564 0a0a 0a64 6566 205f 6164 645f 6f72  ed...def _add_or
-00013430: 6465 7262 795f 636f 6c75 6d6e 2870 6174  derby_column(pat
-00013440: 683a 2050 6174 682c 206c 6179 6572 3a20  h: Path, layer: 
-00013450: 7374 722c 206e 616d 653a 2073 7472 293a  str, name: str):
-00013460: 0a20 2020 2023 2050 7265 7061 7265 2074  .    # Prepare t
-00013470: 6865 2065 7870 7265 7373 696f 6e20 746f  he expression to
-00013480: 2063 616c 6375 6c61 7465 2074 6865 206f   calculate the o
-00013490: 7264 6572 6279 2063 6f6c 756d 6e2e 0a20  rderby column.. 
-000134a0: 2020 2023 2049 6e20 6120 7370 6174 6961     # In a spatia
-000134b0: 6c20 6669 6c65 2c20 6120 7370 6174 6961  l file, a spatia
-000134c0: 6c20 6f72 6465 7220 7769 6c6c 206d 616b  l order will mak
-000134d0: 6520 6c61 7465 7220 7573 6520 6d6f 7265  e later use more
-000134e0: 2065 6666 6963 69c3 ab6e 742c 0a20 2020   effici..nt,.   
-000134f0: 2023 2073 6f20 7573 6520 6120 6765 6f68   # so use a geoh
-00013500: 6173 682e 0a20 2020 206c 6179 6572 696e  ash..    layerin
-00013510: 666f 203d 2067 666f 2e67 6574 5f6c 6179  fo = gfo.get_lay
-00013520: 6572 696e 666f 2870 6174 6829 0a20 2020  erinfo(path).   
-00013530: 2069 6620 6c61 7965 7269 6e66 6f2e 6372   if layerinfo.cr
-00013540: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
-00013550: 6420 6c61 7965 7269 6e66 6f2e 6372 732e  d layerinfo.crs.
-00013560: 6973 5f67 656f 6772 6170 6869 633a 0a20  is_geographic:. 
-00013570: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00013580: 636f 6f72 6469 6e61 7465 7320 6172 6520  coordinates are 
-00013590: 6765 6f67 7261 7068 6963 2028 696e 206c  geographic (in l
-000135a0: 6174 2f6c 6f6e 2064 6567 7265 6573 292c  at/lon degrees),
-000135b0: 206f 6b0a 2020 2020 2020 2020 6578 7072   ok.        expr
-000135c0: 6573 7369 6f6e 203d 2066 2253 545f 4765  ession = f"ST_Ge
-000135d0: 6f48 6173 6828 7b6c 6179 6572 696e 666f  oHash({layerinfo
-000135e0: 2e67 656f 6d65 7472 7963 6f6c 756d 6e7d  .geometrycolumn}
-000135f0: 2c20 3130 2922 0a20 2020 2065 6c73 653a  , 10)".    else:
-00013600: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-00013610: 6579 2061 7265 206e 6f74 2067 656f 6772  ey are not geogr
-00013620: 6170 6869 6320 2869 6e20 6c61 742f 6c6f  aphic (in lat/lo
-00013630: 6e20 6465 6772 6565 7329 2c20 7468 6579  n degrees), they
-00013640: 206e 6565 6420 746f 2062 650a 2020 2020   need to be.    
-00013650: 2020 2020 2320 636f 6e76 6572 7465 6420      # converted 
-00013660: 746f 207e 2064 6567 7265 6573 2074 6f20  to ~ degrees to 
-00013670: 6265 2061 626c 6520 746f 2063 616c 6375  be able to calcu
-00013680: 6c61 7465 2061 2067 656f 6861 7368 2e0a  late a geohash..
-00013690: 0a20 2020 2020 2020 2023 2050 726f 7065  .        # Prope
-000136a0: 726c 7920 6361 6c63 756c 6174 696e 6720  rly calculating 
-000136b0: 7468 6520 7472 616e 7366 6f72 6d61 7469  the transformati
-000136c0: 6f6e 2074 6f20 6567 2e20 5747 5320 6973  on to eg. WGS is
-000136d0: 2074 6572 7269 626c 7920 736c 6f77 2e2e   terribly slow..
-000136e0: 2e0a 2020 2020 2020 2020 2320 6578 7072  ..        # expr
-000136f0: 6573 7369 6f6e 203d 2066 2222 2253 545f  ession = f"""ST_
-00013700: 4765 6f48 6173 6828 5354 5f54 7261 6e73  GeoHash(ST_Trans
-00013710: 666f 726d 284d 616b 6550 6f69 6e74 280a  form(MakePoint(.
-00013720: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00013730: 284d 6272 4d61 7858 2867 656f 6d29 2b4d  (MbrMaxX(geom)+M
-00013740: 6272 4d69 6e58 2867 656f 6d29 292f 322c  brMinX(geom))/2,
-00013750: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00013760: 2028 4d62 724d 696e 5928 6765 6f6d 292b   (MbrMinY(geom)+
-00013770: 4d62 724d 6178 5928 6765 6f6d 2929 2f32  MbrMaxY(geom))/2
-00013780: 2c20 5354 5f53 5249 4428 6765 6f6d 2929  , ST_SRID(geom))
-00013790: 2c20 3433 3236 292c 2031 3029 2222 220a  , 4326), 10)""".
-000137a0: 2020 2020 2020 2020 2320 536f 2c20 646f          # So, do
-000137b0: 2073 6f6d 6574 6869 6e67 2065 6c73 6520   something else 
-000137c0: 7468 6174 2773 2066 6173 7465 7220 616e  that's faster an
-000137d0: 6420 7374 696c 6c20 6769 7665 7320 6120  d still gives a 
-000137e0: 676f 6f64 0a20 2020 2020 2020 2023 2067  good.        # g
-000137f0: 656f 6772 6170 6869 6320 636c 7573 7465  eographic cluste
-00013800: 7269 6e67 2e0a 2020 2020 2020 2020 746f  ring..        to
-00013810: 5f67 656f 6772 6170 6869 635f 6661 6374  _geographic_fact
-00013820: 6f72 5f61 7070 726f 7820 3d20 3930 202f  or_approx = 90 /
-00013830: 206d 6178 286c 6179 6572 696e 666f 2e74   max(layerinfo.t
-00013840: 6f74 616c 5f62 6f75 6e64 7329 0a20 2020  otal_bounds).   
-00013850: 2020 2020 2065 7870 7265 7373 696f 6e20       expression 
-00013860: 3d20 6622 2222 5354 5f47 656f 4861 7368  = f"""ST_GeoHash
-00013870: 284d 616b 6550 6f69 6e74 280a 2020 2020  (MakePoint(.    
-00013880: 2020 2020 2020 2020 2020 2020 2828 4d62              ((Mb
-00013890: 724d 6178 5828 7b6c 6179 6572 696e 666f  rMaxX({layerinfo
-000138a0: 2e67 656f 6d65 7472 7963 6f6c 756d 6e7d  .geometrycolumn}
-000138b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000138c0: 2020 2020 2b4d 6272 4d69 6e58 287b 6c61      +MbrMinX({la
-000138d0: 7965 7269 6e66 6f2e 6765 6f6d 6574 7279  yerinfo.geometry
-000138e0: 636f 6c75 6d6e 7d29 292f 320a 2020 2020  column}))/2.    
-000138f0: 2020 2020 2020 2020 2020 2020 292a 7b74              )*{t
-00013900: 6f5f 6765 6f67 7261 7068 6963 5f66 6163  o_geographic_fac
-00013910: 746f 725f 6170 7072 6f78 7d2c 0a20 2020  tor_approx},.   
-00013920: 2020 2020 2020 2020 2020 2020 2028 284d               ((M
-00013930: 6272 4d69 6e59 287b 6c61 7965 7269 6e66  brMinY({layerinf
-00013940: 6f2e 6765 6f6d 6574 7279 636f 6c75 6d6e  o.geometrycolumn
-00013950: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00013960: 2020 2020 202b 4d62 724d 6178 5928 7b6c       +MbrMaxY({l
-00013970: 6179 6572 696e 666f 2e67 656f 6d65 7472  ayerinfo.geometr
-00013980: 7963 6f6c 756d 6e7d 2929 2f32 0a20 2020  ycolumn}))/2.   
-00013990: 2020 2020 2020 2020 2020 2020 2029 2a7b               )*{
-000139a0: 746f 5f67 656f 6772 6170 6869 635f 6661  to_geographic_fa
-000139b0: 6374 6f72 5f61 7070 726f 787d 2c20 3433  ctor_approx}, 43
-000139c0: 3236 292c 2031 3029 2222 220a 0a20 2020  26), 10)"""..   
-000139d0: 2023 204e 6f77 2077 6520 6361 6e20 6163   # Now we can ac
-000139e0: 7475 616c 6c79 2061 6464 2074 6865 2063  tually add the c
-000139f0: 6f6c 756d 6e2e 0a20 2020 2067 666f 2e61  olumn..    gfo.a
-00013a00: 6464 5f63 6f6c 756d 6e28 7061 7468 3d70  dd_column(path=p
-00013a10: 6174 682c 206e 616d 653d 6e61 6d65 2c20  ath, name=name, 
-00013a20: 7479 7065 3d67 666f 2e44 6174 6154 7970  type=gfo.DataTyp
-00013a30: 652e 5445 5854 2c20 6578 7072 6573 7369  e.TEXT, expressi
-00013a40: 6f6e 3d65 7870 7265 7373 696f 6e29 0a20  on=expression). 
-00013a50: 2020 2073 716c 6974 655f 7374 6d74 203d     sqlite_stmt =
-00013a60: 2066 2743 5245 4154 4520 494e 4445 5820   f'CREATE INDEX 
-00013a70: 7b6e 616d 657d 5f69 6478 204f 4e20 227b  {name}_idx ON "{
-00013a80: 6c61 7965 727d 2228 7b6e 616d 657d 2927  layer}"({name})'
-00013a90: 0a20 2020 2067 666f 2e65 7865 6375 7465  .    gfo.execute
-00013aa0: 5f73 716c 2870 6174 683d 7061 7468 2c20  _sql(path=path, 
-00013ab0: 7371 6c5f 7374 6d74 3d73 716c 6974 655f  sql_stmt=sqlite_
-00013ac0: 7374 6d74 290a                           stmt).
+0000fa70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000fa80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000fa90: 4578 6365 7074 696f 6e28 2272 6574 7269  Exception("retri
+0000faa0: 6564 2031 3020 7469 6d65 732c 2064 6174  ed 10 times, dat
+0000fab0: 6162 6173 6520 7374 696c 6c20 6c6f 636b  abase still lock
+0000fac0: 6564 2229 2066 726f 6d20 6578 0a20 2020  ed") from ex.   
+0000fad0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fae0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000faf0: 6169 7365 2065 780a 0a20 2020 2023 2043  aise ex..    # C
+0000fb00: 6865 636b 2072 6573 756c 740a 2020 2020  heck result.    
+0000fb10: 7065 7266 696e 666f 5b22 7469 6d65 5f72  perfinfo["time_r
+0000fb20: 6561 6422 5d20 3d20 2864 6174 6574 696d  ead"] = (datetim
+0000fb30: 652e 6e6f 7728 2920 2d20 7374 6172 745f  e.now() - start_
+0000fb40: 7265 6164 292e 746f 7461 6c5f 7365 636f  read).total_seco
+0000fb50: 6e64 7328 290a 2020 2020 7265 7475 726e  nds().    return
+0000fb60: 5f69 6e66 6f5b 226e 625f 726f 7773 5f64  _info["nb_rows_d
+0000fb70: 6f6e 6522 5d20 3d20 6c65 6e28 696e 7075  one"] = len(inpu
+0000fb80: 745f 6764 6629 0a20 2020 2069 6620 7265  t_gdf).    if re
+0000fb90: 7475 726e 5f69 6e66 6f5b 226e 625f 726f  turn_info["nb_ro
+0000fba0: 7773 5f64 6f6e 6522 5d20 3d3d 2030 3a0a  ws_done"] == 0:.
+0000fbb0: 2020 2020 2020 2020 6d65 7373 6167 6520          message 
+0000fbc0: 3d20 6622 4e6f 2069 6e70 7574 2067 656f  = f"No input geo
+0000fbd0: 6d65 7472 6965 7320 666f 756e 6420 696e  metries found in
+0000fbe0: 207b 696e 7075 745f 7061 7468 7d22 0a20   {input_path}". 
+0000fbf0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+0000fc00: 666f 286d 6573 7361 6765 290a 2020 2020  fo(message).    
+0000fc10: 2020 2020 7265 7475 726e 5f69 6e66 6f5b      return_info[
+0000fc20: 226d 6573 7361 6765 225d 203d 206d 6573  "message"] = mes
+0000fc30: 7361 6765 0a20 2020 2020 2020 2072 6574  sage.        ret
+0000fc40: 7572 6e5f 696e 666f 5b22 746f 7461 6c5f  urn_info["total_
+0000fc50: 7469 6d65 225d 203d 2028 6461 7465 7469  time"] = (dateti
+0000fc60: 6d65 2e6e 6f77 2829 202d 2073 7461 7274  me.now() - start
+0000fc70: 5f74 696d 6529 2e74 6f74 616c 5f73 6563  _time).total_sec
+0000fc80: 6f6e 6473 2829 0a20 2020 2020 2020 2072  onds().        r
+0000fc90: 6574 7572 6e20 7265 7475 726e 5f69 6e66  eturn return_inf
+0000fca0: 6f0a 0a20 2020 2023 204e 6f77 2074 6865  o..    # Now the
+0000fcb0: 2072 6561 6c20 7072 6f63 6573 7369 6e67   real processing
+0000fcc0: 0a20 2020 2069 6620 6167 675f 636f 6c75  .    if agg_colu
+0000fcd0: 6d6e 7320 6973 206e 6f74 204e 6f6e 653a  mns is not None:
+0000fce0: 0a20 2020 2020 2020 2069 6620 225f 5f44  .        if "__D
+0000fcf0: 4953 534f 4c56 455f 544f 4a53 4f4e 2220  ISSOLVE_TOJSON" 
+0000fd00: 6e6f 7420 696e 2069 6e70 7574 5f67 6466  not in input_gdf
+0000fd10: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
+0000fd20: 2020 2020 2020 2320 4669 7273 7420 7061        # First pa
+0000fd30: 7373 202d 3e20 7075 7420 7265 6c65 7661  ss -> put releva
+0000fd40: 6e74 2063 6f6c 756d 6e73 2069 6e20 6a73  nt columns in js
+0000fd50: 6f6e 2066 6965 6c64 0a20 2020 2020 2020  on field.       
+0000fd60: 2020 2020 2061 6767 6675 6e63 203d 207b       aggfunc = {
+0000fd70: 2274 6f5f 6a73 6f6e 223a 2061 6767 5f63  "to_json": agg_c
+0000fd80: 6f6c 756d 6e73 5f6e 6565 6465 647d 0a20  olumns_needed}. 
+0000fd90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fda0: 2020 2020 2020 2020 2023 2043 6f6c 756d           # Colum
+0000fdb0: 6e73 2061 6c72 6561 6479 2063 6f64 6564  ns already coded
+0000fdc0: 2069 6e20 6120 6a73 6f6e 2063 6f6c 756d   in a json colum
+0000fdd0: 6e2c 2073 6f20 6d65 7267 6520 6a73 6f6e  n, so merge json
+0000fde0: 206c 6973 7473 0a20 2020 2020 2020 2020   lists.         
+0000fdf0: 2020 2061 6767 6675 6e63 203d 2022 6d65     aggfunc = "me
+0000fe00: 7267 655f 6a73 6f6e 5f6c 6973 7473 220a  rge_json_lists".
+0000fe10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000fe20: 2020 6167 6766 756e 6320 3d20 2266 6972    aggfunc = "fir
+0000fe30: 7374 220a 2020 2020 7374 6172 745f 6469  st".    start_di
+0000fe40: 7373 6f6c 7665 203d 2064 6174 6574 696d  ssolve = datetim
+0000fe50: 652e 6e6f 7728 290a 2020 2020 6469 7373  e.now().    diss
+0000fe60: 5f67 6466 203d 205f 6469 7373 6f6c 7665  _gdf = _dissolve
+0000fe70: 280a 2020 2020 2020 2020 6466 3d69 6e70  (.        df=inp
+0000fe80: 7574 5f67 6466 2c20 6279 3d67 726f 7570  ut_gdf, by=group
+0000fe90: 6279 5f63 6f6c 756d 6e73 2c20 6167 6766  by_columns, aggf
+0000fea0: 756e 633d 6167 6766 756e 632c 2061 735f  unc=aggfunc, as_
+0000feb0: 696e 6465 783d 4661 6c73 652c 2064 726f  index=False, dro
+0000fec0: 706e 613d 4661 6c73 650a 2020 2020 290a  pna=False.    ).
+0000fed0: 2020 2020 7065 7266 696e 666f 5b22 7469      perfinfo["ti
+0000fee0: 6d65 5f64 6973 736f 6c76 6522 5d20 3d20  me_dissolve"] = 
+0000fef0: 2864 6174 6574 696d 652e 6e6f 7728 2920  (datetime.now() 
+0000ff00: 2d20 7374 6172 745f 6469 7373 6f6c 7665  - start_dissolve
+0000ff10: 292e 746f 7461 6c5f 7365 636f 6e64 7328  ).total_seconds(
+0000ff20: 290a 0a20 2020 2023 2049 6620 6578 706c  )..    # If expl
+0000ff30: 6f64 6563 6f6c 6c65 6374 696f 6e73 2069  odecollections i
+0000ff40: 7320 5472 7565 2061 6e64 2046 6f72 2070  s True and For p
+0000ff50: 6f6c 7967 6f6e 732c 2065 7870 6c6f 6465  olygons, explode
+0000ff60: 206d 756c 7469 2d67 656f 6d65 7472 6965   multi-geometrie
+0000ff70: 732e 0a20 2020 2023 2049 6620 6e65 6564  s..    # If need
+0000ff80: 6564 2074 6865 7920 7769 6c6c 2062 6520  ed they will be 
+0000ff90: 2763 6f6c 6c65 6374 6564 2720 6166 7465  'collected' afte
+0000ffa0: 7277 6172 6473 2074 6f20 6d75 6c74 6970  rwards to multip
+0000ffb0: 6f6c 7967 6f6e 7320 6167 6169 6e2e 0a20  olygons again.. 
+0000ffc0: 2020 2069 6620 6578 706c 6f64 6563 6f6c     if explodecol
+0000ffd0: 6c65 6374 696f 6e73 2069 7320 5472 7565  lections is True
+0000ffe0: 206f 7220 696e 7075 745f 6765 6f6d 6574   or input_geomet
+0000fff0: 7279 7479 7065 2069 6e20 5b0a 2020 2020  rytype in [.    
+00010000: 2020 2020 4765 6f6d 6574 7279 5479 7065      GeometryType
+00010010: 2e50 4f4c 5947 4f4e 2c0a 2020 2020 2020  .POLYGON,.      
+00010020: 2020 4765 6f6d 6574 7279 5479 7065 2e4d    GeometryType.M
+00010030: 554c 5449 504f 4c59 474f 4e2c 0a20 2020  ULTIPOLYGON,.   
+00010040: 205d 3a0a 2020 2020 2020 2020 2320 6173   ]:.        # as
+00010050: 7365 7274 2074 6f20 6576 6164 6520 7079  sert to evade py
+00010060: 4c61 6e63 6520 7761 726e 696e 670a 2020  Lance warning.  
+00010070: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+00010080: 6e73 7461 6e63 6528 6469 7373 5f67 6466  nstance(diss_gdf
+00010090: 2c20 6770 642e 4765 6f44 6174 6146 7261  , gpd.GeoDataFra
+000100a0: 6d65 290a 2020 2020 2020 2020 6469 7373  me).        diss
+000100b0: 5f67 6466 203d 2064 6973 735f 6764 662e  _gdf = diss_gdf.
+000100c0: 6578 706c 6f64 6528 6967 6e6f 7265 5f69  explode(ignore_i
+000100d0: 6e64 6578 3d54 7275 6529 0a0a 2020 2020  ndex=True)..    
+000100e0: 2320 436c 6970 2074 6865 2072 6573 756c  # Clip the resul
+000100f0: 7420 6f6e 2074 6865 2062 6f72 6465 7273  t on the borders
+00010100: 206f 6620 7468 6520 6262 6f78 206e 6f74   of the bbox not
+00010110: 2074 6f20 6861 7665 206f 7665 726c 6170   to have overlap
+00010120: 730a 2020 2020 2320 6265 7477 6565 6e20  s.    # between 
+00010130: 7468 6520 6469 6666 6572 656e 7420 7469  the different ti
+00010140: 6c65 732e 0a20 2020 2023 2049 6620 7468  les..    # If th
+00010150: 6973 2069 7320 6e6f 7420 6170 706c 6965  is is not applie
+00010160: 642c 2074 6869 7320 7265 7375 6c74 7320  d, this results 
+00010170: 696e 2073 6f6d 6520 6765 6f6d 6574 7269  in some geometri
+00010180: 6573 206e 6f74 2062 6569 6e67 206d 6572  es not being mer
+00010190: 6765 640a 2020 2020 2320 6f72 2069 6e20  ged.    # or in 
+000101a0: 6475 706c 6963 6174 6573 2e0a 2020 2020  duplicates..    
+000101b0: 2320 5245 4d41 524b 3a20 666f 7220 286d  # REMARK: for (m
+000101c0: 756c 7469 296c 696e 6573 7472 696e 6773  ulti)linestrings
+000101d0: 2c20 7468 6520 656e 6470 6f69 6e74 7320  , the endpoints 
+000101e0: 6372 6561 7465 6420 6279 2074 6865 2063  created by the c
+000101f0: 6c69 7020 6172 6520 6e6f 740a 2020 2020  lip are not.    
+00010200: 2320 616c 7761 7973 2074 6865 2073 616d  # always the sam
+00010210: 6520 6475 6520 746f 2072 6f75 6e64 696e  e due to roundin
+00010220: 672c 2073 6f20 6469 7373 6f6c 7669 6e67  g, so dissolving
+00010230: 2069 6e20 6120 6e65 7874 2070 6173 7320   in a next pass 
+00010240: 646f 6573 6e27 740a 2020 2020 2320 616c  doesn't.    # al
+00010250: 7761 7973 2072 6573 756c 7420 696e 206c  ways result in l
+00010260: 696e 6573 7472 696e 6773 2062 6569 6e67  inestrings being
+00010270: 2072 652d 636f 6e6e 6563 7465 642e 2e2e   re-connected...
+00010280: 2042 6563 6175 7365 2064 6973 736f 6c76   Because dissolv
+00010290: 696e 670a 2020 2020 2320 6c69 6e65 7320  ing.    # lines 
+000102a0: 6973 6e27 7420 736f 2063 6f6d 7075 7461  isn't so computa
+000102b0: 7469 6f6e 616c 6c79 2068 6561 7679 2061  tionally heavy a
+000102c0: 6e79 7761 792c 2064 726f 7020 7375 7070  nyway, drop supp
+000102d0: 6f72 7420 6865 7265 2e0a 2020 2020 6966  ort here..    if
+000102e0: 2062 626f 7820 6973 206e 6f74 204e 6f6e   bbox is not Non
+000102f0: 653a 0a20 2020 2020 2020 2073 7461 7274  e:.        start
+00010300: 5f63 6c69 7020 3d20 6461 7465 7469 6d65  _clip = datetime
+00010310: 2e6e 6f77 2829 0a20 2020 2020 2020 2062  .now().        b
+00010320: 626f 785f 706f 6c79 676f 6e20 3d20 7368  box_polygon = sh
+00010330: 5f67 656f 6d2e 506f 6c79 676f 6e28 0a20  _geom.Polygon(. 
+00010340: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
+00010350: 2020 2020 2020 2020 2020 2020 2028 6262               (bb
+00010360: 6f78 5b30 5d2c 2062 626f 785b 315d 292c  ox[0], bbox[1]),
+00010370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010380: 2028 6262 6f78 5b30 5d2c 2062 626f 785b   (bbox[0], bbox[
+00010390: 335d 292c 0a20 2020 2020 2020 2020 2020  3]),.           
+000103a0: 2020 2020 2028 6262 6f78 5b32 5d2c 2062       (bbox[2], b
+000103b0: 626f 785b 335d 292c 0a20 2020 2020 2020  box[3]),.       
+000103c0: 2020 2020 2020 2020 2028 6262 6f78 5b32           (bbox[2
+000103d0: 5d2c 2062 626f 785b 315d 292c 0a20 2020  ], bbox[1]),.   
+000103e0: 2020 2020 2020 2020 2020 2020 2028 6262               (bb
+000103f0: 6f78 5b30 5d2c 2062 626f 785b 315d 292c  ox[0], bbox[1]),
+00010400: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
+00010410: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00010420: 2062 626f 785f 6764 6620 3d20 6770 642e   bbox_gdf = gpd.
+00010430: 4765 6f44 6174 6146 7261 6d65 280a 2020  GeoDataFrame(.  
+00010440: 2020 2020 2020 2020 2020 6461 7461 3d5b            data=[
+00010450: 315d 2c20 6765 6f6d 6574 7279 3d5b 6262  1], geometry=[bb
+00010460: 6f78 5f70 6f6c 7967 6f6e 5d2c 2063 7273  ox_polygon], crs
+00010470: 3d69 6e70 7574 5f67 6466 2e63 7273 0a20  =input_gdf.crs. 
+00010480: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00010490: 2020 2320 4361 7463 6820 6972 7265 6c65    # Catch irrele
+000104a0: 7661 6e74 2070 616e 6461 7320 6675 7475  vant pandas futu
+000104b0: 7265 2077 6172 6e69 6e67 0a20 2020 2020  re warning.     
+000104c0: 2020 2023 2054 4f44 4f3a 2077 6865 6e20     # TODO: when 
+000104d0: 7265 6d6f 7665 6420 696e 206c 6174 6572  removed in later
+000104e0: 2076 6572 7369 6f6e 206f 6620 7061 6e64   version of pand
+000104f0: 6173 2c20 6361 6e20 6265 2072 656d 6f76  as, can be remov
+00010500: 6564 2068 6572 650a 2020 2020 2020 2020  ed here.        
+00010510: 7769 7468 2077 6172 6e69 6e67 732e 6361  with warnings.ca
+00010520: 7463 685f 7761 726e 696e 6773 2829 3a0a  tch_warnings():.
+00010530: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
+00010540: 6167 6520 3d20 280a 2020 2020 2020 2020  age = (.        
+00010550: 2020 2020 2020 2020 2249 6e20 6120 6675          "In a fu
+00010560: 7475 7265 2076 6572 7369 6f6e 2c20 6064  ture version, `d
+00010570: 662e 696c 6f63 5b3a 2c20 695d 203d 206e  f.iloc[:, i] = n
+00010580: 6577 7661 6c73 6020 7769 6c6c 2061 7474  ewvals` will att
+00010590: 656d 7074 2074 6f20 220a 2020 2020 2020  empt to ".      
+000105a0: 2020 2020 2020 2020 2020 2273 6574 2074            "set t
+000105b0: 6865 2076 616c 7565 7320 696e 706c 6163  he values inplac
+000105c0: 6520 696e 7374 6561 6420 6f66 2061 6c77  e instead of alw
+000105d0: 6179 7320 7365 7474 696e 6720 6120 6e65  ays setting a ne
+000105e0: 7720 6172 7261 792e 220a 2020 2020 2020  w array.".      
+000105f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010600: 2020 2020 7761 726e 696e 6773 2e66 696c      warnings.fil
+00010610: 7465 7277 6172 6e69 6e67 7328 0a20 2020  terwarnings(.   
+00010620: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00010630: 696f 6e3d 2269 676e 6f72 6522 2c20 6361  ion="ignore", ca
+00010640: 7465 676f 7279 3d46 7574 7572 6557 6172  tegory=FutureWar
+00010650: 6e69 6e67 2c20 6d65 7373 6167 653d 7265  ning, message=re
+00010660: 2e65 7363 6170 6528 6d65 7373 6167 6529  .escape(message)
+00010670: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00010680: 2020 2020 2020 2020 2020 2023 206b 6565             # kee
+00010690: 705f 6765 6f6d 5f74 7970 653d 5472 7565  p_geom_type=True
+000106a0: 2067 6176 6520 736f 6d65 7469 6d65 7320   gave sometimes 
+000106b0: 6572 726f 722c 2061 6e64 2073 7469 6c6c  error, and still
+000106c0: 2064 6f65 7320 696e 2030 2e39 2e30 0a20   does in 0.9.0. 
+000106d0: 2020 2020 2020 2020 2020 2023 2073 6f20             # so 
+000106e0: 7573 6520 6f77 6e20 696d 706c 656d 656e  use own implemen
+000106f0: 7461 7469 6f6e 206f 6620 6b65 6570 5f67  tation of keep_g
+00010700: 656f 6d5f 7479 7065 0a20 2020 2020 2020  eom_type.       
+00010710: 2020 2020 2064 6973 735f 6764 6620 3d20       diss_gdf = 
+00010720: 6770 642e 636c 6970 2864 6973 735f 6764  gpd.clip(diss_gd
+00010730: 662c 2062 626f 785f 6764 6629 2020 2320  f, bbox_gdf)  # 
+00010740: 2c20 6b65 6570 5f67 656f 6d5f 7479 7065  , keep_geom_type
+00010750: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00010760: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+00010770: 616e 6365 2864 6973 735f 6764 662c 2067  ance(diss_gdf, g
+00010780: 7064 2e47 656f 4461 7461 4672 616d 6529  pd.GeoDataFrame)
+00010790: 0a0a 2020 2020 2020 2020 2320 4f6e 6c79  ..        # Only
+000107a0: 206b 6565 7020 6765 6f6d 6574 7269 6573   keep geometries
+000107b0: 206f 6620 7468 6520 7072 696d 6974 6976   of the primitiv
+000107c0: 6520 7479 7065 2073 7065 6369 6669 6564  e type specified
+000107d0: 2061 6674 6572 2063 6c69 702e 2e2e 0a20   after clip.... 
+000107e0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+000107f0: 696e 7374 616e 6365 2864 6973 735f 6764  instance(diss_gd
+00010800: 662c 2067 7064 2e47 656f 4461 7461 4672  f, gpd.GeoDataFr
+00010810: 616d 6529 0a20 2020 2020 2020 2064 6973  ame).        dis
+00010820: 735f 6764 662e 6765 6f6d 6574 7279 203d  s_gdf.geometry =
+00010830: 2067 656f 7365 7269 6573 5f75 7469 6c2e   geoseries_util.
+00010840: 6765 6f6d 6574 7279 5f63 6f6c 6c65 6374  geometry_collect
+00010850: 696f 6e5f 6578 7472 6163 7428 0a20 2020  ion_extract(.   
+00010860: 2020 2020 2020 2020 2064 6973 735f 6764           diss_gd
+00010870: 662e 6765 6f6d 6574 7279 2c20 696e 7075  f.geometry, inpu
+00010880: 745f 6765 6f6d 6574 7279 7479 7065 2e74  t_geometrytype.t
+00010890: 6f5f 7072 696d 6974 6976 6574 7970 650a  o_primitivetype.
+000108a0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000108b0: 2020 2070 6572 6669 6e66 6f5b 2274 696d     perfinfo["tim
+000108c0: 655f 636c 6970 225d 203d 2028 6461 7465  e_clip"] = (date
+000108d0: 7469 6d65 2e6e 6f77 2829 202d 2073 7461  time.now() - sta
+000108e0: 7274 5f63 6c69 7029 2e74 6f74 616c 5f73  rt_clip).total_s
+000108f0: 6563 6f6e 6473 2829 0a0a 2020 2020 2320  econds()..    # 
+00010900: 5365 7420 656d 7074 7920 6765 6f6d 6574  Set empty geomet
+00010910: 7269 6573 2074 6f20 6e75 6c6c 2f4e 6f6e  ries to null/Non
+00010920: 650a 2020 2020 6173 7365 7274 2064 6973  e.    assert dis
+00010930: 735f 6764 662e 6765 6f6d 6574 7279 2069  s_gdf.geometry i
+00010940: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2064  s not None.    d
+00010950: 6973 735f 6764 662e 6c6f 635b 6469 7373  iss_gdf.loc[diss
+00010960: 5f67 6466 2e67 656f 6d65 7472 792e 6973  _gdf.geometry.is
+00010970: 5f65 6d70 7479 2c20 5b22 6765 6f6d 6574  _empty, ["geomet
+00010980: 7279 225d 5d20 3d20 4e6f 6e65 0a0a 2020  ry"]] = None..  
+00010990: 2020 2320 5265 6d6f 7665 2072 6f77 7320    # Remove rows 
+000109a0: 7768 6572 6520 6765 6f6d 2069 7320 4e6f  where geom is No
+000109b0: 6e65 2f6e 756c 6c2f 656d 7074 790a 2020  ne/null/empty.  
+000109c0: 2020 6966 206e 6f74 206b 6565 705f 656d    if not keep_em
+000109d0: 7074 795f 6765 6f6d 733a 0a20 2020 2020  pty_geoms:.     
+000109e0: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+000109f0: 616e 6365 2864 6973 735f 6764 662c 2067  ance(diss_gdf, g
+00010a00: 7064 2e47 656f 4461 7461 4672 616d 6529  pd.GeoDataFrame)
+00010a10: 0a20 2020 2020 2020 2064 6973 735f 6764  .        diss_gd
+00010a20: 6620 3d20 6469 7373 5f67 6466 5b7e 6469  f = diss_gdf[~di
+00010a30: 7373 5f67 6466 2e67 656f 6d65 7472 792e  ss_gdf.geometry.
+00010a40: 6973 6e61 2829 5d0a 0a20 2020 2023 2049  isna()]..    # I
+00010a50: 6620 7468 6572 6520 6973 206e 6f20 7265  f there is no re
+00010a60: 7375 6c74 2c20 7265 7475 726e 0a20 2020  sult, return.   
+00010a70: 2069 6620 6c65 6e28 6469 7373 5f67 6466   if len(diss_gdf
+00010a80: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00010a90: 6d65 7373 6167 6520 3d20 6622 5265 7375  message = f"Resu
+00010aa0: 6c74 2069 7320 656d 7074 7920 666f 7220  lt is empty for 
+00010ab0: 7b69 6e70 7574 5f70 6174 687d 220a 2020  {input_path}".  
+00010ac0: 2020 2020 2020 7265 7475 726e 5f69 6e66        return_inf
+00010ad0: 6f5b 226d 6573 7361 6765 225d 203d 206d  o["message"] = m
+00010ae0: 6573 7361 6765 0a20 2020 2020 2020 2072  essage.        r
+00010af0: 6574 7572 6e5f 696e 666f 5b22 7065 7266  eturn_info["perf
+00010b00: 696e 666f 225d 203d 2070 6572 6669 6e66  info"] = perfinf
+00010b10: 6f0a 2020 2020 2020 2020 7265 7475 726e  o.        return
+00010b20: 5f69 6e66 6f5b 2274 6f74 616c 5f74 696d  _info["total_tim
+00010b30: 6522 5d20 3d20 2864 6174 6574 696d 652e  e"] = (datetime.
+00010b40: 6e6f 7728 2920 2d20 7374 6172 745f 7469  now() - start_ti
+00010b50: 6d65 292e 746f 7461 6c5f 7365 636f 6e64  me).total_second
+00010b60: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
+00010b70: 726e 2072 6574 7572 6e5f 696e 666f 0a0a  rn return_info..
+00010b80: 2020 2020 2320 4164 6420 636f 6c75 6d6e      # Add column
+00010b90: 2077 6974 6820 7469 6c65 5f69 640a 2020   with tile_id.  
+00010ba0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+00010bb0: 6e63 6528 6469 7373 5f67 6466 2c20 6770  nce(diss_gdf, gp
+00010bc0: 642e 4765 6f44 6174 6146 7261 6d65 290a  d.GeoDataFrame).
+00010bd0: 2020 2020 6966 2074 696c 655f 6964 2069      if tile_id i
+00010be0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00010bf0: 2020 2020 6469 7373 5f67 6466 5b22 7469      diss_gdf["ti
+00010c00: 6c65 5f69 6422 5d20 3d20 7469 6c65 5f69  le_id"] = tile_i
+00010c10: 640a 0a20 2020 2069 6620 6772 6964 7369  d..    if gridsi
+00010c20: 7a65 2021 3d20 302e 303a 0a20 2020 2020  ze != 0.0:.     
+00010c30: 2020 2064 6973 735f 6764 662e 6765 6f6d     diss_gdf.geom
+00010c40: 6574 7279 203d 2073 6861 7065 6c79 325f  etry = shapely2_
+00010c50: 6f72 5f70 7967 656f 732e 7365 745f 7072  or_pygeos.set_pr
+00010c60: 6563 6973 696f 6e28 0a20 2020 2020 2020  ecision(.       
+00010c70: 2020 2020 2064 6973 735f 6764 662e 6765       diss_gdf.ge
+00010c80: 6f6d 6574 7279 2e61 7272 6179 2e64 6174  ometry.array.dat
+00010c90: 612c 2067 7269 645f 7369 7a65 3d67 7269  a, grid_size=gri
+00010ca0: 6473 697a 650a 2020 2020 2020 2020 290a  dsize.        ).
+00010cb0: 0a20 2020 2023 2053 6176 6520 7468 6520  .    # Save the 
+00010cc0: 7265 7375 6c74 2074 6f20 6465 7374 696e  result to destin
+00010cd0: 6174 696f 6e20 6669 6c65 2873 290a 2020  ation file(s).  
+00010ce0: 2020 7374 6172 745f 746f 5f66 696c 6520    start_to_file 
+00010cf0: 3d20 6461 7465 7469 6d65 2e6e 6f77 2829  = datetime.now()
+00010d00: 0a0a 2020 2020 2320 4966 2074 6865 2074  ..    # If the t
+00010d10: 696c 6573 2064 6f6e 2774 206e 6565 6420  iles don't need 
+00010d20: 746f 2062 6520 6d65 7267 6564 2061 6674  to be merged aft
+00010d30: 6572 7761 7264 732c 2077 6520 6361 6e20  erwards, we can 
+00010d40: 6a75 7374 2073 6176 6520 7468 6520 7265  just save the re
+00010d50: 7375 6c74 2061 730a 2020 2020 2320 6974  sult as.    # it
+00010d60: 2069 732e 0a20 2020 2069 6620 7374 7228   is..    if str(
+00010d70: 6f75 7470 7574 5f6e 6f74 6f6e 626f 7264  output_notonbord
+00010d80: 6572 5f70 6174 6829 203d 3d20 7374 7228  er_path) == str(
+00010d90: 6f75 7470 7574 5f6f 6e62 6f72 6465 725f  output_onborder_
+00010da0: 7061 7468 293a 0a20 2020 2020 2020 2023  path):.        #
+00010db0: 2061 7373 6572 7420 746f 2065 7661 6465   assert to evade
+00010dc0: 2070 794c 616e 6365 2077 6172 6e69 6e67   pyLance warning
+00010dd0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00010de0: 6973 696e 7374 616e 6365 2864 6973 735f  isinstance(diss_
+00010df0: 6764 662c 2067 7064 2e47 656f 4461 7461  gdf, gpd.GeoData
+00010e00: 4672 616d 6529 0a20 2020 2020 2020 2023  Frame).        #
+00010e10: 2055 7365 2066 6f72 6365 5f6d 756c 7469   Use force_multi
+00010e20: 7479 7065 2c20 746f 2065 7661 6465 2077  type, to evade w
+00010e30: 6172 6e69 6e67 7320 7768 656e 2073 6f6d  arnings when som
+00010e40: 6520 6261 7463 6865 7320 636f 6e74 6169  e batches contai
+00010e50: 6e0a 2020 2020 2020 2020 2320 7369 6e67  n.        # sing
+00010e60: 6c65 7479 7065 2061 6e64 2073 6f6d 6520  letype and some 
+00010e70: 636f 6e74 6169 6e20 6d75 6c74 6974 7970  contain multityp
+00010e80: 6520 6765 6f6d 6574 7269 6573 0a20 2020  e geometries.   
+00010e90: 2020 2020 2067 666f 2e74 6f5f 6669 6c65       gfo.to_file
+00010ea0: 280a 2020 2020 2020 2020 2020 2020 6469  (.            di
+00010eb0: 7373 5f67 6466 2c0a 2020 2020 2020 2020  ss_gdf,.        
+00010ec0: 2020 2020 6f75 7470 7574 5f6e 6f74 6f6e      output_noton
+00010ed0: 626f 7264 6572 5f70 6174 682c 0a20 2020  border_path,.   
+00010ee0: 2020 2020 2020 2020 206c 6179 6572 3d6f           layer=o
+00010ef0: 7574 7075 745f 6c61 7965 722c 0a20 2020  utput_layer,.   
+00010f00: 2020 2020 2020 2020 2066 6f72 6365 5f6d           force_m
+00010f10: 756c 7469 7479 7065 3d54 7275 652c 0a20  ultitype=True,. 
+00010f20: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00010f30: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00010f40: 2020 2020 6372 6561 7465 5f73 7061 7469      create_spati
+00010f50: 616c 5f69 6e64 6578 3d46 616c 7365 2c0a  al_index=False,.
+00010f60: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
+00010f70: 7365 3a0a 2020 2020 2020 2020 2320 4966  se:.        # If
+00010f80: 206e 6f74 2c20 7361 7665 2074 6865 2070   not, save the p
+00010f90: 6f6c 7967 6f6e 7320 6f6e 2074 6865 2062  olygons on the b
+00010fa0: 6f72 6465 7220 7365 7065 7261 7465 6c79  order seperately
+00010fb0: 0a20 2020 2020 2020 2062 626f 785f 6c69  .        bbox_li
+00010fc0: 6e65 735f 6764 6620 3d20 6770 642e 4765  nes_gdf = gpd.Ge
+00010fd0: 6f44 6174 6146 7261 6d65 280a 2020 2020  oDataFrame(.    
+00010fe0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+00010ff0: 3d67 656f 7365 7269 6573 5f75 7469 6c2e  =geoseries_util.
+00011000: 706f 6c79 676f 6e73 5f74 6f5f 6c69 6e65  polygons_to_line
+00011010: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00011020: 2020 2067 7064 2e47 656f 5365 7269 6573     gpd.GeoSeries
+00011030: 285b 7368 5f67 656f 6d2e 626f 7828 6262  ([sh_geom.box(bb
+00011040: 6f78 5b30 5d2c 2062 626f 785b 315d 2c20  ox[0], bbox[1], 
+00011050: 6262 6f78 5b32 5d2c 2062 626f 785b 335d  bbox[2], bbox[3]
+00011060: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00011070: 292c 0a20 2020 2020 2020 2020 2020 2063  ),.            c
+00011080: 7273 3d69 6e70 7574 5f67 6466 2e63 7273  rs=input_gdf.crs
+00011090: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+000110a0: 2020 2020 6f6e 626f 7264 6572 5f67 6466      onborder_gdf
+000110b0: 203d 2067 7064 2e73 6a6f 696e 2864 6973   = gpd.sjoin(dis
+000110c0: 735f 6764 662c 2062 626f 785f 6c69 6e65  s_gdf, bbox_line
+000110d0: 735f 6764 662c 2070 7265 6469 6361 7465  s_gdf, predicate
+000110e0: 3d22 696e 7465 7273 6563 7473 2229 0a20  ="intersects"). 
+000110f0: 2020 2020 2020 206f 6e62 6f72 6465 725f         onborder_
+00011100: 6764 662e 6472 6f70 2822 696e 6465 785f  gdf.drop("index_
+00011110: 7269 6768 7422 2c20 6178 6973 3d31 2c20  right", axis=1, 
+00011120: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+00011130: 2020 2020 2020 6966 206c 656e 286f 6e62        if len(onb
+00011140: 6f72 6465 725f 6764 6629 203e 2030 3a0a  order_gdf) > 0:.
+00011150: 2020 2020 2020 2020 2020 2020 2320 6173              # as
+00011160: 7365 7274 2074 6f20 6576 6164 6520 7079  sert to evade py
+00011170: 4c61 6e63 6520 7761 726e 696e 670a 2020  Lance warning.  
+00011180: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00011190: 2069 7369 6e73 7461 6e63 6528 6f6e 626f   isinstance(onbo
+000111a0: 7264 6572 5f67 6466 2c20 6770 642e 4765  rder_gdf, gpd.Ge
+000111b0: 6f44 6174 6146 7261 6d65 290a 2020 2020  oDataFrame).    
+000111c0: 2020 2020 2020 2020 2320 5573 6520 666f          # Use fo
+000111d0: 7263 655f 6d75 6c74 6974 7970 652c 2074  rce_multitype, t
+000111e0: 6f20 6576 6164 6520 7761 726e 696e 6773  o evade warnings
+000111f0: 2077 6865 6e20 736f 6d65 2062 6174 6368   when some batch
+00011200: 6573 2063 6f6e 7461 696e 0a20 2020 2020  es contain.     
+00011210: 2020 2020 2020 2023 2073 696e 676c 6574         # singlet
+00011220: 7970 6520 616e 6420 736f 6d65 2063 6f6e  ype and some con
+00011230: 7461 696e 206d 756c 7469 7479 7065 2067  tain multitype g
+00011240: 656f 6d65 7472 6965 730a 2020 2020 2020  eometries.      
+00011250: 2020 2020 2020 6766 6f2e 746f 5f66 696c        gfo.to_fil
+00011260: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00011270: 2020 206f 6e62 6f72 6465 725f 6764 662c     onborder_gdf,
+00011280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011290: 206f 7574 7075 745f 6f6e 626f 7264 6572   output_onborder
+000112a0: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
+000112b0: 2020 2020 2020 206c 6179 6572 3d6f 7574         layer=out
+000112c0: 7075 745f 6c61 7965 722c 0a20 2020 2020  put_layer,.     
+000112d0: 2020 2020 2020 2020 2020 2066 6f72 6365             force
+000112e0: 5f6d 756c 7469 7479 7065 3d54 7275 652c  _multitype=True,
+000112f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011300: 2063 7265 6174 655f 7370 6174 6961 6c5f   create_spatial_
+00011310: 696e 6465 783d 4661 6c73 652c 0a20 2020  index=False,.   
+00011320: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00011330: 2020 2020 6e6f 746f 6e62 6f72 6465 725f      notonborder_
+00011340: 6764 6620 3d20 6469 7373 5f67 6466 5b7e  gdf = diss_gdf[~
+00011350: 6469 7373 5f67 6466 2e69 6e64 6578 2e69  diss_gdf.index.i
+00011360: 7369 6e28 6f6e 626f 7264 6572 5f67 6466  sin(onborder_gdf
+00011370: 2e69 6e64 6578 295d 0a20 2020 2020 2020  .index)].       
+00011380: 2069 6620 6c65 6e28 6e6f 746f 6e62 6f72   if len(notonbor
+00011390: 6465 725f 6764 6629 203e 2030 3a0a 2020  der_gdf) > 0:.  
+000113a0: 2020 2020 2020 2020 2020 2320 6173 7365            # asse
+000113b0: 7274 2074 6f20 6576 6164 6520 7079 4c61  rt to evade pyLa
+000113c0: 6e63 6520 7761 726e 696e 670a 2020 2020  nce warning.    
+000113d0: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+000113e0: 7369 6e73 7461 6e63 6528 6e6f 746f 6e62  sinstance(notonb
+000113f0: 6f72 6465 725f 6764 662c 2067 7064 2e47  order_gdf, gpd.G
+00011400: 656f 4461 7461 4672 616d 6529 0a20 2020  eoDataFrame).   
+00011410: 2020 2020 2020 2020 2023 2055 7365 2066           # Use f
+00011420: 6f72 6365 5f6d 756c 7469 7479 7065 2c20  orce_multitype, 
+00011430: 746f 2065 7661 6465 2077 6172 6e69 6e67  to evade warning
+00011440: 7320 7768 656e 2073 6f6d 6520 6261 7463  s when some batc
+00011450: 6865 7320 636f 6e74 6169 6e0a 2020 2020  hes contain.    
+00011460: 2020 2020 2020 2020 2320 7369 6e67 6c65          # single
+00011470: 7479 7065 2061 6e64 2073 6f6d 6520 636f  type and some co
+00011480: 6e74 6169 6e20 6d75 6c74 6974 7970 6520  ntain multitype 
+00011490: 6765 6f6d 6574 7269 6573 0a20 2020 2020  geometries.     
+000114a0: 2020 2020 2020 2067 666f 2e74 6f5f 6669         gfo.to_fi
+000114b0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+000114c0: 2020 2020 6e6f 746f 6e62 6f72 6465 725f      notonborder_
+000114d0: 6764 662c 0a20 2020 2020 2020 2020 2020  gdf,.           
+000114e0: 2020 2020 206f 7574 7075 745f 6e6f 746f       output_noto
+000114f0: 6e62 6f72 6465 725f 7061 7468 2c0a 2020  nborder_path,.  
+00011500: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00011510: 7965 723d 6f75 7470 7574 5f6c 6179 6572  yer=output_layer
+00011520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011530: 2020 666f 7263 655f 6d75 6c74 6974 7970    force_multityp
+00011540: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+00011550: 2020 2020 2020 2020 696e 6465 783d 4661          index=Fa
+00011560: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00011570: 2020 2020 2063 7265 6174 655f 7370 6174       create_spat
+00011580: 6961 6c5f 696e 6465 783d 4661 6c73 652c  ial_index=False,
+00011590: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000115a0: 2020 2070 6572 6669 6e66 6f5b 2274 696d     perfinfo["tim
+000115b0: 655f 746f 5f66 696c 6522 5d20 3d20 2864  e_to_file"] = (d
+000115c0: 6174 6574 696d 652e 6e6f 7728 2920 2d20  atetime.now() - 
+000115d0: 7374 6172 745f 746f 5f66 696c 6529 2e74  start_to_file).t
+000115e0: 6f74 616c 5f73 6563 6f6e 6473 2829 0a0a  otal_seconds()..
+000115f0: 2020 2020 2320 4669 6e61 6c69 7365 2e2e      # Finalise..
+00011600: 2e0a 2020 2020 6d65 7373 6167 6520 3d20  ..    message = 
+00011610: 6622 6469 7373 6f6c 7665 2072 6561 6479  f"dissolve ready
+00011620: 2069 6e20 7b64 6174 6574 696d 652e 6e6f   in {datetime.no
+00011630: 7728 292d 7374 6172 745f 7469 6d65 7d20  w()-start_time} 
+00011640: 6f6e 207b 696e 7075 745f 7061 7468 7d21  on {input_path}!
+00011650: 220a 2020 2020 6c6f 6767 6572 2e64 6562  ".    logger.deb
+00011660: 7567 286d 6573 7361 6765 290a 0a20 2020  ug(message)..   
+00011670: 2023 2043 6f6c 6c65 6374 2070 6572 6669   # Collect perfi
+00011680: 6e66 6f0a 2020 2020 746f 7461 6c5f 7065  nfo.    total_pe
+00011690: 7266 5f74 696d 6520 3d20 300a 2020 2020  rf_time = 0.    
+000116a0: 7065 7266 7374 7269 6e67 203d 2022 220a  perfstring = "".
+000116b0: 2020 2020 666f 7220 7065 7266 636f 6465      for perfcode
+000116c0: 2069 6e20 7065 7266 696e 666f 3a0a 2020   in perfinfo:.  
+000116d0: 2020 2020 2020 746f 7461 6c5f 7065 7266        total_perf
+000116e0: 5f74 696d 6520 2b3d 2070 6572 6669 6e66  _time += perfinf
+000116f0: 6f5b 7065 7266 636f 6465 5d0a 2020 2020  o[perfcode].    
+00011700: 2020 2020 7065 7266 7374 7269 6e67 202b      perfstring +
+00011710: 3d20 6622 7b70 6572 6663 6f64 657d 3a20  = f"{perfcode}: 
+00011720: 7b70 6572 6669 6e66 6f5b 7065 7266 636f  {perfinfo[perfco
+00011730: 6465 5d3a 2e32 667d 2c20 220a 2020 2020  de]:.2f}, ".    
+00011740: 7265 7475 726e 5f69 6e66 6f5b 2274 6f74  return_info["tot
+00011750: 616c 5f74 696d 6522 5d20 3d20 2864 6174  al_time"] = (dat
+00011760: 6574 696d 652e 6e6f 7728 2920 2d20 7374  etime.now() - st
+00011770: 6172 745f 7469 6d65 292e 746f 7461 6c5f  art_time).total_
+00011780: 7365 636f 6e64 7328 290a 2020 2020 7065  seconds().    pe
+00011790: 7266 696e 666f 5b22 756e 6163 636f 756e  rfinfo["unaccoun
+000117a0: 7465 6422 5d20 3d20 7265 7475 726e 5f69  ted"] = return_i
+000117b0: 6e66 6f5b 2274 6f74 616c 5f74 696d 6522  nfo["total_time"
+000117c0: 5d20 2d20 746f 7461 6c5f 7065 7266 5f74  ] - total_perf_t
+000117d0: 696d 650a 2020 2020 7065 7266 7374 7269  ime.    perfstri
+000117e0: 6e67 202b 3d20 6622 756e 6163 636f 756e  ng += f"unaccoun
+000117f0: 7465 643a 207b 7065 7266 696e 666f 5b27  ted: {perfinfo['
+00011800: 756e 6163 636f 756e 7465 6427 5d3a 2e32  unaccounted']:.2
+00011810: 667d 220a 0a20 2020 2023 2052 6574 7572  f}"..    # Retur
+00011820: 6e0a 2020 2020 7265 7475 726e 5f69 6e66  n.    return_inf
+00011830: 6f5b 2270 6572 6669 6e66 6f22 5d20 3d20  o["perfinfo"] = 
+00011840: 7065 7266 696e 666f 0a20 2020 2072 6574  perfinfo.    ret
+00011850: 7572 6e5f 696e 666f 5b22 7065 7266 7374  urn_info["perfst
+00011860: 7269 6e67 225d 203d 2070 6572 6673 7472  ring"] = perfstr
+00011870: 696e 670a 2020 2020 7265 7475 726e 5f69  ing.    return_i
+00011880: 6e66 6f5b 226d 6573 7361 6765 225d 203d  nfo["message"] =
+00011890: 206d 6573 7361 6765 0a20 2020 2072 6574   message.    ret
+000118a0: 7572 6e20 7265 7475 726e 5f69 6e66 6f0a  urn return_info.
+000118b0: 0a0a 6465 6620 5f64 6973 736f 6c76 6528  ..def _dissolve(
+000118c0: 0a20 2020 2064 663a 2067 7064 2e47 656f  .    df: gpd.Geo
+000118d0: 4461 7461 4672 616d 652c 0a20 2020 2062  DataFrame,.    b
+000118e0: 793d 4e6f 6e65 2c0a 2020 2020 6167 6766  y=None,.    aggf
+000118f0: 756e 633a 204f 7074 696f 6e61 6c5b 556e  unc: Optional[Un
+00011900: 696f 6e5b 7374 722c 2064 6963 745d 5d20  ion[str, dict]] 
+00011910: 3d20 2266 6972 7374 222c 0a20 2020 2061  = "first",.    a
+00011920: 735f 696e 6465 783d 5472 7565 2c0a 2020  s_index=True,.  
+00011930: 2020 6c65 7665 6c3d 4e6f 6e65 2c0a 2020    level=None,.  
+00011940: 2020 736f 7274 3d54 7275 652c 0a20 2020    sort=True,.   
+00011950: 206f 6273 6572 7665 643d 4661 6c73 652c   observed=False,
+00011960: 0a20 2020 2064 726f 706e 613d 5472 7565  .    dropna=True
+00011970: 2c0a 2920 2d3e 2067 7064 2e47 656f 4461  ,.) -> gpd.GeoDa
+00011980: 7461 4672 616d 653a 0a20 2020 2022 2222  taFrame:.    """
+00011990: 0a20 2020 2044 6973 736f 6c76 6520 6765  .    Dissolve ge
+000119a0: 6f6d 6574 7269 6573 2077 6974 6869 6e20  ometries within 
+000119b0: 6067 726f 7570 6279 6020 696e 746f 2073  `groupby` into s
+000119c0: 696e 676c 6520 6f62 7365 7276 6174 696f  ingle observatio
+000119d0: 6e2e 0a20 2020 2054 6869 7320 6973 2061  n..    This is a
+000119e0: 6363 6f6d 706c 6973 6865 6420 6279 2061  ccomplished by a
+000119f0: 7070 6c79 696e 6720 7468 6520 6075 6e61  pplying the `una
+00011a00: 7279 5f75 6e69 6f6e 6020 6d65 7468 6f64  ry_union` method
+00011a10: 0a20 2020 2074 6f20 616c 6c20 6765 6f6d  .    to all geom
+00011a20: 6574 7269 6573 2077 6974 6869 6e20 6120  etries within a 
+00011a30: 6772 6f75 7073 656c 662e 0a20 2020 204f  groupself..    O
+00011a40: 6273 6572 7661 7469 6f6e 7320 6173 736f  bservations asso
+00011a50: 6369 6174 6564 2077 6974 6820 6561 6368  ciated with each
+00011a60: 2060 6772 6f75 7062 7960 2067 726f 7570   `groupby` group
+00011a70: 2077 696c 6c20 6265 2061 6767 7265 6761   will be aggrega
+00011a80: 7465 640a 2020 2020 7573 696e 6720 7468  ted.    using th
+00011a90: 6520 6061 6767 6675 6e63 602e 0a20 2020  e `aggfunc`..   
+00011aa0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00011ab0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2062  ----------.    b
+00011ac0: 7920 3a20 7374 7269 6e67 2c20 6465 6661  y : string, defa
+00011ad0: 756c 7420 4e6f 6e65 0a20 2020 2020 2020  ult None.       
+00011ae0: 2043 6f6c 756d 6e20 7768 6f73 6520 7661   Column whose va
+00011af0: 6c75 6573 2064 6566 696e 6520 6772 6f75  lues define grou
+00011b00: 7073 2074 6f20 6265 2064 6973 736f 6c76  ps to be dissolv
+00011b10: 6564 2e20 4966 204e 6f6e 652c 0a20 2020  ed. If None,.   
+00011b20: 2020 2020 2077 686f 6c65 2047 656f 4461       whole GeoDa
+00011b30: 7461 4672 616d 6520 6973 2063 6f6e 7369  taFrame is consi
+00011b40: 6465 7265 6420 6120 7369 6e67 6c65 2067  dered a single g
+00011b50: 726f 7570 2e0a 2020 2020 6167 6766 756e  roup..    aggfun
+00011b60: 6320 3a20 6675 6e63 7469 6f6e 2c20 7374  c : function, st
+00011b70: 7269 6e67 206f 7220 6469 6374 2c20 6465  ring or dict, de
+00011b80: 6661 756c 7420 2266 6972 7374 220a 2020  fault "first".  
+00011b90: 2020 2020 2020 4167 6772 6567 6174 696f        Aggregatio
+00011ba0: 6e20 6675 6e63 7469 6f6e 2066 6f72 206d  n function for m
+00011bb0: 616e 6970 756c 6174 696f 6e20 6f66 2064  anipulation of d
+00011bc0: 6174 6120 6173 736f 6369 6174 6564 0a20  ata associated. 
+00011bd0: 2020 2020 2020 2077 6974 6820 6561 6368         with each
+00011be0: 2067 726f 7570 2e20 5061 7373 6564 2074   group. Passed t
+00011bf0: 6f20 7061 6e64 6173 2060 6772 6f75 7062  o pandas `groupb
+00011c00: 792e 6167 6760 206d 6574 686f 642e 0a20  y.agg` method.. 
+00011c10: 2020 2061 735f 696e 6465 7820 3a20 626f     as_index : bo
+00011c20: 6f6c 6561 6e2c 2064 6566 6175 6c74 2054  olean, default T
+00011c30: 7275 650a 2020 2020 2020 2020 4966 2074  rue.        If t
+00011c40: 7275 652c 2067 726f 7570 6279 2063 6f6c  rue, groupby col
+00011c50: 756d 6e73 2062 6563 6f6d 6520 696e 6465  umns become inde
+00011c60: 7820 6f66 2072 6573 756c 742e 0a20 2020  x of result..   
+00011c70: 206c 6576 656c 203a 2069 6e74 206f 7220   level : int or 
+00011c80: 7374 7220 6f72 2073 6571 7565 6e63 6520  str or sequence 
+00011c90: 6f66 2069 6e74 206f 7220 7365 7175 656e  of int or sequen
+00011ca0: 6365 206f 6620 7374 722c 2064 6566 6175  ce of str, defau
+00011cb0: 6c74 204e 6f6e 650a 2020 2020 2020 2020  lt None.        
+00011cc0: 4966 2074 6865 2061 7869 7320 6973 2061  If the axis is a
+00011cd0: 204d 756c 7469 496e 6465 7820 2868 6965   MultiIndex (hie
+00011ce0: 7261 7263 6869 6361 6c29 2c20 6772 6f75  rarchical), grou
+00011cf0: 7020 6279 2061 0a20 2020 2020 2020 2070  p by a.        p
+00011d00: 6172 7469 6375 6c61 7220 6c65 7665 6c20  articular level 
+00011d10: 6f72 206c 6576 656c 732e 0a20 2020 2020  or levels..     
+00011d20: 2020 202e 2e20 7665 7273 696f 6e61 6464     .. versionadd
+00011d30: 6564 3a3a 2030 2e39 2e30 0a20 2020 2073  ed:: 0.9.0.    s
+00011d40: 6f72 7420 3a20 626f 6f6c 2c20 6465 6661  ort : bool, defa
+00011d50: 756c 7420 5472 7565 0a20 2020 2020 2020  ult True.       
+00011d60: 2053 6f72 7420 6772 6f75 7020 6b65 7973   Sort group keys
+00011d70: 2e20 4765 7420 6265 7474 6572 2070 6572  . Get better per
+00011d80: 666f 726d 616e 6365 2062 7920 7475 726e  formance by turn
+00011d90: 696e 6720 7468 6973 206f 6666 2e0a 2020  ing this off..  
+00011da0: 2020 2020 2020 4e6f 7465 2074 6869 7320        Note this 
+00011db0: 646f 6573 206e 6f74 2069 6e66 6c75 656e  does not influen
+00011dc0: 6365 2074 6865 206f 7264 6572 206f 6620  ce the order of 
+00011dd0: 6f62 7365 7276 6174 696f 6e73 2077 6974  observations wit
+00011de0: 6869 6e0a 2020 2020 2020 2020 6561 6368  hin.        each
+00011df0: 2067 726f 7570 2e20 4772 6f75 7062 7920   group. Groupby 
+00011e00: 7072 6573 6572 7665 7320 7468 6520 6f72  preserves the or
+00011e10: 6465 7220 6f66 2072 6f77 7320 7769 7468  der of rows with
+00011e20: 696e 2065 6163 6820 6772 6f75 702e 0a20  in each group.. 
+00011e30: 2020 2020 2020 202e 2e20 7665 7273 696f         .. versio
+00011e40: 6e61 6464 6564 3a3a 2030 2e39 2e30 0a20  nadded:: 0.9.0. 
+00011e50: 2020 206f 6273 6572 7665 6420 3a20 626f     observed : bo
+00011e60: 6f6c 2c20 6465 6661 756c 7420 4661 6c73  ol, default Fals
+00011e70: 650a 2020 2020 2020 2020 5468 6973 206f  e.        This o
+00011e80: 6e6c 7920 6170 706c 6965 7320 6966 2061  nly applies if a
+00011e90: 6e79 206f 6620 7468 6520 6772 6f75 7065  ny of the groupe
+00011ea0: 7273 2061 7265 2043 6174 6567 6f72 6963  rs are Categoric
+00011eb0: 616c 732e 0a20 2020 2020 2020 2049 6620  als..        If 
+00011ec0: 5472 7565 3a20 6f6e 6c79 2073 686f 7720  True: only show 
+00011ed0: 6f62 7365 7276 6564 2076 616c 7565 7320  observed values 
+00011ee0: 666f 7220 6361 7465 676f 7269 6361 6c20  for categorical 
+00011ef0: 6772 6f75 7065 7273 2e0a 2020 2020 2020  groupers..      
+00011f00: 2020 4966 2046 616c 7365 3a20 7368 6f77    If False: show
+00011f10: 2061 6c6c 2076 616c 7565 7320 666f 7220   all values for 
+00011f20: 6361 7465 676f 7269 6361 6c20 6772 6f75  categorical grou
+00011f30: 7065 7273 2e0a 2020 2020 2020 2020 2e2e  pers..        ..
+00011f40: 2076 6572 7369 6f6e 6164 6465 643a 3a20   versionadded:: 
+00011f50: 302e 392e 300a 2020 2020 6472 6f70 6e61  0.9.0.    dropna
+00011f60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00011f70: 2054 7275 650a 2020 2020 2020 2020 4966   True.        If
+00011f80: 2054 7275 652c 2061 6e64 2069 6620 6772   True, and if gr
+00011f90: 6f75 7020 6b65 7973 2063 6f6e 7461 696e  oup keys contain
+00011fa0: 204e 4120 7661 6c75 6573 2c20 4e41 2076   NA values, NA v
+00011fb0: 616c 7565 730a 2020 2020 2020 2020 746f  alues.        to
+00011fc0: 6765 7468 6572 2077 6974 6820 726f 772f  gether with row/
+00011fd0: 636f 6c75 6d6e 2077 696c 6c20 6265 2064  column will be d
+00011fe0: 726f 7070 6564 2e20 4966 2046 616c 7365  ropped. If False
+00011ff0: 2c20 4e41 0a20 2020 2020 2020 2076 616c  , NA.        val
+00012000: 7565 7320 7769 6c6c 2061 6c73 6f20 6265  ues will also be
+00012010: 2074 7265 6174 6564 2061 7320 7468 6520   treated as the 
+00012020: 6b65 7920 696e 2067 726f 7570 732e 0a20  key in groups.. 
+00012030: 2020 2020 2020 2054 6869 7320 7061 7261         This para
+00012040: 6d65 7465 7220 6973 206e 6f74 2073 7570  meter is not sup
+00012050: 706f 7274 6564 2066 6f72 2070 616e 6461  ported for panda
+00012060: 7320 3c20 312e 312e 302e 0a20 2020 2020  s < 1.1.0..     
+00012070: 2020 2041 2077 6172 6e69 6e67 2077 696c     A warning wil
+00012080: 6c20 6265 2065 6d69 7474 6564 2066 6f72  l be emitted for
+00012090: 2065 6172 6c69 6572 2070 616e 6461 7320   earlier pandas 
+000120a0: 7665 7273 696f 6e73 0a20 2020 2020 2020  versions.       
+000120b0: 2069 6620 6120 6e6f 6e2d 6465 6661 756c   if a non-defaul
+000120c0: 7420 7661 6c75 6520 6973 2067 6976 656e  t value is given
+000120d0: 2066 6f72 2074 6869 7320 7061 7261 6d65   for this parame
+000120e0: 7465 722e 0a20 2020 2020 2020 202e 2e20  ter..        .. 
+000120f0: 7665 7273 696f 6e61 6464 6564 3a3a 2030  versionadded:: 0
+00012100: 2e39 2e30 0a20 2020 2052 6574 7572 6e73  .9.0.    Returns
+00012110: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00012120: 2047 656f 4461 7461 4672 616d 650a 2020   GeoDataFrame.  
+00012130: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00012140: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00012150: 6672 6f6d 2073 6861 7065 6c79 2e67 656f  from shapely.geo
+00012160: 6d65 7472 7920 696d 706f 7274 2050 6f69  metry import Poi
+00012170: 6e74 0a20 2020 203e 3e3e 2064 203d 207b  nt.    >>> d = {
+00012180: 0a20 2020 202e 2e2e 2020 2020 2022 636f  .    ...     "co
+00012190: 6c31 223a 205b 226e 616d 6531 222c 2022  l1": ["name1", "
+000121a0: 6e61 6d65 3222 2c20 226e 616d 6531 225d  name2", "name1"]
+000121b0: 2c0a 2020 2020 2e2e 2e20 2020 2020 2267  ,.    ...     "g
+000121c0: 656f 6d65 7472 7922 3a20 5b50 6f69 6e74  eometry": [Point
+000121d0: 2831 2c20 3229 2c20 506f 696e 7428 322c  (1, 2), Point(2,
+000121e0: 2031 292c 2050 6f69 6e74 2830 2c20 3129   1), Point(0, 1)
+000121f0: 5d2c 0a20 2020 202e 2e2e 207d 0a20 2020  ],.    ... }.   
+00012200: 203e 3e3e 2067 6466 203d 2067 656f 7061   >>> gdf = geopa
+00012210: 6e64 6173 2e47 656f 4461 7461 4672 616d  ndas.GeoDataFram
+00012220: 6528 642c 2063 7273 3d34 3332 3629 0a20  e(d, crs=4326). 
+00012230: 2020 203e 3e3e 2067 6466 0a20 2020 2020     >>> gdf.     
+00012240: 2020 2063 6f6c 3120 2020 2020 2020 2020     col1         
+00012250: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+00012260: 0a20 2020 2030 2020 6e61 6d65 3120 2050  .    0  name1  P
+00012270: 4f49 4e54 2028 312e 3030 3030 3020 322e  OINT (1.00000 2.
+00012280: 3030 3030 3029 0a20 2020 2031 2020 6e61  00000).    1  na
+00012290: 6d65 3220 2050 4f49 4e54 2028 322e 3030  me2  POINT (2.00
+000122a0: 3030 3020 312e 3030 3030 3029 0a20 2020  000 1.00000).   
+000122b0: 2032 2020 6e61 6d65 3120 2050 4f49 4e54   2  name1  POINT
+000122c0: 2028 302e 3030 3030 3020 312e 3030 3030   (0.00000 1.0000
+000122d0: 3029 0a20 2020 203e 3e3e 2064 6973 736f  0).    >>> disso
+000122e0: 6c76 6564 203d 2067 6466 2e64 6973 736f  lved = gdf.disso
+000122f0: 6c76 6528 2763 6f6c 3127 290a 2020 2020  lve('col1').    
+00012300: 3e3e 3e20 6469 7373 6f6c 7665 6420 2023  >>> dissolved  #
+00012310: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
+00012320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012350: 6765 6f6d 6574 7279 0a20 2020 2063 6f6c  geometry.    col
+00012360: 310a 2020 2020 6e61 6d65 3120 204d 554c  1.    name1  MUL
+00012370: 5449 504f 494e 5420 2830 2e30 3030 3030  TIPOINT (0.00000
+00012380: 2031 2e30 3030 3030 2c20 312e 3030 3030   1.00000, 1.0000
+00012390: 3020 322e 3030 3030 3029 0a20 2020 206e  0 2.00000).    n
+000123a0: 616d 6532 2020 2020 2020 2020 2020 2020  ame2            
+000123b0: 2020 2020 2020 2020 2020 2020 504f 494e              POIN
+000123c0: 5420 2832 2e30 3030 3030 2031 2e30 3030  T (2.00000 1.000
+000123d0: 3030 290a 2020 2020 5365 6520 616c 736f  00).    See also
+000123e0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+000123f0: 2020 4765 6f44 6174 6146 7261 6d65 2e65    GeoDataFrame.e
+00012400: 7870 6c6f 6465 203a 2065 7870 6c6f 6465  xplode : explode
+00012410: 206d 756c 7469 2d70 6172 7420 6765 6f6d   multi-part geom
+00012420: 6574 7269 6573 2069 6e74 6f20 7369 6e67  etries into sing
+00012430: 6c65 2067 656f 6d65 7472 6965 730a 2020  le geometries.  
+00012440: 2020 2222 220a 0a20 2020 2069 6620 6279    """..    if by
+00012450: 2069 7320 4e6f 6e65 2061 6e64 206c 6576   is None and lev
+00012460: 656c 2069 7320 4e6f 6e65 3a0a 2020 2020  el is None:.    
+00012470: 2020 2020 6279 5f6c 6f63 616c 203d 206e      by_local = n
+00012480: 702e 7a65 726f 7328 6c65 6e28 6466 292c  p.zeros(len(df),
+00012490: 2064 7479 7065 3d22 696e 7436 3422 290a   dtype="int64").
+000124a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000124b0: 2020 6279 5f6c 6f63 616c 203d 2062 790a    by_local = by.
+000124c0: 0a20 2020 2067 726f 7570 6279 5f6b 7761  .    groupby_kwa
+000124d0: 7267 7320 3d20 7b0a 2020 2020 2020 2020  rgs = {.        
+000124e0: 2262 7922 3a20 6279 5f6c 6f63 616c 2c0a  "by": by_local,.
+000124f0: 2020 2020 2020 2020 226c 6576 656c 223a          "level":
+00012500: 206c 6576 656c 2c0a 2020 2020 2020 2020   level,.        
+00012510: 2273 6f72 7422 3a20 736f 7274 2c0a 2020  "sort": sort,.  
+00012520: 2020 2020 2020 226f 6273 6572 7665 6422        "observed"
+00012530: 3a20 6f62 7365 7276 6564 2c0a 2020 2020  : observed,.    
+00012540: 2020 2020 2264 726f 706e 6122 3a20 6472      "dropna": dr
+00012550: 6f70 6e61 2c0a 2020 2020 7d0a 2020 2020  opna,.    }.    
+00012560: 2222 220a 2020 2020 6966 206e 6f74 2063  """.    if not c
+00012570: 6f6d 7061 742e 5041 4e44 4153 5f47 455f  ompat.PANDAS_GE_
+00012580: 3131 3a0a 2020 2020 2020 2020 6772 6f75  11:.        grou
+00012590: 7062 795f 6b77 6172 6773 2e70 6f70 2822  pby_kwargs.pop("
+000125a0: 6472 6f70 6e61 2229 0a0a 2020 2020 2020  dropna")..      
+000125b0: 2020 6966 206e 6f74 2064 726f 706e 613a    if not dropna:
+000125c0: 2020 2320 4966 2074 6865 7920 7061 7373    # If they pass
+000125d0: 6564 2061 206e 6f6e 2d64 6566 6175 6c74  ed a non-default
+000125e0: 2064 726f 706e 6120 7661 6c75 650a 2020   dropna value.  
+000125f0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00012600: 6773 2e77 6172 6e28 2264 726f 706e 6120  gs.warn("dropna 
+00012610: 6b77 6172 6720 6973 206e 6f74 2073 7570  kwarg is not sup
+00012620: 706f 7274 6564 2066 6f72 2070 616e 6461  ported for panda
+00012630: 7320 3c20 312e 312e 3022 290a 2020 2020  s < 1.1.0").    
+00012640: 2222 220a 0a20 2020 2023 2050 726f 6365  """..    # Proce
+00012650: 7373 206e 6f6e 2d73 7061 7469 616c 2063  ss non-spatial c
+00012660: 6f6d 706f 6e65 6e74 0a20 2020 2064 6174  omponent.    dat
+00012670: 6120 3d20 7064 2e44 6174 6146 7261 6d65  a = pd.DataFrame
+00012680: 2864 662e 6472 6f70 2863 6f6c 756d 6e73  (df.drop(columns
+00012690: 3d64 662e 6765 6f6d 6574 7279 2e6e 616d  =df.geometry.nam
+000126a0: 6529 290a 0a20 2020 2069 6620 6167 6766  e))..    if aggf
+000126b0: 756e 6320 6973 206e 6f74 204e 6f6e 6520  unc is not None 
+000126c0: 616e 6420 6973 696e 7374 616e 6365 2861  and isinstance(a
+000126d0: 6767 6675 6e63 2c20 6469 6374 2920 616e  ggfunc, dict) an
+000126e0: 6420 2274 6f5f 6a73 6f6e 2220 696e 2061  d "to_json" in a
+000126f0: 6767 6675 6e63 3a0a 2020 2020 2020 2020  ggfunc:.        
+00012700: 6167 675f 636f 6c75 6d6e 7320 3d20 6c69  agg_columns = li
+00012710: 7374 2873 6574 2861 6767 6675 6e63 5b22  st(set(aggfunc["
+00012720: 746f 5f6a 736f 6e22 5d29 290a 2020 2020  to_json"])).    
+00012730: 2020 2020 6167 6772 6567 6174 6564 5f64      aggregated_d
+00012740: 6174 6120 3d20 280a 2020 2020 2020 2020  ata = (.        
+00012750: 2020 2020 6461 7461 2e67 726f 7570 6279      data.groupby
+00012760: 282a 2a67 726f 7570 6279 5f6b 7761 7267  (**groupby_kwarg
+00012770: 7329 0a20 2020 2020 2020 2020 2020 202e  s).            .
+00012780: 6170 706c 7928 6c61 6d62 6461 2067 3a20  apply(lambda g: 
+00012790: 675b 6167 675f 636f 6c75 6d6e 735d 2e74  g[agg_columns].t
+000127a0: 6f5f 6a73 6f6e 286f 7269 656e 743d 2272  o_json(orient="r
+000127b0: 6563 6f72 6473 2229 290a 2020 2020 2020  ecords")).      
+000127c0: 2020 2020 2020 2e74 6f5f 6672 616d 6528        .to_frame(
+000127d0: 6e61 6d65 3d22 5f5f 4449 5353 4f4c 5645  name="__DISSOLVE
+000127e0: 5f54 4f4a 534f 4e22 290a 2020 2020 2020  _TOJSON").      
+000127f0: 2020 290a 2020 2020 656c 6966 2069 7369    ).    elif isi
+00012800: 6e73 7461 6e63 6528 6167 6766 756e 632c  nstance(aggfunc,
+00012810: 2073 7472 2920 616e 6420 6167 6766 756e   str) and aggfun
+00012820: 6320 3d3d 2022 6d65 7267 655f 6a73 6f6e  c == "merge_json
+00012830: 5f6c 6973 7473 223a 0a20 2020 2020 2020  _lists":.       
+00012840: 2023 204d 6572 6765 2061 6e64 2066 6c61   # Merge and fla
+00012850: 7474 656e 2074 6865 206a 736f 6e20 6c69  tten the json li
+00012860: 7374 7320 696e 2074 6865 2067 726f 7570  sts in the group
+00012870: 730a 2020 2020 2020 2020 6465 6620 6772  s.        def gr
+00012880: 6f75 705f 666c 6174 7465 6e5f 6a73 6f6e  oup_flatten_json
+00012890: 5f6c 6973 7428 6729 3a0a 2020 2020 2020  _list(g):.      
+000128a0: 2020 2020 2020 2320 4576 616c 7561 7465        # Evaluate
+000128b0: 2061 6c6c 2067 726f 7570 6564 2072 6f77   all grouped row
+000128c0: 7320 746f 206a 736f 6e20 6f62 6a65 6374  s to json object
+000128d0: 732e 2054 6869 7320 7265 7375 6c74 7320  s. This results 
+000128e0: 696e 2061 206c 6973 7420 6f66 0a20 2020  in a list of.   
+000128f0: 2020 2020 2020 2020 2023 206c 6973 7473           # lists
+00012900: 206f 6620 6a73 6f6e 206f 626a 6563 7473   of json objects
+00012910: 2e0a 2020 2020 2020 2020 2020 2020 6a73  ..            js
+00012920: 6f6e 5f6e 6573 7465 645f 6c69 7374 7320  on_nested_lists 
+00012930: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00012940: 2020 2020 6a73 6f6e 2e6c 6f61 6473 286a      json.loads(j
+00012950: 736f 6e5f 7661 6c75 6573 2920 666f 7220  son_values) for 
+00012960: 6a73 6f6e 5f76 616c 7565 7320 696e 2067  json_values in g
+00012970: 5b22 5f5f 4449 5353 4f4c 5645 5f54 4f4a  ["__DISSOLVE_TOJ
+00012980: 534f 4e22 5d0a 2020 2020 2020 2020 2020  SON"].          
+00012990: 2020 5d0a 0a20 2020 2020 2020 2020 2020    ]..           
+000129a0: 2023 2045 7874 7261 6374 2074 6865 2072   # Extract the r
+000129b0: 6f77 7320 6672 6f6d 2074 6865 206e 6573  ows from the nes
+000129c0: 7465 6420 6c69 7374 7320 2b20 7075 7420  ted lists + put 
+000129d0: 696e 2061 2066 6c61 7420 6c69 7374 2061  in a flat list a
+000129e0: 7320 7374 7269 6e67 730a 2020 2020 2020  s strings.      
+000129f0: 2020 2020 2020 6a73 6f6e 7374 725f 666c        jsonstr_fl
+00012a00: 6174 203d 205b 0a20 2020 2020 2020 2020  at = [.         
+00012a10: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+00012a20: 7328 6a73 6f6e 5f76 616c 7565 290a 2020  s(json_value).  
+00012a30: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00012a40: 7220 6a73 6f6e 5f76 616c 7565 7320 696e  r json_values in
+00012a50: 206a 736f 6e5f 6e65 7374 6564 5f6c 6973   json_nested_lis
+00012a60: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+00012a70: 2020 2066 6f72 206a 736f 6e5f 7661 6c75     for json_valu
+00012a80: 6520 696e 206a 736f 6e5f 7661 6c75 6573  e in json_values
+00012a90: 0a20 2020 2020 2020 2020 2020 205d 0a0a  .            ]..
+00012aa0: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+00012ab0: 6d6f 7665 2064 7570 6c69 6361 7465 730a  move duplicates.
+00012ac0: 2020 2020 2020 2020 2020 2020 6a73 6f6e              json
+00012ad0: 7373 7472 5f64 6973 7469 6e63 7420 3d20  sstr_distinct = 
+00012ae0: 7365 7428 6a73 6f6e 7374 725f 666c 6174  set(jsonstr_flat
+00012af0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00012b00: 2043 6f6e 7665 7274 2074 6865 2064 6174   Convert the dat
+00012b10: 6120 6167 6169 6e20 746f 2061 206c 6973  a again to a lis
+00012b20: 7420 6f66 206a 736f 6e20 6f62 6a65 6374  t of json object
+00012b30: 730a 2020 2020 2020 2020 2020 2020 6a73  s.            js
+00012b40: 6f6e 5f64 6973 7469 6e63 7420 3d20 5b6a  on_distinct = [j
+00012b50: 736f 6e2e 6c6f 6164 7328 6a73 6f6e 5f76  son.loads(json_v
+00012b60: 616c 7565 2920 666f 7220 6a73 6f6e 5f76  alue) for json_v
+00012b70: 616c 7565 2069 6e20 6a73 6f6e 7373 7472  alue in jsonsstr
+00012b80: 5f64 6973 7469 6e63 745d 0a0a 2020 2020  _distinct]..    
+00012b90: 2020 2020 2020 2020 2320 5265 7475 726e          # Return
+00012ba0: 2061 7320 6a73 6f6e 2073 7472 696e 670a   as json string.
+00012bb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012bc0: 726e 206a 736f 6e2e 6475 6d70 7328 6a73  rn json.dumps(js
+00012bd0: 6f6e 5f64 6973 7469 6e63 7429 0a0a 2020  on_distinct)..  
+00012be0: 2020 2020 2020 6167 6772 6567 6174 6564        aggregated
+00012bf0: 5f64 6174 6120 3d20 280a 2020 2020 2020  _data = (.      
+00012c00: 2020 2020 2020 6461 7461 2e67 726f 7570        data.group
+00012c10: 6279 282a 2a67 726f 7570 6279 5f6b 7761  by(**groupby_kwa
+00012c20: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00012c30: 202e 6170 706c 7928 6c61 6d62 6461 2067   .apply(lambda g
+00012c40: 3a20 6772 6f75 705f 666c 6174 7465 6e5f  : group_flatten_
+00012c50: 6a73 6f6e 5f6c 6973 7428 6729 290a 2020  json_list(g)).  
+00012c60: 2020 2020 2020 2020 2020 2e74 6f5f 6672            .to_fr
+00012c70: 616d 6528 6e61 6d65 3d22 5f5f 4449 5353  ame(name="__DISS
+00012c80: 4f4c 5645 5f54 4f4a 534f 4e22 290a 2020  OLVE_TOJSON").  
+00012c90: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+00012ca0: 3a0a 2020 2020 2020 2020 6167 6772 6567  :.        aggreg
+00012cb0: 6174 6564 5f64 6174 6120 3d20 6461 7461  ated_data = data
+00012cc0: 2e67 726f 7570 6279 282a 2a67 726f 7570  .groupby(**group
+00012cd0: 6279 5f6b 7761 7267 7329 2e61 6767 2861  by_kwargs).agg(a
+00012ce0: 6767 6675 6e63 290a 2020 2020 2020 2020  ggfunc).        
+00012cf0: 2320 4368 6563 6b20 6966 2061 6c6c 2063  # Check if all c
+00012d00: 6f6c 756d 6e73 2077 6572 6520 7072 6f70  olumns were prop
+00012d10: 6572 6c79 2061 6767 7265 6761 7465 640a  erly aggregated.
+00012d20: 2020 2020 2020 2020 6173 7365 7274 2062          assert b
+00012d30: 795f 6c6f 6361 6c20 6973 206e 6f74 204e  y_local is not N
+00012d40: 6f6e 650a 2020 2020 2020 2020 636f 6c75  one.        colu
+00012d50: 6d6e 735f 746f 5f61 6767 203d 205b 636f  mns_to_agg = [co
+00012d60: 6c75 6d6e 2066 6f72 2063 6f6c 756d 6e20  lumn for column 
+00012d70: 696e 2064 6174 612e 636f 6c75 6d6e 7320  in data.columns 
+00012d80: 6966 2063 6f6c 756d 6e20 6e6f 7420 696e  if column not in
+00012d90: 2062 795f 6c6f 6361 6c5d 0a20 2020 2020   by_local].     
+00012da0: 2020 2069 6620 6c65 6e28 636f 6c75 6d6e     if len(column
+00012db0: 735f 746f 5f61 6767 2920 213d 206c 656e  s_to_agg) != len
+00012dc0: 2861 6767 7265 6761 7465 645f 6461 7461  (aggregated_data
+00012dd0: 2e63 6f6c 756d 6e73 293a 0a20 2020 2020  .columns):.     
+00012de0: 2020 2020 2020 2064 726f 7070 6564 5f63         dropped_c
+00012df0: 6f6c 756d 6e73 203d 205b 0a20 2020 2020  olumns = [.     
+00012e00: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00012e10: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00012e20: 2020 666f 7220 636f 6c75 6d6e 2069 6e20    for column in 
+00012e30: 636f 6c75 6d6e 735f 746f 5f61 6767 0a20  columns_to_agg. 
+00012e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012e50: 6620 636f 6c75 6d6e 206e 6f74 2069 6e20  f column not in 
+00012e60: 6167 6772 6567 6174 6564 5f64 6174 612e  aggregated_data.
+00012e70: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+00012e80: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+00012e90: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00012ea0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00012eb0: 2020 2066 2243 6f6c 756d 6e28 7329 207b     f"Column(s) {
+00012ec0: 6472 6f70 7065 645f 636f 6c75 6d6e 737d  dropped_columns}
+00012ed0: 2061 7265 206e 6f74 2073 7570 706f 7274   are not support
+00012ee0: 6564 2066 6f72 2061 6767 7265 6761 7469  ed for aggregati
+00012ef0: 6f6e 2c20 7374 6f70 220a 2020 2020 2020  on, stop".      
+00012f00: 2020 2020 2020 290a 0a20 2020 2023 2050        )..    # P
+00012f10: 726f 6365 7373 2073 7061 7469 616c 2063  rocess spatial c
+00012f20: 6f6d 706f 6e65 6e74 0a20 2020 2064 6566  omponent.    def
+00012f30: 206d 6572 6765 5f67 656f 6d65 7472 6965   merge_geometrie
+00012f40: 7328 626c 6f63 6b29 3a0a 2020 2020 2020  s(block):.      
+00012f50: 2020 6d65 7267 6564 5f67 656f 6d20 3d20    merged_geom = 
+00012f60: 626c 6f63 6b2e 756e 6172 795f 756e 696f  block.unary_unio
+00012f70: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
+00012f80: 206d 6572 6765 645f 6765 6f6d 0a0a 2020   merged_geom..  
+00012f90: 2020 6720 3d20 6466 2e67 726f 7570 6279    g = df.groupby
+00012fa0: 2867 726f 7570 5f6b 6579 733d 4661 6c73  (group_keys=Fals
+00012fb0: 652c 202a 2a67 726f 7570 6279 5f6b 7761  e, **groupby_kwa
+00012fc0: 7267 7329 5b64 662e 6765 6f6d 6574 7279  rgs)[df.geometry
+00012fd0: 2e6e 616d 655d 2e61 6767 280a 2020 2020  .name].agg(.    
+00012fe0: 2020 2020 6d65 7267 655f 6765 6f6d 6574      merge_geomet
+00012ff0: 7269 6573 0a20 2020 2029 0a0a 2020 2020  ries.    )..    
+00013000: 2320 4167 6772 6567 6174 650a 2020 2020  # Aggregate.    
+00013010: 6167 6772 6567 6174 6564 5f67 656f 6d65  aggregated_geome
+00013020: 7472 7920 3d20 6770 642e 4765 6f44 6174  try = gpd.GeoDat
+00013030: 6146 7261 6d65 280a 2020 2020 2020 2020  aFrame(.        
+00013040: 6461 7461 3d67 2c20 6765 6f6d 6574 7279  data=g, geometry
+00013050: 3d64 662e 6765 6f6d 6574 7279 2e6e 616d  =df.geometry.nam
+00013060: 652c 2063 7273 3d64 662e 6372 730a 2020  e, crs=df.crs.  
+00013070: 2020 290a 2020 2020 2320 5265 636f 6d62    ).    # Recomb
+00013080: 696e 650a 2020 2020 6167 6772 6567 6174  ine.    aggregat
+00013090: 6564 203d 2061 6767 7265 6761 7465 645f  ed = aggregated_
+000130a0: 6765 6f6d 6574 7279 2e6a 6f69 6e28 6167  geometry.join(ag
+000130b0: 6772 6567 6174 6564 5f64 6174 6129 0a0a  gregated_data)..
+000130c0: 2020 2020 2320 5265 7365 7420 6966 2072      # Reset if r
+000130d0: 6571 7565 7374 6564 0a20 2020 2069 6620  equested.    if 
+000130e0: 6e6f 7420 6173 5f69 6e64 6578 3a0a 2020  not as_index:.  
+000130f0: 2020 2020 2020 6167 6772 6567 6174 6564        aggregated
+00013100: 203d 2061 6767 7265 6761 7465 642e 7265   = aggregated.re
+00013110: 7365 745f 696e 6465 7828 290a 0a20 2020  set_index()..   
+00013120: 2023 204d 616b 6520 7375 7265 206f 7574   # Make sure out
+00013130: 7075 7420 7479 7065 7320 6f66 2067 726f  put types of gro
+00013140: 7570 6564 2063 6f6c 756d 6e73 2061 7265  uped columns are
+00013150: 2074 6865 2073 616d 6520 6173 2069 6e70   the same as inp
+00013160: 7574 2074 7970 6573 2e0a 2020 2020 2320  ut types..    # 
+00013170: 452e 672e 206f 626a 6563 7420 636f 6c75  E.g. object colu
+00013180: 6d6e 7320 6265 636f 6d65 2066 6c6f 6174  mns become float
+00013190: 2069 6620 616c 6c20 7661 6c75 6573 2061   if all values a
+000131a0: 7265 204e 6f6e 652e 0a20 2020 2069 6620  re None..    if 
+000131b0: 6279 2069 7320 6e6f 7420 4e6f 6e65 3a0a  by is not None:.
+000131c0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000131d0: 7461 6e63 6528 6279 2c20 7374 7229 3a0a  tance(by, str):.
+000131e0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+000131f0: 7920 696e 2061 6767 7265 6761 7465 642e  y in aggregated.
+00013200: 636f 6c75 6d6e 7320 616e 6420 6466 5b62  columns and df[b
+00013210: 795d 2e64 7479 7065 2021 3d20 6167 6772  y].dtype != aggr
+00013220: 6567 6174 6564 5b62 795d 2e64 7479 7065  egated[by].dtype
+00013230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013240: 2020 6167 6772 6567 6174 6564 5b62 795d    aggregated[by]
+00013250: 203d 2061 6767 7265 6761 7465 645b 6279   = aggregated[by
+00013260: 5d2e 6173 7479 7065 2864 665b 6279 5d2e  ].astype(df[by].
+00013270: 6474 7970 6529 0a20 2020 2020 2020 2065  dtype).        e
+00013280: 6c69 6620 6973 696e 7374 616e 6365 2862  lif isinstance(b
+00013290: 792c 2049 7465 7261 626c 6529 3a0a 2020  y, Iterable):.  
+000132a0: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+000132b0: 6c20 696e 2062 793a 0a20 2020 2020 2020  l in by:.       
+000132c0: 2020 2020 2020 2020 2069 6620 636f 6c20           if col 
+000132d0: 696e 2061 6767 7265 6761 7465 642e 636f  in aggregated.co
+000132e0: 6c75 6d6e 7320 616e 6420 6466 5b63 6f6c  lumns and df[col
+000132f0: 5d2e 6474 7970 6520 213d 2061 6767 7265  ].dtype != aggre
+00013300: 6761 7465 645b 636f 6c5d 2e64 7479 7065  gated[col].dtype
+00013310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013320: 2020 2020 2020 6167 6772 6567 6174 6564        aggregated
+00013330: 5b63 6f6c 5d20 3d20 6167 6772 6567 6174  [col] = aggregat
+00013340: 6564 5b63 6f6c 5d2e 6173 7479 7065 2864  ed[col].astype(d
+00013350: 665b 636f 6c5d 2e64 7479 7065 290a 0a20  f[col].dtype).. 
+00013360: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+00013370: 616e 6365 2861 6767 7265 6761 7465 642c  ance(aggregated,
+00013380: 2067 7064 2e47 656f 4461 7461 4672 616d   gpd.GeoDataFram
+00013390: 6529 0a20 2020 2072 6574 7572 6e20 6167  e).    return ag
+000133a0: 6772 6567 6174 6564 0a0a 0a64 6566 205f  gregated...def _
+000133b0: 6164 645f 6f72 6465 7262 795f 636f 6c75  add_orderby_colu
+000133c0: 6d6e 2870 6174 683a 2050 6174 682c 206c  mn(path: Path, l
+000133d0: 6179 6572 3a20 7374 722c 206e 616d 653a  ayer: str, name:
+000133e0: 2073 7472 293a 0a20 2020 2023 2050 7265   str):.    # Pre
+000133f0: 7061 7265 2074 6865 2065 7870 7265 7373  pare the express
+00013400: 696f 6e20 746f 2063 616c 6375 6c61 7465  ion to calculate
+00013410: 2074 6865 206f 7264 6572 6279 2063 6f6c   the orderby col
+00013420: 756d 6e2e 0a20 2020 2023 2049 6e20 6120  umn..    # In a 
+00013430: 7370 6174 6961 6c20 6669 6c65 2c20 6120  spatial file, a 
+00013440: 7370 6174 6961 6c20 6f72 6465 7220 7769  spatial order wi
+00013450: 6c6c 206d 616b 6520 6c61 7465 7220 7573  ll make later us
+00013460: 6520 6d6f 7265 2065 6666 6963 69c3 ab6e  e more effici..n
+00013470: 742c 0a20 2020 2023 2073 6f20 7573 6520  t,.    # so use 
+00013480: 6120 6765 6f68 6173 682e 0a20 2020 206c  a geohash..    l
+00013490: 6179 6572 696e 666f 203d 2067 666f 2e67  ayerinfo = gfo.g
+000134a0: 6574 5f6c 6179 6572 696e 666f 2870 6174  et_layerinfo(pat
+000134b0: 6829 0a20 2020 2069 6620 6c61 7965 7269  h).    if layeri
+000134c0: 6e66 6f2e 6372 7320 6973 206e 6f74 204e  nfo.crs is not N
+000134d0: 6f6e 6520 616e 6420 6c61 7965 7269 6e66  one and layerinf
+000134e0: 6f2e 6372 732e 6973 5f67 656f 6772 6170  o.crs.is_geograp
+000134f0: 6869 633a 0a20 2020 2020 2020 2023 2049  hic:.        # I
+00013500: 6620 7468 6520 636f 6f72 6469 6e61 7465  f the coordinate
+00013510: 7320 6172 6520 6765 6f67 7261 7068 6963  s are geographic
+00013520: 2028 696e 206c 6174 2f6c 6f6e 2064 6567   (in lat/lon deg
+00013530: 7265 6573 292c 206f 6b0a 2020 2020 2020  rees), ok.      
+00013540: 2020 6578 7072 6573 7369 6f6e 203d 2066    expression = f
+00013550: 2253 545f 4765 6f48 6173 6828 7b6c 6179  "ST_GeoHash({lay
+00013560: 6572 696e 666f 2e67 656f 6d65 7472 7963  erinfo.geometryc
+00013570: 6f6c 756d 6e7d 2c20 3130 2922 0a20 2020  olumn}, 10)".   
+00013580: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+00013590: 2049 6620 7468 6579 2061 7265 206e 6f74   If they are not
+000135a0: 2067 656f 6772 6170 6869 6320 2869 6e20   geographic (in 
+000135b0: 6c61 742f 6c6f 6e20 6465 6772 6565 7329  lat/lon degrees)
+000135c0: 2c20 7468 6579 206e 6565 6420 746f 2062  , they need to b
+000135d0: 650a 2020 2020 2020 2020 2320 636f 6e76  e.        # conv
+000135e0: 6572 7465 6420 746f 207e 2064 6567 7265  erted to ~ degre
+000135f0: 6573 2074 6f20 6265 2061 626c 6520 746f  es to be able to
+00013600: 2063 616c 6375 6c61 7465 2061 2067 656f   calculate a geo
+00013610: 6861 7368 2e0a 0a20 2020 2020 2020 2023  hash...        #
+00013620: 2050 726f 7065 726c 7920 6361 6c63 756c   Properly calcul
+00013630: 6174 696e 6720 7468 6520 7472 616e 7366  ating the transf
+00013640: 6f72 6d61 7469 6f6e 2074 6f20 6567 2e20  ormation to eg. 
+00013650: 5747 5320 6973 2074 6572 7269 626c 7920  WGS is terribly 
+00013660: 736c 6f77 2e2e 2e0a 2020 2020 2020 2020  slow....        
+00013670: 2320 6578 7072 6573 7369 6f6e 203d 2066  # expression = f
+00013680: 2222 2253 545f 4765 6f48 6173 6828 5354  """ST_GeoHash(ST
+00013690: 5f54 7261 6e73 666f 726d 284d 616b 6550  _Transform(MakeP
+000136a0: 6f69 6e74 280a 2020 2020 2020 2020 2320  oint(.        # 
+000136b0: 2020 2020 2020 284d 6272 4d61 7858 2867        (MbrMaxX(g
+000136c0: 656f 6d29 2b4d 6272 4d69 6e58 2867 656f  eom)+MbrMinX(geo
+000136d0: 6d29 292f 322c 0a20 2020 2020 2020 2023  m))/2,.        #
+000136e0: 2020 2020 2020 2028 4d62 724d 696e 5928         (MbrMinY(
+000136f0: 6765 6f6d 292b 4d62 724d 6178 5928 6765  geom)+MbrMaxY(ge
+00013700: 6f6d 2929 2f32 2c20 5354 5f53 5249 4428  om))/2, ST_SRID(
+00013710: 6765 6f6d 2929 2c20 3433 3236 292c 2031  geom)), 4326), 1
+00013720: 3029 2222 220a 2020 2020 2020 2020 2320  0)""".        # 
+00013730: 536f 2c20 646f 2073 6f6d 6574 6869 6e67  So, do something
+00013740: 2065 6c73 6520 7468 6174 2773 2066 6173   else that's fas
+00013750: 7465 7220 616e 6420 7374 696c 6c20 6769  ter and still gi
+00013760: 7665 7320 6120 676f 6f64 0a20 2020 2020  ves a good.     
+00013770: 2020 2023 2067 656f 6772 6170 6869 6320     # geographic 
+00013780: 636c 7573 7465 7269 6e67 2e0a 2020 2020  clustering..    
+00013790: 2020 2020 746f 5f67 656f 6772 6170 6869      to_geographi
+000137a0: 635f 6661 6374 6f72 5f61 7070 726f 7820  c_factor_approx 
+000137b0: 3d20 3930 202f 206d 6178 286c 6179 6572  = 90 / max(layer
+000137c0: 696e 666f 2e74 6f74 616c 5f62 6f75 6e64  info.total_bound
+000137d0: 7329 0a20 2020 2020 2020 2065 7870 7265  s).        expre
+000137e0: 7373 696f 6e20 3d20 6622 2222 5354 5f47  ssion = f"""ST_G
+000137f0: 656f 4861 7368 284d 616b 6550 6f69 6e74  eoHash(MakePoint
+00013800: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00013810: 2020 2828 4d62 724d 6178 5828 7b6c 6179    ((MbrMaxX({lay
+00013820: 6572 696e 666f 2e67 656f 6d65 7472 7963  erinfo.geometryc
+00013830: 6f6c 756d 6e7d 290a 2020 2020 2020 2020  olumn}).        
+00013840: 2020 2020 2020 2020 2020 2b4d 6272 4d69            +MbrMi
+00013850: 6e58 287b 6c61 7965 7269 6e66 6f2e 6765  nX({layerinfo.ge
+00013860: 6f6d 6574 7279 636f 6c75 6d6e 7d29 292f  ometrycolumn}))/
+00013870: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+00013880: 2020 292a 7b74 6f5f 6765 6f67 7261 7068    )*{to_geograph
+00013890: 6963 5f66 6163 746f 725f 6170 7072 6f78  ic_factor_approx
+000138a0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+000138b0: 2020 2028 284d 6272 4d69 6e59 287b 6c61     ((MbrMinY({la
+000138c0: 7965 7269 6e66 6f2e 6765 6f6d 6574 7279  yerinfo.geometry
+000138d0: 636f 6c75 6d6e 7d29 0a20 2020 2020 2020  column}).       
+000138e0: 2020 2020 2020 2020 2020 202b 4d62 724d             +MbrM
+000138f0: 6178 5928 7b6c 6179 6572 696e 666f 2e67  axY({layerinfo.g
+00013900: 656f 6d65 7472 7963 6f6c 756d 6e7d 2929  eometrycolumn}))
+00013910: 2f32 0a20 2020 2020 2020 2020 2020 2020  /2.             
+00013920: 2020 2029 2a7b 746f 5f67 656f 6772 6170     )*{to_geograp
+00013930: 6869 635f 6661 6374 6f72 5f61 7070 726f  hic_factor_appro
+00013940: 787d 2c20 3433 3236 292c 2031 3029 2222  x}, 4326), 10)""
+00013950: 220a 0a20 2020 2023 204e 6f77 2077 6520  "..    # Now we 
+00013960: 6361 6e20 6163 7475 616c 6c79 2061 6464  can actually add
+00013970: 2074 6865 2063 6f6c 756d 6e2e 0a20 2020   the column..   
+00013980: 2067 666f 2e61 6464 5f63 6f6c 756d 6e28   gfo.add_column(
+00013990: 7061 7468 3d70 6174 682c 206e 616d 653d  path=path, name=
+000139a0: 6e61 6d65 2c20 7479 7065 3d67 666f 2e44  name, type=gfo.D
+000139b0: 6174 6154 7970 652e 5445 5854 2c20 6578  ataType.TEXT, ex
+000139c0: 7072 6573 7369 6f6e 3d65 7870 7265 7373  pression=express
+000139d0: 696f 6e29 0a20 2020 2073 716c 6974 655f  ion).    sqlite_
+000139e0: 7374 6d74 203d 2066 2743 5245 4154 4520  stmt = f'CREATE 
+000139f0: 494e 4445 5820 7b6e 616d 657d 5f69 6478  INDEX {name}_idx
+00013a00: 204f 4e20 227b 6c61 7965 727d 2228 7b6e   ON "{layer}"({n
+00013a10: 616d 657d 2927 0a20 2020 2067 666f 2e65  ame})'.    gfo.e
+00013a20: 7865 6375 7465 5f73 716c 2870 6174 683d  xecute_sql(path=
+00013a30: 7061 7468 2c20 7371 6c5f 7374 6d74 3d73  path, sql_stmt=s
+00013a40: 716c 6974 655f 7374 6d74 290a            qlite_stmt).
```

### Comparing `geofileops-0.8.0a6/geofileops/util/_geoops_ogr.py` & `geofileops-0.8.0a7/geofileops/util/_geoops_ogr.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/_geoops_sql.py` & `geofileops-0.8.0a7/geofileops/util/_geoops_sql.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,15 +21,15 @@
 from geofileops import GeofileType, GeometryType, PrimitiveType
 from geofileops import fileops
 from geofileops.fileops import _append_to_nolock
 from . import _general_util
 from . import _io_util
 from . import _ogr_sql_util
 from . import _ogr_util
-from ..helpers import _parameter_helper
+from geofileops.helpers import _parameter_helper
 from . import _processing_util
 from . import _sqlite_util
 
 ################################################################################
 # Some init
 ################################################################################
 
@@ -84,14 +84,15 @@
 
     # Go!
     # ---
     return _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name="buffer",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=force_output_geometrytype,
         gridsize=gridsize,
@@ -132,14 +133,15 @@
     # Go!
     # ---
     # Output geometry type same as input geometry type
     return _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name="convexhull",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=input_layerinfo.geometrytype,
         gridsize=gridsize,
@@ -179,14 +181,15 @@
 
     # Go!
     input_layer_info = gfo.get_layerinfo(input_path, input_layer)
     return _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name="delete_duplicate_geometries",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=input_layer_info.geometrytype,
         gridsize=gridsize,
@@ -222,14 +225,15 @@
            {batch_filter}
     """
 
     _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name="isvalid",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=GeometryType.POINT,
         gridsize=0.0,
@@ -324,14 +328,15 @@
            {{batch_filter}}
     """
 
     _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name=operation_name,
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=force_output_geometrytype,
         gridsize=0.0,
@@ -372,26 +377,27 @@
             logger.info(f"Stop select: output exists already {output_path}")
             return
     logger.debug(f"  -> select to execute:\n{sql_stmt}")
 
     # If no output geometrytype is specified, use the geometrytype of the input layer
     if force_output_geometrytype is None:
         force_output_geometrytype = gfo.get_layerinfo(
-            input_path, input_layer
+            input_path, input_layer, raise_on_nogeom=False
         ).geometrytype
         logger.info(
             "No force_output_geometrytype specified, so defaults to input layer "
             f"geometrytype: {force_output_geometrytype}"
         )
 
     # Go!
     return _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_stmt,
+        geom_selected=None,
         operation_name="select",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=force_output_geometrytype,
         gridsize=gridsize,
@@ -432,14 +438,15 @@
 
     # Output geometry type same as input geometry type
     input_layer_info = gfo.get_layerinfo(input_path, input_layer)
     return _single_layer_vector_operation(
         input_path=input_path,
         output_path=output_path,
         sql_template=sql_template,
+        geom_selected=True,
         operation_name="simplify",
         input_layer=input_layer,
         output_layer=output_layer,
         columns=columns,
         explodecollections=explodecollections,
         force_output_geometrytype=input_layer_info.geometrytype,
         gridsize=gridsize,
@@ -452,14 +459,15 @@
     )
 
 
 def _single_layer_vector_operation(
     input_path: Path,
     output_path: Path,
     sql_template: str,
+    geom_selected: Optional[bool],
     operation_name: str,
     input_layer: Optional[str],
     output_layer: Optional[str],
     columns: Optional[List[str]],
     explodecollections: bool,
     force_output_geometrytype: Optional[GeometryType],
     gridsize: float,
@@ -494,17 +502,19 @@
             return
         else:
             gfo.remove(output_path)
 
     # Calculate
     tempdir = _io_util.create_tempdir(f"geofileops/{operation_name.replace(' ', '_')}")
     try:
-        # If gridsize != 0.0 we need an sqlite file to be able to determine the columns
-        # later on.
-        convert_to_spatialite_based = False if gridsize == 0.0 else True
+        # If gridsize != 0.0 or if geom_selected is None we need an sqlite file to be
+        # able to determine the columns later on.
+        convert_to_spatialite_based = (
+            True if gridsize != 0.0 or geom_selected is None else False
+        )
         processing_params = _prepare_processing_params(
             input1_path=input_path,
             input1_layer=input_layer,
             input1_layer_alias="layer",
             tempdir=tempdir,
             nb_parallel=nb_parallel,
             batchsize=batchsize,
@@ -512,15 +522,17 @@
         )
         # If None is returned, just stop.
         if processing_params is None or processing_params.batches is None:
             return
 
         # Get layer info of the input layer to use
         assert processing_params.input1_path is not None
-        input_layerinfo = gfo.get_layerinfo(processing_params.input1_path, input_layer)
+        input_layerinfo = gfo.get_layerinfo(
+            processing_params.input1_path, input_layer, raise_on_nogeom=False
+        )
 
         # If multiple batches, there should be a batch_filter placeholder sql_template
         nb_batches = len(processing_params.batches)
         if nb_batches > 1:
             placeholders = [
                 name for _, name, _, _ in string.Formatter().parse(sql_template) if name
             ]
@@ -533,58 +545,77 @@
         # Format column string for use in select
         column_formatter = _ogr_sql_util.ColumnFormatter(
             columns_asked=columns,
             columns_in_layer=input_layerinfo.columns,
             fid_column=input_layerinfo.fid_column,
         )
 
+        #  to Check if a geometry column is available + selected
+        if geom_selected is None:
+            if input_layerinfo.geometrycolumn is None:
+                # There is no geometry column in the source file
+                geom_selected = False
+            else:
+                # There is a geometry column in the source file, check if it is selected
+                sql_tmp = sql_template.format(
+                    geometrycolumn=input_layerinfo.geometrycolumn,
+                    columns_to_select_str=column_formatter.prefixed_aliased(),
+                    input_layer=processing_params.input1_layer,
+                    batch_filter="",
+                )
+                cols = _sqlite_util.get_columns(
+                    sql_stmt=sql_tmp,
+                    input1_path=processing_params.input1_path,
+                )
+                geom_selected = input_layerinfo.geometrycolumn in cols
+
         # Fill out/add to the sql_template what is already possible
         # ---------------------------------------------------------
 
         # Add snaptogrid around sql_template if gridsize specified
-        if gridsize != 0.0:
+        if geom_selected and gridsize != 0.0:
             # Apply snaptogrid, but this results in invalid geometries, so also
             # ST_Makevalid. It can also result in collapsed (pieces of)
             # geometries, so also collectionextract.
             gridsize_op = (
                 f"ST_MakeValid(SnapToGrid(sub_gridsize.{{geometrycolumn}}, {gridsize}))"
             )
             if force_output_geometrytype is None:
                 warnings.warn(
                     "a gridsize is specified but no force_output_geometrytype, this "
-                    "can result in inconsistent geometries in the output"
+                    "can result in inconsistent geometries in the output",
+                    stacklevel=2,
                 )
             else:
                 primitivetypeid = force_output_geometrytype.to_primitivetype.value
                 gridsize_op = f"ST_CollectionExtract({gridsize_op}, {primitivetypeid})"
 
             # Get all columns of the sql_template
             sql_tmp = sql_template.format(
                 geometrycolumn=input_layerinfo.geometrycolumn,
                 columns_to_select_str=column_formatter.prefixed_aliased(),
                 input_layer=processing_params.input1_layer,
                 batch_filter="",
             )
             cols = _sqlite_util.get_columns(
-                sql_stmt=sql_tmp,
-                input1_path=processing_params.input1_path,  # type: ignore
+                sql_stmt=sql_tmp, input1_path=processing_params.input1_path
             )
             cols = [
                 col for col in cols if col.lower() != input_layerinfo.geometrycolumn
             ]
             columns_to_select = _ogr_sql_util.columns_quoted(cols)
             sql_template = f"""
                 SELECT {gridsize_op} AS {{geometrycolumn}}
                       {columns_to_select}
                   FROM ( {sql_template}
                     ) sub_gridsize
             """
 
         # If empty/null geometries don't need to be kept, filter them away
-        if not keep_empty_geoms:
+        if geom_selected and not keep_empty_geoms:
             sql_template = f"""
                 SELECT * FROM
                     ( {sql_template}
                     )
                  WHERE {{geometrycolumn}} IS NOT NULL
             """
 
@@ -602,15 +633,15 @@
             """
             # Where has been applied already so set to None.
             where = None
 
         # When null geometries are being kept, we need to make sure the geom in the
         # first row is not NULL because of a bug in gdal, so add ORDER BY as last step.
         #   -> https://github.com/geofileops/geofileops/issues/308
-        if keep_empty_geoms:
+        if geom_selected and keep_empty_geoms:
             sql_template = f"""
                 SELECT * FROM
                     ( {sql_template}
                     )
                  ORDER BY {{geometrycolumn}} IS NULL
             """
 
@@ -735,19 +766,35 @@
                     operation_name,
                     nb_parallel=nb_parallel,
                 )
 
         # Round up and clean up
         # Now create spatial index and move to output location
         if tmp_output_path.exists():
-            gfo.create_spatial_index(
-                path=tmp_output_path, layer=output_layer, exist_ok=True
-            )
+            if (
+                gfo.get_layerinfo(
+                    path=tmp_output_path, layer=output_layer, raise_on_nogeom=False
+                ).geometrycolumn
+                is not None
+            ):
+                gfo.create_spatial_index(
+                    path=tmp_output_path, layer=output_layer, exist_ok=True
+                )
             output_path.parent.mkdir(parents=True, exist_ok=True)
             gfo.move(tmp_output_path, output_path)
+        elif (
+            GeofileType(tmp_output_path) == GeofileType.ESRIShapefile
+            and tmp_output_path.with_suffix(".dbf").exists()
+        ):
+            # If the output shapefile doesn't have a geometry column, the .shp file
+            # doesn't exist but the .dbf does
+            output_path.parent.mkdir(parents=True, exist_ok=True)
+            gfo.move(
+                tmp_output_path.with_suffix(".dbf"), output_path.with_suffix(".dbf")
+            )
         else:
             logger.debug(f"Result of {operation_name} was empty!")
 
     finally:
         # Clean tmp dir
         shutil.rmtree(tempdir, ignore_errors=True)
 
@@ -2137,15 +2184,16 @@
             # Apply snaptogrid, but this results in invalid geometries, so also
             # ST_Makevalid. It can also result in collapsed (pieces of)
             # geometries, so also collectionextract.
             gridsize_op = f"ST_MakeValid(SnapToGrid(sub_gridsize.geom, {gridsize}))"
             if force_output_geometrytype is None:
                 warnings.warn(
                     "a gridsize is specified but no force_output_geometrytype, this "
-                    "can result in inconsistent geometries in the output"
+                    "can result in inconsistent geometries in the output",
+                    stacklevel=2,
                 )
             else:
                 primitivetypeid = force_output_geometrytype.to_primitivetype.value
                 gridsize_op = f"ST_CollectionExtract({gridsize_op}, {primitivetypeid})"
 
             # Get all columns of the sql_template
             sql_tmp = sql_template.format(
@@ -2429,15 +2477,17 @@
     batchsize: int = -1,
     input1_layer_alias: Optional[str] = None,
     input2_path: Optional[Path] = None,
     input2_layer: Optional[str] = None,
 ) -> Optional[ProcessingParams]:
     # Init
     returnvalue = ProcessingParams(nb_parallel=nb_parallel)
-    input1_layerinfo = gfo.get_layerinfo(input1_path, input1_layer)
+    input1_layerinfo = gfo.get_layerinfo(
+        input1_path, input1_layer, raise_on_nogeom=False
+    )
 
     # Determine the optimal number of parallel processes + batches
     if returnvalue.nb_parallel == -1:
         # If no batch size specified, put at least 100 rows in a batch
         if batchsize <= 0:
             min_rows_per_batch = 100
         else:
@@ -2495,15 +2545,18 @@
 
         # If input files are of the same format + are spatialite compatible,
         # just use them
         if input1_geofiletype.is_spatialite_based and (
             input2_geofiletype is None or input1_geofiletype == input2_geofiletype
         ):
             returnvalue.input1_path = input1_path
-            if input1_geofiletype == GeofileType.GPKG:
+            if (
+                input1_geofiletype == GeofileType.GPKG
+                and input1_layerinfo.geometrycolumn is not None
+            ):
                 # HasSpatialindex doesn't work for spatialite file
                 gfo.create_spatial_index(input1_path, input1_layer, exist_ok=True)
         else:
             # If not ok, copy the input layer to gpkg
             returnvalue.input1_path = tempdir / f"{input1_path.stem}.gpkg"
             gfo.copy_layer(
                 src=input1_path,
@@ -2515,15 +2568,21 @@
 
         if input2_path is not None and input2_geofiletype is not None:
             if (
                 input2_geofiletype == input1_geofiletype
                 and input2_geofiletype.is_spatialite_based
             ):
                 returnvalue.input2_path = input2_path
-                if input2_geofiletype == GeofileType.GPKG:
+                input2_layerinfo = gfo.get_layerinfo(
+                    input2_path, input2_layer, raise_on_nogeom=False
+                )
+                if (
+                    input2_geofiletype == GeofileType.GPKG
+                    and input2_layerinfo.geometrycolumn is not None
+                ):
                     # HasSpatialindex doesn't work for spatialite file
                     gfo.create_spatial_index(input2_path, input2_layer, exist_ok=True)
             else:
                 # If not spatialite compatible, copy the input layer to gpkg
                 returnvalue.input2_path = tempdir / f"{input2_path.stem}.gpkg"
                 gfo.copy_layer(
                     src=input2_path,
@@ -2538,15 +2597,17 @@
     if input2_path is None or input1_path == input2_path:
         returnvalue.input2_databasename = returnvalue.input1_databasename
     else:
         returnvalue.input2_databasename = "input2"
 
     # Prepare batches to process
     # Get column names and info
-    layer1_info = gfo.get_layerinfo(returnvalue.input1_path, returnvalue.input1_layer)
+    layer1_info = gfo.get_layerinfo(
+        returnvalue.input1_path, returnvalue.input1_layer, raise_on_nogeom=False
+    )
 
     # Check number of batches + appoint nb rows to batches
     nb_rows_input_layer = layer1_info.featurecount
     if nb_batches > int(nb_rows_input_layer / 10):
         nb_batches = max(int(nb_rows_input_layer / 10), 1)
 
     batches = {}
@@ -2563,20 +2624,16 @@
             SELECT MIN(rowid) minmax_rowid FROM "{layer1_info.name}"
             UNION ALL
             SELECT MAX(rowid) minmax_rowid FROM "{layer1_info.name}"
         """
         batch_info_df = gfo.read_file(
             path=returnvalue.input1_path, sql_stmt=sql_stmt, sql_dialect="SQLITE"
         )
-        min_rowid = pd.to_numeric(
-            batch_info_df["minmax_rowid"][0]
-        ).item()  # type: ignore
-        max_rowid = pd.to_numeric(
-            batch_info_df["minmax_rowid"][1]
-        ).item()  # type: ignore
+        min_rowid = pd.to_numeric(batch_info_df["minmax_rowid"][0]).item()
+        max_rowid = pd.to_numeric(batch_info_df["minmax_rowid"][1]).item()
 
         # Determine the exact batches to use
         if ((max_rowid - min_rowid) / nb_rows_input_layer) < 1.1:
             # If the rowid's are quite consecutive, use an imperfect, but
             # fast distribution in batches
             batch_info_list = []
             nb_rows_per_batch = round(nb_rows_input_layer / nb_batches)
```

### Comparing `geofileops-0.8.0a6/geofileops/util/_io_util.py` & `geofileops-0.8.0a7/geofileops/util/_io_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/_ogr_sql_util.py` & `geofileops-0.8.0a7/geofileops/util/_ogr_sql_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/_ogr_util.py` & `geofileops-0.8.0a7/geofileops/util/_ogr_util.py`

 * *Files 11% similar despite different names*

```diff
@@ -102,15 +102,15 @@
         output_layer=info.output_layer,
         input_srs=info.input_srs,
         output_srs=info.output_srs,
         reproject=info.reproject,
         spatial_filter=info.spatial_filter,
         clip_geometry=info.clip_geometry,
         sql_stmt=info.sql_stmt,
-        sql_dialect=info.sql_dialect,  # type: ignore
+        sql_dialect=info.sql_dialect,
         where=info.where,
         transaction_size=info.transaction_size,
         append=info.append,
         update=info.update,
         explodecollections=info.explodecollections,
         force_output_geometrytype=info.force_output_geometrytype,
         options=info.options,
@@ -147,16 +147,17 @@
     #   https://gdal.org/api/python/osgeo.gdal.html#osgeo.gdal.VectorTranslateOptions
     args = []
     if isinstance(input_path, str):
         input_path = Path(input_path)
     gdal_options = _prepare_gdal_options(options, split_by_option_type=True)
 
     # Input file parameters
+    input_filetype = GeofileType(input_path)
     # Cleanup the input_layers variable.
-    if input_path.suffix.lower() == ".shp":
+    if input_filetype == GeofileType.ESRIShapefile:
         # For shapefiles, having input_layers not None gives issues
         input_layers = None
     elif sql_stmt is not None:
         # If a sql statement is passed, the input layers are not relevant,
         # and ogr2ogr will give a warning, so clear it.
         input_layers = None
     if input_layers is not None and isinstance(input_layers, str):
@@ -207,15 +208,18 @@
     # Input dataset open options
     for option_name, value in gdal_options["INPUT_OPEN"].items():
         args.extend(["-oo", f"{option_name}={value}"])
 
     # Output file parameters
     # Get output format from the filename
     output_filetype = GeofileType(output_path)
-    input_filetype = GeofileType(input_path)
+
+    # Shapefiles only can have one layer, and the layer name == the stem of the file
+    if output_filetype == GeofileType.ESRIShapefile:
+        output_layer = output_path.stem
 
     # SRS
     if output_srs is not None and isinstance(output_srs, int):
         output_srs = f"EPSG:{output_srs}"
 
     # Output basic options
     if output_path.exists() is True:
@@ -324,14 +328,29 @@
                         raise RuntimeError(
                             f"input_layers {input_layers} not found in: {input_path}"
                         )
                     spatialref = datasource_layer.GetSpatialRef()
                     if spatialref is not None:
                         output_srs = spatialref.ExportToWkt()
 
+            # If the output is a shapefile and the input geometries are NULL, gdal
+            # creates an attribute column "geometry" in the output file. To be able to
+            # detect this case later on, check here if the input file already has an
+            # attribute column "geometry".
+            input_has_geom_attribute = False
+            input_has_geometry_attribute = False
+            input_layer = input_ds.GetLayer()
+            layer_defn = input_layer.GetLayerDefn()
+            for field_idx in range(layer_defn.GetFieldCount()):
+                field_name_lower = layer_defn.GetFieldDefn(field_idx).GetName().lower()
+                if field_name_lower == "geom":
+                    input_has_geom_attribute = True
+                elif field_name_lower == "geometry":
+                    input_has_geometry_attribute = True
+
             # Consolidate all parameters
             # First take copy of args, because gdal.VectorTranslateOptions adds all
             # other parameters to the list passed (by ref)!!!
             args_copy = list(args)
             options = gdal.VectorTranslateOptions(
                 options=args_copy,
                 format=output_filetype.ogrdriver,
@@ -380,37 +399,59 @@
                         logger.info(line)
                 errorlog_file.truncate(0)  # size '0' when using r+
 
         # If the resulting datasource is None, something went wrong
         if result_ds is None:
             raise GFOError(f"result_ds is None ({cpl_error})")
 
-        # If the output file is an empty shapefile and it was the result of a SQLITE sql
-        # statement, delete the "geom" or "geometry" column if it is present
-        # gdal bug documented in https://github.com/geofileops/geofileops/issues/313
-        if (
-            sql_stmt is not None
-            and sql_dialect == "SQLITE"
-            and output_path.suffix.lower() == ".shp"
-        ):
-            assert isinstance(result_ds, gdal.Dataset)
-            result_layer = result_ds.GetLayerByIndex(0)
-            if result_layer.GetFeatureCount() == 0:
-                layer_defn = result_layer.GetLayerDefn()
-                for field_idx in range(layer_defn.GetFieldCount()):
-                    field_name = layer_defn.GetFieldDefn(field_idx).GetName()
-                    if field_name.lower() in ["geom", "geometry"]:
-                        result_layer.DeleteField(field_idx)
-                        break
-
         # Sometimes an invalid output file is written, so close and try to reopen it.
         result_ds = None
         if output_path.exists():
             try:
-                result_ds = gdal.OpenEx(str(output_path))
+                result_ds = gdal.OpenEx(
+                    str(output_path), nOpenFlags=gdal.OF_VECTOR | gdal.OF_UPDATE
+                )
+
+                # If the (first) output row contains NULL as geom/geometry, gdal will
+                # add an attribute column with the name of the (alias of) the geometry
+                # column: so "geometry" or "geom".
+                # To fix this, delete the "geom" or "geometry" attribute column if
+                # present if the input file didn't have an attribute column with this
+                # name.
+                # Bug documented in https://github.com/geofileops/geofileops/issues/313
+                #
+                # Remark: this check must be done on the reopened output file because
+                # in some cases the "geometrycolumn" is incorrectly listed in the field
+                # list of the Dataset returned by VectorTranslate. E.g. when the input
+                # file is empty.
+                if not input_has_geometry_attribute or not input_has_geom_attribute:
+                    assert isinstance(result_ds, gdal.Dataset)
+                    if output_layer is not None:
+                        result_layer = result_ds.GetLayer(output_layer)
+                    elif result_ds.GetLayerCount() == 1:
+                        result_layer = result_ds.GetLayerByIndex(0)
+                    else:
+                        result_layer = None
+                        logger.warning(
+                            "Unable to determine output layer, so not able to remove "
+                            "possibly incorrect geom and geometry text columns, with "
+                            f"input_path: {input_path}, output_path: {output_path}"
+                        )
+
+                    # Output layer was found, so check it
+                    if result_layer is not None:
+                        layer_defn = result_layer.GetLayerDefn()
+                        for field_idx in range(layer_defn.GetFieldCount()):
+                            name = layer_defn.GetFieldDefn(field_idx).GetName().lower()
+                            if (name == "geom" and not input_has_geom_attribute) or (
+                                name == "geometry" and not input_has_geometry_attribute
+                            ):
+                                result_layer.DeleteField(field_idx)
+                                break
+
             except Exception as ex:
                 logger.info(
                     f"Opening output file gave error, probably the input file was "
                     f"empty, no rows were selected or geom was NULL: {ex}"
                 )
                 gfo.remove(output_path)
             finally:
```

### Comparing `geofileops-0.8.0a6/geofileops/util/_processing_util.py` & `geofileops-0.8.0a7/geofileops/util/_processing_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/_sqlite_util.py` & `geofileops-0.8.0a7/geofileops/util/_sqlite_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/geodataframe_util.py` & `geofileops-0.8.0a7/geofileops/util/geodataframe_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/geofiletype.py` & `geofileops-0.8.0a7/geofileops/util/geofiletype.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops/util/geofiletypes.csv` & `geofileops-0.8.0a7/geofileops/util/geofiletypes.csv`

 * *Files 22% similar despite different names*

```diff
@@ -1,6 +1,6 @@
-geofiletype,   ogrdriver,        suffixes,       is_fid_zerobased, is_spatialite_based, suffixes_extrafiles
-ESRIShapefile, "ESRI Shapefile", "['.shp']",     True,             False,               "['.shp', '.dbf', '.shx', '.prj', '.qix', '.sbn', '.sbx']"
-GeoJSON,       GeoJSON,          "['.geojson']", True,             False,               
-GPKG,          GPKG,             "['.gpkg']",    False,            True,                "['gpkg-journal']"
-SQLite,        SQLite,           "['.sqlite']",  False,            True,                
-FlatGeobuf,    FlatGeobuf,       "['.fgb']",     True,             False,               
+geofiletype,   ogrdriver,        suffixes,              is_fid_zerobased, is_spatialite_based, suffixes_extrafiles
+ESRIShapefile, "ESRI Shapefile", "['.shp', '.dbf']",    True,             False,               "['.shp', '.dbf', '.shx', '.prj', '.qix', '.sbn', '.sbx']"
+GeoJSON,       GeoJSON,          "['.geojson']",        True,             False,               
+GPKG,          GPKG,             "['.gpkg']",           False,            True,                "['gpkg-journal']"
+SQLite,        SQLite,           "['.sqlite']",         False,            True,                
+FlatGeobuf,    FlatGeobuf,       "['.fgb']",            True,             False,
```

### Comparing `geofileops-0.8.0a6/geofileops/util/geometry_util.py` & `geofileops-0.8.0a7/geofileops/util/geometry_util.py`

 * *Files 2% similar despite different names*

```diff
@@ -242,27 +242,21 @@
     Returns:
         sh_geom.base.BaseGeometry: List of primitive geometries, only
             containing the primitive type specified.
     """
     # Extract the polygons from the multipolygon, but store them as multipolygons anyway
     if geometry is None:
         return None
-    elif isinstance(geometry, sh_geom.Point) or isinstance(
-        geometry, sh_geom.MultiPoint
-    ):
+    elif isinstance(geometry, (sh_geom.MultiPoint, sh_geom.Point)):
         if primitivetype == PrimitiveType.POINT:
             return geometry
-    elif isinstance(geometry, sh_geom.LineString) or isinstance(
-        geometry, sh_geom.MultiLineString
-    ):
+    elif isinstance(geometry, (sh_geom.LineString, sh_geom.MultiLineString)):
         if primitivetype == PrimitiveType.LINESTRING:
             return geometry
-    elif isinstance(geometry, sh_geom.Polygon) or isinstance(
-        geometry, sh_geom.MultiPolygon
-    ):
+    elif isinstance(geometry, (sh_geom.MultiPolygon, sh_geom.Polygon)):
         if primitivetype == PrimitiveType.POLYGON:
             return geometry
     elif isinstance(geometry, sh_geom.GeometryCollection):
         returngeoms = []
         for geometry in sh_geom.GeometryCollection(geometry).geoms:
             returngeoms.append(
                 collection_extract(geometry, primitivetype=primitivetype)
@@ -602,20 +596,14 @@
         )
 
         # If the result is None and the topology needs to be preserved, return
         # original polygon
         if preserve_topology is True and result_poly is None:
             return polygon
 
-        # evade pyLance warning + return
-        assert (
-            result_poly is None
-            or isinstance(result_poly, sh_geom.Polygon)
-            or isinstance(result_poly, sh_geom.MultiPolygon)
-        )
         return result_poly
 
     def simplify_linestring(linestring: sh_geom.LineString) -> sh_geom.LineString:
         # If the linestring cannot be simplified, return it
         if linestring is None or len(linestring.coords) <= 2:
             return linestring
 
@@ -651,15 +639,15 @@
             raise Exception(
                 f"Unsupported algorithm: {algorithm}, supported: {SimplifyAlgorithm}"
             )
 
         coords_on_border_idx = []
         if keep_points_on is not None:
             coords_gdf = gpd.GeoDataFrame(
-                geometry=list(sh_geom.MultiPoint(coords).geoms)  # type: ignore
+                geometry=list(sh_geom.MultiPoint(coords).geoms)
             )
             coords_on_border_series = coords_gdf.intersects(keep_points_on)
             coords_on_border_idx = np.array(
                 coords_on_border_series.index[coords_on_border_series]
             )
 
         # Extracts coordinates that need to be kept
@@ -735,17 +723,15 @@
     # Determine the coordinates that need to be kept
     coords_to_keep_idx = simplify_coords_lang_idx(
         coords=coords_arr, tolerance=tolerance, lookahead=lookahead
     )
     coords_simplified_arr = coords_arr[coords_to_keep_idx]
 
     # If input was np.ndarray, return np.ndarray, otherwise list
-    if isinstance(coords, np.ndarray) or isinstance(
-        coords, sh_coords.CoordinateSequence
-    ):
+    if isinstance(coords, (np.ndarray, sh_coords.CoordinateSequence)):
         return coords_simplified_arr
     else:
         return coords_simplified_arr.tolist()
 
 
 def simplify_coords_lang_idx(
     coords: Union[np.ndarray, list, sh_coords.CoordinateSequence],
@@ -754,16 +740,16 @@
 ) -> Union[np.ndarray, list]:
     """
     Simplify a line using lang algorithm and return the coordinate indexes to
     be kept.
 
     Inspiration for the implementation came from:
         * https://github.com/giscan/Generalizer/blob/master/simplify.py
-        * https://github.com/keszegrobert/polyline-simplification/blob/master/6.%20Lang.ipynb  # noqa: E501
-        * https://web.archive.org/web/20171005193700/http://web.cs.sunyit.edu/~poissad/projects/Curve/about_algorithms/lang.php  # noqa: E501
+        * https://github.com/keszegrobert/polyline-simplification/blob/master/6.%20Lang.ipynb
+        * https://web.archive.org/web/20171005193700/http://web.cs.sunyit.edu/~poissad/projects/Curve/about_algorithms/lang.php
 
     Args:
         coords (Union[np.ndarray, list]): list of coordinates to be simplified.
         tolerance (float): distance tolerance to use.
         lookahead (int, optional): the number of points to consider for removing
             in a moving window. Defaults to 8.
```

### Comparing `geofileops-0.8.0a6/geofileops/util/geoseries_util.py` & `geofileops-0.8.0a7/geofileops/util/geoseries_util.py`

 * *Files 1% similar despite different names*

```diff
@@ -127,24 +127,24 @@
         # Too difficult to harmonize, so just return
         return geoseries
 
 
 def is_valid_reason(geoseries: gpd.GeoSeries) -> pd.Series:
     # Get result and keep geoseries indexes
     return pd.Series(
-        data=shapely2_or_pygeos.is_valid_reason(geoseries.array.data),  # type: ignore
+        data=shapely2_or_pygeos.is_valid_reason(geoseries.array.data),
         index=geoseries.index,
     )
 
 
 def _harmonize_to_multitype(
     geoseries: gpd.GeoSeries, dest_geometrytype: GeometryType
 ) -> gpd.GeoSeries:
     # Copy geoseries data to new array
-    geometries_arr = geoseries.array.data.copy()  # type: ignore
+    geometries_arr = geoseries.array.data.copy()
 
     # Set empty geometries to None
     empty_idxs = shapely2_or_pygeos.is_empty(geometries_arr)
     if empty_idxs.sum():
         geometries_arr[empty_idxs] = None
 
     # Cast all geometries that are not of the correct multitype yet
@@ -178,15 +178,15 @@
             )
     else:
         raise Exception(f"Unsupported destination GeometryType: {dest_geometrytype}")
 
     # Prepare result to return
     geoseries_result = gpd.GeoSeries(
         geometries_arr, index=geoseries.index, crs=geoseries.crs
-    )  # type: ignore
+    )
     assert isinstance(geoseries_result, gpd.GeoSeries)
     return geoseries_result
 
 
 def polygons_to_lines(geoseries: gpd.GeoSeries) -> gpd.GeoSeries:
     polygons_lines = []
     for geom in geoseries:
@@ -257,15 +257,15 @@
         # For LANG, a simple copy is OK
         assert isinstance(topolines_simpl, sh_geom.MultiLineString)
         topo.output["arcs"] = [list(geom.coords) for geom in topolines_simpl.geoms]
     else:
         # For RDP, only overwrite the lines that have a valid result
         for index in range(len(topo.output["arcs"])):
             # If the result of the simplify is a point, keep original
-            topoline_simpl = topolines_simpl.geoms[index].coords  # type: ignore
+            topoline_simpl = topolines_simpl.geoms[index].coords
             if len(topoline_simpl) < 2:
                 continue
             elif (
                 list(topoline_simpl[0]) != topo.output["arcs"][index][0]
                 or list(topoline_simpl[-1]) != topo.output["arcs"][index][-1]
             ):
                 # Start or end point of the simplified version is not the same anymore
```

### Comparing `geofileops-0.8.0a6/geofileops/util/grid_util.py` & `geofileops-0.8.0a7/geofileops/util/grid_util.py`

 * *Files 2% similar despite different names*

```diff
@@ -86,15 +86,15 @@
             )
             cell_top += height
             cell_bottom += height
 
         cell_left += width
         cell_right += width
 
-    return gpd.GeoDataFrame(geometry=polygons, crs=crs)  # type: ignore
+    return gpd.GeoDataFrame(geometry=polygons, crs=crs)
 
 
 def create_grid2(
     total_bounds: Tuple[float, float, float, float],
     nb_squarish_tiles: int,
     crs: Union[pyproj.CRS, int, str, None],
     nb_squarish_tiles_max: Optional[int] = None,
@@ -219,8 +219,8 @@
             curr_tiles_being_split = tmp_tiles_after_split
 
         # Copy the tile parts to the result and retain possible other columns
         for tile_split_part in curr_tiles_being_split:
             result_tiles.append(tile._replace(geometry=tile_split_part))
 
     # We should be ready...
-    return gpd.GeoDataFrame(data=result_tiles, crs=input_tiles.crs)  # type: ignore
+    return gpd.GeoDataFrame(data=result_tiles, crs=input_tiles.crs)
```

### Comparing `geofileops-0.8.0a6/geofileops/util/test.gpkg` & `geofileops-0.8.0a7/geofileops/util/test.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/geofileops.egg-info/PKG-INFO` & `geofileops-0.8.0a7/geofileops.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: geofileops
-Version: 0.8.0a6
+Version: 0.8.0a7
 Summary: Package to do spatial operations on large geo files.
 Home-page: https://github.com/geofileops/geofileops
 Author: Pieter Roggemans
 Author-email: pieter.roggemans@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: Operating System :: OS Independent
 Requires-Python: >=3.8
```

### Comparing `geofileops-0.8.0a6/geofileops.egg-info/SOURCES.txt` & `geofileops-0.8.0a7/geofileops.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 LICENSE.txt
 MANIFEST.in
 README.md
 pyproject.toml
-setup.cfg
 setup.py
 benchmark/__init__.py
 benchmark/benchmark_all.py
 benchmark/benchmark_geofileops.py
 benchmark/benchmarker.py
 benchmark/reporter.py
 benchmark/benchmarks/__init__.py
```

### Comparing `geofileops-0.8.0a6/setup.py` & `geofileops-0.8.0a7/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -17,15 +17,15 @@
     url="https://github.com/geofileops/geofileops",
     include_package_data=True,
     packages=setuptools.find_packages(),
     install_requires=[
         "cloudpickle",
         "fiona",
         "gdal",
-        "geopandas>=0.11,<1",
+        "geopandas>=0.11,<0.14",
         "numpy",
         "pandas",
         "psutil",
         "pyogrio",
         "pyproj",
         "shapely",
         "topojson",
```

### Comparing `geofileops-0.8.0a6/tests/data/BEFL-kbl.gpkg` & `geofileops-0.8.0a7/tests/data/BEFL-kbl.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/geofileops_testdata.qgz` & `geofileops-0.8.0a7/tests/data/geofileops_testdata.qgz`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/linestring-row-trees.gpkg` & `geofileops-0.8.0a7/tests/data/linestring-row-trees.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/linestring-watercourse.gpkg` & `geofileops-0.8.0a7/tests/data/linestring-watercourse.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/linestrings_hedges.gpkg` & `geofileops-0.8.0a7/tests/data/linestrings_hedges.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/point.gpkg` & `geofileops-0.8.0a7/tests/data/point.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-invalid.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-invalid.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-no-rows.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-no-rows.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-all.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-all.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-one.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-one.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-overlappingcircles-two+three.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-overlappingcircles-two+three.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-parcel.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-parcel.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-simplify-onborder-testcase.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-simplify-onborder-testcase.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-twolayers.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-twolayers.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygon-zone.gpkg` & `geofileops-0.8.0a7/tests/data/polygon-zone.gpkg`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygonstyle.qml` & `geofileops-0.8.0a7/tests/data/polygonstyle.qml`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/data/polygonstyle.sld` & `geofileops-0.8.0a7/tests/data/polygonstyle.sld`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_general_util.py` & `geofileops-0.8.0a7/tests/test_general_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_geofile.py` & `geofileops-0.8.0a7/tests/test_geofile.py`

 * *Files 10% similar despite different names*

```diff
@@ -44,15 +44,15 @@
     nb_points = 10
     gdf = gpd.GeoDataFrame(
         [
             {"geometry": sh_geom.Point(x, y), "value1": x + y, "value2": x * y}
             for x, y in zip(range(nb_points), range(nb_points))
         ],
         crs="epsg:4326",
-    )  # type: ignore
+    )
     return gdf
 
 
 def test_add_column(tmp_path):
     test_path = test_helper.get_testfile("polygon-parcel", dst_dir=tmp_path)
 
     # The area column shouldn't be in the test file yet
@@ -419,58 +419,105 @@
     test_path = tmp_path / f"{src.stem}_geometry{src.suffix}"
     gfo.copy_layer(src, test_path, force_output_geometrytype="GEOMETRY")
     assert gfo.get_layerinfo(test_path).geometrytypename == "GEOMETRY"
     geometrytypes = gfo.get_layer_geometrytypes(src)
     assert geometrytypes == ["POLYGON", "MULTIPOLYGON"]
 
 
-@pytest.mark.parametrize(
-    "testfile, suffix, layer",
-    [
-        ("polygon-parcel", ".gpkg", None),
-        ("polygon-parcel", ".shp", None),
-        ("polygon-twolayers", ".gpkg", "parcels"),
-    ],
-)
-def test_get_layerinfo(testfile, suffix, layer):
-    src = test_helper.get_testfile(testfile, suffix=suffix)
+@pytest.mark.parametrize("suffix", [".gpkg", ".shp"])
+def test_get_layerinfo(suffix):
+    src = test_helper.get_testfile("polygon-parcel", suffix=suffix)
     # Tests
-    layerinfo = gfo.get_layerinfo(src, layer)
+    layerinfo = gfo.get_layerinfo(src)
     assert str(layerinfo).startswith("<class 'geofileops.fileops.LayerInfo'>")
     assert layerinfo.featurecount == 46
+
     if src.suffix == ".shp":
         assert layerinfo.geometrycolumn == "geometry"
         assert layerinfo.name == src.stem
         assert layerinfo.fid_column == ""
     elif src.suffix == ".gpkg":
         assert layerinfo.geometrycolumn == "geom"
         assert layerinfo.name == "parcels"
         assert layerinfo.fid_column == "fid"
+
     assert layerinfo.geometrytypename == gfo.GeometryType.MULTIPOLYGON.name
     assert layerinfo.geometrytype == gfo.GeometryType.MULTIPOLYGON
-    assert len(layerinfo.columns) == 11
-    assert layerinfo.columns["OIDN"].gdal_type == "Integer64"
     assert layerinfo.total_bounds is not None
     assert layerinfo.crs is not None
     assert layerinfo.crs.to_epsg() == 31370
 
+    assert len(layerinfo.columns) == 11
+    assert layerinfo.columns["OIDN"].gdal_type == "Integer64"
+
     # Some tests for exception cases
     # Layer specified that doesn't exist
     with pytest.raises(ValueError, match="Layer not_existing_layer not found in file"):
         layerinfo = gfo.get_layerinfo(src, "not_existing_layer")
 
     # Path specified that doesn't exist
     with pytest.raises(ValueError, match="input_path doesn't exist"):
         not_existing_path = _io_util.with_stem(src, "not_existing_layer")
         layerinfo = gfo.get_layerinfo(not_existing_path)
 
-    # Multiple layers available, but no layer specified
-    if len(gfo.listlayers(src)) > 1:
-        with pytest.raises(ValueError, match="Layer has > 1 layer"):
-            layerinfo = gfo.get_layerinfo(src)
+
+def test_get_layerinfo_nogeom(tmp_path):
+    """
+    Test correct behaviour of get_layerinfo if file doesn't have a geometry column.
+
+    Remark: no use testing shapefile, as it doesn't have a .shp file without geometry
+    column, only a .dbf (and optional .cpg), so get_layerinfo doesn' work anyway!
+    """
+    # Prepare test data
+    src_geom_path = test_helper.get_testfile("polygon-parcel")
+    data_df = gfo.read_file(src_geom_path, ignore_geometry=True)
+    src = tmp_path / f"{src_geom_path.stem}_nogeom{src_geom_path.suffix}"
+    gfo.to_file(data_df, src)
+
+    # Test with raise_on_nogeom=True
+    # ------------------------------
+    with pytest.raises(ValueError, match="Layer doesn't have a geometry column"):
+        layerinfo = gfo.get_layerinfo(src, raise_on_nogeom=True)
+
+    # Test with raise_on_nogeom=False
+    # -------------------------------
+    layerinfo = gfo.get_layerinfo(src, raise_on_nogeom=False)
+    assert str(layerinfo).startswith("<class 'geofileops.fileops.LayerInfo'>")
+    assert layerinfo.featurecount == 46
+
+    assert layerinfo.geometrycolumn is None
+    assert layerinfo.name == src.stem
+    assert layerinfo.fid_column == "fid"
+
+    assert layerinfo.geometrytypename == "NONE"
+    assert layerinfo.geometrytype is None
+    assert layerinfo.total_bounds is None
+    assert layerinfo.crs is None
+
+    assert len(layerinfo.columns) == 11
+
+
+def test_get_layerinfo_twolayers():
+    src = test_helper.get_testfile("polygon-twolayers")
+
+    # Test first layer
+    layerinfo = gfo.get_layerinfo(src, "parcels")
+    assert layerinfo.featurecount == 46
+    assert layerinfo.name == "parcels"
+    assert len(layerinfo.columns) == 11
+
+    # Test second layer
+    layerinfo = gfo.get_layerinfo(src, "zones")
+    assert layerinfo.featurecount == 5
+    assert layerinfo.name == "zones"
+    assert len(layerinfo.columns) == 1
+
+    # Test error if no layer specified
+    with pytest.raises(ValueError, match="Layer has > 1 layer"):
+        layerinfo = gfo.get_layerinfo(src)
 
 
 @pytest.mark.parametrize("suffix", SUFFIXES)
 def test_get_only_layer_one_layer(suffix):
     # Test Geopackage with 1 layer
     src = test_helper.get_testfile("polygon-parcel", suffix=suffix)
     layer = gfo.get_only_layer(src)
@@ -1069,15 +1116,15 @@
     assert output_force_info.geometrytype == GeometryType.MULTIPOLYGON
 
 
 @pytest.mark.parametrize("suffix", SUFFIXES)
 def test_to_file_geomempty(tmp_path, suffix, engine_setter):
     # Test for gdf with an empty polygon + a polygon
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             sh_geom.GeometryCollection(),
             test_helper.TestData.polygon_with_island,
         ]
     )
     # By default, get_geometrytypes ignores the type of empty geometries.
     test_geometrytypes = geoseries_util.get_geometrytypes(test_gdf.geometry)
     assert len(test_geometrytypes) == 1
@@ -1108,15 +1155,15 @@
         assert test_read_geometrytypes[0] is GeometryType.POLYGON
 
 
 @pytest.mark.parametrize("suffix", SUFFIXES)
 def test_to_file_geomnone(tmp_path, suffix, engine_setter):
     # Test for gdf with a None geometry + a polygon
     test_gdf = gpd.GeoDataFrame(
-        geometry=[None, test_helper.TestData.polygon_with_island]  # type: ignore
+        geometry=[None, test_helper.TestData.polygon_with_island]
     )
     test_geometrytypes = geoseries_util.get_geometrytypes(test_gdf.geometry)
     assert len(test_geometrytypes) == 1
     output_none_path = tmp_path / f"file_with_nonegeom{suffix}"
     gfo.to_file(test_gdf, output_none_path)
 
     # Now check the result if the data is still the same after being read again
@@ -1175,15 +1222,15 @@
 
         # replicate pandas' default index names for regular and MultiIndex
         if index_cols == [None]:
             index_cols = ["index"]
         elif len(index_cols) > 1 and not all(index_cols):
             for level, index_col in enumerate(index_cols):
                 if index_col is None:
-                    index_cols[level] = "level_" + str(level)  # type: ignore
+                    index_cols[level] = "level_" + str(level)
 
         # check GeoDataFrame with default index=None to autodetect
         tempfilename = next(fngen)
         gfo.to_file(df, tempfilename, index=None)
         df_check = gfo.read_file(tempfilename)
         if len(other_cols) == 0:
             expected_cols = driver_col[:]
@@ -1206,108 +1253,143 @@
         df_check = gfo.read_file(tempfilename)
         if len(other_cols) == 0:
             expected_cols = driver_col + ["geometry"]
         else:
             expected_cols = other_cols + ["geometry"]
         assert list(df_check.columns) == expected_cols
 
-        return
-
     # Checks where index is not used/saved
     # ------------------------------------
 
     # index is a default RangeIndex
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
     do_checks(gdf, index_is_used=False)
 
     # index is a RangeIndex, starting from 1
     gdf.index += 1
     do_checks(gdf, index_is_used=False)
 
     # index is a Int64Index regular sequence from 1
     p_gdf.index = list(range(1, len(gdf) + 1))
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
     do_checks(gdf, index_is_used=False)
 
     # index was a default RangeIndex, but delete one row to make an Int64Index
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
     gdf = gdf.drop(5, axis=0)
     do_checks(gdf, index_is_used=False)
 
     # no other columns (except geometry)
-    gdf = gpd.GeoDataFrame(geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(geometry=p_gdf.geometry)
     do_checks(gdf, index_is_used=False)
 
     # Checks where index is used/saved
     # --------------------------------
 
     # named index
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
     gdf.index.name = "foo_index"
     do_checks(gdf, index_is_used=True)
 
     # named index, same as pandas' default name after .reset_index(drop=False)
     gdf.index.name = "index"
     do_checks(gdf, index_is_used=True)
 
     # named MultiIndex
     p_gdf = points_gdf.copy()
     p_gdf["value3"] = p_gdf["value2"] - p_gdf["value1"]
     p_gdf.set_index(["value1", "value2"], inplace=True)
-    gdf = gpd.GeoDataFrame(p_gdf, geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf, geometry=p_gdf.geometry)
     do_checks(gdf, index_is_used=True)
 
     # partially unnamed MultiIndex
-    gdf.index.names = ["first", None]  # type: ignore
+    gdf.index.names = ["first", None]
     do_checks(gdf, index_is_used=True)
 
     # unnamed MultiIndex
-    gdf.index.names = [None, None]  # type: ignore
+    gdf.index.names = [None, None]
     do_checks(gdf, index_is_used=True)
 
     # unnamed Float64Index
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
     gdf.index = p_gdf.index.astype(float) / 10
     do_checks(gdf, index_is_used=True)
 
     # named Float64Index
     gdf.index.name = "centile"
     do_checks(gdf, index_is_used=True)
 
     # index as string
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
-    gdf.index = pd.TimedeltaIndex(range(len(gdf)), "days")  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
+    gdf.index = pd.TimedeltaIndex(range(len(gdf)), "days")
     # TODO: TimedeltaIndex is an invalid field type
     gdf.index = gdf.index.astype(str)
     do_checks(gdf, index_is_used=True)
 
     # unnamed DatetimeIndex
     p_gdf = points_gdf.copy()
-    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)  # type: ignore
-    gdf.index = pd.TimedeltaIndex(
-        range(len(gdf)), "days"
-    ) + pd.DatetimeIndex(  # type: ignore
+    gdf = gpd.GeoDataFrame(p_gdf["value1"], geometry=p_gdf.geometry)
+    gdf.index = pd.TimedeltaIndex(range(len(gdf)), "days") + pd.DatetimeIndex(
         ["1999-12-27"] * len(gdf)
     )
     if suffix == ".shp":
         # Shapefile driver does not support datetime fields
         gdf.index = gdf.index.astype(str)
     do_checks(gdf, index_is_used=True)
 
     # named DatetimeIndex
     gdf.index.name = "datetime"
     do_checks(gdf, index_is_used=True)
 
 
 @pytest.mark.parametrize("suffix", SUFFIXES)
+def test_to_file_nogeom(tmp_path, suffix):
+    """
+    Remark: a shapefile doesn't have a .shp file without geometry column, only a .dbf
+    (and optional .cpg)!
+    """
+    # Prepare test data
+    input_geom_path = test_helper.get_testfile("polygon-parcel", suffix=suffix)
+    input_df = gfo.read_file(input_geom_path, ignore_geometry=True)
+    test_path = tmp_path / f"{input_geom_path.stem}_nogeom{suffix}"
+    gfo.to_file(input_df, test_path)
+
+    # Check the file written
+    if suffix == ".gpkg":
+        layerinfo = gfo.get_layerinfo(test_path, raise_on_nogeom=False)
+        assert str(layerinfo).startswith("<class 'geofileops.fileops.LayerInfo'>")
+        assert layerinfo.featurecount == 46
+
+        assert layerinfo.geometrycolumn is None
+        assert layerinfo.name == test_path.stem
+        assert layerinfo.fid_column == "fid"
+
+        assert layerinfo.geometrytypename == "NONE"
+        assert layerinfo.geometrytype is None
+        assert layerinfo.total_bounds is None
+        assert layerinfo.crs is None
+
+        assert len(layerinfo.columns) == 11
+    elif suffix == ".shp":
+        # a shapefile doesn't have a .shp file without geometry column, only a .dbf
+        # (and optional .cpg).
+        assert not test_path.exists()
+        test_df = gfo.read_file(test_path.with_suffix(".dbf"))
+        assert len(test_df) == 46
+        assert len(test_df.columns) == 11
+    else:
+        raise ValueError(f"test not implemented for suffix {suffix}")
+
+
+@pytest.mark.parametrize("suffix", SUFFIXES)
 def test_remove(tmp_path, suffix):
     # Prepare test data
     src = test_helper.get_testfile("polygon-parcel", dst_dir=tmp_path, suffix=suffix)
     assert src.exists()
 
     # Remove and check result
     gfo.remove(src)
```

### Comparing `geofileops-0.8.0a6/tests/test_geofileops_singlelayer.py` & `geofileops-0.8.0a7/tests/test_geofileops_singlelayer.py`

 * *Files 0% similar despite different names*

```diff
@@ -377,14 +377,15 @@
         batchsize=batchsize,
     )
 
     # Now check if the output file is correctly created
     assert output_path.exists()
     assert fileops.has_spatial_index(output_path)
     output_layerinfo = fileops.get_layerinfo(output_path)
+    assert len(output_layerinfo.columns) == len(input_layerinfo.columns)
 
     if input_layerinfo.geometrytype in [
         GeometryType.MULTIPOINT,
         GeometryType.MULTILINESTRING,
     ]:
         # A Negative buffer of points or linestrings gives NULL geometries
         if keep_empty_geoms:
@@ -394,20 +395,18 @@
                 # The None geoms aren't properly detected as geometry in shp, so becomes
                 # an extra attribute column...
                 # assert len(output_layerinfo.columns) == len(input_layerinfo.columns)
                 pass
         else:
             # Everything is filtered away...
             assert output_layerinfo.featurecount == 0
-            assert len(output_layerinfo.columns) == len(input_layerinfo.columns)
 
     else:
         # A Negative buffer of polygons gives a result for large polygons.
         # 7 polygons disappear because of the negative buffer
-        assert len(output_layerinfo.columns) == len(input_layerinfo.columns)
         assert output_layerinfo.geometrytype == GeometryType.MULTIPOLYGON
 
         # Read result for some more detailed checks
         output_gdf = fileops.read_file(output_path)
 
         # Prepare expected result
         expected_gdf = fileops.read_file(input_path)
```

### Comparing `geofileops-0.8.0a6/tests/test_geofileops_singlelayer_gpd.py` & `geofileops-0.8.0a7/tests/test_geofileops_singlelayer_gpd.py`

 * *Files 0% similar despite different names*

```diff
@@ -44,15 +44,15 @@
 def test_apply(tmp_path, suffix, only_geom_input, gridsize, keep_empty_geoms, where):
     # Prepare test data
     test_gdf = gpd.GeoDataFrame(
         data=[
             {"uidn": 1, "geometry": test_helper.TestData.polygon_small_island},
             {"uidn": 2, "geometry": test_helper.TestData.polygon_with_island},
         ],
-        crs=31370,  # type: ignore
+        crs=31370,
     )
     input_path = tmp_path / f"polygons_small_holes_{suffix}"
     gfo.to_file(test_gdf, input_path)
     output_path = tmp_path / f"{input_path.stem}-output{suffix}"
     input_layerinfo = gfo.get_layerinfo(input_path)
     batchsize = math.ceil(input_layerinfo.featurecount / 2)
 
@@ -133,15 +133,15 @@
     # Prepare test data
     test_gdf = gpd.GeoDataFrame(
         data=[
             {"id": 1, "geometry": test_helper.TestData.polygon_small_island},
             {"id": 2, "geometry": test_helper.TestData.polygon_with_island},
             {"id": 3, "geometry": None},
         ],
-        crs=31370,  # type: ignore
+        crs=31370,
     )
     input_path = tmp_path / f"polygons_small_holes_{suffix}"
     gfo.to_file(test_gdf, input_path)
     output_path = tmp_path / f"{input_path.stem}-output{suffix}"
     input_layerinfo = gfo.get_layerinfo(input_path)
     batchsize = math.ceil(input_layerinfo.featurecount / 2)
 
@@ -207,15 +207,15 @@
 
 
 def test_apply_geooperation_invalid_operation(tmp_path):
     with pytest.raises(ValueError, match="operation not supported: INVALID"):
         geoops_gpd._apply_geooperation(
             input_path=test_helper.get_testfile("polygon-parcel"),
             output_path=tmp_path / "output.gpkg",
-            operation="INVALID",  # type: ignore
+            operation="INVALID",
             operation_params={},
         )
 
 
 @pytest.mark.parametrize(
     "suffix, epsg", [(".gpkg", 31370), (".gpkg", 4326), (".shp", 31370)]
 )
@@ -585,22 +585,20 @@
     assert input_gdf.crs == output_gdf.crs
     assert len(output_gdf) == output_layerinfo.featurecount
     assert output_gdf["geometry"][0] is not None
 
     # Compare result expected values using geopandas
     columns = ["geometry"]
     if groupby_columns is None or len(groupby_columns) == 0:
-        expected_gdf = input_gdf[columns].dissolve()  # type: ignore
+        expected_gdf = input_gdf[columns].dissolve()
     else:
         groupby_columns_upper = {column.upper(): column for column in groupby_columns}
         columns += list(groupby_columns_upper)
         expected_gdf = (
-            input_gdf[columns]
-            .dissolve(by=list(groupby_columns_upper))  # type: ignore
-            .reset_index()
+            input_gdf[columns].dissolve(by=list(groupby_columns_upper)).reset_index()
         ).rename(columns=groupby_columns_upper)
     expected_gdf = test_helper.prepare_expected_result(
         expected_gdf,
         explodecollections=explode,
         gridsize=gridsize,
         keep_empty_geoms=False,
         where=where,
@@ -640,15 +638,15 @@
     elif testfile == "linestring-row-trees":
         groupby_columns = ["rowtype"]
         expected_geometrytype = GeometryType.LINESTRING
     elif testfile == "point":
         groupby_columns = ["type"]
         expected_geometrytype = GeometryType.POINT
     else:
-        raise ValueError(f"unimplimentd testfile: {testfile}")
+        raise ValueError(f"unimplimented testfile: {testfile}")
     if not explodecollections or suffix == ".shp":
         expected_geometrytype = expected_geometrytype.to_multitype
 
     gfo.dissolve(
         input_path=input_path,
         output_path=output_path,
         explodecollections=explodecollections,
@@ -978,17 +976,17 @@
     assert output_gdf["gwsgrp_cnt"][grasland_idx] == 30
     assert output_gdf["lbl_count"][grasland_idx] == 30
     print(f"output_gdf.lbl_concat_distinct: {output_gdf['lbl_conc_d'][grasland_idx]}")
     assert output_gdf["lbl_cnt_d"][grasland_idx] == 1
     assert output_gdf["lbl_conc"][grasland_idx].startswith("Grasland,Grasland,")
     assert output_gdf["lbl_conc_s"][grasland_idx].startswith("Grasland;Grasland;")
     assert output_gdf["lbl_conc_d"][grasland_idx] == "Grasland"
-    assert output_gdf["tlt_mea"][grasland_idx] == 60  # type: ignore
-    assert int(output_gdf["tlt_min"][grasland_idx]) == 60  # type: ignore
-    assert output_gdf["tlt_sum"][grasland_idx] == 1800  # type: ignore
+    assert output_gdf["tlt_mea"][grasland_idx] == 60
+    assert int(output_gdf["tlt_min"][grasland_idx]) == 60
+    assert output_gdf["tlt_sum"][grasland_idx] == 1800
 
     groenten_idx = output_gdf[
         output_gdf["GEWASGROEP"] == "Groenten, kruiden en sierplanten"
     ].index.to_list()[0]
     assert output_gdf["lbl_count"][groenten_idx] == 5
     print(
         "groenten.lblhfdtlt_concat_distinct: "
```

### Comparing `geofileops-0.8.0a6/tests/test_geofileops_singlelayer_ogr.py` & `geofileops-0.8.0a7/tests/test_geofileops_singlelayer_ogr.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_geofileops_singlelayer_sql.py` & `geofileops-0.8.0a7/tests/test_geofileops_singlelayer_sql.py`

 * *Files 8% similar despite different names*

```diff
@@ -23,22 +23,22 @@
 from tests.test_helper import assert_geodataframe_equal
 
 
 @pytest.mark.parametrize("gridsize", [0.0, 0.1])
 def test_delete_duplicate_geometries(tmp_path, gridsize):
     # Prepare test data
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.polygon_no_islands,
             test_helper.TestData.polygon_no_islands,
             test_helper.TestData.polygon_with_island2,
         ],
-        crs=test_helper.TestData.crs_epsg,  # type: ignore
+        crs=test_helper.TestData.crs_epsg,
     )
     expected_gdf = test_gdf.iloc[[0, 2, 4]].reset_index(drop=True)
     suffix = ".gpkg"
     input_path = tmp_path / f"input_test_data{suffix}"
     gfo.to_file(test_gdf, input_path)
     input_info = gfo.get_layerinfo(input_path)
 
@@ -199,17 +199,15 @@
             Polygon([(0, 5), (5, 5), (5, 10), (0, 10), (0, 5)]),
         ),
     ],
 )
 def test_makevalid_gridsize(tmp_path, descr: str, geometry, expected_geometry):
     # Prepare test data
     # -----------------
-    input_gdf = gpd.GeoDataFrame(
-        {"descr": [descr]}, geometry=[geometry], crs=31370
-    )  # type: ignore
+    input_gdf = gpd.GeoDataFrame({"descr": [descr]}, geometry=[geometry], crs=31370)
     input_path = tmp_path / "test.gpkg"
     gfo.to_file(input_gdf, input_path)
     gridsize = 1
 
     # Now we are ready to test
     # ------------------------
     result_path = tmp_path / "test_makevalid.gpkg"
@@ -220,15 +218,15 @@
         force=True,
     )
     result_gdf = gfo.read_file(result_path)
 
     # Compare with expected result
     expected_gdf = gpd.GeoDataFrame(
         {"descr": [descr]}, geometry=[expected_geometry], crs=31370
-    )  # type: ignore
+    )
     expected_gdf = expected_gdf[~expected_gdf.geometry.is_empty]
     if len(expected_gdf) == 0:
         assert len(result_gdf) == 0
     else:
         assert_geodataframe_equal(result_gdf, expected_gdf)
 
 
@@ -437,18 +435,95 @@
     # Prepare test data
     input_path = test_helper.get_testfile("polygon-parcel", suffix=suffix)
 
     # Now run test
     output_path = tmp_path / f"{input_path.stem}-output{suffix}"
     sql_stmt = 'SELECT {geometrycolumn}, not_existing_column FROM "{input_layer}"'
 
-    with pytest.raises(Exception, match="Error <"):
+    with pytest.raises(Exception, match="Error no such column"):
         gfo.select(input_path=input_path, output_path=output_path, sql_stmt=sql_stmt)
 
 
+@pytest.mark.parametrize("suffix", SUFFIXES)
+@pytest.mark.parametrize("gridsize", [0.0, 0.01])
+def test_select_nogeom_in_input(tmp_path, suffix, gridsize):
+    # Prepare test data
+    input_geom_path = test_helper.get_testfile("polygon-parcel", suffix=suffix)
+    data_df = gfo.read_file(input_geom_path, ignore_geometry=True)
+    input_path = tmp_path / f"{input_geom_path.stem}_nogeom{suffix}"
+    gfo.to_file(data_df, input_path)
+
+    # Now run test
+    output_path = tmp_path / f"{input_path.stem}-output{suffix}"
+    sql_stmt = 'SELECT * FROM "{input_layer}"'
+
+    # Column casing seems to behave odd: without gridsize (=subselect) results in upper
+    # casing regardless of quotes or not, with gridsize (=subselect) casing in select is
+    # retained in output.
+    if suffix == ".shp":
+        input_path = input_path.with_suffix(".dbf")
+    gfo.select(
+        input_path=input_path,
+        output_path=output_path,
+        sql_stmt=sql_stmt,
+        gridsize=gridsize,
+    )
+
+    # Now check if the tmp file is correctly created
+    if suffix == ".shp":
+        output_path = output_path.with_suffix(".dbf")
+    layerinfo_output = gfo.get_layerinfo(output_path, raise_on_nogeom=False)
+    layerinfo_input = gfo.get_layerinfo(input_path, raise_on_nogeom=False)
+    assert layerinfo_input.featurecount == layerinfo_output.featurecount
+    columns_output_upper = [col.upper() for col in layerinfo_output.columns]
+    assert "OIDN" in columns_output_upper
+    assert "UIDN" in columns_output_upper
+    assert len(layerinfo_output.columns) == len(layerinfo_input.columns)
+
+    assert layerinfo_output.geometrycolumn is None
+    assert layerinfo_output.geometrytype is None
+
+
+@pytest.mark.parametrize("suffix", SUFFIXES)
+@pytest.mark.parametrize("gridsize", [0.0, 0.01])
+def test_select_nogeom_selected(tmp_path, suffix, gridsize):
+    # Prepare test data
+    input_path = test_helper.get_testfile("polygon-parcel", suffix=suffix)
+
+    # Now run test
+    output_path = tmp_path / f"{input_path.stem}-output{suffix}"
+    layerinfo_input = gfo.get_layerinfo(input_path)
+    sql_stmt = 'SELECT "oidn", "UIDN" FROM "{input_layer}"'
+
+    # Column casing seems to behave odd: without gridsize (=subselect) results in upper
+    # casing rgardless of quotes or not, with gridsize (=subselect) casing in select is
+    # retained in output.
+    gfo.select(
+        input_path=input_path,
+        output_path=output_path,
+        sql_stmt=sql_stmt,
+        gridsize=gridsize,
+    )
+
+    # Now check if the tmp file is correctly created
+    layerinfo_output = gfo.get_layerinfo(output_path)
+    assert layerinfo_input.featurecount == layerinfo_output.featurecount
+    columns_output_upper = [col.upper() for col in layerinfo_output.columns]
+    assert "OIDN" in columns_output_upper
+    assert "UIDN" in columns_output_upper
+    assert len(layerinfo_output.columns) == 2
+    assert layerinfo_output.geometrytype == GeometryType.MULTIPOLYGON
+
+    # Now check the contents of the result file
+    output_gdf = gfo.read_file(output_path)
+
+    # A geometry column is present even though it isn't selected, but values are None
+    assert output_gdf["geometry"][0] is None
+
+
 def test_select_output_exists(tmp_path):
     # Prepare test data
     input_path = test_helper.get_testfile("polygon-parcel")
     output_path = tmp_path / f"{input_path.stem}-output{input_path.suffix}"
     output_path.touch()
     sql_stmt = 'SELECT {geometrycolumn}, oidn, uidn FROM "{input_layer}"'
```

### Comparing `geofileops-0.8.0a6/tests/test_geofileops_twolayers.py` & `geofileops-0.8.0a7/tests/test_geofileops_twolayers.py`

 * *Files 1% similar despite different names*

```diff
@@ -119,15 +119,15 @@
     assert gfo.has_spatial_index(output_path)
     output_gdf = gfo.read_file(output_path)
     input_gdf = gfo.read_file(input_path)
     erase_gdf = gfo.read_file(erase_path)
     output_gpd_gdf = gpd.overlay(
         input_gdf, erase_gdf, how="difference", keep_geom_type=True
     )
-    output_gpd_gdf = output_gpd_gdf.explode(ignore_index=True)  # type: ignore
+    output_gpd_gdf = output_gpd_gdf.explode(ignore_index=True)
     assert_geodataframe_equal(
         output_gdf,
         output_gpd_gdf,
         promote_to_multi=True,
         sort_values=True,
         check_less_precise=True,
         normalize=True,
@@ -260,18 +260,15 @@
 
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     overlay_operation = "intersection"
     expected_gdf = input1_gdf.overlay(
         input2_gdf, how=overlay_operation, keep_geom_type=True
     )
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(expected_gdf.columns, output_gdf.columns)
-    }
+    renames = dict(zip(expected_gdf.columns, output_gdf.columns))
     expected_gdf = expected_gdf.rename(columns=renames)
     if gridsize != 0.0:
         expected_gdf.geometry = shapely2_or_pygeos.set_precision(
             expected_gdf.geometry.array.data, grid_size=gridsize
         )
     if explodecollections:
         expected_gdf = expected_gdf.explode(ignore_index=True)
@@ -1003,18 +1000,15 @@
     # Check the contents of the result file
     # TODO: this test should be more elaborate...
     output_gfo_gdf = gfo.read_file(output_path)
     assert output_gfo_gdf["geometry"][0] is not None
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     output_gpd_gdf = input1_gdf.overlay(input2_gdf, how="identity", keep_geom_type=True)
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(output_gpd_gdf.columns, output_gfo_gdf.columns)
-    }
+    renames = dict(zip(output_gpd_gdf.columns, output_gfo_gdf.columns))
     output_gpd_gdf = output_gpd_gdf.rename(columns=renames)
     if gridsize != 0.0:
         output_gpd_gdf.geometry = shapely2_or_pygeos.set_precision(
             output_gpd_gdf.geometry.array.data, grid_size=gridsize
         )
     # OIDN is float vs int? -> check_column_type=False
     assert_geodataframe_equal(
@@ -1054,18 +1048,15 @@
     output_gfo_gdf = gfo.read_file(output_path)
     assert output_gfo_gdf["geometry"][0] is not None
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     output_gpd_gdf = input1_gdf.overlay(
         input2_gdf, how="symmetric_difference", keep_geom_type=True
     )
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(output_gpd_gdf.columns, output_gfo_gdf.columns)
-    }
+    renames = dict(zip(output_gpd_gdf.columns, output_gfo_gdf.columns))
     output_gpd_gdf = output_gpd_gdf.rename(columns=renames)
     if gridsize != 0.0:
         output_gpd_gdf.geometry = shapely2_or_pygeos.set_precision(
             output_gpd_gdf.geometry.array.data, grid_size=gridsize
         )
     assert_geodataframe_equal(
         output_gfo_gdf,
@@ -1129,18 +1120,15 @@
 
     # Check the contents of the result file
     output_gfo_gdf = gfo.read_file(output_path)
     assert output_gfo_gdf["geometry"][0] is not None
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     output_gpd_gdf = input1_gdf.overlay(input2_gdf, how="union", keep_geom_type=True)
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(output_gpd_gdf.columns, output_gfo_gdf.columns)
-    }
+    renames = dict(zip(output_gpd_gdf.columns, output_gfo_gdf.columns))
     output_gpd_gdf = output_gpd_gdf.rename(columns=renames)
     output_gpd_gdf["l1_DATUM"] = pd.to_datetime(output_gpd_gdf["l1_DATUM"])
     if gridsize != 0.0:
         output_gpd_gdf.geometry = shapely2_or_pygeos.set_precision(
             output_gpd_gdf.geometry.array.data, grid_size=gridsize
         )
     if explodecollections:
@@ -1195,18 +1183,15 @@
 
     # Check the contents of the result file
     output_gdf = gfo.read_file(output_path)
     assert output_gdf["geometry"][0] is not None
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     output_gpd_gdf = input1_gdf.overlay(input2_gdf, how="union", keep_geom_type=True)
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(output_gpd_gdf.columns, output_gdf.columns)
-    }
+    renames = dict(zip(output_gpd_gdf.columns, output_gdf.columns))
     output_gpd_gdf = output_gpd_gdf.rename(columns=renames)
     assert_geodataframe_equal(
         output_gdf,
         output_gpd_gdf,
         promote_to_multi=True,
         sort_values=True,
         check_less_precise=True,
@@ -1250,18 +1235,15 @@
 
     # Check the contents of the result file
     output_gdf = gfo.read_file(output_path)
     assert output_gdf["geometry"][0] is not None
     input1_gdf = gfo.read_file(input1_path)
     input2_gdf = gfo.read_file(input2_path)
     output_gpd_gdf = input1_gdf.overlay(input2_gdf, how="union", keep_geom_type=True)
-    renames = {
-        name_gpd: name_gfo
-        for name_gpd, name_gfo in zip(output_gpd_gdf.columns, output_gdf.columns)
-    }
+    renames = dict(zip(output_gpd_gdf.columns, output_gdf.columns))
     output_gpd_gdf = output_gpd_gdf.rename(columns=renames)
     assert_geodataframe_equal(
         output_gdf,
         output_gpd_gdf,
         promote_to_multi=True,
         sort_values=True,
         check_less_precise=True,
```

### Comparing `geofileops-0.8.0a6/tests/test_geofiletype.py` & `geofileops-0.8.0a7/tests/test_geofiletype.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_geometry_util.py` & `geofileops-0.8.0a7/tests/test_geometry_util.py`

 * *Files 1% similar despite different names*

```diff
@@ -233,15 +233,18 @@
     multipoly_removerings = sh_geom.MultiPolygon(
         [polygon_removerings_withholes, polygon_removerings_noholes]
     )
     poly_result = geometry_util.remove_inner_rings(
         multipoly_removerings, min_area_to_keep=3, crs=None
     )
     assert isinstance(poly_result, sh_geom.MultiPolygon)
-    assert len(poly_result.geoms[0].interiors) == 1  # type: ignore
+    interiors = poly_result.geoms[
+        0
+    ].interiors  # pyright: ignore[reportOptionalMemberAccess]
+    assert len(interiors) == 1
 
 
 def test_simplify_coords_lang():
     # Test LineString, lookahead -1, via coordinates
     linestring = sh_geom.LineString([(0, 0), (10, 10), (20, 20)])
     coords_simplified = geometry_util.simplify_coords_lang(
         coords=linestring.coords, tolerance=1, lookahead=-1
@@ -325,15 +328,15 @@
         geometry=multilinestring,
         algorithm=geometry_util.SimplifyAlgorithm.LANG,
         tolerance=1,
     )
     assert isinstance(geom_simplified, sh_geom.MultiLineString)
     assert len(geom_simplified.geoms) == 2
     assert len(geom_simplified.geoms[0].coords) < len(
-        multilinestring.geoms[0].coords  # type: ignore
+        multilinestring.geoms[0].coords  # pyright: ignore[reportOptionalMemberAccess]
     )
     assert len(geom_simplified.geoms[0].coords) == 2
 
     # Test Polygon simplification
     poly = sh_geom.Polygon(
         shell=[(0, 0), (0, 10), (1, 10), (10, 10), (10, 0), (0, 0)],
         holes=[[(2, 2), (2, 8), (8, 8), (8, 2), (2, 2)]],
@@ -708,23 +711,23 @@
 def test_simplify_ext_no_simplification():
     # Backup reference to simplification module
     _temp_simplification = None
     if sys.modules.get("simplification"):
         _temp_simplification = sys.modules["simplification"]
     try:
         # Fake that the module is not available
-        sys.modules["simplification"] = None  # type: ignore
+        sys.modules["simplification"] = None
 
         # Using RDP needs simplification module, so should give ImportError
         geometry_util.simplify_ext(
             geometry=sh_geom.LineString([(0, 0), (10, 10), (20, 20)]),
             algorithm=geometry_util.SimplifyAlgorithm.RAMER_DOUGLAS_PEUCKER,
             tolerance=1,
         )
-        assert True is False
+        assert False
     except ImportError:
-        assert True is True
+        assert True
     finally:
         if _temp_simplification:
             sys.modules["simplification"] = _temp_simplification
         else:
             del sys.modules["simplification"]
```

### Comparing `geofileops-0.8.0a6/tests/test_geoseries_util.py` & `geofileops-0.8.0a7/tests/test_geoseries_util.py`

 * *Files 8% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 from geofileops.util import geoseries_util
 from geofileops.util.geometry_util import GeometryType, PrimitiveType, SimplifyAlgorithm
 from tests import test_helper
 
 
 def test_get_geometrytypes():
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.Point(),
             sh_geom.LineString(),
             sh_geom.Polygon(),
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
             test_helper.TestData.polygon_with_island,
@@ -30,30 +30,30 @@
         ]
     )
     # None and empty geometries are by default ignored in get_geometrytypes
     test_geometrytypes = geoseries_util.get_geometrytypes(test_gdf.geometry)
     assert len(test_geometrytypes) == 5
 
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.Point(),
             sh_geom.LineString(),
             sh_geom.Polygon(),
             test_helper.TestData.point,
         ]
     )
     # None and empty geometries are by default ignored in get_geometrytypes
     test_geometrytypes = geoseries_util.get_geometrytypes(test_gdf.geometry)
     assert len(test_geometrytypes) == 1
     assert GeometryType.POINT in test_geometrytypes
 
     # Empty geometries are counted with ignore_empty_geometries=False.
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.Point(),
             sh_geom.LineString(),
             sh_geom.Polygon(),
             test_helper.TestData.point,
         ]
     )
@@ -71,15 +71,15 @@
     else:
         assert len(test_geometrytypes) == 2
 
 
 def test_geometry_collection_extract():
     # Test for gdf with all types of geometrytypes, extract!
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.polygon_no_islands,
             test_helper.TestData.multipolygon,
             test_helper.TestData.geometrycollection,
         ]
@@ -98,15 +98,15 @@
     for index, geom in test_result_gdf.items():
         assert geom is not None
 
 
 def test_harmonize_geometrytypes():
     # Test for gdf with None + point + multipoint -> all multipoint
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.Point(),
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
         ]
@@ -127,15 +127,15 @@
         if index in [0, 1]:
             assert geom is None
         else:
             assert geom is not None
 
     # Test for gdf with linestring + multilinestring -> all multilinestring
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.LineString(),
             test_helper.TestData.linestring,
             test_helper.TestData.multilinestring,
             test_helper.TestData.linestring,
             test_helper.TestData.multilinestring,
         ]
@@ -156,26 +156,26 @@
         if index in [0, 1]:
             assert geom is None
         else:
             assert geom is not None
 
     # Test for gdf with polygon + multipolygon -> all multipolygon
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             test_helper.TestData.polygon_with_island,
             None,
             sh_geom.Polygon(),
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.multipolygon,
         ]
     )
     test_gdf_geometrytypes = geoseries_util.get_geometrytypes(test_gdf.geometry)
     assert len(test_gdf_geometrytypes) == 2
     # Filter the gdf a bit to test that the indexes are retained properly in
-    test_gdf = test_gdf.iloc[[1, 2, 3, 4]]  # type: ignore
+    test_gdf = test_gdf.iloc[[1, 2, 3, 4]]
     test_result_gdf = test_gdf.copy()
     assert isinstance(test_result_gdf, gpd.GeoDataFrame)
     test_result_gdf.geometry = geoseries_util.harmonize_geometrytypes(
         test_result_gdf.geometry
     )
     test_result_geometrytypes = geoseries_util.get_geometrytypes(
         test_result_gdf.geometry
@@ -186,15 +186,15 @@
         if index in [1, 2]:
             assert geom is None
         else:
             assert geom is not None
 
     # Test for gdf with all types of geometrytypes -> no harmonization possible
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             None,
             sh_geom.Polygon(),
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.polygon_no_islands,
             test_helper.TestData.multipolygon,
@@ -220,15 +220,15 @@
             assert geom is not None
 
 
 def test_is_valid_reason(tmp_path):
     # Test with valid data + Empty geometry
     # -------------------------------------
     test_gdf = gpd.GeoDataFrame(
-        geometry=[  # type: ignore
+        geometry=[
             sh_geom.Polygon(),
             test_helper.TestData.point,
             test_helper.TestData.multipoint,
             test_helper.TestData.polygon_with_island,
             test_helper.TestData.polygon_no_islands,
             test_helper.TestData.multipolygon,
             test_helper.TestData.geometrycollection,
@@ -247,15 +247,15 @@
 
     assert len(result) == len(test_filtered_gdf)
     assert result.unique() == "Valid Geometry"
     assert result.index.to_list() == test_filtered_gdf.index.to_list()
 
     # Test with None
     # --------------
-    test_gdf = gpd.GeoDataFrame(geometry=[None])  # type: ignore
+    test_gdf = gpd.GeoDataFrame(geometry=[None])
     result = geoseries_util.is_valid_reason(test_gdf.geometry)
 
     # is_valid_reason returns None for None geometries
     assert result[0] is None
 
     # Test with invalid data
     # ----------------------
```

### Comparing `geofileops-0.8.0a6/tests/test_grid_util.py` & `geofileops-0.8.0a7/tests/test_grid_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_helper.py` & `geofileops-0.8.0a7/tests/test_helper.py`

 * *Files 4% similar despite different names*

```diff
@@ -45,15 +45,15 @@
     expected_gdf = gdf.copy()
 
     if gridsize != 0.0:
         expected_gdf.geometry = shapely2_or_pygeos.set_precision(
             expected_gdf.geometry.array.data, grid_size=gridsize
         )
     if explodecollections:
-        expected_gdf = expected_gdf.explode(ignore_index=True)  # type: ignore
+        expected_gdf = expected_gdf.explode(ignore_index=True)
 
     # Check what filtering is needed
     filter_area_gt = None
     if where is None or where == "":
         pass
     elif where == "ST_Area({geometrycolumn}) > 400":
         filter_area_gt = 400
@@ -139,14 +139,15 @@
 ) -> Path:
     # Prepare original filepath
     testfile_path = _data_dir / f"{testfile}.gpkg"
     if testfile_path.exists is False:
         raise ValueError(f"Invalid testfile type: {testfile}")
     if dst_dir is None:
         dst_dir = Path(tempfile.gettempdir()) / "geofileops_test_data"
+    assert isinstance(dst_dir, Path)
     dst_dir.mkdir(parents=True, exist_ok=True)
 
     # Prepare file + return
     empty_str = "_empty" if empty else ""
     prepared_path = dst_dir / f"{testfile_path.stem}_{epsg}{empty_str}{suffix}"
     dst_geofiletype = gfo.GeofileType(prepared_path)
     if prepared_path.exists():
@@ -336,16 +337,16 @@
         output_path = output_dir / "right.geojson"
         gfo.to_file(right, output_path, create_spatial_index=None)
 
     gpd_testing.assert_geodataframe_equal(
         left=left,
         right=right,
         check_dtype=check_dtype,
-        check_index_type=check_index_type,  # type: ignore
-        check_column_type=check_column_type,  # type: ignore
+        check_index_type=check_index_type,
+        check_column_type=check_column_type,
         check_frame_type=check_frame_type,
         check_like=check_like,
         check_less_precise=check_less_precise,
         check_geom_type=check_geom_type,
         check_crs=check_crs,
         normalize=normalize,
     )
```

### Comparing `geofileops-0.8.0a6/tests/test_io_util.py` & `geofileops-0.8.0a7/tests/test_io_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_layerstyles.py` & `geofileops-0.8.0a7/tests/test_layerstyles.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_ogr_sql_util.py` & `geofileops-0.8.0a7/tests/test_ogr_sql_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_parameter_helper.py` & `geofileops-0.8.0a7/tests/test_parameter_helper.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_processing_util.py` & `geofileops-0.8.0a7/tests/test_processing_util.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_spatialite.py` & `geofileops-0.8.0a7/tests/test_spatialite.py`

 * *Files identical despite different names*

### Comparing `geofileops-0.8.0a6/tests/test_sqlite_util.py` & `geofileops-0.8.0a7/tests/test_sqlite_util.py`

 * *Files identical despite different names*

